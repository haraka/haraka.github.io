{"_path":"/plugins/tls","_dir":"plugins","_draft":false,"_partial":false,"_locale":"","title":"tls - TLS support for Haraka","description":"Haraka tls plugin - TLS support for Haraka","navigation":{"title":"tls"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"tls-plugin"},"children":[{"type":"text","value":"TLS plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin enables the use of TLS (via "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"STARTTLS"}]},{"type":"text","value":") in Haraka."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For this plugin to work you must have SSL certificates installed correctly."}]},{"type":"element","tag":"h2","props":{"id":"certificate-files"},"children":[{"type":"text","value":"Certificate Files"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Defaults are shown and can be overridden in "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"config/tls.ini"}]},{"type":"text","value":"."}]},{"type":"element","tag":"pre","props":{"code":"key=tls_key.pem\ncert=tls_cert.pem\ndhparam=dhparams.pem\n","language":"ini","meta":"","className":"language-ini shiki shiki-themes github-dark github-light","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-dark:#F97583;--shiki-default:#D73A49"},"children":[{"type":"text","value":"key"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#E1E4E8;--shiki-default:#24292E"},"children":[{"type":"text","value":"=tls_key.pem\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-dark:#F97583;--shiki-default:#D73A49"},"children":[{"type":"text","value":"cert"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#E1E4E8;--shiki-default:#24292E"},"children":[{"type":"text","value":"=tls_cert.pem\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-dark:#F97583;--shiki-default:#D73A49"},"children":[{"type":"text","value":"dhparam"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#E1E4E8;--shiki-default:#24292E"},"children":[{"type":"text","value":"=dhparams.pem\n"}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"certificate-directory"},"children":[{"type":"text","value":"Certificate Directory"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If the directory "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"config/tls"}]},{"type":"text","value":" exists, each file within the directory is expected to be a PEM encoded TLS bundle. Generate the PEM bundles in The Usual Way"},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"TM"}]},{"type":"text","value":" by concatenating the key, certificate, and CA/chain certs in that order. Example:"}]},{"type":"element","tag":"pre","props":{"code":"cat example.com.key example.com.crt ca.crt > config/tls/example.com.pem\n","language":"sh","meta":"","className":"language-sh shiki shiki-themes github-dark github-light","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-dark:#B392F0;--shiki-default:#6F42C1"},"children":[{"type":"text","value":"cat"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#9ECBFF;--shiki-default:#032F62"},"children":[{"type":"text","value":" example.com.key"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#9ECBFF;--shiki-default:#032F62"},"children":[{"type":"text","value":" example.com.crt"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#9ECBFF;--shiki-default:#032F62"},"children":[{"type":"text","value":" ca.crt"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#F97583;--shiki-default:#D73A49"},"children":[{"type":"text","value":" >"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#9ECBFF;--shiki-default:#032F62"},"children":[{"type":"text","value":" config/tls/example.com.pem\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"An example "},{"type":"element","tag":"a","props":{"href":"https://acme.sh","rel":["nofollow"]},"children":[{"type":"text","value":"acme.sh"}]},{"type":"text","value":" deployment "},{"type":"element","tag":"a","props":{"href":"https://github.com/msimerson/Mail-Toaster-6/blob/master/provision/letsencrypt.sh","rel":["nofollow"]},"children":[{"type":"text","value":"script"}]},{"type":"text","value":" demonstrates how to install "},{"type":"element","tag":"a","props":{"href":"https://letsencrypt.org","rel":["nofollow"]},"children":[{"type":"text","value":"Let's Encrypt"}]},{"type":"text","value":" certificates to the Haraka "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"config/tls"}]},{"type":"text","value":"directory."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Haraka has "},{"type":"element","tag":"a","props":{"href":"https://en.wikipedia.org/wiki/Server_Name_Indication","rel":["nofollow"]},"children":[{"type":"text","value":"SNI"}]},{"type":"text","value":" support. When the remote MUA/MTA presents a servername during the TLS handshake and a TLS certificate with that Common Name matches, that certificate will be presented. If no match is found, the default certificate (see Certificate Files above) is presented."}]},{"type":"element","tag":"h2","props":{"id":"purchased-certificate"},"children":[{"type":"text","value":"Purchased Certificate"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you have a purchased certificate, append any intermediate/chained/ca-cert\nfiles to the certificate in this order:"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The CA signed SSL cert"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Any intermediate certificates"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The CA root certificate"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"See also "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/wiki/Setting-up-TLS-with-CA-certificates","rel":["nofollow"]},"children":[{"type":"text","value":"Setting Up TLS"}]}]},{"type":"element","tag":"h2","props":{"id":"self-issued-unsigned-certificate"},"children":[{"type":"text","value":"Self Issued (unsigned) Certificate"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Create a certificate and key file in the config directory with the following\ncommand:"}]},{"type":"element","tag":"pre","props":{"code":"openssl req -x509 -nodes -days 2190 -newkey rsa:2048 -keyout config/tls_key.pem -out config/tls_cert.pem\n","language":"sh","meta":"","className":"language-sh shiki shiki-themes github-dark github-light","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-dark:#B392F0;--shiki-default:#6F42C1"},"children":[{"type":"text","value":"openssl"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#9ECBFF;--shiki-default:#032F62"},"children":[{"type":"text","value":" req"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#79B8FF;--shiki-default:#005CC5"},"children":[{"type":"text","value":" -x509"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#79B8FF;--shiki-default:#005CC5"},"children":[{"type":"text","value":" -nodes"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#79B8FF;--shiki-default:#005CC5"},"children":[{"type":"text","value":" -days"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#79B8FF;--shiki-default:#005CC5"},"children":[{"type":"text","value":" 2190"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#79B8FF;--shiki-default:#005CC5"},"children":[{"type":"text","value":" -newkey"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#9ECBFF;--shiki-default:#032F62"},"children":[{"type":"text","value":" rsa:2048"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#79B8FF;--shiki-default:#005CC5"},"children":[{"type":"text","value":" -keyout"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#9ECBFF;--shiki-default:#032F62"},"children":[{"type":"text","value":" config/tls_key.pem"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#79B8FF;--shiki-default:#005CC5"},"children":[{"type":"text","value":" -out"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#9ECBFF;--shiki-default:#032F62"},"children":[{"type":"text","value":" config/tls_cert.pem\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You will be prompted to provide details of your organization. Make sure the\nCommon Name is set to your servers Fully Qualified Domain Name, which should\nbe the same as the contents of your "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"config/me"}]},{"type":"text","value":" file."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The following settings can be specified in "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"config/tls.ini"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h3","props":{"id":"key"},"children":[{"type":"text","value":"key"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Specifies an alternative location for the key file. For multiple keys, use "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"key[]="}]},{"type":"text","value":" assignment for each. Non-absolute paths are relative to the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"config/"}]},{"type":"text","value":" directory."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To configure a single key and a cert chain, located in the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"config/"}]},{"type":"text","value":"\ndirectory, use the following in "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"tls.ini"}]},{"type":"text","value":":"}]},{"type":"element","tag":"pre","props":{"code":"key=example.com.key.pem\ncert=example.com.crt-chain.pem\n","language":"ini","meta":"","className":"language-ini shiki shiki-themes github-dark github-light","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-dark:#F97583;--shiki-default:#D73A49"},"children":[{"type":"text","value":"key"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#E1E4E8;--shiki-default:#24292E"},"children":[{"type":"text","value":"=example.com.key.pem\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-dark:#F97583;--shiki-default:#D73A49"},"children":[{"type":"text","value":"cert"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#E1E4E8;--shiki-default:#24292E"},"children":[{"type":"text","value":"=example.com.crt-chain.pem\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To use multiple pairs of key and cert chain files outside of the haraka\n"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"config/"}]},{"type":"text","value":" directory, configure instead:"}]},{"type":"element","tag":"pre","props":{"code":"key[]=/etc/ssl/private/example.com.rsa.key.pem\ncert[]=/etc/ssl/private/example.com.rsa.crt-chain.pem\nkey[]=/etc/ssl/private/example.com.ecdsa.key.pem\ncert[]=/etc/ssl/private/example.com.ecdsa.crt-chain.pem\n","language":"ini","meta":"","className":"language-ini shiki shiki-themes github-dark github-light","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-dark:#E1E4E8;--shiki-default:#24292E"},"children":[{"type":"text","value":"key[]=/etc/ssl/private/example.com.rsa.key.pem\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-dark:#E1E4E8;--shiki-default:#24292E"},"children":[{"type":"text","value":"cert[]=/etc/ssl/private/example.com.rsa.crt-chain.pem\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-dark:#E1E4E8;--shiki-default:#24292E"},"children":[{"type":"text","value":"key[]=/etc/ssl/private/example.com.ecdsa.key.pem\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-dark:#E1E4E8;--shiki-default:#24292E"},"children":[{"type":"text","value":"cert[]=/etc/ssl/private/example.com.ecdsa.crt-chain.pem\n"}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"cert"},"children":[{"type":"text","value":"cert"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Specifies the location(s) for the certificate chain file. For multiple certificate chains, use "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"cert[]="}]},{"type":"text","value":" assignment for each. Non-absolute paths are relative to the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"config/"}]},{"type":"text","value":" directory. See the description of the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"key"}]},{"type":"text","value":" parameter for specific use."}]},{"type":"element","tag":"h3","props":{"id":"no_tls_hosts"},"children":[{"type":"text","value":"no_tls_hosts"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If needed, add this section to the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"config/tls.ini"}]},{"type":"text","value":" file and list any IP ranges that have broken TLS hosts. Ex:"}]},{"type":"element","tag":"pre","props":{"code":"[no_tls_hosts]\n192.168.1.3\n172.16.0.0/16\n","language":"ini","meta":"","className":"language-ini shiki shiki-themes github-dark github-light","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-dark:#B392F0;--shiki-default:#6F42C1"},"children":[{"type":"text","value":"[no_tls_hosts]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-dark:#E1E4E8;--shiki-default:#24292E"},"children":[{"type":"text","value":"192.168.1.3\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-dark:#E1E4E8;--shiki-default:#24292E"},"children":[{"type":"text","value":"172.16.0.0/16\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"a","props":{"href":"http://nodejs.org/api/tls.html","rel":["nofollow"]},"children":[{"type":"text","value":"Node.js TLS"}]},{"type":"text","value":" page has additional information about the following options."}]},{"type":"element","tag":"h3","props":{"id":"no_starttls_ports"},"children":[{"type":"text","value":"no_starttls_ports"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"An array of incoming ports on which Haraka will not advertise STARTTLS capability."}]},{"type":"element","tag":"pre","props":{"code":"no_starttls_ports[]=2525\n","language":"ini","meta":"","className":"language-ini shiki shiki-themes github-dark github-light","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-dark:#E1E4E8;--shiki-default:#24292E"},"children":[{"type":"text","value":"no_starttls_ports[]=2525\n"}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"force_tls_hosts"},"children":[{"type":"text","value":"force_tls_hosts"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For known good TLS hosts, it's possible to force that the outbound mailer will only connect via secure sockets. This makes Haraka use "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"forced TLS"}]},{"type":"text","value":" instead of "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"opportunistic TLS"}]},{"type":"text","value":". For forced TLS, the STARTTLS upgrade must succeed with a valid certificate (overriding "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"rejectUnauthorized"}]},{"type":"text","value":"). The list is matched both against the host (MX record or "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"nexthop"}]},{"type":"text","value":" in "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"relay_dest_domains.ini"}]},{"type":"text","value":"), and the domain name of the email address."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Note: unlike "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"no_tls_hosts"}]},{"type":"text","value":", this feature is implemented as an array:"}]},{"type":"element","tag":"pre","props":{"code":"[outbound]\nforce_tls_hosts[]=172.17.123.1\nforce_tls_hosts[]=172.17.124.0/24\nforce_tls_hosts[]=mx.example.org\nforce_tls_hosts[]=example.com\n","language":"ini","meta":"","className":"language-ini shiki shiki-themes github-dark github-light","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-dark:#B392F0;--shiki-default:#6F42C1"},"children":[{"type":"text","value":"[outbound]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-dark:#E1E4E8;--shiki-default:#24292E"},"children":[{"type":"text","value":"force_tls_hosts[]=172.17.123.1\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-dark:#E1E4E8;--shiki-default:#24292E"},"children":[{"type":"text","value":"force_tls_hosts[]=172.17.124.0/24\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-dark:#E1E4E8;--shiki-default:#24292E"},"children":[{"type":"text","value":"force_tls_hosts[]=mx.example.org\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-dark:#E1E4E8;--shiki-default:#24292E"},"children":[{"type":"text","value":"force_tls_hosts[]=example.com\n"}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"ciphers"},"children":[{"type":"text","value":"ciphers"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A list of allowable ciphers to use. Example:"}]},{"type":"element","tag":"pre","props":{"code":"ciphers=EECDH+AESGCM:EDH+aRSA+AESGCM:EECDH+AES256:EDH+aRSA+AES256:EECDH+AES128:EDH+aRSA+AES128:RSA+AES:RSA+3DES\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"ciphers=EECDH+AESGCM:EDH+aRSA+AESGCM:EECDH+AES256:EDH+aRSA+AES256:EECDH+AES128:EDH+aRSA+AES128:RSA+AES:RSA+3DES\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"See also: "},{"type":"element","tag":"a","props":{"href":"https://ssl-config.mozilla.org/","rel":["nofollow"]},"children":[{"type":"text","value":"Mozilla SSL configuration generator"}]},{"type":"text","value":" and the "},{"type":"element","tag":"a","props":{"href":"https://www.ssllabs.com/ssltest/index.html","rel":["nofollow"]},"children":[{"type":"text","value":"SSLlabs Test Page"}]}]},{"type":"element","tag":"h3","props":{"id":"minversion"},"children":[{"type":"text","value":"minVersion"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Specifies minimum allowable TLS protocol version to use. Example:"}]},{"type":"element","tag":"pre","props":{"code":" minVersion=TLSv1.1 \n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":" minVersion=TLSv1.1 \n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If unset, the default is node's tls.DEFAULT_MIN_VERSION constant."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"("},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Node.js 11.4+ required"}]},{"type":"text","value":", for older instances you can use "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"secureProtocol"}]},{"type":"text","value":" settings)"}]},{"type":"element","tag":"h3","props":{"id":"honorcipherorder"},"children":[{"type":"text","value":"honorCipherOrder"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If specified, the list of configured ciphers is treated as the cipher priority from highest to lowest. The first matching cipher will be used, instead of letting the client choose. The default is "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"true"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h3","props":{"id":"ecdhcurve"},"children":[{"type":"text","value":"ecdhCurve"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Specifies the elliptic curve used for ECDH or ECDHE ciphers.\nOnly one curve can be specified. The default is "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"prime256v1"}]},{"type":"text","value":" (NIST P-256)."}]},{"type":"element","tag":"h3","props":{"id":"dhparam"},"children":[{"type":"text","value":"dhparam"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Specifies the file containing the diffie-hellman parameters to use for DH or DHE key exchange. If this param or file is missing, it will be generated automatically. Default: "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"dhparams.pem"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h3","props":{"id":"requestcert"},"children":[{"type":"text","value":"requestCert"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Whether Haraka should request a certificate from a connecting client."}]},{"type":"element","tag":"pre","props":{"code":"requestCert=[true|false]  (default: true)\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"requestCert=[true|false]  (default: true)\n"}]}]},{"type":"element","tag":"h3","props":{"id":"rejectunauthorized"},"children":[{"type":"text","value":"rejectUnauthorized"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Reject connections from clients without a CA validated TLS certificate."}]},{"type":"element","tag":"pre","props":{"code":"rejectUnauthorized=[true|false]  (default: false)\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"rejectUnauthorized=[true|false]  (default: false)\n"}]}]},{"type":"element","tag":"h3","props":{"id":"requireauthorized"},"children":[{"type":"text","value":"requireAuthorized"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"rejectUnauthorized=false"}]},{"type":"text","value":", require validated TLS certificates on just the specified ports."}]},{"type":"element","tag":"pre","props":{"code":"requireAuthorized[]=465;\nrequireAuthorized[]=587;\n","language":"ini","meta":"","className":"language-ini shiki shiki-themes github-dark github-light","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-dark:#E1E4E8;--shiki-default:#24292E"},"children":[{"type":"text","value":"requireAuthorized[]=465"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#6A737D;--shiki-default:#6A737D"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-dark:#E1E4E8;--shiki-default:#24292E"},"children":[{"type":"text","value":"requireAuthorized[]=587"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#6A737D;--shiki-default:#6A737D"},"children":[{"type":"text","value":";\n"}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"secureprotocol"},"children":[{"type":"text","value":"secureProtocol"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Specifies the OpenSSL API function used for handling the TLS session. Choose\none of the methods described at the\n"},{"type":"element","tag":"a","props":{"href":"https://www.openssl.org/docs/manmaster/ssl/ssl.html","rel":["nofollow"]},"children":[{"type":"text","value":"OpenSSL API page"}]},{"type":"text","value":".\nThe default is "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"SSLv23_method"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h3","props":{"id":"requestocsp"},"children":[{"type":"text","value":"requestOCSP"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Specifies that OCSP Stapling should be enabled, according to RFC 6066.\nStapling of OCSP messages allows the client to receive these along the\nTLS session setup instead of delaying the session setup by requiring a\nseparate http connection to the OCSP server."}]},{"type":"element","tag":"pre","props":{"code":"requestOCSP=[true|false]  (default: false)\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"requestOCSP=[true|false]  (default: false)\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"OCSP responses from the OCSP server are cached in memory for as long as\nthey are valid, and get refreshed after that time. A server restart\nrequires the OCSP responses to be fetched again upon the first client\nconnection."}]},{"type":"element","tag":"h2","props":{"id":"inbound-specific-configuration"},"children":[{"type":"text","value":"Inbound Specific Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"By default the above options are shared with outbound mail (either\nusing "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"smtp_forward"}]},{"type":"text","value":", "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"smtp_proxy"}]},{"type":"text","value":" or plain outbound mail heading to\nan external destination). To make these options specific to inbound\nmail, put them under an "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"[inbound]"}]},{"type":"text","value":" parameter group. Outbound options\ncan go under an "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"[outbound]"}]},{"type":"text","value":" parameter group, and plugins that use\nSMTP tls for queueing such as "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"smtp_proxy"}]},{"type":"text","value":" and "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"smtp_forward"}]},{"type":"text","value":" can\nuse that plugin name for plugin specific options."}]},{"type":"element","tag":"h2","props":{"id":"redis-section"},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"[redis]"}]},{"type":"text","value":" section"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This section is mainly used to enable so called "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"TLS NO-GO"}]},{"type":"text","value":" feature that essentially stops advertising/using TLS if there was a problem setting it up previously. We use "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"no_tls|ip.add.re.ss"}]},{"type":"text","value":" key to store the flag in redis. There are a couple of settings that control the behavior:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"disable_for_failed_hosts = true"}]},{"type":"text","value":" to enable the feature"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"disable_expiry = 604800"}]},{"type":"text","value":" to set for how long we disable TLS for failing host, in seconds"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"disable_inbound_expiry = 3600"}]},{"type":"text","value":" same as above, but applies to inbound (aka STARTTLS capability) only"}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"certificate-files","depth":2,"text":"Certificate Files"},{"id":"certificate-directory","depth":2,"text":"Certificate Directory"},{"id":"purchased-certificate","depth":2,"text":"Purchased Certificate"},{"id":"self-issued-unsigned-certificate","depth":2,"text":"Self Issued (unsigned) Certificate"},{"id":"configuration","depth":2,"text":"Configuration","children":[{"id":"key","depth":3,"text":"key"},{"id":"cert","depth":3,"text":"cert"},{"id":"no_tls_hosts","depth":3,"text":"no_tls_hosts"},{"id":"no_starttls_ports","depth":3,"text":"no_starttls_ports"},{"id":"force_tls_hosts","depth":3,"text":"force_tls_hosts"},{"id":"ciphers","depth":3,"text":"ciphers"},{"id":"minversion","depth":3,"text":"minVersion"},{"id":"honorcipherorder","depth":3,"text":"honorCipherOrder"},{"id":"ecdhcurve","depth":3,"text":"ecdhCurve"},{"id":"dhparam","depth":3,"text":"dhparam"},{"id":"requestcert","depth":3,"text":"requestCert"},{"id":"rejectunauthorized","depth":3,"text":"rejectUnauthorized"},{"id":"requireauthorized","depth":3,"text":"requireAuthorized"},{"id":"secureprotocol","depth":3,"text":"secureProtocol"},{"id":"requestocsp","depth":3,"text":"requestOCSP"}]},{"id":"inbound-specific-configuration","depth":2,"text":"Inbound Specific Configuration"},{"id":"redis-section","depth":2,"text":"[redis] section"}]}},"_type":"markdown","_id":"content:8.plugins:tls.md","_source":"content","_file":"8.plugins/tls.md","_stem":"8.plugins/tls","_extension":"md"}