{"_path":"/plugins/dns-list","_dir":"plugins","_draft":false,"_partial":false,"_locale":"","title":"dns-list - DNS Blacklists plugin for Haraka","description":"Haraka dns lists plugin - DNS Blacklists","navigation":{"title":"dns-list"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"haraka-plugin-dns-list"},"children":[{"type":"text","value":"haraka-plugin-dns-list"}]},{"type":"element","tag":"h2","props":{"id":"dns-lists"},"children":[{"type":"text","value":"dns lists"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Looks up the IP address of the remote host in DNS lists. There are several types of DNS based lists:"}]},{"type":"element","tag":"h3","props":{"id":"block"},"children":[{"type":"text","value":"block"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Block lists (aka: DNSBL) are designed to be used for blocking mail from any host listed in them. Block lists are the most common DNS list type and lists without a type specified are considered block lists. The default action for block lists is to reject the connection. This can be changed by setting "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"reject=false"}]},{"type":"text","value":" in the zone's settings block."}]},{"type":"element","tag":"h3","props":{"id":"allow"},"children":[{"type":"text","value":"allow"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When the remote IP is found in an allow list, this plugin returns OK for the ehlo, helo, and mail hooks."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"IMPORTANT! The order of plugins in config/plugins is important when this feature is used. It should be listed "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"before"}]},{"type":"text","value":" any plugins that you wish to skip, but after any plugins that accept recipients."}]},{"type":"element","tag":"h3","props":{"id":"karma"},"children":[{"type":"text","value":"karma"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Karma lists can have different results for IPs beyond a simple block or allow. See "},{"type":"element","tag":"a","props":{"href":"https://hostkarma.junkemailfilter.com","rel":["nofollow"]},"children":[{"type":"text","value":"hostkarma.junkemailfilter.com"}]},{"type":"text","value":" for details."}]},{"type":"element","tag":"h2","props":{"id":"install"},"children":[{"type":"text","value":"INSTALL"}]},{"type":"element","tag":"pre","props":{"code":"cd /path/to/local/haraka\nnpm install haraka-plugin-dns-list\necho \"dns-list\" >> config/plugins\nservice haraka restart\n","language":"sh","meta":"","className":"language-sh shiki shiki-themes github-dark github-light","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-dark:#79B8FF;--shiki-default:#005CC5"},"children":[{"type":"text","value":"cd"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#9ECBFF;--shiki-default:#032F62"},"children":[{"type":"text","value":" /path/to/local/haraka\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-dark:#B392F0;--shiki-default:#6F42C1"},"children":[{"type":"text","value":"npm"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#9ECBFF;--shiki-default:#032F62"},"children":[{"type":"text","value":" install"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#9ECBFF;--shiki-default:#032F62"},"children":[{"type":"text","value":" haraka-plugin-dns-list\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-dark:#79B8FF;--shiki-default:#005CC5"},"children":[{"type":"text","value":"echo"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#9ECBFF;--shiki-default:#032F62"},"children":[{"type":"text","value":" \"dns-list\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#F97583;--shiki-default:#D73A49"},"children":[{"type":"text","value":" >>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#9ECBFF;--shiki-default:#032F62"},"children":[{"type":"text","value":" config/plugins\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-dark:#B392F0;--shiki-default:#6F42C1"},"children":[{"type":"text","value":"service"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#9ECBFF;--shiki-default:#032F62"},"children":[{"type":"text","value":" haraka"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#9ECBFF;--shiki-default:#032F62"},"children":[{"type":"text","value":" restart\n"}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"configure"},"children":[{"type":"text","value":"Configure"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If the default configuration is insufficient, copy the config file from the distribution into your haraka config dir and modify it:"}]},{"type":"element","tag":"pre","props":{"code":"cp node_modules/haraka-plugin-dns-list/config/dns-list.ini config/dns-list.ini\n$EDITOR config/dns-list.ini\n","language":"sh","meta":"","className":"language-sh shiki shiki-themes github-dark github-light","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-dark:#B392F0;--shiki-default:#6F42C1"},"children":[{"type":"text","value":"cp"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#9ECBFF;--shiki-default:#032F62"},"children":[{"type":"text","value":" node_modules/haraka-plugin-dns-list/config/dns-list.ini"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#9ECBFF;--shiki-default:#032F62"},"children":[{"type":"text","value":" config/dns-list.ini\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-dark:#E1E4E8;--shiki-default:#24292E"},"children":[{"type":"text","value":"$EDITOR config/dns-list.ini\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"dns-lists.ini - INI format with options described below:"}]},{"type":"element","tag":"h4","props":{"id":"main-periodic_checks30"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"main"}]},{"type":"text","value":" periodic_checks=30"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Check every DNS zone every "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"N"}]},{"type":"text","value":" minutes. When the value is less than 5, checks will only be run at start-up."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The checks confirm that lists are responding correctly. When errors are detected, the zone is disabled and will be checked at the next interval. When a zone resumes working correctly it will be enabled."}]},{"type":"element","tag":"h4","props":{"id":"main-zones"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"main"}]},{"type":"text","value":" zones"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"An array or comma separated list of zones to query."}]},{"type":"element","tag":"h4","props":{"id":"main-search-default-all"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"main"}]},{"type":"text","value":" search: (default: all)"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"first: consider first DNS list response conclusive. End processing."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"all: process all DNS list results"}]}]},{"type":"element","tag":"h4","props":{"id":"stats-enabletrue"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"stats"}]},{"type":"text","value":" enable=true"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This feature requires the "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-redis","rel":["nofollow"]},"children":[{"type":"text","value":"redis"}]},{"type":"text","value":" plugin. When enabled, this will record several list statistics to redis:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"the total number of queries (TOTAL)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"the average response time (AVG_RT)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"the return type (e.g. LISTED or ERROR)"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"to a redis hash where the key is "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"dns-list-stat:zone"}]},{"type":"text","value":" and the hash field is the response type."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It will also track the positive response overlap between the lists in another redis hash where the key is "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"dns-list-overlap:zone"}]},{"type":"text","value":" and the hash field is the other list names. Example:"}]},{"type":"element","tag":"pre","props":{"code":"redis 127.0.0.1:6379> hgetall dns-list-stat:zen.spamhaus.org\n1) \"TOTAL\"\n2) \"23\"\n3) \"ENOTFOUND\"\n4) \"11\"\n5) \"LISTED\"\n6) \"12\"\n7) \"AVG_RT\"\n8) \"45.5\"\n\nredis 127.0.0.1:6379> hgetall dns-list-overlap:zen.spamhaus.org\n1) \"b.barracudacentral.org\"\n2) \"1\"\n3) \"bl.spamcop.net\"\n4) \"1\"\n5) \"TOTAL\"\n6) \"1\"\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"redis 127.0.0.1:6379> hgetall dns-list-stat:zen.spamhaus.org\n1) \"TOTAL\"\n2) \"23\"\n3) \"ENOTFOUND\"\n4) \"11\"\n5) \"LISTED\"\n6) \"12\"\n7) \"AVG_RT\"\n8) \"45.5\"\n\nredis 127.0.0.1:6379> hgetall dns-list-overlap:zen.spamhaus.org\n1) \"b.barracudacentral.org\"\n2) \"1\"\n3) \"bl.spamcop.net\"\n4) \"1\"\n5) \"TOTAL\"\n6) \"1\"\n"}]}]},{"type":"element","tag":"h4","props":{"id":"stats-redis_host"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"stats"}]},{"type":"text","value":" redis_host"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In the form of "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"host:port"}]},{"type":"text","value":" this option allows you to specify a different host on which redis runs."}]},{"type":"element","tag":"h3","props":{"id":"per-zone-dns-list-settings"},"children":[{"type":"text","value":"Per-Zone DNS list settings"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The exact name of the DNS zone (as specified above in main.zones) may contain settings about that DNS list."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"type="},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":" block, allow, karma"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"reject=true (default: true) Reject connections from IPs on block lists. Setting this to false makes dnsbl informational. reject=false is best used in conjunction with plugins like "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-karma","rel":["nofollow"]},"children":[{"type":"text","value":"karma"}]},{"type":"text","value":" that employ a scoring engine to make choices about message delivery."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"ipv6=true | false"}]}]},{"type":"element","tag":"h4","props":{"id":"dnswl"},"children":[{"type":"text","value":"dnswl"}]},{"type":"element","tag":"pre","props":{"code":"ok_helo=false\nok_mail=false\n","language":"ini","meta":"","className":"language-ini shiki shiki-themes github-dark github-light","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-dark:#F97583;--shiki-default:#D73A49"},"children":[{"type":"text","value":"ok_helo"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#E1E4E8;--shiki-default:#24292E"},"children":[{"type":"text","value":"=false\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-dark:#F97583;--shiki-default:#D73A49"},"children":[{"type":"text","value":"ok_mail"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#E1E4E8;--shiki-default:#24292E"},"children":[{"type":"text","value":"=false\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"if DNSBL returns OK on the mail hook, it prevents any subsequent mail hooks in other plugins from running. This might include "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-spf","rel":["nofollow"]},"children":[{"type":"text","value":"SPF"}]},{"type":"text","value":", "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-known-senders","rel":["nofollow"]},"children":[{"type":"text","value":"known senders"}]},{"type":"text","value":", "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-karma","rel":["nofollow"]},"children":[{"type":"text","value":"karma"}]},{"type":"text","value":", recipient plugins, and any other plugins that want to do transaction initialization on "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"hook_mail"}]},{"type":"text","value":". It can be dangerous."}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"dns-lists","depth":2,"text":"dns lists","children":[{"id":"block","depth":3,"text":"block"},{"id":"allow","depth":3,"text":"allow"},{"id":"karma","depth":3,"text":"karma"}]},{"id":"install","depth":2,"text":"INSTALL"},{"id":"configure","depth":2,"text":"Configure","children":[{"id":"per-zone-dns-list-settings","depth":3,"text":"Per-Zone DNS list settings"}]}]}},"_type":"markdown","_id":"content:8.plugins:dns-list.md","_source":"content","_file":"8.plugins/dns-list.md","_stem":"8.plugins/dns-list","_extension":"md"}