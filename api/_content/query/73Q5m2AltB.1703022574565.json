{"_path":"/plugins/clamd","_dir":"plugins","_draft":false,"_partial":false,"_locale":"","title":"clamd - ClamAV plugin for Haraka","description":"Haraka clamd plugin - ClamAV anti-virus plugin","navigation":{"title":"clamd"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"clamd-plugin"},"children":[{"type":"text","value":"clamd plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plug-in implements Anti-Virus scanning with ClamAV using the "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"clamd"}]},{"type":"text","value":"\ndaemon."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The plug-in will reject any message that ClamAV considers to be a virus.\nIf an error occurs (e.g. clamd not running or a timeout), the\nmessage will be deferred with a temporary failure."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The following options can be defined in clamd.ini;"}]},{"type":"element","tag":"h3","props":{"id":"clamd_socket-default-localhost3310"},"children":[{"type":"text","value":"clamd_socket (default: localhost:3310)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"N.N.N.N:port, "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"ipv6::literal"}]},{"type":"text","value":":port, host:port or /path/to/socket of\nthe clamd daemon."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Multiple hosts can be listed separated by comma, semi-colon or spaces."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If "},{"type":"element","tag":"port","props":{},"children":[]},{"type":"text","value":" is omitted it defaults to 3310."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"On connection error or timeout the next host in the list will be tried.\nWhen the host list is exhausted, the message will be deferred with\na temporary failure."}]},{"type":"element","tag":"h3","props":{"id":"randomize_host_order-default-false"},"children":[{"type":"text","value":"randomize_host_order (default: false)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If this is set then the list of hosts with be randomized before a\nconnection is attempted."}]},{"type":"element","tag":"h3","props":{"id":"only_with_attachments-default-false"},"children":[{"type":"text","value":"only_with_attachments                         (default: false)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Set this option to only scan messages that contain non-textual\nattachments.  This is a performance optimization, however it will\nprevent ClamAV from detecting threats such as Phishing in plain-text\nor HTML messages."}]},{"type":"element","tag":"h3","props":{"id":"connect_timeout-default-10"},"children":[{"type":"text","value":"connect_timeout                               (default: 10)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Timeout connection to host after this many seconds.  A timeout will\ncause the next host in the list to be tried.  Once all hosts have\nbeen tried then a temporary failure will be returned."}]},{"type":"element","tag":"h3","props":{"id":"timeout-default-30"},"children":[{"type":"text","value":"timeout                                       (default: 30)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Post-connection timeout if there is no activity on the socket after\nthis many seconds.  A timeout will cause the message to be rejected\nwith a tempoary failure."}]},{"type":"element","tag":"h3","props":{"id":"max_size-default-26214400"},"children":[{"type":"text","value":"max_size                                      (default: 26214400)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The maximum size of message that should be sent to clamd in bytes.\nThis option should not be larger than the StreamMaxLength value in\nclamd.conf as clamd will stop scanning once this limit is reached.\nIf the clamd limit is reached the plug-in will log a notice that\nthis has happened and will allow the message though."}]},{"type":"element","tag":"h3","props":{"id":"reject"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"reject"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"An optional reject section can offer control over when to reject connections.\nThe default settings are shown. ClamAV recommends that hits coming from\nSafeBrowsing / Phishing / Heuristics, Potentially Unwanted Applications, and\nUNOFFICIAL be used only for scoring."}]},{"type":"element","tag":"pre","props":{"code":"* virus=true\n* error=true\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"* virus=true\n* error=true\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The following reject options are disabled by default in clamd.conf. With a\ndefault ClamAV install, these will have no effect. When an admin enables in\nclamd.conf, Haraka with then, by default, reject such messages. Adjust these\nsettings to suit."}]},{"type":"element","tag":"pre","props":{"code":"* Broken.Executable=true\n* Structured=true\n* Encrypted=true\n* PUA=true\n* OLE2=true\n* Safebrowsing=true\n* UNOFFICIAL=true\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"* Broken.Executable=true\n* Structured=true\n* Encrypted=true\n* PUA=true\n* OLE2=true\n* Safebrowsing=true\n* UNOFFICIAL=true\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The following options are enabled by default in clamd but ClamAV suggests\nusing them only for scoring."}]},{"type":"element","tag":"pre","props":{"code":"* Phishing=false\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"* Phishing=false\n"}]}]},{"type":"element","tag":"h2","props":{"id":"check"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"check"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The optional check section can allow skipping ClamAV check for remote connection\nmeeting following criteria."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"authenticated"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: true"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If true, messages from authenticated users will be scanned."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"private_ip"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: true"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If true, messages from private IPs will be scanned."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"local_ip"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: true"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If true, messages from localhost will be scanned."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"relay"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: true"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If true, messages that are to be relayed will be scanned."}]}]},{"type":"element","tag":"h2","props":{"id":"clamdexcludes"},"children":[{"type":"text","value":"clamd.excludes"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This file can contain a list of virus name patterns that when matched, are\nnot rejected by this plugin. An X-Haraka-Virus: header will be inserted\ncontaining the virus name. This header can then be used for scoring\nin other plugins."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The format of the file is one pattern per line. Comments are prefixed\nwith #. Matches are case-insensitive."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Patterns are expressed using wildcards (e.g. * and ?) or\nvia regexp by enclosing the pattern in //."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To negate a match (e.g. reject if it matches), prefix the match with !.\nNegative matches are always tested fist."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Example:"}]},{"type":"element","tag":"pre","props":{"code":"# Always reject test signatures\n!*.TestSig_*\n# Skip all unofficial signatures\n*.UNOFFICIAL\n# Phishing\nHeuristics.Phishing.*\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"# Always reject test signatures\n!*.TestSig_*\n# Skip all unofficial signatures\n*.UNOFFICIAL\n# Phishing\nHeuristics.Phishing.*\n"}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"configuration","depth":2,"text":"Configuration","children":[{"id":"clamd_socket-default-localhost3310","depth":3,"text":"clamd_socket (default: localhost:3310)"},{"id":"randomize_host_order-default-false","depth":3,"text":"randomize_host_order (default: false)"},{"id":"only_with_attachments-default-false","depth":3,"text":"only_with_attachments                         (default: false)"},{"id":"connect_timeout-default-10","depth":3,"text":"connect_timeout                               (default: 10)"},{"id":"timeout-default-30","depth":3,"text":"timeout                                       (default: 30)"},{"id":"max_size-default-26214400","depth":3,"text":"max_size                                      (default: 26214400)"},{"id":"reject","depth":3,"text":"reject"}]},{"id":"check","depth":2,"text":"check"},{"id":"clamdexcludes","depth":2,"text":"clamd.excludes"}]}},"_type":"markdown","_id":"content:8.plugins:clamd.md","_source":"content","_file":"8.plugins/clamd.md","_extension":"md"}