{"_path":"/tutorials/settingupoutbound","_dir":"tutorials","_draft":false,"_partial":false,"_locale":"","_empty":false,"title":"Configuring Haraka For Outbound Email","description":"It is trivially easy to configure Haraka as an outbound email server. But\nfirst there are external things you may want to sort out:","navigation":{"title":"Configuring Outbound"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"configuring-outbound-email"},"children":[{"type":"text","value":"Configuring Outbound Email"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It is trivially easy to configure Haraka as an outbound email server. But\nfirst there are external things you may want to sort out:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Get your DNS PTR record working - make sure it matches the A record of the\nhost you are sending from."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Consider implementing an SPF record. I don't personally do this, but some\npeople seem to think it helps."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"There's lots of information elsewhere on the internet about getting these\nthings working, and they are specific to your network and your DNS hosting."}]},{"type":"element","tag":"h2","props":{"id":"first-some-background"},"children":[{"type":"text","value":"First Some Background"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Sending outbound mail through Haraka is called \"relaying\", and that is the\nterm the internals use. The process is simple - if a plugin in Haraka tells\nthe internals that this mail is to be relayed, then it gets queued in the\n\"queue\" directory for delivery. Then it will go through several delivery\nattempts until it is either successful or fails hard for some reason. A\nhard failure will result in a bounce email being sent to the \"MAIL FROM\"\naddress used when connecting to Haraka. If that address also bounces then\nit is considered a \"double bounce\" and Haraka will log an error and drop it\non the floor."}]},{"type":"element","tag":"h2","props":{"id":"the-setup"},"children":[{"type":"text","value":"The Setup"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Outbound mail servers should run on port 587 and enforce authentication. This\nis slightly different from the \"old\" model where there would simply be a\ncheck based on the connecting IP address to see if it was valid to relay.\nNote however that Haraka doesn't stop you doing it this way - we just don't\nprovide a plugin to do that by default - you will have to write one. The\nreason is purely based on security and personal preference."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Let's create a new Haraka instance:"}]},{"type":"element","tag":"code","props":{"code":"haraka -i haraka-outbound\ncd haraka-outbound\n","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"haraka -i haraka-outbound\ncd haraka-outbound"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now edit config/smtp.ini - change the port to 587."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Next we setup our plugins - all we need is the tls and auth plugin. AUTH capability is only advertised after TLS/SSL negotiation (except for connections from the local host):"}]},{"type":"element","tag":"code","props":{"code":"echo \"tls\nauth/flat_file\" > config/plugins\n","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"echo \"tls\nauth/flat_file\" > config/plugins"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now edit the flat file password file, and put in an appropriate username\nand password:"}]},{"type":"element","tag":"code","props":{"code":"vi config/auth_flat_file.ini\n","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"vi config/auth_flat_file.ini"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"See the documentation in docs/plugins/auth/flat_file.md for information about\nwhat can go in that file."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now you can start Haraka. That's all the configuration you need."}]},{"type":"element","tag":"code","props":{"code":"haraka -c .\n","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"haraka -c ."}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now in another window you can run swaks to test this - be sure to substitute\nan email address you can monitor in place of "},{"type":"element","tag":"a","props":{"href":"mailto:youremail@yourdomain.com"},"children":[{"type":"text","value":"youremail@yourdomain.com"}]},{"type":"text","value":", and the\nusername and password you added for the --auth-user and --auth-password params:"}]},{"type":"element","tag":"code","props":{"code":"swaks --to youremail@yourdomain.com --from test@example.com --server localhost \\\n  --port 587 --auth-user testuser --auth-password testpassword\n","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"swaks --to youremail@yourdomain.com --from test@example.com --server localhost \\\n  --port 587 --auth-user testuser --auth-password testpassword"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Watch the output of swaks and ensure no errors have occurred. Then watch\nthe recipient email address (easiest to make this your webmail account) and\nsee that the email arrived."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You are done!"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"first-some-background","depth":2,"text":"First Some Background"},{"id":"the-setup","depth":2,"text":"The Setup"}]}},"_type":"markdown","_id":"content:7.tutorials:SettingUpOutbound.md","_source":"content","_file":"7.tutorials/SettingUpOutbound.md","_extension":"md"}