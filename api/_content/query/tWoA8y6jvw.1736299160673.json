{"_path":"/plugins/spamassassin","_dir":"plugins","_draft":false,"_partial":false,"_locale":"","title":"spamassassin - SpamAssassin integration for Haraka","description":"Haraka spamassassin plugin - SpamAssassin integration for Haraka","navigation":{"title":"spamassassin"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"spamassassin-plugin"},"children":[{"type":"text","value":"SpamAssassin plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin implements the spamd protocol and will send messages to\nspamd for scoring."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"spamassassin.ini"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"spamd_socket = [host:port | /path/to/socket]  "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"optional"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: localhost:783"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Host or path to socket where spamd is running."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"spamd_user = [user]   "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"optional"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: default"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Username to pass to spamd.  This is useful when you are running\nspamd with virtual users."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"You can also pass this value in dynamically by setting:"},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"connection.transaction.notes.spamd_user"}]},{"type":"text","value":" in another plugin."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The special username: "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"first-recipient"}]},{"type":"text","value":". The first envelope recipient\nwill be used as the username."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"the special username "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"all-recipients"}]},{"type":"text","value":" may eventually be supported. See\nthe get_spamd_username function in the plugin."}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"max_size = N  "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"optional"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: 500000"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Maximum size of messages (in bytes) to send to spamd.\nMessages over this size will be skipped."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"reject_threshold = N   "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"optional"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: none (do not reject any mail)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"SpamAssassin score at which the mail should be rejected."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"relay_reject_threshold = N  "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"optional"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: none"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"As above, except this threshold only applies to connections\nthat are relays (e.g. AUTH) where connection.relaying = true.\nThis is used to set a "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"lower"}]},{"type":"text","value":" thresold at which to reject mail\nfrom these hosts to prevent sending outbound spam."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If this is not set, then the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"reject_thresold"}]},{"type":"text","value":" value is used."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"munge_subject_threshold = N  "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"optional"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: none (do not munge the subject)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Score at which the subject should be munged (prefixed)."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"subject_prefix = [prefix]   "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"optional"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: *** SPAM ***"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Prefix to use when munging the subject."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"old_headers_action = [rename | drop | keep]   "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"optional"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: rename"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If old X-Spam-* headers are in the email, what do we do with them?"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"rename"}]},{"type":"text","value":" them to X-Old-Spam-*."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"drop"}]},{"type":"text","value":" will delete them."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"keep"}]},{"type":"text","value":" will keep them (new X-Spam-* headers appear lower down in\nthe headers then)."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connect_timeout = N  "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"optional"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: 30"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Time in seconds to wait for a connection to spamd"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"results_timeout = N  "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"optional"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: 300"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Time in seconds to wait for results from spamd"}]}]},{"type":"element","tag":"h1","props":{"id":"check"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"check"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The optional check section can allow skipping SpamAssassin check for remote connection\nmeeting following criteria."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"authenticated"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: true"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If true, messages from authenticated users will be scored."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"private_ip"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: true"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If true, messages from private IPs will be scored."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"local_ip"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: true"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If true, messages from localhost will be scored."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"relay"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: true"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If true, messages that are to be relayed will be scored."}]}]},{"type":"element","tag":"h1","props":{"id":"defer"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"defer"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The optional defer section can allow returning a DENYSOFT status back to the\nclient.  Setting these to true will force the client to retry later in cases where\nspamassassin is not responding properly.  If set to false, then the errors\nwill be ignored and message processing will continue."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"error"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: false"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If true, return DENYSOFT on socket errors"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connect_timeout"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: false"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If true, return DENYSOFT on socket connection timeouts"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"scan_timeout"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: false"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If true, return DENYSOFT on scan timeouts"}]}]},{"type":"element","tag":"h1","props":{"id":"extras"},"children":[{"type":"text","value":"Extras"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A SpamAssassin plugin can be found in the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"contrib"}]},{"type":"text","value":" directory.\nThe "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Haraka.\\[pm|cf\\]"}]},{"type":"text","value":" files should be placed in the SpamAssassin local\nsite rules directory (/etc/mail/spamassassin on Linux), spamd should be\nrestarted and the plugin will make spamd output the Haraka UUID as part\nof its log output to aid debugging when searching the mail logs."}]},{"type":"element","tag":"h2","props":{"id":"changes"},"children":[{"type":"text","value":"Changes"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin now passes the X-Spam-* headers generated by SA through\nunaltered. You can control the presence and appearance of X-Spam-*\nheaders by editing your SpamAssassin config."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The default headers added by SpamAssassin are:"}]},{"type":"element","tag":"pre","props":{"code":"add_header all Checker-Version SpamAssassin _VERSION_ (_SUBVERSION_) on _HOSTNAME_\nadd_header spam Flag _YESNOCAPS_\nadd_header all Level _STARS(\\*)_\nadd_header all Status \"_YESNO_, score=_SCORE_ required=_REQD_ tests=_TESTS_ autolearn=_AUTOLEARN_ version=_VERSION_\"\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"add_header all Checker-Version SpamAssassin _VERSION_ (_SUBVERSION_) on _HOSTNAME_\nadd_header spam Flag _YESNOCAPS_\nadd_header all Level _STARS(\\*)_\nadd_header all Status \"_YESNO_, score=_SCORE_ required=_REQD_ tests=_TESTS_ autolearn=_AUTOLEARN_ version=_VERSION_\"\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Other headers options you might find interesting or useful are:"}]},{"type":"element","tag":"pre","props":{"code":"add_header all DCC _DCCB_: _DCCR_\nadd_header all Tests _TESTS_\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"add_header all DCC _DCCB_: _DCCR_\nadd_header all Tests _TESTS_\n"}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"configuration","depth":2,"text":"Configuration"},{"id":"changes","depth":2,"text":"Changes"}]}},"_type":"markdown","_id":"content:8.plugins:spamassassin.md","_source":"content","_file":"8.plugins/spamassassin.md","_stem":"8.plugins/spamassassin","_extension":"md"}