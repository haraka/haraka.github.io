{"_path":"/plugins/connect.fcrdns","_dir":"plugins","_draft":false,"_partial":false,"_locale":"","title":"connect.fcrdns - Forward Confirmed Reverse DNS plugin for Haraka","description":"Haraka connect.fcrdns plugin - Forward Confirmed Reverse DNS","navigation":{"title":"connect.fcrdns"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"connectfcrdns-plugin"},"children":[{"type":"text","value":"connect.fcrdns plugin"}]},{"type":"element","tag":"h2","props":{"id":"description"},"children":[{"type":"text","value":"DESCRIPTION"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Determine if the SMTP sender has matching forward and reverse DNS."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"See "},{"type":"element","tag":"a","props":{"href":"http://en.wikipedia.org/wiki/FCrDNS","rel":["nofollow"]},"children":[{"type":"text","value":"FCrDNS at wikipedia"}]}]},{"type":"element","tag":"h2","props":{"id":"usage"},"children":[{"type":"text","value":"USAGE"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Other plugins can use FCrDNS results like this:"}]},{"type":"element","tag":"pre","props":{"code":"var fcrdns = connection.results.get('connect.fcrdns');\nif (fcrdns) {\n    if (fcrdns.fcrdns) {\n        // they passed, reward them\n    }\n\n    var fails = fcrdns.fail;\n    if (connection.results.has('connect.fcrdns', 'fail', /^is_generic/) {\n        // their IP is in their hostname, unlikely to be MX, penalize\n    }\n}\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"var fcrdns = connection.results.get('connect.fcrdns');\nif (fcrdns) {\n    if (fcrdns.fcrdns) {\n        // they passed, reward them\n    }\n\n    var fails = fcrdns.fail;\n    if (connection.results.has('connect.fcrdns', 'fail', /^is_generic/) {\n        // their IP is in their hostname, unlikely to be MX, penalize\n    }\n}\n"}]}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"CONFIGURATION"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Edit config/connect.fcrdns.ini"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin honors the whitelisting of IPs as set by the rdns_access plugin.\nFor that to work, rdns_access needs to be listed "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"before"}]},{"type":"text","value":" this plugin in\nconfig/plugins."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"timeout=30"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When performing DNS lookups, time out after this many seconds."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The following settings permit control of which test will block connections. To\nmimic the lookup_rdns.strict plugin, set no_rdns=true."}]},{"type":"element","tag":"pre","props":{"code":"[reject]\n; reject if the IP address has no PTR record\nno_rdns=false\n\n; reject if the FCrDNS test fails\nno_fcrdns=false\n\n; reject if the PTR points to a hostname without a valid TLD\ninvalid_tld=false\n\n; reject if the rDNS is generic, examples:\n; 1.2.3.4.in.addr.arpa\n; c-67-171-0-90.hsd1.wa.comcast.net\ngeneric_rdns=false\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"[reject]\n; reject if the IP address has no PTR record\nno_rdns=false\n\n; reject if the FCrDNS test fails\nno_fcrdns=false\n\n; reject if the PTR points to a hostname without a valid TLD\ninvalid_tld=false\n\n; reject if the rDNS is generic, examples:\n; 1.2.3.4.in.addr.arpa\n; c-67-171-0-90.hsd1.wa.comcast.net\ngeneric_rdns=false\n"}]}]},{"type":"element","tag":"h2","props":{"id":"anti-spam-effects"},"children":[{"type":"text","value":"ANTI-SPAM EFFECTS"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The reverse DNS of zombie PCs in bot nets is out of the bot operators control.\nThis presents a significant hurdle for a large portion of the hosts that\nattempt spam delivery."}]},{"type":"element","tag":"h2","props":{"id":"how-it-works"},"children":[{"type":"text","value":"HOW IT WORKS"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"From Wikipedia: "},{"type":"element","tag":"a","props":{"href":"http://en.wikipedia.org/wiki/FCrDNS","rel":["nofollow"]},"children":[{"type":"text","value":"Forward Confirmed Reverse DNS"}]}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"First a reverse DNS lookup (PTR query) is performed on the IP address,\nwhich returns a list of zero or more PTR records."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"For each domain name returned in the PTR query results, a regular\n'forward' DNS lookup (type A or AAAA query) is then performed."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Any A or AAAA records returned by the second query are then compared\nagainst the original IP address. If there is a match, FCrDNS passes."}]}]},{"type":"element","tag":"h2","props":{"id":"iprev"},"children":[{"type":"text","value":"iprev"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The iprev results are added to the Authentication-Results header."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://www.ietf.org/rfc/rfc1912.txt","rel":["nofollow"]},"children":[{"type":"text","value":"RFC 1912"}]},{"type":"element","tag":"a","props":{"href":"http://www.ietf.org/rfc/rfc5451.txt","rel":["nofollow"]},"children":[{"type":"text","value":"RFC 5451"}]},{"type":"element","tag":"a","props":{"href":"http://tools.ietf.org/html/rfc7001#section-3","rel":["nofollow"]},"children":[{"type":"text","value":"RFC 7001"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"2.6.3.  \"iprev\" Results"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"pass:  The DNS evaluation succeeded, i.e., the \"reverse\" and\n\"forward\" lookup results were returned and were in agreement."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"fail:  The DNS evaluation failed.  In particular, the \"reverse\" and\n\"forward\" lookups each produced results, but they were not in\nagreement, or the \"forward\" query completed but produced no\nresult, e.g., a DNS RCODE of 3, commonly known as NXDOMAIN, or an\nRCODE of 0 (NOERROR) in a reply containing no answers, was\nreturned."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"temperror:  The DNS evaluation could not be completed due to some\nerror that is likely transient in nature, such as a temporary DNS\nerror, e.g., a DNS RCODE of 2, commonly known as SERVFAIL, or\nother error condition resulted.  A later attempt may produce a\nfinal result."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"permerror:  The DNS evaluation could not be completed because no PTR\ndata are published for the connecting IP address, e.g., a DNS\nRCODE of 3, commonly known as NXDOMAIN, or an RCODE of 0 (NOERROR)\nin a reply containing no answers, was returned.  This prevented\ncompletion of the evaluation.  A later attempt is unlikely to\nproduce a final result."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"description","depth":2,"text":"DESCRIPTION"},{"id":"usage","depth":2,"text":"USAGE"},{"id":"configuration","depth":2,"text":"CONFIGURATION"},{"id":"anti-spam-effects","depth":2,"text":"ANTI-SPAM EFFECTS"},{"id":"how-it-works","depth":2,"text":"HOW IT WORKS"},{"id":"iprev","depth":2,"text":"iprev"}]}},"_type":"markdown","_id":"content:8.plugins:connect.fcrdns.md","_source":"content","_file":"8.plugins/connect.fcrdns.md","_stem":"8.plugins/connect.fcrdns","_extension":"md"}