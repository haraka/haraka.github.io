{"_path":"/plugins/helo.checks","_dir":"plugins","_draft":false,"_partial":false,"_locale":"","title":"helo.checks - HELO Checks plugin for Haraka","description":"Haraka helo.checks plugin - Rejects messages with invalid HELO/EHLO","navigation":{"title":"helo.checks"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"helochecks-plugin"},"children":[{"type":"text","value":"helo.checks plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin performs a number of checks on the HELO string."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"HELO strings are very often forged or dubious in spam and so this can be a\nhighly effective and false-positive free anti-spam measure."}]},{"type":"element","tag":"h2","props":{"id":"usage"},"children":[{"type":"text","value":"Usage"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"helo.checks results can be accessed by subsequent plugins:"}]},{"type":"element","tag":"pre","props":{"code":"var h = connection.results.get('helo.checks');\nif (h.pass && h.pass.length > 5) {\n    // nice job, you passed 6+ tests\n}\nif (h.fail && h.fail.length > 3) {\n    // yikes, you failed 4+ tests!\n}\nif (connection.results.has('helo.checks','pass', /^forward_dns/) {\n    // the HELO hostname is valid\n}\n","language":"js","meta":"","className":"language-js shiki shiki-themes github-dark github-light","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-dark:#F97583;--shiki-default:#D73A49"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#E1E4E8;--shiki-default:#24292E"},"children":[{"type":"text","value":" h "}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#F97583;--shiki-default:#D73A49"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#E1E4E8;--shiki-default:#24292E"},"children":[{"type":"text","value":" connection.results."}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#B392F0;--shiki-default:#6F42C1"},"children":[{"type":"text","value":"get"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#E1E4E8;--shiki-default:#24292E"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#9ECBFF;--shiki-default:#032F62"},"children":[{"type":"text","value":"'helo.checks'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#E1E4E8;--shiki-default:#24292E"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-dark:#F97583;--shiki-default:#D73A49"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#E1E4E8;--shiki-default:#24292E"},"children":[{"type":"text","value":" (h.pass "}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#F97583;--shiki-default:#D73A49"},"children":[{"type":"text","value":"&&"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#E1E4E8;--shiki-default:#24292E"},"children":[{"type":"text","value":" h.pass."}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#79B8FF;--shiki-default:#005CC5"},"children":[{"type":"text","value":"length"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#F97583;--shiki-default:#D73A49"},"children":[{"type":"text","value":" >"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#79B8FF;--shiki-default:#005CC5"},"children":[{"type":"text","value":" 5"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#E1E4E8;--shiki-default:#24292E"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-dark:#6A737D;--shiki-default:#6A737D"},"children":[{"type":"text","value":"    // nice job, you passed 6+ tests\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-dark:#E1E4E8;--shiki-default:#24292E"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-dark:#F97583;--shiki-default:#D73A49"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#E1E4E8;--shiki-default:#24292E"},"children":[{"type":"text","value":" (h.fail "}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#F97583;--shiki-default:#D73A49"},"children":[{"type":"text","value":"&&"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#E1E4E8;--shiki-default:#24292E"},"children":[{"type":"text","value":" h.fail."}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#79B8FF;--shiki-default:#005CC5"},"children":[{"type":"text","value":"length"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#F97583;--shiki-default:#D73A49"},"children":[{"type":"text","value":" >"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#79B8FF;--shiki-default:#005CC5"},"children":[{"type":"text","value":" 3"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#E1E4E8;--shiki-default:#24292E"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-dark:#6A737D;--shiki-default:#6A737D"},"children":[{"type":"text","value":"    // yikes, you failed 4+ tests!\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-dark:#E1E4E8;--shiki-default:#24292E"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-dark:#F97583;--shiki-default:#D73A49"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#E1E4E8;--shiki-default:#24292E"},"children":[{"type":"text","value":" (connection.results."}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#B392F0;--shiki-default:#6F42C1"},"children":[{"type":"text","value":"has"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#E1E4E8;--shiki-default:#24292E"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#9ECBFF;--shiki-default:#032F62"},"children":[{"type":"text","value":"'helo.checks'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#E1E4E8;--shiki-default:#24292E"},"children":[{"type":"text","value":","}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#9ECBFF;--shiki-default:#032F62"},"children":[{"type":"text","value":"'pass'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#E1E4E8;--shiki-default:#24292E"},"children":[{"type":"text","value":","}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#9ECBFF;--shiki-default:#032F62"},"children":[{"type":"text","value":" /"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#F97583;--shiki-default:#D73A49"},"children":[{"type":"text","value":"^"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#DBEDFF;--shiki-default:#032F62"},"children":[{"type":"text","value":"forward_dns"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#9ECBFF;--shiki-default:#032F62"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"style":"--shiki-dark:#E1E4E8;--shiki-default:#24292E"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-dark:#6A737D;--shiki-default:#6A737D"},"children":[{"type":"text","value":"    // the HELO hostname is valid\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-dark:#E1E4E8;--shiki-default:#24292E"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"helo.checks.regexps"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"List of regular expressions to match against the HELO string. The regular\nexpressions are automatically wrapped in "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"^"}]},{"type":"text","value":" and "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"$"}]},{"type":"text","value":" so they always match\nthe entire string."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"helo.checks.ini"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"INI file which controls enabling of certain checks:"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"dns_timeout=30"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"How many seconds to wait for DNS queries to timeout."}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"check"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"check"}]}]},{"type":"element","tag":"pre","props":{"code":"* valid\\_hostname=true\n\n  Checks that the HELO has at least one '.' in it and the organizational\n  name is possible (ie, a host within a Public Suffix).\n\n* bare\\_ip=true\n\n  Checks for HELO <IP> where the IP is not surrounded by square brackets.\n  This is an RFC violation so should always be enabled.\n\n* dynamic=true\n\n  Checks to see if all or part the connecting IP address appears within\n  the HELO argument to indicate that the client has a dynamic IP address.\n\n* literal\\_mismatch=1|2|3\n\n  Checks to see if the IP literal used matches the connecting IP address.\n  If set to 1, the full IP must match.  If set to 2, the /24 must match.\n  If set to 3, the /24 may match, or the IP can be private (RFC 1918).\n\n* match\\_re=true\n\n  See above. This is merely an on/off toggle.\n\n* big\\_company=true\n\n  See below. This is merely an on/off toggle.\n\n* forward\\_dns=true\n\n  Perform a DNS lookup of the HELO hostname and validate that the IP of\n  the remote is included in the IP(s) of the HELO hostname.\n\n  This test requires that the valid\\_hostname check is also enabled.\n\n* rdns\\_match=true\n\n  Sees if the HELO hostname (or at least the domain) match the rDNS\n  hostname(s).\n\n* host\\_mismatch=true\n\n  If HELO is called multiple times, checks if the hostname differs between\n  EHLO invocations.\n\n* proto\\_mismatch=true\n\n  If EHLO was sent and the host later tries to then send HELO or vice-versa.\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"* valid\\_hostname=true\n\n  Checks that the HELO has at least one '.' in it and the organizational\n  name is possible (ie, a host within a Public Suffix).\n\n* bare\\_ip=true\n\n  Checks for HELO <IP> where the IP is not surrounded by square brackets.\n  This is an RFC violation so should always be enabled.\n\n* dynamic=true\n\n  Checks to see if all or part the connecting IP address appears within\n  the HELO argument to indicate that the client has a dynamic IP address.\n\n* literal\\_mismatch=1|2|3\n\n  Checks to see if the IP literal used matches the connecting IP address.\n  If set to 1, the full IP must match.  If set to 2, the /24 must match.\n  If set to 3, the /24 may match, or the IP can be private (RFC 1918).\n\n* match\\_re=true\n\n  See above. This is merely an on/off toggle.\n\n* big\\_company=true\n\n  See below. This is merely an on/off toggle.\n\n* forward\\_dns=true\n\n  Perform a DNS lookup of the HELO hostname and validate that the IP of\n  the remote is included in the IP(s) of the HELO hostname.\n\n  This test requires that the valid\\_hostname check is also enabled.\n\n* rdns\\_match=true\n\n  Sees if the HELO hostname (or at least the domain) match the rDNS\n  hostname(s).\n\n* host\\_mismatch=true\n\n  If HELO is called multiple times, checks if the hostname differs between\n  EHLO invocations.\n\n* proto\\_mismatch=true\n\n  If EHLO was sent and the host later tries to then send HELO or vice-versa.\n"}]}]},{"type":"element","tag":"h3","props":{"id":"reject"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"reject"}]}]},{"type":"element","tag":"pre","props":{"code":"For all of the checks included above, a matching key in the reject section\ncontrols whether messages that fail the test are rejected.\n\nDefaults shown:\n\n[reject]\nhost_mismatch=false\nliteral_mismatch=false\nproto_mismatch=false\nrdns_match=false\ndynamic=false\nbare_ip=false\nvalid_hostname=false\nforward_dns=false\nbig_company=false\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"For all of the checks included above, a matching key in the reject section\ncontrols whether messages that fail the test are rejected.\n\nDefaults shown:\n\n[reject]\nhost_mismatch=false\nliteral_mismatch=false\nproto_mismatch=false\nrdns_match=false\ndynamic=false\nbare_ip=false\nvalid_hostname=false\nforward_dns=false\nbig_company=false\n"}]}]},{"type":"element","tag":"h3","props":{"id":"skip"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"skip"}]}]},{"type":"element","tag":"pre","props":{"code":"* private\\_ip=true\n\n  Bypasses checks for clients within RFC1918, Loopback or APIPA IP address ranges.\n\n* relaying\n\n  Bypass checks for clients who have relaying privileges (whitelisted IP,\n  SMTP-AUTH, etc).\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"* private\\_ip=true\n\n  Bypasses checks for clients within RFC1918, Loopback or APIPA IP address ranges.\n\n* relaying\n\n  Bypass checks for clients who have relaying privileges (whitelisted IP,\n  SMTP-AUTH, etc).\n"}]}]},{"type":"element","tag":"h3","props":{"id":"bigco"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"bigco"}]}]},{"type":"element","tag":"pre","props":{"code":"  A list of <helo>=<rdns>[,<rdns>...] to match against. If the HELO matches\n  what's on the left hand side, the reverse-DNS must match one of the\n  entries on the right hand side or the mail is blocked.\n\n  Example:\n\n        yahoo.com=yahoo.com,yahoo.co.jp\n        aol.com=aol.com\n        gmail.com=google.com\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"  A list of <helo>=<rdns>[,<rdns>...] to match against. If the HELO matches\n  what's on the left hand side, the reverse-DNS must match one of the\n  entries on the right hand side or the mail is blocked.\n\n  Example:\n\n        yahoo.com=yahoo.com,yahoo.co.jp\n        aol.com=aol.com\n        gmail.com=google.com\n"}]}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"usage","depth":2,"text":"Usage"},{"id":"configuration","depth":2,"text":"Configuration","children":[{"id":"check","depth":3,"text":"check"},{"id":"reject","depth":3,"text":"reject"},{"id":"skip","depth":3,"text":"skip"},{"id":"bigco","depth":3,"text":"bigco"}]}]}},"_type":"markdown","_id":"content:8.plugins:helo.checks.md","_source":"content","_file":"8.plugins/helo.checks.md","_stem":"8.plugins/helo.checks","_extension":"md"}