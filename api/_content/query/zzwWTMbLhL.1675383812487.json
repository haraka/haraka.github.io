{"_path":"/plugins/aliases","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"aliases - Alias plugin for Haraka","description":"Haraka aliases plugin - Alias plugin for Haraka","navigation":{"title":"aliases"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"aliases-plugin"},"children":[{"type":"text","value":"Aliases plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin allows one to configure aliases that may perform an action or\nchange the RCPT address in a number of ways.  All aliases are specified in\na JSON formatted configuration file, and must have at very least an action.\nAny syntax error found in the JSON format config file will stop the server\nfrom running."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"IMPORTANT: this plugin must appear in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/plugins"}]},{"type":"text","value":" before other plugins\nthat run on hook_rcpt"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"WARNING: DO NOT USE THIS PLUGIN WITH queue/smtp_proxy."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"aliases"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"JSON formatted configuration file that must contain, at very least, a key\nto match against RCPT address, and a value that is an associative array\nwith an \"action\" : \""},{"type":"element","tag":"action","props":{},"children":[{"type":"text","value":"\" key, value pair.  An example:"}]},{"type":"element","tag":"code","props":{"code":"  { \"test1\" : { \"action\" : \"drop\" } } \n","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"  { \"test1\" : { \"action\" : \"drop\" } } "}]}]}]}]}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"In the above example the \"test1\" alias will drop any message that matches\ntest1, or test1-* or test1+* (wildcard '-' or '+', see below).  Actions\nmay in turn have 0 or more options listed with them like so:"},{"type":"element","tag":"code","props":{"code":"  { \"test3\" : { \"action\" : \"alias\", \"to\" : \"test3-works\" } }\n","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"  { \"test3\" : { \"action\" : \"alias\", \"to\" : \"test3-works\" } }"}]}]}]}]}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"In the above example the \"test3\" alias has an action of \"alias\", and\na required \"to\" field.  If this \"to\" field were missing the alias would\nfail to run, and an error would be printed in the logs."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Now aliases of 'user', '@host' and 'user@host' possible:"},{"type":"element","tag":"code","props":{"code":"  { \"demo\" : { \"action\" : \"drop\" } }\n  or\n  { \"@example.com\" : { \"action\" : \"drop\" } } \n  or\n  { \"demo@example.com\" : { \"action\" : \"drop\" } } \n","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"  { \"demo\" : { \"action\" : \"drop\" } }\n  or\n  { \"@example.com\" : { \"action\" : \"drop\" } } \n  or\n  { \"demo@example.com\" : { \"action\" : \"drop\" } } "}]}]}]}]}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Aliases may also be exploded to multiple recipients:"},{"type":"element","tag":"code","props":{"code":"  { \"sales@example.com\": { \"action: \"alias\", \"to\": [\"alice@example.com\", \"bob@example.com\"] } }\n","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"  { \"sales@example.com\": { \"action: \"alias\", \"to\": [\"alice@example.com\", \"bob@example.com\"] } }"}]}]}]}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"wildcard notation"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"In an effort to match some of the functionality of other alias parsers\nwe've allowed wildcard matching of the alias against the right most\nstring of a RCPT address.  The characters '-' and '+' are commonly used\nfor subaddressing and this plugin has built-in support to alias the\n\"user\" part of the email address."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"That is, if our address were "},{"type":"element","tag":"a","props":{"href":"mailto:test2-testing@example.com"},"children":[{"type":"text","value":"test2-testing@example.com"}]},{"type":"text","value":" (or\n"},{"type":"element","tag":"a","props":{"href":"mailto:test2+testing@example.com"},"children":[{"type":"text","value":"test2+testing@example.com"}]},{"type":"text","value":"), the below alias would match:"},{"type":"element","tag":"code","props":{"code":"  { \"test2\" : { \"action\" : \"drop\" } }\n","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"  { \"test2\" : { \"action\" : \"drop\" } }"}]}]}]}]}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The larger, and more specific alias, should always match first when\nusing wildcard '-' notation.  So if the above RCPT were put up against\nthis alias config, it would not drop, but rather map to another\naddress:"},{"type":"element","tag":"code","props":{"code":"  {\n      \"test2\" : { \"action\" : \"drop\" },\n      \"test2-testing\" : { \"action\" : \"alias\", \"to\" : \"test@foo.com\" }\n  }\n","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"  {\n      \"test2\" : { \"action\" : \"drop\" },\n      \"test2-testing\" : { \"action\" : \"alias\", \"to\" : \"test@foo.com\" }\n  }"}]}]}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"chaining and circuits"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"In short, we do not allow chaining of aliases at this time.  As a\nside-effect, we enjoy protections against alias circuits."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"optional one line formatting"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Any valid JSON will due, however, please consider keeping each alias\non its own line so that others that wish to grep the aliases file\nhave an easier time finding the full configuration for an alias."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"nondeterministic duplicate matches"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"This plugin was written with speed in mind.  That means every lookup\nhashes into the alias file for its match.  While the act of doing so\nis fast, it does mean that any duplicate alias entries will match\nnondeterministically.  That is, we cannot predict what will happen\nhere:"},{"type":"element","tag":"code","props":{"code":"  {\n      \"coinflip\" : { \"action\" : \"alias\", \"to\" : \"heads@coin.com\" },\n      \"coinflip\" : { \"action\" : \"alias\", \"to\" : \"tails@coin.com\" }\n  }\n","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"  {\n      \"coinflip\" : { \"action\" : \"alias\", \"to\" : \"heads@coin.com\" },\n      \"coinflip\" : { \"action\" : \"alias\", \"to\" : \"tails@coin.com\" }\n  }"}]}]}]}]}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Truth be told, one result will likely always be chosen over the other,\nso this is not exactly a coinflip.  We simply cannot say what the\nlanguage implementation will do here, it could change tomorrow."}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"action (required)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The following is a list of supported actions, and the options they require."},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"drop"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"This action simply drops a message, while pretending everything was\nokay to the sender.  This acts much like an alias to /dev/null in\nother servers."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"alias"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"This action will map the alias key to the address specified in the\n\"to\" option.  A note about matching in addition to the note\nabout wildcard '-' above.  When we match an alias, we store the\nhostname of the match for a shortcut substitution syntax later."},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"to (required)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"This option is the full address, or local part at matched hostname\nthat the RCPT address will be re-written to.  For an example of\nan alias to a full address consider the following:"},{"type":"element","tag":"code","props":{"code":"  { \"test5\" : { \"action\" : \"alias\", \"to\" : \"test5@foo.com\" } }\n","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"  { \"test5\" : { \"action\" : \"alias\", \"to\" : \"test5@foo.com\" } }"}]}]}]}]}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"This will map RCPT matches for \"test5\" to \""},{"type":"element","tag":"a","props":{"href":"mailto:test5-works@foo.com"},"children":[{"type":"text","value":"test5-works@foo.com"}]},{"type":"text","value":"\".\nThis would map \""},{"type":"element","tag":"a","props":{"href":"mailto:test5@somedomain.com"},"children":[{"type":"text","value":"test5@somedomain.com"}]},{"type":"text","value":"\" to \""},{"type":"element","tag":"a","props":{"href":"mailto:test5-works@foo.com"},"children":[{"type":"text","value":"test5-works@foo.com"}]},{"type":"text","value":"\"\nevery time.  Now compare this notation with its shortcut\ncounterpart, best used when the \"to\" address is at the same\ndomain as the match:"},{"type":"element","tag":"code","props":{"code":"  { \"test4\" : { \"action\" : \"alias\", \"to\" : \"test4\" } }\n","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"  { \"test4\" : { \"action\" : \"alias\", \"to\" : \"test4\" } }"}]}]}]}]}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Clearly, this notation is more compact, but what does it do.  Well,\nmail to \""},{"type":"element","tag":"a","props":{"href":"mailto:test4-foo@anydomain.com"},"children":[{"type":"text","value":"test4-foo@anydomain.com"}]},{"type":"text","value":"\" will map to \""},{"type":"element","tag":"a","props":{"href":"mailto:test4@anydomain.com"},"children":[{"type":"text","value":"test4@anydomain.com"}]},{"type":"text","value":"\".\nOne can see the clear benefit of using this notation with lots of\naliases on a single domain that map to other local parts at the\nsame domain."}]}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"example-configuration"},"children":[{"type":"text","value":"Example Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"{\n\"test1\" : { \"action\" : \"drop\" },\n\"test2\" : { \"action\" : \"drop\" },\n\"test3\" : { \"action\" : \"alias\", \"to\" : \"test3-works\" },\n\"test4\" : { \"action\" : \"alias\", \"to\" : \"test4\" },\n\"test5\" : { \"action\" : \"alias\", \"to\" : \""},{"type":"element","tag":"a","props":{"href":"mailto:test5-works@success.com"},"children":[{"type":"text","value":"test5-works@success.com"}]},{"type":"text","value":"\" },\n\"test6\" : { \"action\" : \"alias\", \"to\" : \""},{"type":"element","tag":"a","props":{"href":"mailto:test6-works@success.com"},"children":[{"type":"text","value":"test6-works@success.com"}]},{"type":"text","value":"\" }\n}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"configuration","depth":2,"text":"Configuration"},{"id":"example-configuration","depth":2,"text":"Example Configuration"}]}},"_type":"markdown","_id":"content:8.plugins:aliases.md","_source":"content","_file":"8.plugins/aliases.md","_extension":"md"}