{"_path":"/plugins/connect.asn","_dir":"plugins","_draft":false,"_partial":false,"_locale":"","_empty":false,"title":"connect.asn - get AS number of remote IP address plugin for Haraka","description":"Haraka connect.asn plugin - get AS number of remote","navigation":{"title":"connect.asn"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"connectasn-plugin"},"children":[{"type":"text","value":"connect.asn plugin"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Use DNS queries to look up the ASN of the remote IP."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Inserts a result object with the ASN of the remote host."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The AS Number is the "},{"type":"element","tag":"a","props":{"href":"http://en.wikipedia.org/wiki/Autonomous_System_(Internet)","rel":["nofollow"]},"children":[{"type":"text","value":"Autonomous System Number"}]},{"type":"text","value":"\nthat represents the bailiwick or sphere of control of a network operator."}]},{"type":"element","tag":"h2","props":{"id":"faster-lookups"},"children":[{"type":"text","value":"Faster Lookups"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If your mail server is very busy:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Download the "},{"type":"element","tag":"a","props":{"href":"ftp://ftp.routeviews.org/dnszones/"},"children":[{"type":"text","value":"routeviews ASN zones"}]},{"type":"text","value":" and serve them on a local DNS server. If you use SpamAssassin, this is highly recommended as it looks up ASN using routeviews via DNS."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Use instead the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"connect.geoip"}]},{"type":"text","value":" plugin with the MaxMind backend. It caches the ASN database locally and gets the ASN without network traffic and delays."}]}]},{"type":"element","tag":"h2","props":{"id":"usage"},"children":[{"type":"text","value":"Usage"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The AS number can be accessed by plugins that run after "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"connect.asn"}]},{"type":"text","value":" like so:"}]},{"type":"element","tag":"code","props":{"code":"var asn = connection.results.get('connect.asn');\nif (asn && asn.asn) {\n    connection.loginfo(plugin, \"hey look, it's ASN: \" + asn.asn);\n}\n","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"var asn = connection.results.get('connect.asn');\nif (asn && asn.asn) {\n    connection.loginfo(plugin, \"hey look, it's ASN: \" + asn.asn);\n}"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The following settings can be set in config/connect.asn.ini."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"providers: comma separated list of DNS zones that provide IP to ASN lookups"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"origin.asn.cymru.com"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"origin.asn.spameatingmonkey.net"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"asn.routeviews.org"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"test_ip: (Default:"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"An IP address that maps to an ASN (any valid public IP should work)"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"timeout (in seconds): (Default: 4)"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"How long to wait for DNS results to return."}]},{"type":"element","tag":"h2","props":{"id":"headers"},"children":[{"type":"text","value":"Headers"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Optionally add headers to messages with ASN info."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"asn_header (Default: false)"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"add X-Haraka-ASN header with the ASN and if available, netmask."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"provider_header (Default: false)"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Add X-Haraka-ASN-"},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"provider"}]},{"type":"text","value":" header for each provider that returned results."}]},{"type":"element","tag":"h2","props":{"id":"theory"},"children":[{"type":"text","value":"Theory"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"An ASN is a very good approximation of the IP space under the control\nof a network operator. The theory behind ASN tracking is that good network\noperators police their networks, proactively limit abuse, and are less likely\nto be emitting abuse."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Not-so-good network operators are likely to emit a greater number of abusive\nconnections, and should be handled with increased scrutiny."}]},{"type":"element","tag":"h2","props":{"id":"research"},"children":[{"type":"text","value":"Research"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://web.archive.org/web/20090709150921/http://www.cc.gatech.edu/~feamster/papers/snare-usenix09.pdf","rel":["nofollow"]},"children":[{"type":"text","value":"http://www.cc.gatech.edu/~feamster/papers/snare-usenix09.pdf"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"\"Performance based on AS number only...The classifier gets a false positive\nrate of 0.76% "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"and"}]},{"type":"text","value":" a 70% detection rate\""}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"\"AS numbers are more persistently associated with a sender's\nidentity than the IP address, for two reasons: (1) The spamming mail server\nmight be set up within specific ASes without the network administrator\nshutting it down. (2) Bots tend to aggregate within ASes, since the machines\nin the same ASes are likely to have the same vulnerability. It is not easy for\nspammers to move mail servers or the bot armies to a different AS; therefore,\nAS numbers are robust to indicate malicious hosts.\""}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"See also: "},{"type":"element","tag":"a","props":{"href":"http://www.bgpmon.net/using-bgp-data-to-find-spammers/","rel":["nofollow"]},"children":[{"type":"text","value":"Using BGP data to find spammers"}]}]},{"type":"element","tag":"h2","props":{"id":"consumers"},"children":[{"type":"text","value":"Consumers"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"a","props":{"href":"/plugins/karma"},"children":[{"type":"text","value":"karma"}]},{"type":"text","value":" plugin uses the ASN to maintain\nits network neighborhood reputation."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"faster-lookups","depth":2,"text":"Faster Lookups"},{"id":"usage","depth":2,"text":"Usage"},{"id":"configuration","depth":2,"text":"Configuration"},{"id":"headers","depth":2,"text":"Headers"},{"id":"theory","depth":2,"text":"Theory"},{"id":"research","depth":2,"text":"Research"},{"id":"consumers","depth":2,"text":"Consumers"}]}},"_type":"markdown","_id":"content:8.plugins:connect.asn.md","_source":"content","_file":"8.plugins/connect.asn.md","_extension":"md"}