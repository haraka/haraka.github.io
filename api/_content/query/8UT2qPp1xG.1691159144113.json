{"_path":"/plugins/tarpit","_dir":"plugins","_draft":false,"_partial":false,"_locale":"","_empty":false,"title":"tarpit - Tarpit plugin","description":"Haraka tarpit plugin - Tarpit plugin","navigation":{"title":"tarpit"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"tarpit-plugin"},"children":[{"type":"text","value":"Tarpit plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin is designed to introduce deliberate delays on the response\nof every hook in order to slow down a connection.  It has no\nconfiguration and is designed to be used only by other plugins."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It must be loaded early in config/plugins (e.g. before any plugins\nthat accept recipients or that return OK) but must be loaded "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"after"}]},{"type":"text","value":"\nany plugins that wish to use it."}]},{"type":"element","tag":"h2","props":{"id":"usage"},"children":[{"type":"text","value":"Usage"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To use this plugin in another plugin set:"}]},{"type":"element","tag":"code","props":{"className":["language-undefined"],"code":"connection.notes.tarpit = <seconds to delay>;\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"connection.notes.tarpit = <seconds to delay>;"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"or"}]},{"type":"element","tag":"code","props":{"className":["language-undefined"],"code":"connection.transaction.notes.tarpit = <seconds to delay>;\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"connection.transaction.notes.tarpit = <seconds to delay>;"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The configuration file for tarpit is config/tarpit.ini."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hooks_to_delay - a list of hooks to delay at. This setting can be used to\noverride the default list in the plugin. For example, if you notice that\nmalware is disconnecting after delaying rcpt_ok, you can remove just that\nhook from the list:"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"hooks_to_delay=connect,helo,ehlo,mail,rcpt,data,data_post,queue,unrecognized_command,vrfy,noop,rset,quit"}]},{"type":"element","tag":"h2","props":{"id":"plugin-timeout"},"children":[{"type":"text","value":"Plugin Timeout"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"config/tarpit.timeout (Default: 0)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"All Haraka plugins can configure a "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"name"}]},{"type":"text","value":".timeout file. The timeout specifies\nhow long Haraka lets the plugin do nothing before it times out. When zero,\nthere is no timeout. When non-zero and "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"seconds to delay"}]},{"type":"text","value":" is longer than\ntarpit.timeout (default: 1s), you'll get errors like this in your log files:"}]},{"type":"element","tag":"code","props":{"className":["language-undefined"],"code":"[core] Plugin tarpit timed out on hook rcpt - make sure it calls the callback\n[core] Plugin tarpit timed out on hook quit - make sure it calls the callback\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"[core] Plugin tarpit timed out on hook rcpt - make sure it calls the callback\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"[core] Plugin tarpit timed out on hook quit - make sure it calls the callback"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The solution is to set the contents of config/tarpit.timeout to zero or\n"},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"seconds to delay"}]},{"type":"text","value":" + 1."}]},{"type":"element","tag":"h2","props":{"id":"logging"},"children":[{"type":"text","value":"Logging"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When tarpitting a command it will log 'tarpitting response for Ns' to\nthe INFO facility where N is the number of seconds."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"usage","depth":2,"text":"Usage"},{"id":"configuration","depth":2,"text":"Configuration"},{"id":"plugin-timeout","depth":2,"text":"Plugin Timeout"},{"id":"logging","depth":2,"text":"Logging"}]}},"_type":"markdown","_id":"content:8.plugins:tarpit.md","_source":"content","_file":"8.plugins/tarpit.md","_extension":"md"}