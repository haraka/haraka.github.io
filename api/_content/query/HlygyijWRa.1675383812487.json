{"_path":"/plugins/dkim_sign","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"dkim_sign - DKIM Sign plugin for Haraka","description":"Haraka dkim_sign plugin - DKIM Sign","navigation":{"title":"dkim_sign"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"dkim_sign-plugin"},"children":[{"type":"text","value":"dkim_sign plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin implements the DKIM Core specification found at dkimcore.org"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"DKIM Core is a simplified subset of DKIM which is easier to understand\nand deploy, yet provides all the same delivery advantages as DKIM."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin can only "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"sign"}]},{"type":"text","value":" outbound messages.  It does not validate\nDKIM signatures."}]},{"type":"element","tag":"h2","props":{"id":"getting-started"},"children":[{"type":"text","value":"Getting Started"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Generate DKIM selector and keys:"}]},{"type":"element","tag":"code","props":{"code":"% cd /path/to/haraka/config/dkim\n./dkim_key_gen.sh example.org\n","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"% cd /path/to/haraka/config/dkim\n./dkim_key_gen.sh example.org"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Peek into the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"dkim_key_gen.sh"}]},{"type":"text","value":" shell script to see the commands used to\ncreate and format the DKIM public key. Within the config/dkim/example.org\ndirectory will be 4 files:"}]},{"type":"element","tag":"code","props":{"code":"% ls config/dkim/example.org/\ndns private public selector\n","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"% ls config/dkim/example.org/\ndns private public selector"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"private"}]},{"type":"text","value":" and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" files contain the DKIM keys, the selector is\nin the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"selector"}]},{"type":"text","value":" file and the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"dns"}]},{"type":"text","value":" file contains a formatted record of\nthe public key, as well as suggestions for DKIM, SPF, and DMARC policy\nrecords. The records in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"dns"}]},{"type":"text","value":" are ready to be copy/pasted into the DNS\nzone for example.org."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The DKIM DNS record will look like this:"}]},{"type":"element","tag":"code","props":{"code":"may2013._domainkey TXT \"v=DKIM1;p=[public key stripped of whitespace];\"\n","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"may2013._domainkey TXT \"v=DKIM1;p=[public key stripped of whitespace];\""}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"And the values in the address have the following meaning:"}]},{"type":"element","tag":"code","props":{"code":"hash: h=[ sha1 | sha256 ]\ntest; t=[ s | s:y ]\ngranularity: g=[ ]\nnotes: n=[ ]\nservices: s=[email]\nkeytypes: [ rsa ]\n","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"hash: h=[ sha1 | sha256 ]\ntest; t=[ s | s:y ]\ngranularity: g=[ ]\nnotes: n=[ ]\nservices: s=[email]\nkeytypes: [ rsa ]"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"key-size"},"children":[{"type":"text","value":"Key size"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The default key size created by "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"dkim_key_gen.sh"}]},{"type":"text","value":" is 2048. As of mid-2014, there are some DNS providers that do not support key sizes that long."}]},{"type":"element","tag":"h1","props":{"id":"what-to-sign"},"children":[{"type":"text","value":"What to sign"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The DKIM signing key for messages from example.org "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"should"}]},{"type":"text","value":" be signed with\na DKIM key for example.org. Failing to do so will result in messages not\nhaving an "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"aligned"}]},{"type":"text","value":" DKIM signature. For DMARC enabled domains, this will\nlikely result in deliverability problems."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For correct alignment, Haraka signs each message with that domains DKIM key.\nFor an alternative, see the legacy Single Domain Configuration below."}]},{"type":"element","tag":"h1","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin uses the configuration "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"dkim_sign.ini"}]},{"type":"text","value":" in INI format.\nAll configuration should appear within the 'main' block and is\nchecked for updates on every run."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"disabled = "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":" 1 | true | yes"}]},{"type":"text","value":"             (OPTIONAL)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Set this to disable DKIM signing"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"headers_to_sign = list, of; headers       (REQUIRED)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Set this to the list of headers that should be signed\nseparated by either a comma, colon or semi-colon.\nThis is to prevent any tampering of the specified headers.\nThe 'From' header is required to be present by the RFC and\nwill be added if it is missing."}]}]},{"type":"element","tag":"h2","props":{"id":"single-domain-configuration"},"children":[{"type":"text","value":"Single Domain Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To sign all messages with a single DKIM key, these two config settings\nare required."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"selector = name"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Set this to the selector name published in DNS under the\n_domainkey sub-domain of the domain referenced below."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"domain = name"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Set this to the domain name that will be used to sign messages\nwhich don't match a per-domain DKIM key.  The DNS TXT entry for:"},{"type":"element","tag":"code","props":{"code":"  <selector>._domainkey.<domain>\n","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"  <selector>._domainkey.<domain>"}]}]}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"dkim.private.key = filename"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Create a file "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"dkim.private.key"}]},{"type":"text","value":" in the config folder and paste\nyour private key in it."}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"getting-started","depth":2,"text":"Getting Started"},{"id":"key-size","depth":2,"text":"Key size"},{"id":"single-domain-configuration","depth":2,"text":"Single Domain Configuration"}]}},"_type":"markdown","_id":"content:8.plugins:dkim_sign.md","_source":"content","_file":"8.plugins/dkim_sign.md","_extension":"md"}