{"generatedAt":1671497050740,"generateTime":94,"contents":[{"_path":"/","_dir":"","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"Haraka SMTP Email Server","description":"Haraka is an open source SMTP server written in Node.js. Haraka is fast, scalable, and extensible.","excerpt":{"type":"root","children":[{"type":"element","tag":"block-hero","props":{":cta":"[\"Get Started\",\"/getting_started\"]",":secondary":"[\"Open on GitHub →\",\"https://github.com/haraka/Haraka\"]","snippet":"npm install Haraka -g"},"children":[{"type":"element","tag":"template","props":{"v-slot:title":""},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Haraka"}]}]},{"type":"element","tag":"template","props":{"v-slot:description":""},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"A modern, high performance, flexible SMTP server"}]},{"type":"text","value":". Haraka is an open source SMTP server written in Node.js which provides extremely high performance coupled with a flexible plugin system allowing Javascript programmers full access to change the behaviour of the server. It is used heavily in some high traffic sites - see the \"Known Users\" link above for testimonials."}]}]}]}]},"navigation":false,"layout":"page","body":{"type":"root","children":[{"type":"element","tag":"block-hero","props":{":cta":"[\"Get Started\",\"/getting_started\"]",":secondary":"[\"Open on GitHub →\",\"https://github.com/haraka/Haraka\"]","snippet":"npm install Haraka -g"},"children":[{"type":"element","tag":"template","props":{"v-slot:title":""},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Haraka"}]}]},{"type":"element","tag":"template","props":{"v-slot:description":""},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"A modern, high performance, flexible SMTP server"}]},{"type":"text","value":". Haraka is an open source SMTP server written in Node.js which provides extremely high performance coupled with a flexible plugin system allowing Javascript programmers full access to change the behaviour of the server. It is used heavily in some high traffic sites - see the \"Known Users\" link above for testimonials."}]}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:0.index.md","_source":"content","_file":"0.index.md","_extension":"md"},{"_path":"/getting_started","_dir":"","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"Getting Started","description":"Getting Started with Haraka","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"getting-started"},"children":[{"type":"text","value":"Getting Started"}]},{"type":"element","tag":"h2","props":{"id":"haraka"},"children":[{"type":"text","value":"Haraka"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A modern, high performance, flexible SMTP server."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Haraka is an open source SMTP server written in Node.js which provides extremely high performance coupled with a flexible plugin system allowing Javascript programmers full access to change the behaviour of the server. It is used heavily in some high traffic sites - see the "},{"type":"element","tag":"nuxt-link","props":{"to":"/users/"},"children":[{"type":"text","value":"\"Known Users\""}]},{"type":"text","value":" link above for testimonials."}]},{"type":"element","tag":"form","props":{"action":"https://www.paypal.com/cgi-bin/webscr","method":"post","target":"_top","className":["h-10"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tag":"input","props":{"type":"hidden","name":"cmd","value":"_donations"},"children":[]},{"type":"text","value":"\n    "},{"type":"element","tag":"input","props":{"type":"hidden","name":"business","value":"helpme+paypal@gmail.com"},"children":[]},{"type":"text","value":"\n    "},{"type":"element","tag":"input","props":{"type":"hidden","name":"item_name","value":"Haraka"},"children":[]},{"type":"text","value":"\n    "},{"type":"element","tag":"input","props":{"type":"hidden","name":"currency_code","value":"CAD"},"children":[]},{"type":"text","value":"\n    "},{"type":"element","tag":"input","props":{"type":"image","src":"https://www.paypalobjects.com/en_US/i/btn/btn_donate_LG.gif","border":0,"name":"submit","title":"PayPal - The safer, easier way to pay online!","alt":"Donate with PayPal button"},"children":[]},{"type":"text","value":"\n    "},{"type":"element","tag":"img","props":{"alt":"","border":0,"src":"https://www.paypal.com/en_US/i/scr/pixel.gif","width":1,"height":1},"children":[]}]},{"type":"element","tag":"div","props":{"className":["flex","space-x-4"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tag":"a","props":{"href":"#"},"children":[{"type":"element","tag":"img","props":{"alt":"Tests","src":"https://github.com/haraka/Haraka/workflows/Haraka%20Tests/badge.svg"},"children":[]}]},{"type":"text","value":"\n    "},{"type":"element","tag":"a","props":{"href":"#"},"children":[{"type":"element","tag":"img","props":{"alt":"Tests - Windows","src":"https://github.com/haraka/Haraka/workflows/Haraka%20Tests%20-%20Windows/badge.svg"},"children":[]}]},{"type":"text","value":"\n    "},{"type":"element","tag":"a","props":{"href":"https://codecov.io/github/haraka/Haraka?branch=master","rel":["nofollow","noopener","noreferrer"],"target":"_blank"},"children":[{"type":"element","tag":"img","props":{"dataVF58a9f50":"","alt":"Coverage Status","src":"https://codecov.io/github/haraka/Haraka/coverage.svg"},"children":[]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Haraka is a highly scalable "},{"type":"element","tag":"a","props":{"href":"http://nodejs.org","rel":["nofollow"]},"children":[{"type":"text","value":"node.js"}]},{"type":"text","value":" email server with a modular\nplugin architecture. Haraka can serve thousands of concurrent connections\nand deliver thousands of messages per second. Haraka and plugins are written\nin asynchronous JS and are very fast."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Haraka has very good spam protection (see "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/Plugins.md","rel":["nofollow"]},"children":[{"type":"text","value":"plugins"}]},{"type":"text","value":") and works\nwell as a filtering "},{"type":"element","tag":"a","props":{"href":"http://en.wikipedia.org/wiki/Message_transfer_agent","rel":["nofollow"]},"children":[{"type":"text","value":"MTA"}]},{"type":"text","value":". It also works well as a "},{"type":"element","tag":"a","props":{"href":"http://en.wikipedia.org/wiki/Mail_submission_agent","rel":["nofollow"]},"children":[{"type":"text","value":"MSA"}]},{"type":"text","value":" running on\nport 587 with auth and "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/dkim_sign.md","rel":["nofollow"]},"children":[{"type":"text","value":"dkim_sign"}]},{"type":"text","value":" plugins enabled."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Haraka makes no attempt to be a mail store (like Exchange or Postfix/Exim/Qmail),\na "},{"type":"element","tag":"a","props":{"href":"https://en.wikipedia.org/wiki/Mail_delivery_agent","rel":["nofollow"]},"children":[{"type":"text","value":"LDA"}]},{"type":"text","value":", nor an IMAP server (like Dovecot or Courier). Haraka is\ntypically used "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"with"}]},{"type":"text","value":" such systems."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Haraka has a scalable outbound mail delivery engine built in. Mail\nmarked as "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"relaying"}]},{"type":"text","value":" (such as via an "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"auth"}]},{"type":"text","value":" plugin) is automatically\nqueued for outbound delivery."}]},{"type":"element","tag":"h3","props":{"id":"getting-help"},"children":[{"type":"text","value":"Getting Help"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"mailto:haraka-sub@harakamail.com"},"children":[{"type":"text","value":"Join the mailing list"}]},{"type":"text","value":" (implemented as a Haraka plugin)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://communityinviter.com/apps/harakaserver/public-inviter","rel":["nofollow"]},"children":[{"type":"text","value":"Join us on Slack"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/issues","rel":["nofollow"]},"children":[{"type":"text","value":"GitHub Issues"}]}]}]},{"type":"element","tag":"h3","props":{"id":"screencast"},"children":[{"type":"text","value":"Screencast"}]},{"type":"element","tag":"div","props":{},"children":[{"type":"element","tag":"video-player","props":{"src":"https://www.youtube.com/watch?v=6twKXMAsPsw"},"children":[]}]},{"type":"element","tag":"h3","props":{"id":"why-use-haraka"},"children":[{"type":"text","value":"Why Use Haraka?"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Haraka's plugin architecture provides an easily extensible MTA that\ncomplements traditional MTAs that excel at managing mail stores but do\nnot have sufficient filtering."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The plugin system makes it easy to code new features. A typical example\nis providing qmail-like extended addresses to an Exchange system,\nwhereby you could receive mail as "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"user-anyword@domain.com"}]},{"type":"text","value":", and yet\nstill have it correctly routed to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"user@domain.com"}]},{"type":"text","value":". This is a few lines of\ncode in Haraka."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Plugins are provided for running mail through "},{"type":"element","tag":"a","props":{"href":"https://haraka.github.io/plugins/spamassassin/","rel":["nofollow"]},"children":[{"type":"text","value":"SpamAssassin"}]},{"type":"text","value":", validating\n"},{"type":"element","tag":"a","props":{"href":"https://haraka.github.io/plugins/helo.checks/","rel":["nofollow"]},"children":[{"type":"text","value":"HELO"}]},{"type":"text","value":" names, checking "},{"type":"element","tag":"a","props":{"href":"https://haraka.github.io/plugins/dnsbl/","rel":["nofollow"]},"children":[{"type":"text","value":"DNS Blocklists"}]},{"type":"text","value":", and "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/tree/master/plugins","rel":["nofollow"]},"children":[{"type":"text","value":"many others"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h3","props":{"id":"installing-haraka"},"children":[{"type":"text","value":"Installing Haraka"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Haraka requires "},{"type":"element","tag":"a","props":{"href":"http://nodejs.org","rel":["nofollow"]},"children":[{"type":"text","value":"node.js"}]},{"type":"text","value":" to run. Install Haraka with [npm]"},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"2"}]},{"type":"text","value":":"}]},{"type":"element","tag":"code-group","props":{},"children":[{"type":"element","tag":"code","props":{"code":"npm install -g Haraka\n","filename":"npm","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"npm install -g Haraka\n"}]}]}]},{"type":"element","tag":"code","props":{"code":"yarn add global Haraka\n","filename":"yarn","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"yarn add global Haraka\n"}]}]}]},{"type":"element","tag":"code","props":{"code":"pnpm add -g Haraka\n","filename":"pnpm","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"pnpm add -g Haraka\n"}]}]}]}]},{"type":"element","tag":"alert","props":{"type":"info"},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If the command gives \"nobody\" errors run the next command"}]}]},{"type":"element","tag":"code-group","props":{},"children":[{"type":"element","tag":"code","props":{"code":"npm -g config set user root\nnpm install -g Haraka\n","filename":"npm","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"npm -g config set user root\nnpm install -g Haraka\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"After installation, use the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"haraka"}]},{"type":"text","value":" binary to set up the service."}]},{"type":"element","tag":"h3","props":{"id":"running-haraka"},"children":[{"type":"text","value":"Running Haraka"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"First, create the service:"}]},{"type":"element","tag":"code","props":{"code":"haraka -i /path/to/haraka_test\n","language":"sh"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"haraka -i /path/to/haraka_test\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"That creates the directory "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"haraka_test"}]},{"type":"text","value":" with "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config"}]},{"type":"text","value":" and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"plugin"}]},{"type":"text","value":"\ndirectories within. It also sets the host name used by Haraka\nto the output of "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"hostname"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"hostname"}]},{"type":"text","value":" is not correct, edit "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/host_list"}]},{"type":"text","value":". For example,\nto receive mail addressed to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"user@domain.com"}]},{"type":"text","value":", add "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"domain.com"}]},{"type":"text","value":" to the\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/host_list"}]},{"type":"text","value":" file."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Finally, start Haraka using root permissions:"}]},{"type":"element","tag":"code","props":{"code":"haraka -c /path/to/haraka_test\n","language":"sh"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"haraka -c /path/to/haraka_test\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"And it will run."}]},{"type":"element","tag":"h3","props":{"id":"configure-haraka"},"children":[{"type":"text","value":"Configure Haraka"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To choose which plugins run, edit "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/plugins"}]},{"type":"text","value":". Plugins control the\noverall behaviour of Haraka. By default, only messages to domains listed\nin "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/host_list"}]},{"type":"text","value":" will be accepted and then delivered via the\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"smtp-forward"}]},{"type":"text","value":" plugin. Configure the destination in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/smtp_forward.ini"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h3","props":{"id":"read-the-fine-manual"},"children":[{"type":"text","value":"Read the Fine Manual"}]},{"type":"element","tag":"code","props":{"code":"haraka -h plugins/$name\n","language":"sh"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"haraka -h plugins/$name\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The docs detail how each plugin is configured. After editing\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/plugins"}]},{"type":"text","value":", restart Haraka and enjoy!"}]},{"type":"element","tag":"h3","props":{"id":"running-from-git"},"children":[{"type":"text","value":"Running from git"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you are unable to use npm to install Haraka, you can run from git by\nfollowing these steps:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"First clone the repository:"}]},{"type":"element","tag":"code","props":{"code":"git clone https://github.com/haraka/Haraka.git\ncd Haraka\n","language":"sh"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"git clone https://github.com/haraka/Haraka.git\ncd Haraka\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Install Haraka's node.js dependencies locally:"}]},{"type":"element","tag":"code","props":{"code":"npm install\n","language":"sh"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"npm install\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Edit "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/plugins"}]},{"type":"text","value":" and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/smtp.ini"}]},{"type":"text","value":" to specify the plugins and\nconfig you want."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Finally run Haraka:"}]},{"type":"element","tag":"code","props":{"code":"node haraka.js\n","language":"sh"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"node haraka.js\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"license-and-author"},"children":[{"type":"text","value":"License and Author"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Haraka is MIT licensed - see the "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/LICENSE","rel":["nofollow"]},"children":[{"type":"text","value":"LICENSE"}]},{"type":"text","value":" file for details."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Haraka is a project started by "},{"type":"element","tag":"a","props":{"href":"https://github.com/baudehlo","rel":["nofollow"]},"children":[{"type":"text","value":"Matt Sergeant"}]},{"type":"text","value":", a 10 year veteran of the email\nand anti-spam world. Previous projects have been the project leader for\nSpamAssassin and a hacker on "},{"type":"element","tag":"a","props":{"href":"https://github.com/smtpd/qpsmtpd/","rel":["nofollow"]},"children":[{"type":"text","value":"Qpsmtpd"}]},{"type":"text","value":"."}]}]},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"getting-started"},"children":[{"type":"text","value":"Getting Started"}]},{"type":"element","tag":"h2","props":{"id":"haraka"},"children":[{"type":"text","value":"Haraka"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A modern, high performance, flexible SMTP server."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Haraka is an open source SMTP server written in Node.js which provides extremely high performance coupled with a flexible plugin system allowing Javascript programmers full access to change the behaviour of the server. It is used heavily in some high traffic sites - see the "},{"type":"element","tag":"nuxt-link","props":{"to":"/users/"},"children":[{"type":"text","value":"\"Known Users\""}]},{"type":"text","value":" link above for testimonials."}]},{"type":"element","tag":"form","props":{"action":"https://www.paypal.com/cgi-bin/webscr","method":"post","target":"_top","className":["h-10"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tag":"input","props":{"type":"hidden","name":"cmd","value":"_donations"},"children":[]},{"type":"text","value":"\n    "},{"type":"element","tag":"input","props":{"type":"hidden","name":"business","value":"helpme+paypal@gmail.com"},"children":[]},{"type":"text","value":"\n    "},{"type":"element","tag":"input","props":{"type":"hidden","name":"item_name","value":"Haraka"},"children":[]},{"type":"text","value":"\n    "},{"type":"element","tag":"input","props":{"type":"hidden","name":"currency_code","value":"CAD"},"children":[]},{"type":"text","value":"\n    "},{"type":"element","tag":"input","props":{"type":"image","src":"https://www.paypalobjects.com/en_US/i/btn/btn_donate_LG.gif","border":0,"name":"submit","title":"PayPal - The safer, easier way to pay online!","alt":"Donate with PayPal button"},"children":[]},{"type":"text","value":"\n    "},{"type":"element","tag":"img","props":{"alt":"","border":0,"src":"https://www.paypal.com/en_US/i/scr/pixel.gif","width":1,"height":1},"children":[]}]},{"type":"element","tag":"div","props":{"className":["flex","space-x-4"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tag":"a","props":{"href":"#"},"children":[{"type":"element","tag":"img","props":{"alt":"Tests","src":"https://github.com/haraka/Haraka/workflows/Haraka%20Tests/badge.svg"},"children":[]}]},{"type":"text","value":"\n    "},{"type":"element","tag":"a","props":{"href":"#"},"children":[{"type":"element","tag":"img","props":{"alt":"Tests - Windows","src":"https://github.com/haraka/Haraka/workflows/Haraka%20Tests%20-%20Windows/badge.svg"},"children":[]}]},{"type":"text","value":"\n    "},{"type":"element","tag":"a","props":{"href":"https://codecov.io/github/haraka/Haraka?branch=master","rel":["nofollow","noopener","noreferrer"],"target":"_blank"},"children":[{"type":"element","tag":"img","props":{"dataVF58a9f50":"","alt":"Coverage Status","src":"https://codecov.io/github/haraka/Haraka/coverage.svg"},"children":[]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Haraka is a highly scalable "},{"type":"element","tag":"a","props":{"href":"http://nodejs.org","rel":["nofollow"]},"children":[{"type":"text","value":"node.js"}]},{"type":"text","value":" email server with a modular\nplugin architecture. Haraka can serve thousands of concurrent connections\nand deliver thousands of messages per second. Haraka and plugins are written\nin asynchronous JS and are very fast."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Haraka has very good spam protection (see "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/Plugins.md","rel":["nofollow"]},"children":[{"type":"text","value":"plugins"}]},{"type":"text","value":") and works\nwell as a filtering "},{"type":"element","tag":"a","props":{"href":"http://en.wikipedia.org/wiki/Message_transfer_agent","rel":["nofollow"]},"children":[{"type":"text","value":"MTA"}]},{"type":"text","value":". It also works well as a "},{"type":"element","tag":"a","props":{"href":"http://en.wikipedia.org/wiki/Mail_submission_agent","rel":["nofollow"]},"children":[{"type":"text","value":"MSA"}]},{"type":"text","value":" running on\nport 587 with auth and "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/dkim_sign.md","rel":["nofollow"]},"children":[{"type":"text","value":"dkim_sign"}]},{"type":"text","value":" plugins enabled."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Haraka makes no attempt to be a mail store (like Exchange or Postfix/Exim/Qmail),\na "},{"type":"element","tag":"a","props":{"href":"https://en.wikipedia.org/wiki/Mail_delivery_agent","rel":["nofollow"]},"children":[{"type":"text","value":"LDA"}]},{"type":"text","value":", nor an IMAP server (like Dovecot or Courier). Haraka is\ntypically used "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"with"}]},{"type":"text","value":" such systems."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Haraka has a scalable outbound mail delivery engine built in. Mail\nmarked as "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"relaying"}]},{"type":"text","value":" (such as via an "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"auth"}]},{"type":"text","value":" plugin) is automatically\nqueued for outbound delivery."}]},{"type":"element","tag":"h3","props":{"id":"getting-help"},"children":[{"type":"text","value":"Getting Help"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"mailto:haraka-sub@harakamail.com"},"children":[{"type":"text","value":"Join the mailing list"}]},{"type":"text","value":" (implemented as a Haraka plugin)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://communityinviter.com/apps/harakaserver/public-inviter","rel":["nofollow"]},"children":[{"type":"text","value":"Join us on Slack"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/issues","rel":["nofollow"]},"children":[{"type":"text","value":"GitHub Issues"}]}]}]},{"type":"element","tag":"h3","props":{"id":"screencast"},"children":[{"type":"text","value":"Screencast"}]},{"type":"element","tag":"div","props":{},"children":[{"type":"element","tag":"video-player","props":{"src":"https://www.youtube.com/watch?v=6twKXMAsPsw"},"children":[]}]},{"type":"element","tag":"h3","props":{"id":"why-use-haraka"},"children":[{"type":"text","value":"Why Use Haraka?"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Haraka's plugin architecture provides an easily extensible MTA that\ncomplements traditional MTAs that excel at managing mail stores but do\nnot have sufficient filtering."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The plugin system makes it easy to code new features. A typical example\nis providing qmail-like extended addresses to an Exchange system,\nwhereby you could receive mail as "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"user-anyword@domain.com"}]},{"type":"text","value":", and yet\nstill have it correctly routed to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"user@domain.com"}]},{"type":"text","value":". This is a few lines of\ncode in Haraka."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Plugins are provided for running mail through "},{"type":"element","tag":"a","props":{"href":"https://haraka.github.io/plugins/spamassassin/","rel":["nofollow"]},"children":[{"type":"text","value":"SpamAssassin"}]},{"type":"text","value":", validating\n"},{"type":"element","tag":"a","props":{"href":"https://haraka.github.io/plugins/helo.checks/","rel":["nofollow"]},"children":[{"type":"text","value":"HELO"}]},{"type":"text","value":" names, checking "},{"type":"element","tag":"a","props":{"href":"https://haraka.github.io/plugins/dnsbl/","rel":["nofollow"]},"children":[{"type":"text","value":"DNS Blocklists"}]},{"type":"text","value":", and "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/tree/master/plugins","rel":["nofollow"]},"children":[{"type":"text","value":"many others"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h3","props":{"id":"installing-haraka"},"children":[{"type":"text","value":"Installing Haraka"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Haraka requires "},{"type":"element","tag":"a","props":{"href":"http://nodejs.org","rel":["nofollow"]},"children":[{"type":"text","value":"node.js"}]},{"type":"text","value":" to run. Install Haraka with [npm]"},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"2"}]},{"type":"text","value":":"}]},{"type":"element","tag":"code-group","props":{},"children":[{"type":"element","tag":"code","props":{"code":"npm install -g Haraka\n","filename":"npm","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-705f4b"},"children":[{"type":"text","value":"npm install -g Haraka"}]}]}]}]}]},{"type":"element","tag":"code","props":{"code":"yarn add global Haraka\n","filename":"yarn","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-705f4b"},"children":[{"type":"text","value":"yarn add global Haraka"}]}]}]}]}]},{"type":"element","tag":"code","props":{"code":"pnpm add -g Haraka\n","filename":"pnpm","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-705f4b"},"children":[{"type":"text","value":"pnpm add -g Haraka"}]}]}]}]}]}]},{"type":"element","tag":"alert","props":{"type":"info"},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If the command gives \"nobody\" errors run the next command"}]}]},{"type":"element","tag":"code-group","props":{},"children":[{"type":"element","tag":"code","props":{"code":"npm -g config set user root\nnpm install -g Haraka\n","filename":"npm","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-705f4b"},"children":[{"type":"text","value":"npm -g config "}]},{"type":"element","tag":"span","props":{"class":"ct-dbb89d"},"children":[{"type":"text","value":"set"}]},{"type":"element","tag":"span","props":{"class":"ct-705f4b"},"children":[{"type":"text","value":" user root"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-705f4b"},"children":[{"type":"text","value":"npm install -g Haraka"}]}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"After installation, use the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"haraka"}]},{"type":"text","value":" binary to set up the service."}]},{"type":"element","tag":"h3","props":{"id":"running-haraka"},"children":[{"type":"text","value":"Running Haraka"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"First, create the service:"}]},{"type":"element","tag":"code","props":{"code":"haraka -i /path/to/haraka_test\n","language":"sh"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-705f4b"},"children":[{"type":"text","value":"haraka -i /path/to/haraka_test"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"That creates the directory "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"haraka_test"}]},{"type":"text","value":" with "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config"}]},{"type":"text","value":" and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"plugin"}]},{"type":"text","value":"\ndirectories within. It also sets the host name used by Haraka\nto the output of "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"hostname"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"hostname"}]},{"type":"text","value":" is not correct, edit "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/host_list"}]},{"type":"text","value":". For example,\nto receive mail addressed to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"user@domain.com"}]},{"type":"text","value":", add "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"domain.com"}]},{"type":"text","value":" to the\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/host_list"}]},{"type":"text","value":" file."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Finally, start Haraka using root permissions:"}]},{"type":"element","tag":"code","props":{"code":"haraka -c /path/to/haraka_test\n","language":"sh"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-705f4b"},"children":[{"type":"text","value":"haraka -c /path/to/haraka_test"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"And it will run."}]},{"type":"element","tag":"h3","props":{"id":"configure-haraka"},"children":[{"type":"text","value":"Configure Haraka"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To choose which plugins run, edit "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/plugins"}]},{"type":"text","value":". Plugins control the\noverall behaviour of Haraka. By default, only messages to domains listed\nin "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/host_list"}]},{"type":"text","value":" will be accepted and then delivered via the\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"smtp-forward"}]},{"type":"text","value":" plugin. Configure the destination in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/smtp_forward.ini"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h3","props":{"id":"read-the-fine-manual"},"children":[{"type":"text","value":"Read the Fine Manual"}]},{"type":"element","tag":"code","props":{"code":"haraka -h plugins/$name\n","language":"sh"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-705f4b"},"children":[{"type":"text","value":"haraka -h plugins/$name"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The docs detail how each plugin is configured. After editing\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/plugins"}]},{"type":"text","value":", restart Haraka and enjoy!"}]},{"type":"element","tag":"h3","props":{"id":"running-from-git"},"children":[{"type":"text","value":"Running from git"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you are unable to use npm to install Haraka, you can run from git by\nfollowing these steps:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"First clone the repository:"}]},{"type":"element","tag":"code","props":{"code":"git clone https://github.com/haraka/Haraka.git\ncd Haraka\n","language":"sh"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-705f4b"},"children":[{"type":"text","value":"git clone https://github.com/haraka/Haraka.git"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dbb89d"},"children":[{"type":"text","value":"cd"}]},{"type":"element","tag":"span","props":{"class":"ct-705f4b"},"children":[{"type":"text","value":" Haraka"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Install Haraka's node.js dependencies locally:"}]},{"type":"element","tag":"code","props":{"code":"npm install\n","language":"sh"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-705f4b"},"children":[{"type":"text","value":"npm install"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Edit "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/plugins"}]},{"type":"text","value":" and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/smtp.ini"}]},{"type":"text","value":" to specify the plugins and\nconfig you want."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Finally run Haraka:"}]},{"type":"element","tag":"code","props":{"code":"node haraka.js\n","language":"sh"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-705f4b"},"children":[{"type":"text","value":"node haraka.js"}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"license-and-author"},"children":[{"type":"text","value":"License and Author"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Haraka is MIT licensed - see the "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/LICENSE","rel":["nofollow"]},"children":[{"type":"text","value":"LICENSE"}]},{"type":"text","value":" file for details."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Haraka is a project started by "},{"type":"element","tag":"a","props":{"href":"https://github.com/baudehlo","rel":["nofollow"]},"children":[{"type":"text","value":"Matt Sergeant"}]},{"type":"text","value":", a 10 year veteran of the email\nand anti-spam world. Previous projects have been the project leader for\nSpamAssassin and a hacker on "},{"type":"element","tag":"a","props":{"href":"https://github.com/smtpd/qpsmtpd/","rel":["nofollow"]},"children":[{"type":"text","value":"Qpsmtpd"}]},{"type":"text","value":"."}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-dbb89d{color:#0550AE}\n.ct-705f4b{color:#24292F}\n.dark .ct-705f4b{color:#C9D1D9}\n.dark .ct-dbb89d{color:#79C0FF}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"haraka","depth":2,"text":"Haraka","children":[{"id":"getting-help","depth":3,"text":"Getting Help"},{"id":"screencast","depth":3,"text":"Screencast"},{"id":"why-use-haraka","depth":3,"text":"Why Use Haraka?"},{"id":"installing-haraka","depth":3,"text":"Installing Haraka"},{"id":"running-haraka","depth":3,"text":"Running Haraka"},{"id":"configure-haraka","depth":3,"text":"Configure Haraka"},{"id":"read-the-fine-manual","depth":3,"text":"Read the Fine Manual"},{"id":"running-from-git","depth":3,"text":"Running from git"},{"id":"license-and-author","depth":3,"text":"License and Author"}]}]}},"_type":"markdown","_id":"content:1.getting_started.md","_source":"content","_file":"1.getting_started.md","_extension":"md"},{"_path":"/about","_dir":"","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"About","description":"These pages attempt to give a potted history of Haraka.","excerpt":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"introduction-to-haraka"},"children":[{"type":"text","value":"Introduction to Haraka"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Haraka is a high performance SMTP server. It came out of Matt Sergeant's experience at MessageLabs/Symantec, building extremely high performance spam traps that had to process thousands of concurrent high latency connections."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Having worked on Qpsmtpd before, the basic design of a plugin system was taken from Qpsmtpd, and applied to a new Node.js mail server."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The original goal was to learn how to code in Node.js, but it turned into so much more."}]},{"type":"element","tag":"h2","props":{"id":"a-growing-user-base"},"children":[{"type":"text","value":"A Growing User Base"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Shortly after releasing the first few working versions, Haraka was noticed by Craigslist. They were looking to implement something similar, likely in C++, but also using an event loop architecture for scalability. Their current Postfix servers were not scaling well enough."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Craigslist extended Haraka and improved many of the core features and plugins. After rollout to their systems they de-commissioned around 50% of their hardware that was wasted by the difficult to extend Postfix system."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"At the same time, other high end users, including British anti-spam systems developers FSL, began to notice Haraka."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"With many commercial contributors, Haraka has grown into a very capable, stable and scalable mail server."}]},{"type":"element","tag":"h2","props":{"id":"adding-outbound"},"children":[{"type":"text","value":"Adding Outbound"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Once Haraka was fully capable of replacing anyone's inbound mail server (where mail arrives for them from the Internet, and where you have to implement the most stringent of Anti-Spam methods), it was time to add a scalable outbound mail sender to Haraka."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We spent many late nights putting together the outbound feature and making sure it was as scalable as the inbound service. Testing shows that it is several times faster than Postfix at sending email."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"There's still work to do on outbound, but for most senders it will fit the bill perfectly."}]},{"type":"element","tag":"h2","props":{"id":"future-directions"},"children":[{"type":"text","value":"Future Directions"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In the future Haraka intends to add features to make the outbound system rival those of commercial large scale mail vendors such as Port 25 and Message Systems."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To do that we need to add a queue management system which scales transparently across clusters. Large receivers of email have specific requirements which are hard to adhere to when you have a cluster of hardware, such as how much mail they are willing to receive in a particular time window."}]}]},"body":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"introduction-to-haraka"},"children":[{"type":"text","value":"Introduction to Haraka"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Haraka is a high performance SMTP server. It came out of Matt Sergeant's experience at MessageLabs/Symantec, building extremely high performance spam traps that had to process thousands of concurrent high latency connections."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Having worked on Qpsmtpd before, the basic design of a plugin system was taken from Qpsmtpd, and applied to a new Node.js mail server."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The original goal was to learn how to code in Node.js, but it turned into so much more."}]},{"type":"element","tag":"h2","props":{"id":"a-growing-user-base"},"children":[{"type":"text","value":"A Growing User Base"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Shortly after releasing the first few working versions, Haraka was noticed by Craigslist. They were looking to implement something similar, likely in C++, but also using an event loop architecture for scalability. Their current Postfix servers were not scaling well enough."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Craigslist extended Haraka and improved many of the core features and plugins. After rollout to their systems they de-commissioned around 50% of their hardware that was wasted by the difficult to extend Postfix system."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"At the same time, other high end users, including British anti-spam systems developers FSL, began to notice Haraka."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"With many commercial contributors, Haraka has grown into a very capable, stable and scalable mail server."}]},{"type":"element","tag":"h2","props":{"id":"adding-outbound"},"children":[{"type":"text","value":"Adding Outbound"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Once Haraka was fully capable of replacing anyone's inbound mail server (where mail arrives for them from the Internet, and where you have to implement the most stringent of Anti-Spam methods), it was time to add a scalable outbound mail sender to Haraka."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We spent many late nights putting together the outbound feature and making sure it was as scalable as the inbound service. Testing shows that it is several times faster than Postfix at sending email."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"There's still work to do on outbound, but for most senders it will fit the bill perfectly."}]},{"type":"element","tag":"h2","props":{"id":"future-directions"},"children":[{"type":"text","value":"Future Directions"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In the future Haraka intends to add features to make the outbound system rival those of commercial large scale mail vendors such as Port 25 and Message Systems."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To do that we need to add a queue management system which scales transparently across clusters. Large receivers of email have specific requirements which are hard to adhere to when you have a cluster of hardware, such as how much mail they are willing to receive in a particular time window."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"introduction-to-haraka","depth":2,"text":"Introduction to Haraka"},{"id":"a-growing-user-base","depth":2,"text":"A Growing User Base"},{"id":"adding-outbound","depth":2,"text":"Adding Outbound"},{"id":"future-directions","depth":2,"text":"Future Directions"}]}},"_type":"markdown","_id":"content:2.about.md","_source":"content","_file":"2.about.md","_extension":"md"},{"_path":"/community","_dir":"","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"Community","description":"Haraka has a strong community presence. Use the links below to talk with us.","excerpt":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"mailing-list"},"children":[{"type":"text","value":"Mailing List"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Haraka has an active Mailing List which you can join by sending a mail to "},{"type":"element","tag":"a","props":{"href":"mailto:haraka-sub@harakamail.com"},"children":[{"type":"text","value":"haraka-sub@harakamail.com"}]},{"type":"text","value":". We are working on providing list archives."}]},{"type":"element","tag":"h2","props":{"id":"slack"},"children":[{"type":"text","value":"Slack"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The core developers have much of their discussions about features in the Slack channel #haraka. You can join us there by "},{"type":"element","tag":"a","props":{"href":"https://communityinviter.com/apps/harakaserver/public-inviter","rel":["nofollow"]},"children":[{"type":"text","value":"clicking here"}]},{"type":"text","value":". It is highly recommended to join the IRC channel if you are new to Haraka and wish to ask questions. They will be answered fastest there."}]},{"type":"element","tag":"h2","props":{"id":"github"},"children":[{"type":"text","value":"Github"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For everything else, we use Github. Post bug reports there on the issue tracker and feel free to browse the code and try and learn the structure of the project."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Haraka can be found at "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka","rel":["nofollow"]},"children":[{"type":"text","value":"haraka/Haraka"}]},{"type":"text","value":" on Github."}]}]},"body":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"mailing-list"},"children":[{"type":"text","value":"Mailing List"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Haraka has an active Mailing List which you can join by sending a mail to "},{"type":"element","tag":"a","props":{"href":"mailto:haraka-sub@harakamail.com"},"children":[{"type":"text","value":"haraka-sub@harakamail.com"}]},{"type":"text","value":". We are working on providing list archives."}]},{"type":"element","tag":"h2","props":{"id":"slack"},"children":[{"type":"text","value":"Slack"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The core developers have much of their discussions about features in the Slack channel #haraka. You can join us there by "},{"type":"element","tag":"a","props":{"href":"https://communityinviter.com/apps/harakaserver/public-inviter","rel":["nofollow"]},"children":[{"type":"text","value":"clicking here"}]},{"type":"text","value":". It is highly recommended to join the IRC channel if you are new to Haraka and wish to ask questions. They will be answered fastest there."}]},{"type":"element","tag":"h2","props":{"id":"github"},"children":[{"type":"text","value":"Github"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For everything else, we use Github. Post bug reports there on the issue tracker and feel free to browse the code and try and learn the structure of the project."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Haraka can be found at "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka","rel":["nofollow"]},"children":[{"type":"text","value":"haraka/Haraka"}]},{"type":"text","value":" on Github."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"mailing-list","depth":2,"text":"Mailing List"},{"id":"slack","depth":2,"text":"Slack"},{"id":"github","depth":2,"text":"Github"}]}},"_type":"markdown","_id":"content:3.community.md","_source":"content","_file":"3.community.md","_extension":"md"},{"_path":"/users","_dir":"","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"Known Users","description":"Large Scale Haraka Users","excerpt":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"large-scale-haraka-users"},"children":[{"type":"text","value":"Large Scale Haraka Users"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Haraka is used by many large scale email providers. If you are using Haraka in a large scale environment, please add your company to this list."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://cloudron.io"},"children":[{"type":"text","value":"Cloudron - A platform for self-hosting web apps"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://www.craigslist.org/about/thanks"},"children":[{"type":"text","value":"Craigslist - Over 20 million emails a day through Haraka"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.emailitin.com/"},"children":[{"type":"text","value":"Email It In - A service to email files to Google Drive, Dropbox or Skydrive"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://www.fortantispam.com/"},"children":[{"type":"text","value":"Fort Anti-Spam"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://mail.tm"},"children":[{"type":"text","value":"Mail.tm - Temporary Email"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://mirusresearch.com/"},"children":[{"type":"text","value":"Mirus Research - Address simplification/forwarding services"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://threatwave.com/"},"children":[{"type":"text","value":"ThreatWave - Hidden insights and data from email - over 150 million emails a day"}]}]}]}]},"body":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"large-scale-haraka-users"},"children":[{"type":"text","value":"Large Scale Haraka Users"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Haraka is used by many large scale email providers. If you are using Haraka in a large scale environment, please add your company to this list."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://cloudron.io"},"children":[{"type":"text","value":"Cloudron - A platform for self-hosting web apps"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://www.craigslist.org/about/thanks"},"children":[{"type":"text","value":"Craigslist - Over 20 million emails a day through Haraka"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.emailitin.com/"},"children":[{"type":"text","value":"Email It In - A service to email files to Google Drive, Dropbox or Skydrive"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://www.fortantispam.com/"},"children":[{"type":"text","value":"Fort Anti-Spam"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://mail.tm"},"children":[{"type":"text","value":"Mail.tm - Temporary Email"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://mirusresearch.com/"},"children":[{"type":"text","value":"Mirus Research - Address simplification/forwarding services"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://threatwave.com/"},"children":[{"type":"text","value":"ThreatWave - Hidden insights and data from email - over 150 million emails a day"}]}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"large-scale-haraka-users","depth":2,"text":"Large Scale Haraka Users"}]}},"_type":"markdown","_id":"content:5.users.md","_source":"content","_file":"5.users.md","_extension":"md"},{"_path":"/core/_dir","_dir":"core","_draft":false,"_partial":true,"_locale":"en","title":"Core","_id":"content:6.core:_dir.yml","_type":"yaml","_source":"content","_file":"6.core/_dir.yml","_extension":"yml"},{"_path":"/core/Address","_dir":"core","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"Address Object","description":"The Address object is an interface to reading email addresses passed in at\nSMTP time. As such it parses all the formats in RFC-2821 and 2822, and\nsupports correctly escaping email addresses.","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"address-object"},"children":[{"type":"text","value":"Address Object"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The Address object is an interface to reading email addresses passed in at\nSMTP time. As such it parses all the formats in RFC-2821 and 2822, and\nsupports correctly escaping email addresses."}]},{"type":"element","tag":"h2","props":{"id":"api"},"children":[{"type":"text","value":"API"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"new Address (user, host)"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Create a new address object for user@host"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"new Address (email)"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Creates a new address object by parsing the email address. Will throw an\nexception if the address cannot be parsed."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"address.user"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Access the local part of the email address"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"address.host"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Access the domain part of the email adress"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"address.format()"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Provides the email address in the appropriate "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"<user@host>"}]},{"type":"text","value":" format. And\ndeals correctly with the null sender and local names."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"address.toString()"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Same as format()."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"address.address()"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Provides the email address in 'user@host' format."}]},{"type":"element","tag":"h2","props":{"id":"advanced-usage"},"children":[{"type":"text","value":"Advanced Usage"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It is possible to mess with the regular expressions used to match addresses\nfor stricter or less strict matching."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To change the behaviour mess with the following variables:"}]},{"type":"element","tag":"code","props":{"code":"var adr = require('./address');\n// Now change one of the following. Note they are RegExp objects NOT strings.\nadr.atom_expr;\nadr.address_literal_expr;\nadr.subdomain_expr;\nadr.domain_expr;\nadr.qtext_expr;\nadr.text_expr;\n// Don't forget to recompile:\nadr.compile_re();\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"var adr = require('./address');\n// Now change one of the following. Note they are RegExp objects NOT strings.\nadr.atom_expr;\nadr.address_literal_expr;\nadr.subdomain_expr;\nadr.domain_expr;\nadr.qtext_expr;\nadr.text_expr;\n// Don't forget to recompile:\nadr.compile_re();\n"}]}]}]}]},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"address-object"},"children":[{"type":"text","value":"Address Object"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The Address object is an interface to reading email addresses passed in at\nSMTP time. As such it parses all the formats in RFC-2821 and 2822, and\nsupports correctly escaping email addresses."}]},{"type":"element","tag":"h2","props":{"id":"api"},"children":[{"type":"text","value":"API"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"new Address (user, host)"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Create a new address object for user@host"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"new Address (email)"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Creates a new address object by parsing the email address. Will throw an\nexception if the address cannot be parsed."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"address.user"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Access the local part of the email address"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"address.host"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Access the domain part of the email adress"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"address.format()"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Provides the email address in the appropriate "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"<user@host>"}]},{"type":"text","value":" format. And\ndeals correctly with the null sender and local names."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"address.toString()"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Same as format()."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"address.address()"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Provides the email address in 'user@host' format."}]},{"type":"element","tag":"h2","props":{"id":"advanced-usage"},"children":[{"type":"text","value":"Advanced Usage"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It is possible to mess with the regular expressions used to match addresses\nfor stricter or less strict matching."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To change the behaviour mess with the following variables:"}]},{"type":"element","tag":"code","props":{"code":"var adr = require('./address');\n// Now change one of the following. Note they are RegExp objects NOT strings.\nadr.atom_expr;\nadr.address_literal_expr;\nadr.subdomain_expr;\nadr.domain_expr;\nadr.qtext_expr;\nadr.text_expr;\n// Don't forget to recompile:\nadr.compile_re();\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"var adr = require('./address');\n// Now change one of the following. Note they are RegExp objects NOT strings.\nadr.atom_expr;\nadr.address_literal_expr;\nadr.subdomain_expr;\nadr.domain_expr;\nadr.qtext_expr;\nadr.text_expr;\n// Don't forget to recompile:\nadr.compile_re();"}]}]}]}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"api","depth":2,"text":"API"},{"id":"advanced-usage","depth":2,"text":"Advanced Usage"}]}},"_type":"markdown","_id":"content:6.core:1.Address.md","_source":"content","_file":"6.core/1.Address.md","_extension":"md"},{"_path":"/core/Body","_dir":"core","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"Body Object","description":"This documentation has moved to haraka/email-message.","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"body-object"},"children":[{"type":"text","value":"Body Object"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This documentation has moved to "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/email-message#body","rel":["nofollow"]},"children":[{"type":"text","value":"haraka/email-message"}]},{"type":"text","value":"."}]}]},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"body-object"},"children":[{"type":"text","value":"Body Object"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This documentation has moved to "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/email-message#body","rel":["nofollow"]},"children":[{"type":"text","value":"haraka/email-message"}]},{"type":"text","value":"."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:6.core:2.Body.md","_source":"content","_file":"6.core/2.Body.md","_extension":"md"},{"_path":"/core/Config","_dir":"core","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"Config","description":"This documentation has moved to haraka-config.","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"config"},"children":[{"type":"text","value":"Config"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This documentation has moved to "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-config","rel":["nofollow"]},"children":[{"type":"text","value":"haraka-config"}]},{"type":"text","value":"."}]}]},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"config"},"children":[{"type":"text","value":"Config"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This documentation has moved to "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-config","rel":["nofollow"]},"children":[{"type":"text","value":"haraka-config"}]},{"type":"text","value":"."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:6.core:3.Config.md","_source":"content","_file":"6.core/3.Config.md","_extension":"md"},{"_path":"/core/Connection","_dir":"core","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"Connection Object","description":"For each connection to Haraka there is one connection object.","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"connection-object"},"children":[{"type":"text","value":"Connection Object"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For each connection to Haraka there is one connection object."}]},{"type":"element","tag":"h2","props":{"id":"api"},"children":[{"type":"text","value":"API"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connection.uuid"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A unique UUID for this connection."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connection.remote - info about the host that is connecting to Haraka."},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"ip   - remote IP address"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"host - reverse DNS of the remote hosts IP"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"is_private - true if the remote IP is from a private (loopback, RFC 1918, link local, etc.) IP address."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"is_local - true if the remote IP is localhost (loopback, link local)"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connection.local - info about the host that is running Haraka"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"ip - the IP of the Haraka server, as reported by the OS"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"port - the port number handling the connection."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"host - the rDNS host name of the local IP"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connection.proxy - proxy properties set when a proxy is used (like haproxy)"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"allowed - if the remote IP has proxy permission"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"ip - when proxied, the proxy servers IP address"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"type - currently null or 'haproxy'"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connection.hello"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"verb - Either 'EHLO' or 'HELO' whichever the remote end used"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"host - The hostname given with HELO or EHLO"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connection.notes"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"An object which persists during the lifetime of the connection. It is used to store connection-specific properties. See also, connection.results and "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-notes","rel":["nofollow"]},"children":[{"type":"text","value":"haraka-notes"}]},{"type":"text","value":"."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connection.transaction"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The current transaction object, valid after MAIL FROM, and destroyed at queue\ntime, RSET time, or if MAIL FROM was rejected. See the Transaction Object\ndocumentation file."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connection.relaying"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A boolean flag to say whether this connection is allowed to relay mails (i.e.\ndeliver mails outbound). This is normally set by SMTP AUTH, or sometimes via\nan IP address check."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connection.current_line"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For low level use. Contains the current line sent from the remote end,\nverbatim as it was sent. Can be useful in certain botnet detection techniques."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connection.last_response"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Contains the last SMTP response sent to the client."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connection.remote_closed"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For low level use.  This value is set when the remote host drops the connection."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connection.results"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Store results of processing in a structured format. See "},{"type":"element","tag":"a","props":{"href":"http://haraka.github.io/manual/Results.html","rel":["nofollow"]},"children":[{"type":"text","value":"docs/Results"}]}]}]},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"connection-object"},"children":[{"type":"text","value":"Connection Object"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For each connection to Haraka there is one connection object."}]},{"type":"element","tag":"h2","props":{"id":"api"},"children":[{"type":"text","value":"API"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connection.uuid"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A unique UUID for this connection."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connection.remote - info about the host that is connecting to Haraka."},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"ip   - remote IP address"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"host - reverse DNS of the remote hosts IP"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"is_private - true if the remote IP is from a private (loopback, RFC 1918, link local, etc.) IP address."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"is_local - true if the remote IP is localhost (loopback, link local)"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connection.local - info about the host that is running Haraka"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"ip - the IP of the Haraka server, as reported by the OS"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"port - the port number handling the connection."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"host - the rDNS host name of the local IP"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connection.proxy - proxy properties set when a proxy is used (like haproxy)"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"allowed - if the remote IP has proxy permission"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"ip - when proxied, the proxy servers IP address"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"type - currently null or 'haproxy'"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connection.hello"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"verb - Either 'EHLO' or 'HELO' whichever the remote end used"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"host - The hostname given with HELO or EHLO"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connection.notes"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"An object which persists during the lifetime of the connection. It is used to store connection-specific properties. See also, connection.results and "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-notes","rel":["nofollow"]},"children":[{"type":"text","value":"haraka-notes"}]},{"type":"text","value":"."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connection.transaction"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The current transaction object, valid after MAIL FROM, and destroyed at queue\ntime, RSET time, or if MAIL FROM was rejected. See the Transaction Object\ndocumentation file."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connection.relaying"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A boolean flag to say whether this connection is allowed to relay mails (i.e.\ndeliver mails outbound). This is normally set by SMTP AUTH, or sometimes via\nan IP address check."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connection.current_line"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For low level use. Contains the current line sent from the remote end,\nverbatim as it was sent. Can be useful in certain botnet detection techniques."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connection.last_response"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Contains the last SMTP response sent to the client."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connection.remote_closed"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For low level use.  This value is set when the remote host drops the connection."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connection.results"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Store results of processing in a structured format. See "},{"type":"element","tag":"a","props":{"href":"http://haraka.github.io/manual/Results.html","rel":["nofollow"]},"children":[{"type":"text","value":"docs/Results"}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"api","depth":2,"text":"API"}]}},"_type":"markdown","_id":"content:6.core:4.Connection.md","_source":"content","_file":"6.core/4.Connection.md","_extension":"md"},{"_path":"/core/CoreConfig","_dir":"core","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"Core Configuration Files","description":"See Logging.","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"core-configuration-files"},"children":[{"type":"text","value":"Core Configuration Files"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"See "},{"type":"element","tag":"a","props":{"href":"/core/Logging"},"children":[{"type":"text","value":"Logging"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The Haraka core reads some configuration files to determine a few actions:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"smtp.yaml or smtp.json"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If either of these files exist then they are loaded first after log.ini.\nThis file is designed to use the JSON/YAML file overrides documented in\n"},{"type":"element","tag":"a","props":{"href":"/core/Config"},"children":[{"type":"text","value":"Config"}]},{"type":"text","value":" to optionally provide the entire configuration in a single file."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"databytes"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Contains the maximum SIZE of an email that Haraka will receive."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"plugins"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The list of plugins to load"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"smtp.ini"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Keys:"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"listen_host, port - the host and port to listen on (default: ::0 and 25)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"listen - (default: "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"::0"}]},{"type":"text","value":":25) Comma separated IP:Port addresses to listen on"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"inactivity_time - how long to let clients idle in seconds (default: 300)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"nodes - specifies how many processes to fork. The string \"cpus\" will fork as many children as there are CPUs (default: 1, which enables cluster mode with a single process)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"user - optionally a user to drop privileges to. Can be a string or UID."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"group - optionally a group to drop privileges to. Can be a string or GID."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"ignore_bad_plugins - If a plugin fails to compile by default Haraka will stop at load time.\nIf, however, you wish to continue on without that plugin's facilities, then\nset this config option"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"daemonize - enable this to cause Haraka to fork into the background on start-up (default: 0)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"daemon_log_file - (default: /var/log/haraka.log) where to redirect stdout/stderr when daemonized"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"daemon_pid_file - (default: /var/run/haraka.pid) where to write a PID file to"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"spool_dir - (default: none) directory to create temporary spool files in"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"spool_after - (default: -1) if message exceeds this size in bytes, then spool the message to disk\nspecify -1 to disable spooling completely or 0 to force all messages to be spooled to disk."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"graceful_shutdown - (default: false) enable this to wait for sockets on shutdown instead of closing them quickly"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"force_shutdown_timeout - (default: 30) number of seconds to wait for a graceful shutdown"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"smtputf8 - (default: true) advertise support for SMTPUTF8"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"strict_rfc1869 - (default: false) Requires senders to conform to RFC 1869 and RFC 821 when sending the MAIL FROM and RCPT TO commands. In particular,\nthe inclusion of spurious spaces or missing angle brackets will be rejected."}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"me"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"A name to use for this server. Used in received lines and elsewhere. Setup\nby default to be your hostname."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"deny_includes_uuid"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Each connection and mail in Haraka includes a UUID which is also in most log\nmessages. If you put a "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"1"}]},{"type":"text","value":" in this file then every denied mail (either via\nDENY/5xx or DENYSOFT/4xx return codes) will include the uuid at the start\nof each line of the deny message in brackets, making it easy to track\nproblems back to the logs."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Because UUIDs are long, if you put a number greater than 1 in the config\nfile, it will be truncated to that length. We recommend a 6 as a good\nbalance of finding in the logs and not making lines too long."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"banner_includes_uuid"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"This will add the full UUID to the first line of the SMTP greeting banner."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"early_talker_delay"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If clients talk early we "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"punish"}]},{"type":"text","value":" them with a delay of this many milliseconds\ndefault: 1000."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"plugin_timeout"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Seconds to allow a plugin to run before the next hook is called automatically\ndefault: 30"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Note also that each plugin can have a "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/<plugin_name>.timeout"}]},{"type":"text","value":"\nfile specifying a per-plugin timeout.  In this file you can set a timeout of 0 to mean that this plugin's hooks never time out.  Use this with care."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If the plugin is in a sub-directory of plugins, then you must create this file\nin the equivalent path e.g. the queue/smtp_forward would need a timeout file in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/queue/smtp_forward.timeout"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"smtpgreeting"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The greeting line used when a client connects. This can be multiple lines\nif required (this may cause some connecting machines to fail - though\nusually only spam-bots)."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"max_received_count"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The maximum number of \"Received\" headers allowed in an email. This is a\nsimple protection against mail loops. Defaults to 100."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"max_line_length"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The maximum length of lines in SMTP session commands (e.g. RCPT, HELO etc).\nDefaults to 512 (bytes) which is mandated by RFC 5321 §4.5.3.1.4. Clients\nexceeding this limit will be immediately disconnected with a \"521 Command\nline too long\" error."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"max_data_line_length"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The maximum length of lines in the DATA section of emails. Defaults to 992\n(bytes) which is the limit set by Sendmail. When this limit is exceeded the\nthree bytes \"\\r\\n \" (0x0d 0x0a 0x20) are inserted into the stream to \"fix\"\nit. This has the potential to \"break\" some email, but makes it more likely\nto be accepted by upstream/downstream services, and is the same behaviour\nas Sendmail. Also when the data line length limit is exceeded\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"transaction.notes.data_line_length_exceeded"}]},{"type":"text","value":" is set to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"true"}]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"outbound.concurrency_max"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Maximum concurrency to use when delivering mails outbound. Defaults to 100."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"outbound.disabled"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Put a "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"1"}]},{"type":"text","value":" in this file to temporarily disable outbound delivery. Useful\nwhile figuring out network issues or testing."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"outbound.bounce_message"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The bounce message if delivery of the message fails. The default is normally fine. Bounce messages contain a number of template\nreplacement values which are best discovered by looking at the source code."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"haproxy_hosts"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"A list of HAProxy hosts that Haraka should enable the PROXY protocol from.\nSee "},{"type":"element","tag":"a","props":{"href":"/core/HAProxy"},"children":[{"type":"text","value":"HAProxy"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"max_mime_parts"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Defaults to 1000. There's a potential denial of service in large numbers of\nMIME parts in carefully crafted emails. If this limit is too low for some\nreason you can increase it by setting a value in this file."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connection_close_message"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Defaults to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"closing connection. Have a jolly good day."}]},{"type":"text","value":" can be overrridden with custom text"}]}]}]},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"core-configuration-files"},"children":[{"type":"text","value":"Core Configuration Files"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"See "},{"type":"element","tag":"a","props":{"href":"/core/Logging"},"children":[{"type":"text","value":"Logging"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The Haraka core reads some configuration files to determine a few actions:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"smtp.yaml or smtp.json"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If either of these files exist then they are loaded first after log.ini.\nThis file is designed to use the JSON/YAML file overrides documented in\n"},{"type":"element","tag":"a","props":{"href":"/core/Config"},"children":[{"type":"text","value":"Config"}]},{"type":"text","value":" to optionally provide the entire configuration in a single file."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"databytes"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Contains the maximum SIZE of an email that Haraka will receive."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"plugins"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The list of plugins to load"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"smtp.ini"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Keys:"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"listen_host, port - the host and port to listen on (default: ::0 and 25)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"listen - (default: "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"::0"}]},{"type":"text","value":":25) Comma separated IP:Port addresses to listen on"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"inactivity_time - how long to let clients idle in seconds (default: 300)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"nodes - specifies how many processes to fork. The string \"cpus\" will fork as many children as there are CPUs (default: 1, which enables cluster mode with a single process)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"user - optionally a user to drop privileges to. Can be a string or UID."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"group - optionally a group to drop privileges to. Can be a string or GID."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"ignore_bad_plugins - If a plugin fails to compile by default Haraka will stop at load time.\nIf, however, you wish to continue on without that plugin's facilities, then\nset this config option"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"daemonize - enable this to cause Haraka to fork into the background on start-up (default: 0)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"daemon_log_file - (default: /var/log/haraka.log) where to redirect stdout/stderr when daemonized"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"daemon_pid_file - (default: /var/run/haraka.pid) where to write a PID file to"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"spool_dir - (default: none) directory to create temporary spool files in"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"spool_after - (default: -1) if message exceeds this size in bytes, then spool the message to disk\nspecify -1 to disable spooling completely or 0 to force all messages to be spooled to disk."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"graceful_shutdown - (default: false) enable this to wait for sockets on shutdown instead of closing them quickly"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"force_shutdown_timeout - (default: 30) number of seconds to wait for a graceful shutdown"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"smtputf8 - (default: true) advertise support for SMTPUTF8"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"strict_rfc1869 - (default: false) Requires senders to conform to RFC 1869 and RFC 821 when sending the MAIL FROM and RCPT TO commands. In particular,\nthe inclusion of spurious spaces or missing angle brackets will be rejected."}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"me"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"A name to use for this server. Used in received lines and elsewhere. Setup\nby default to be your hostname."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"deny_includes_uuid"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Each connection and mail in Haraka includes a UUID which is also in most log\nmessages. If you put a "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"1"}]},{"type":"text","value":" in this file then every denied mail (either via\nDENY/5xx or DENYSOFT/4xx return codes) will include the uuid at the start\nof each line of the deny message in brackets, making it easy to track\nproblems back to the logs."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Because UUIDs are long, if you put a number greater than 1 in the config\nfile, it will be truncated to that length. We recommend a 6 as a good\nbalance of finding in the logs and not making lines too long."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"banner_includes_uuid"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"This will add the full UUID to the first line of the SMTP greeting banner."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"early_talker_delay"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If clients talk early we "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"punish"}]},{"type":"text","value":" them with a delay of this many milliseconds\ndefault: 1000."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"plugin_timeout"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Seconds to allow a plugin to run before the next hook is called automatically\ndefault: 30"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Note also that each plugin can have a "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/<plugin_name>.timeout"}]},{"type":"text","value":"\nfile specifying a per-plugin timeout.  In this file you can set a timeout of 0 to mean that this plugin's hooks never time out.  Use this with care."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If the plugin is in a sub-directory of plugins, then you must create this file\nin the equivalent path e.g. the queue/smtp_forward would need a timeout file in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/queue/smtp_forward.timeout"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"smtpgreeting"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The greeting line used when a client connects. This can be multiple lines\nif required (this may cause some connecting machines to fail - though\nusually only spam-bots)."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"max_received_count"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The maximum number of \"Received\" headers allowed in an email. This is a\nsimple protection against mail loops. Defaults to 100."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"max_line_length"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The maximum length of lines in SMTP session commands (e.g. RCPT, HELO etc).\nDefaults to 512 (bytes) which is mandated by RFC 5321 §4.5.3.1.4. Clients\nexceeding this limit will be immediately disconnected with a \"521 Command\nline too long\" error."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"max_data_line_length"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The maximum length of lines in the DATA section of emails. Defaults to 992\n(bytes) which is the limit set by Sendmail. When this limit is exceeded the\nthree bytes \"\\r\\n \" (0x0d 0x0a 0x20) are inserted into the stream to \"fix\"\nit. This has the potential to \"break\" some email, but makes it more likely\nto be accepted by upstream/downstream services, and is the same behaviour\nas Sendmail. Also when the data line length limit is exceeded\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"transaction.notes.data_line_length_exceeded"}]},{"type":"text","value":" is set to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"true"}]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"outbound.concurrency_max"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Maximum concurrency to use when delivering mails outbound. Defaults to 100."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"outbound.disabled"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Put a "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"1"}]},{"type":"text","value":" in this file to temporarily disable outbound delivery. Useful\nwhile figuring out network issues or testing."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"outbound.bounce_message"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The bounce message if delivery of the message fails. The default is normally fine. Bounce messages contain a number of template\nreplacement values which are best discovered by looking at the source code."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"haproxy_hosts"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"A list of HAProxy hosts that Haraka should enable the PROXY protocol from.\nSee "},{"type":"element","tag":"a","props":{"href":"/core/HAProxy"},"children":[{"type":"text","value":"HAProxy"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"max_mime_parts"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Defaults to 1000. There's a potential denial of service in large numbers of\nMIME parts in carefully crafted emails. If this limit is too low for some\nreason you can increase it by setting a value in this file."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connection_close_message"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Defaults to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"closing connection. Have a jolly good day."}]},{"type":"text","value":" can be overrridden with custom text"}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:6.core:5.CoreConfig.md","_source":"content","_file":"6.core/5.CoreConfig.md","_extension":"md"},{"_path":"/core/CustomReturnCodes","_dir":"core","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"Custom Return Codes","description":"This content has moved to haraka-dsn.","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"custom-return-codes"},"children":[{"type":"text","value":"Custom Return Codes"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This content has moved to "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-dsn","rel":["nofollow"]},"children":[{"type":"text","value":"haraka-dsn"}]},{"type":"text","value":"."}]}]},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"custom-return-codes"},"children":[{"type":"text","value":"Custom Return Codes"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This content has moved to "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-dsn","rel":["nofollow"]},"children":[{"type":"text","value":"haraka-dsn"}]},{"type":"text","value":"."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:6.core:6.CustomReturnCodes.md","_source":"content","_file":"6.core/6.CustomReturnCodes.md","_extension":"md"},{"_path":"/core/HAProxy","_dir":"core","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"HAProxy PROXY protocol extension support","description":"Haraka natively supports the PROXY protocol 1.","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"haproxy"},"children":[{"type":"text","value":"HAProxy"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Haraka natively supports the PROXY protocol "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This allows an upstream proxy to pass IP address and port of the client which\nHaraka will use instead of the socket IP address (which is of the proxy).\nThis allows DNSBLs and access control lists to operate on the proxied address."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Support is disabled by default and if HAProxy or other attempts to send a\nPROXY command then Haraka will return a DENYSOFTDISCONNECT error.\nDENYSOFT is used to prevent configuration errors from rejecting valid mail."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To enable support for PROXY you must create a "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"haproxy_hosts"}]},{"type":"text","value":" configuration\nfile which should contain a list of IP addresses of the HAProxy hosts\nthat should be allowed to send the PROXY command. A range of IP\naddresses can be specified by it's CIDR network address."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When a host connects to Haraka that matches an IP address present in the\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"haproxy_hosts"}]},{"type":"text","value":" file - a banner is not sent, instead Haraka waits for the\nPROXY command to be sent before proceeding.  The connection will timeout\nwith "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"421 PROXY timed out"}]},{"type":"text","value":" if the command is not sent within 30 seconds."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"NOTE: because Haraka does not send a banner when a listed HAProxy host\nconnects you must set check-send-proxy to ensure that the service checks\nsend a PROXY command before they run."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"1"}]},{"type":"text","value":" "},{"type":"element","tag":"a","props":{"href":"http://haproxy.1wt.eu/download/1.5/doc/proxy-protocol.txt","rel":["nofollow"]},"children":[{"type":"text","value":"http://haproxy.1wt.eu/download/1.5/doc/proxy-protocol.txt"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"HAProxy supports the PROXY protocol in version 1.5 or later however there\nare patches available to add support for 1.4."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Here is an example listener section for haproxy.cfg:"}]},{"type":"element","tag":"code","props":{"code":"listen smtp :25\n        mode tcp\n        option tcplog\n        option smtpchk\n        balance roundrobin\n        server smtp1 ip.of.haraka.server1:25 check-send-proxy check inter 10s send-proxy\n        server smtp2 ip.of.haraka.server2:25 check-send-proxy check inter 10s send-proxy\n        server smtp3 ip.of.haraka.server3:25 check-send-proxy check inter 10s send-proxy\n        server smtp4 ip.of.haraka.server4:25 check-send-proxy check inter 10s send-proxy\n        server smtp5 ip.of.haraka.server5:25 check-send-proxy check inter 10s send-proxy\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"listen smtp :25\n        mode tcp\n        option tcplog\n        option smtpchk\n        balance roundrobin\n        server smtp1 ip.of.haraka.server1:25 check-send-proxy check inter 10s send-proxy\n        server smtp2 ip.of.haraka.server2:25 check-send-proxy check inter 10s send-proxy\n        server smtp3 ip.of.haraka.server3:25 check-send-proxy check inter 10s send-proxy\n        server smtp4 ip.of.haraka.server4:25 check-send-proxy check inter 10s send-proxy\n        server smtp5 ip.of.haraka.server5:25 check-send-proxy check inter 10s send-proxy\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The important part is "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"send-proxy"}]},{"type":"text","value":" which causes HAProxy to send the PROXY\nextension on connection."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When using "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"option smtpchk"}]},{"type":"text","value":" you will see CONNRESET errors reported in the Haraka logs as\nsmtpchk drops the connection before the HELO response is still being written.\nYou can use the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"option tcp-check"}]},{"type":"text","value":" instead to provide a better service check by having\nthe check wait for the banner, send QUIT and then check the response:"}]},{"type":"element","tag":"code","props":{"code":"    option tcp-check\n    tcp-check expect rstring ^220\\ \n    tcp-check send QUIT\\r\\n\n    tcp-check expect rstring ^221\\ \n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"    option tcp-check\n    tcp-check expect rstring ^220\\ \n    tcp-check send QUIT\\r\\n\n    tcp-check expect rstring ^221\\ \n"}]}]}]}]},"navigation":{"title":"HAProxy"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"haproxy"},"children":[{"type":"text","value":"HAProxy"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Haraka natively supports the PROXY protocol "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This allows an upstream proxy to pass IP address and port of the client which\nHaraka will use instead of the socket IP address (which is of the proxy).\nThis allows DNSBLs and access control lists to operate on the proxied address."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Support is disabled by default and if HAProxy or other attempts to send a\nPROXY command then Haraka will return a DENYSOFTDISCONNECT error.\nDENYSOFT is used to prevent configuration errors from rejecting valid mail."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To enable support for PROXY you must create a "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"haproxy_hosts"}]},{"type":"text","value":" configuration\nfile which should contain a list of IP addresses of the HAProxy hosts\nthat should be allowed to send the PROXY command. A range of IP\naddresses can be specified by it's CIDR network address."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When a host connects to Haraka that matches an IP address present in the\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"haproxy_hosts"}]},{"type":"text","value":" file - a banner is not sent, instead Haraka waits for the\nPROXY command to be sent before proceeding.  The connection will timeout\nwith "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"421 PROXY timed out"}]},{"type":"text","value":" if the command is not sent within 30 seconds."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"NOTE: because Haraka does not send a banner when a listed HAProxy host\nconnects you must set check-send-proxy to ensure that the service checks\nsend a PROXY command before they run."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"1"}]},{"type":"text","value":" "},{"type":"element","tag":"a","props":{"href":"http://haproxy.1wt.eu/download/1.5/doc/proxy-protocol.txt","rel":["nofollow"]},"children":[{"type":"text","value":"http://haproxy.1wt.eu/download/1.5/doc/proxy-protocol.txt"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"HAProxy supports the PROXY protocol in version 1.5 or later however there\nare patches available to add support for 1.4."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Here is an example listener section for haproxy.cfg:"}]},{"type":"element","tag":"code","props":{"code":"listen smtp :25\n        mode tcp\n        option tcplog\n        option smtpchk\n        balance roundrobin\n        server smtp1 ip.of.haraka.server1:25 check-send-proxy check inter 10s send-proxy\n        server smtp2 ip.of.haraka.server2:25 check-send-proxy check inter 10s send-proxy\n        server smtp3 ip.of.haraka.server3:25 check-send-proxy check inter 10s send-proxy\n        server smtp4 ip.of.haraka.server4:25 check-send-proxy check inter 10s send-proxy\n        server smtp5 ip.of.haraka.server5:25 check-send-proxy check inter 10s send-proxy\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"listen smtp :25\n        mode tcp\n        option tcplog\n        option smtpchk\n        balance roundrobin\n        server smtp1 ip.of.haraka.server1:25 check-send-proxy check inter 10s send-proxy\n        server smtp2 ip.of.haraka.server2:25 check-send-proxy check inter 10s send-proxy\n        server smtp3 ip.of.haraka.server3:25 check-send-proxy check inter 10s send-proxy\n        server smtp4 ip.of.haraka.server4:25 check-send-proxy check inter 10s send-proxy\n        server smtp5 ip.of.haraka.server5:25 check-send-proxy check inter 10s send-proxy"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The important part is "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"send-proxy"}]},{"type":"text","value":" which causes HAProxy to send the PROXY\nextension on connection."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When using "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"option smtpchk"}]},{"type":"text","value":" you will see CONNRESET errors reported in the Haraka logs as\nsmtpchk drops the connection before the HELO response is still being written.\nYou can use the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"option tcp-check"}]},{"type":"text","value":" instead to provide a better service check by having\nthe check wait for the banner, send QUIT and then check the response:"}]},{"type":"element","tag":"code","props":{"code":"    option tcp-check\n    tcp-check expect rstring ^220\\ \n    tcp-check send QUIT\\r\\n\n    tcp-check expect rstring ^221\\ \n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"    option tcp-check\n    tcp-check expect rstring ^220\\ \n    tcp-check send QUIT\\r\\n\n    tcp-check expect rstring ^221\\ "}]}]}]}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:6.core:7.HAProxy.md","_source":"content","_file":"6.core/7.HAProxy.md","_extension":"md"},{"_path":"/core/Header","_dir":"core","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"Header Object","description":"This documentation has moved to haraka/email-message.","excerpt":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This documentation has moved to "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/email-message#header","rel":["nofollow"]},"children":[{"type":"text","value":"haraka/email-message"}]},{"type":"text","value":"."}]}]},"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This documentation has moved to "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/email-message#header","rel":["nofollow"]},"children":[{"type":"text","value":"haraka/email-message"}]},{"type":"text","value":"."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:6.core:9.Header.md","_source":"content","_file":"6.core/9.Header.md","_extension":"md"},{"_path":"/core/Net_Utils","_dir":"core","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"Net_Utils","description":"This module provides network utility functions.","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"net_utils"},"children":[{"type":"text","value":"Net_Utils"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This module provides network utility functions."}]},{"type":"element","tag":"h2","props":{"id":"usage"},"children":[{"type":"text","value":"Usage"}]},{"type":"element","tag":"code","props":{"code":"var net_utils = require('./net_utils');\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"var net_utils = require('./net_utils');\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"ip_to_long"},"children":[{"type":"text","value":"ip_to_long"}]},{"type":"element","tag":"code","props":{"code":"// Convert IPv4 to long\nvar long = net_utils.ip_to_long('11.22.33.44');  // 185999660\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"// Convert IPv4 to long\nvar long = net_utils.ip_to_long('11.22.33.44');  // 185999660\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"long_to_ip"},"children":[{"type":"text","value":"long_to_ip"}]},{"type":"element","tag":"code","props":{"code":"// Convert long to IPv4\nvar ip = net_utils.long_to_ip(185999660);  // 11.22.33.44\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"// Convert long to IPv4\nvar ip = net_utils.long_to_ip(185999660);  // 11.22.33.44\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"dec_to_hex"},"children":[{"type":"text","value":"dec_to_hex"}]},{"type":"element","tag":"code","props":{"code":"// Convert decimal to hex\nvar hex = net_utils.dec_to_hex(20111104);  // 132df00\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"// Convert decimal to hex\nvar hex = net_utils.dec_to_hex(20111104);  // 132df00\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"hex_to_dec"},"children":[{"type":"text","value":"hex_to_dec"}]},{"type":"element","tag":"code","props":{"code":"// Convert hex to decimal\nvar dec = net_utils.hex_to_dec('132df00');  // 20111104\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"// Convert hex to decimal\nvar dec = net_utils.hex_to_dec('132df00');  // 20111104\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"is_local_ipv4"},"children":[{"type":"text","value":"is_local_ipv4"}]},{"type":"element","tag":"code","props":{"code":"// Is IPv4 address on a local network?\nnet_utils.is_local_ipv4('127.0.0.200');   // true (localhost)\nnet_utils.is_local_ipv4('169.254.0.0');   // true (link local)\nnet_utils.is_local_ipv4('226.0.0.1');     // false\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"// Is IPv4 address on a local network?\nnet_utils.is_local_ipv4('127.0.0.200');   // true (localhost)\nnet_utils.is_local_ipv4('169.254.0.0');   // true (link local)\nnet_utils.is_local_ipv4('226.0.0.1');     // false\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"is_private_ipv4"},"children":[{"type":"text","value":"is_private_ipv4"}]},{"type":"element","tag":"code","props":{"code":"// Is IPv4 address in RFC 1918 reserved private address space?\nnet_utils.is_private_ipv4('10.0.0.0');       // true\nnet_utils.is_private_ipv4('192.168.0.0');    // true\nnet_utils.is_private_ipv4('172.16.0.0');     // true\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"// Is IPv4 address in RFC 1918 reserved private address space?\nnet_utils.is_private_ipv4('10.0.0.0');       // true\nnet_utils.is_private_ipv4('192.168.0.0');    // true\nnet_utils.is_private_ipv4('172.16.0.0');     // true\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"is_local_ipv6"},"children":[{"type":"text","value":"is_local_ipv6"}]},{"type":"element","tag":"code","props":{"code":"// Is IPv6 addr on local network?\nnet_utils.is_local_ipv6('::1');           // true (localhost)\nnet_utils.is_local_ipv6('fe80::')         // true (link local)\nnet_utils.is_local_ipv6('fc00::')         // true (unique local)\nnet_utils.is_local_ipv6('fd00::')         // true (unique local)\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"// Is IPv6 addr on local network?\nnet_utils.is_local_ipv6('::1');           // true (localhost)\nnet_utils.is_local_ipv6('fe80::')         // true (link local)\nnet_utils.is_local_ipv6('fc00::')         // true (unique local)\nnet_utils.is_local_ipv6('fd00::')         // true (unique local)\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"is_private_ip"},"children":[{"type":"text","value":"is_private_ip"}]},{"type":"element","tag":"code","props":{"code":"// determines if an IPv4 or IPv6 address is on a \"private\" network\n// For IPv4, returns true if is_private_ipv4 or is_local_ipv4 are true\n// For IPv6, returns true if is_local_ipv6 is true\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"// determines if an IPv4 or IPv6 address is on a \"private\" network\n// For IPv4, returns true if is_private_ipv4 or is_local_ipv4 are true\n// For IPv6, returns true if is_local_ipv6 is true\n"}]}]}]}]},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"net_utils"},"children":[{"type":"text","value":"Net_Utils"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This module provides network utility functions."}]},{"type":"element","tag":"h2","props":{"id":"usage"},"children":[{"type":"text","value":"Usage"}]},{"type":"element","tag":"code","props":{"code":"var net_utils = require('./net_utils');\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-23bac9"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":" net_utils "}]},{"type":"element","tag":"span","props":{"class":"ct-23bac9"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-404be3"},"children":[{"type":"text","value":"require"}]},{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-2fa1ab"},"children":[{"type":"text","value":"'./net_utils'"}]},{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":");"}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"ip_to_long"},"children":[{"type":"text","value":"ip_to_long"}]},{"type":"element","tag":"code","props":{"code":"// Convert IPv4 to long\nvar long = net_utils.ip_to_long('11.22.33.44');  // 185999660\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-75e720"},"children":[{"type":"text","value":"// Convert IPv4 to long"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-23bac9"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":" long "}]},{"type":"element","tag":"span","props":{"class":"ct-23bac9"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":" net_utils."}]},{"type":"element","tag":"span","props":{"class":"ct-08f0ec"},"children":[{"type":"text","value":"ip_to_long"}]},{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-2fa1ab"},"children":[{"type":"text","value":"'11.22.33.44'"}]},{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":");  "}]},{"type":"element","tag":"span","props":{"class":"ct-75e720"},"children":[{"type":"text","value":"// 185999660"}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"long_to_ip"},"children":[{"type":"text","value":"long_to_ip"}]},{"type":"element","tag":"code","props":{"code":"// Convert long to IPv4\nvar ip = net_utils.long_to_ip(185999660);  // 11.22.33.44\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-75e720"},"children":[{"type":"text","value":"// Convert long to IPv4"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-23bac9"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":" ip "}]},{"type":"element","tag":"span","props":{"class":"ct-23bac9"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":" net_utils."}]},{"type":"element","tag":"span","props":{"class":"ct-08f0ec"},"children":[{"type":"text","value":"long_to_ip"}]},{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-404be3"},"children":[{"type":"text","value":"185999660"}]},{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":");  "}]},{"type":"element","tag":"span","props":{"class":"ct-75e720"},"children":[{"type":"text","value":"// 11.22.33.44"}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"dec_to_hex"},"children":[{"type":"text","value":"dec_to_hex"}]},{"type":"element","tag":"code","props":{"code":"// Convert decimal to hex\nvar hex = net_utils.dec_to_hex(20111104);  // 132df00\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-75e720"},"children":[{"type":"text","value":"// Convert decimal to hex"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-23bac9"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":" hex "}]},{"type":"element","tag":"span","props":{"class":"ct-23bac9"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":" net_utils."}]},{"type":"element","tag":"span","props":{"class":"ct-08f0ec"},"children":[{"type":"text","value":"dec_to_hex"}]},{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-404be3"},"children":[{"type":"text","value":"20111104"}]},{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":");  "}]},{"type":"element","tag":"span","props":{"class":"ct-75e720"},"children":[{"type":"text","value":"// 132df00"}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"hex_to_dec"},"children":[{"type":"text","value":"hex_to_dec"}]},{"type":"element","tag":"code","props":{"code":"// Convert hex to decimal\nvar dec = net_utils.hex_to_dec('132df00');  // 20111104\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-75e720"},"children":[{"type":"text","value":"// Convert hex to decimal"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-23bac9"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":" dec "}]},{"type":"element","tag":"span","props":{"class":"ct-23bac9"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":" net_utils."}]},{"type":"element","tag":"span","props":{"class":"ct-08f0ec"},"children":[{"type":"text","value":"hex_to_dec"}]},{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-2fa1ab"},"children":[{"type":"text","value":"'132df00'"}]},{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":");  "}]},{"type":"element","tag":"span","props":{"class":"ct-75e720"},"children":[{"type":"text","value":"// 20111104"}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"is_local_ipv4"},"children":[{"type":"text","value":"is_local_ipv4"}]},{"type":"element","tag":"code","props":{"code":"// Is IPv4 address on a local network?\nnet_utils.is_local_ipv4('127.0.0.200');   // true (localhost)\nnet_utils.is_local_ipv4('169.254.0.0');   // true (link local)\nnet_utils.is_local_ipv4('226.0.0.1');     // false\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-75e720"},"children":[{"type":"text","value":"// Is IPv4 address on a local network?"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":"net_utils."}]},{"type":"element","tag":"span","props":{"class":"ct-08f0ec"},"children":[{"type":"text","value":"is_local_ipv4"}]},{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-2fa1ab"},"children":[{"type":"text","value":"'127.0.0.200'"}]},{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":");   "}]},{"type":"element","tag":"span","props":{"class":"ct-75e720"},"children":[{"type":"text","value":"// true (localhost)"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":"net_utils."}]},{"type":"element","tag":"span","props":{"class":"ct-08f0ec"},"children":[{"type":"text","value":"is_local_ipv4"}]},{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-2fa1ab"},"children":[{"type":"text","value":"'169.254.0.0'"}]},{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":");   "}]},{"type":"element","tag":"span","props":{"class":"ct-75e720"},"children":[{"type":"text","value":"// true (link local)"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":"net_utils."}]},{"type":"element","tag":"span","props":{"class":"ct-08f0ec"},"children":[{"type":"text","value":"is_local_ipv4"}]},{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-2fa1ab"},"children":[{"type":"text","value":"'226.0.0.1'"}]},{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":");     "}]},{"type":"element","tag":"span","props":{"class":"ct-75e720"},"children":[{"type":"text","value":"// false"}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"is_private_ipv4"},"children":[{"type":"text","value":"is_private_ipv4"}]},{"type":"element","tag":"code","props":{"code":"// Is IPv4 address in RFC 1918 reserved private address space?\nnet_utils.is_private_ipv4('10.0.0.0');       // true\nnet_utils.is_private_ipv4('192.168.0.0');    // true\nnet_utils.is_private_ipv4('172.16.0.0');     // true\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-75e720"},"children":[{"type":"text","value":"// Is IPv4 address in RFC 1918 reserved private address space?"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":"net_utils."}]},{"type":"element","tag":"span","props":{"class":"ct-08f0ec"},"children":[{"type":"text","value":"is_private_ipv4"}]},{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-2fa1ab"},"children":[{"type":"text","value":"'10.0.0.0'"}]},{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":");       "}]},{"type":"element","tag":"span","props":{"class":"ct-75e720"},"children":[{"type":"text","value":"// true"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":"net_utils."}]},{"type":"element","tag":"span","props":{"class":"ct-08f0ec"},"children":[{"type":"text","value":"is_private_ipv4"}]},{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-2fa1ab"},"children":[{"type":"text","value":"'192.168.0.0'"}]},{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":");    "}]},{"type":"element","tag":"span","props":{"class":"ct-75e720"},"children":[{"type":"text","value":"// true"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":"net_utils."}]},{"type":"element","tag":"span","props":{"class":"ct-08f0ec"},"children":[{"type":"text","value":"is_private_ipv4"}]},{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-2fa1ab"},"children":[{"type":"text","value":"'172.16.0.0'"}]},{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":");     "}]},{"type":"element","tag":"span","props":{"class":"ct-75e720"},"children":[{"type":"text","value":"// true"}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"is_local_ipv6"},"children":[{"type":"text","value":"is_local_ipv6"}]},{"type":"element","tag":"code","props":{"code":"// Is IPv6 addr on local network?\nnet_utils.is_local_ipv6('::1');           // true (localhost)\nnet_utils.is_local_ipv6('fe80::')         // true (link local)\nnet_utils.is_local_ipv6('fc00::')         // true (unique local)\nnet_utils.is_local_ipv6('fd00::')         // true (unique local)\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-75e720"},"children":[{"type":"text","value":"// Is IPv6 addr on local network?"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":"net_utils."}]},{"type":"element","tag":"span","props":{"class":"ct-08f0ec"},"children":[{"type":"text","value":"is_local_ipv6"}]},{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-2fa1ab"},"children":[{"type":"text","value":"'::1'"}]},{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":");           "}]},{"type":"element","tag":"span","props":{"class":"ct-75e720"},"children":[{"type":"text","value":"// true (localhost)"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":"net_utils."}]},{"type":"element","tag":"span","props":{"class":"ct-08f0ec"},"children":[{"type":"text","value":"is_local_ipv6"}]},{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-2fa1ab"},"children":[{"type":"text","value":"'fe80::'"}]},{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":")         "}]},{"type":"element","tag":"span","props":{"class":"ct-75e720"},"children":[{"type":"text","value":"// true (link local)"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":"net_utils."}]},{"type":"element","tag":"span","props":{"class":"ct-08f0ec"},"children":[{"type":"text","value":"is_local_ipv6"}]},{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-2fa1ab"},"children":[{"type":"text","value":"'fc00::'"}]},{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":")         "}]},{"type":"element","tag":"span","props":{"class":"ct-75e720"},"children":[{"type":"text","value":"// true (unique local)"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":"net_utils."}]},{"type":"element","tag":"span","props":{"class":"ct-08f0ec"},"children":[{"type":"text","value":"is_local_ipv6"}]},{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-2fa1ab"},"children":[{"type":"text","value":"'fd00::'"}]},{"type":"element","tag":"span","props":{"class":"ct-8b5fac"},"children":[{"type":"text","value":")         "}]},{"type":"element","tag":"span","props":{"class":"ct-75e720"},"children":[{"type":"text","value":"// true (unique local)"}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"is_private_ip"},"children":[{"type":"text","value":"is_private_ip"}]},{"type":"element","tag":"code","props":{"code":"// determines if an IPv4 or IPv6 address is on a \"private\" network\n// For IPv4, returns true if is_private_ipv4 or is_local_ipv4 are true\n// For IPv6, returns true if is_local_ipv6 is true\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-75e720"},"children":[{"type":"text","value":"// determines if an IPv4 or IPv6 address is on a \"private\" network"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-75e720"},"children":[{"type":"text","value":"// For IPv4, returns true if is_private_ipv4 or is_local_ipv4 are true"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-75e720"},"children":[{"type":"text","value":"// For IPv6, returns true if is_local_ipv6 is true"}]}]}]}]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-08f0ec{color:#8250DF}\n.ct-75e720{color:#6E7781}\n.ct-2fa1ab{color:#0A3069}\n.ct-404be3{color:#0550AE}\n.ct-8b5fac{color:#24292F}\n.ct-23bac9{color:#CF222E}\n.dark .ct-23bac9{color:#FF7B72}\n.dark .ct-8b5fac{color:#C9D1D9}\n.dark .ct-404be3{color:#79C0FF}\n.dark .ct-2fa1ab{color:#A5D6FF}\n.dark .ct-75e720{color:#8B949E}\n.dark .ct-08f0ec{color:#D2A8FF}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"usage","depth":2,"text":"Usage","children":[{"id":"ip_to_long","depth":3,"text":"ip_to_long"},{"id":"long_to_ip","depth":3,"text":"long_to_ip"},{"id":"dec_to_hex","depth":3,"text":"dec_to_hex"},{"id":"hex_to_dec","depth":3,"text":"hex_to_dec"},{"id":"is_local_ipv4","depth":3,"text":"is_local_ipv4"},{"id":"is_private_ipv4","depth":3,"text":"is_private_ipv4"},{"id":"is_local_ipv6","depth":3,"text":"is_local_ipv6"},{"id":"is_private_ip","depth":3,"text":"is_private_ip"}]}]}},"_type":"markdown","_id":"content:6.core:10.Net_Utils.md","_source":"content","_file":"6.core/10.Net_Utils.md","_extension":"md"},{"_path":"/core/Outbound","_dir":"core","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"Outbound Mail with Haraka","description":"How to send outbound mail with Haraka","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"outbound-mail"},"children":[{"type":"text","value":"Outbound Mail"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A default installation of Haraka will queue outbound mail for delivery in the\nqueue directory. Those mails will be delivered to the appropriate MX record\nfor that domain. Mails are queued onto your disk, and will deal appropriately\nwith temporary failures to retry delivery later."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Outbound mails are defined as those that have set the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"connection.relaying"}]},{"type":"text","value":"\nflag to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"true"}]},{"type":"text","value":" via a plugin. The simplest way of doing that is to use SMTP\nAUTH, and have the client authenticate. For example using the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"auth/flat_file"}]},{"type":"text","value":"\nplugin. However it is very simple to write a custom plugin to do this."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For statistics on outbound mail use the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"process_title"}]},{"type":"text","value":" plugin. See the\ndocumentation for that plugin for details."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To flush the outbound queue (for temporary failed mails) hit the Haraka master\nprocess with the SIGHUP signal (via the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"kill"}]},{"type":"text","value":" command line tool)."}]},{"type":"element","tag":"h2","props":{"id":"outbound-configuration-files"},"children":[{"type":"text","value":"Outbound Configuration Files"}]},{"type":"element","tag":"h3","props":{"id":"outboundini"},"children":[{"type":"text","value":"outbound.ini"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"disabled"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Default: false. Allows one to temporarily disable outbound delivery, while\nstill receiving and queuing emails. This can be changed while Haraka is\nrunning."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"concurrency_max"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Default: 100. Specifies the maximum concurrent connections to make. Note that\nif using cluster (multiple CPUs) then this will be multiplied by the number\nof CPUs that you have."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"enable_tls"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Default: true. Switch to false to disable TLS for outbound mail."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This uses the same "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"tls_key.pem"}]},{"type":"text","value":" and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"tls_cert.pem"}]},{"type":"text","value":" files that the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"tls"}]},{"type":"text","value":"\nplugin uses, along with other values in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"tls.ini"}]},{"type":"text","value":". See the "},{"type":"element","tag":"a","props":{"href":"http://haraka.github.io/manual/plugins/tls.html","rel":["nofollow"]},"children":[{"type":"text","value":"tls plugin\ndocs"}]},{"type":"text","value":" for information on generating those\nfiles."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Within "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"tls.ini"}]},{"type":"text","value":" you can specify global options for the values "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"ciphers"}]},{"type":"text","value":",\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"requestCert"}]},{"type":"text","value":" and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"rejectUnauthorized"}]},{"type":"text","value":", alternatively you can provide\nseparate values by putting them under a key: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[outbound]"}]},{"type":"text","value":", such as:"}]},{"type":"element","tag":"code","props":{"code":"[outbound]\nciphers=!DES\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"[outbound]\nciphers=!DES\n"}]}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"ipv6_enabled"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When this has a \"true\" value inside (usually a "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"), it defaults to an 'AAAA'\nlookup first for each MX record, and uses those hosts to send email via."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"always_split"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Default: false. By default, Haraka groups message recipients by domain so that\nmessages with multiple recipients at the same domain get sent in a single SMTP\nsession. When "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"always_split"}]},{"type":"text","value":" is enabled, each recipient gets a queue entry and\ndelivery in its own SMTP session. This carries a performance penalty but\nenables more flexibility in mail delivery and bounce handling."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"received_header"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Default: \"Haraka outbound\". If this text is any string except "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"disabled"}]},{"type":"text","value":", the\nstring is attached as a "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Received"}]},{"type":"text","value":" header to all outbound mail just before it is queued."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"connect_timeout"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Timeout for connecting to remote servers. Default: 30s"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"pool_timeout"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Outbound mail uses \"pooled\" connections. An unused pool connection will send\na QUIT after this time. Default: 50s"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Pooled connections means that a mail to a particular IP address will hold that\nconnection open and use it the next time it is requested. This helps with\nlarge scale outbound mail. If you don't send lots of mail it is advised to\nlower the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"pool_timeout"}]},{"type":"text","value":" value since it may upset receiving mail servers."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Setting this value to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"0"}]},{"type":"text","value":" will effectively disable the use of pools. You may\nwish to set this if you have a "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"get_mx"}]},{"type":"text","value":" hook that picks outbound servers on\na per-email basis (rather than per-domain)."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"pool_concurrency_max"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Set this to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"0"}]},{"type":"text","value":" to completely disable the pooling code."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This value determines how many concurrent connections can be made to a single\nIP address (destination) in the pool. Default: 10 connections."}]},{"type":"element","tag":"h3","props":{"id":"outboundbounce_message"},"children":[{"type":"text","value":"outbound.bounce_message"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"See \"Bounce Messages\" below for details."}]},{"type":"element","tag":"h2","props":{"id":"the-hmail-object"},"children":[{"type":"text","value":"The HMail Object"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Many hooks (see below) pass in a "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"hmail"}]},{"type":"text","value":" object."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You likely won't ever need to call methods on this object, so they are left\nundocumented here."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The attributes of an "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"hmail"}]},{"type":"text","value":" object that may be of use are:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"path - the full path to the queue file"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"filename - the filename within the queue dir"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"num_failures - the number of times this mail has been temp failed"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"notes - notes you can store on a hmail object (similar to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"transaction.notes"}]},{"type":"text","value":")\nto allow you to pass information between outbound hooks"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"todo - see below"}]}]},{"type":"element","tag":"h2","props":{"id":"the-todo-object"},"children":[{"type":"text","value":"The ToDo Object"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"todo"}]},{"type":"text","value":" object contains information about how to deliver this mail. Keys\nyou may be interested in are:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"rcpt_to - an Array of "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Address"}]},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"1"}]},{"type":"text","value":" objects - the rfc.2821 recipients of this mail"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"mail_from - an "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Address"}]},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"1"}]},{"type":"text","value":" object - the rfc.2821 sender of this mail"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"domain - the domain this mail is going to (see "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"always_split"}]},{"type":"text","value":" above)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"notes - the original transaction.notes for this mail, also contains the\nfollowing useful keys:\n** outbound_ip - the IP address to bind to (note do not set this manually,\nuse the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"get_mx"}]},{"type":"text","value":" hook)\n** outbound_helo - the EHLO domain to use (again, do not set manually)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"queue_time - the epoch milliseconds time when this mail was queued"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"uuid - the original transaction.uuid"}]}]},{"type":"element","tag":"h2","props":{"id":"outbound-mail-hooks"},"children":[{"type":"text","value":"Outbound Mail Hooks"}]},{"type":"element","tag":"h3","props":{"id":"the-queue_outbound-hook"},"children":[{"type":"text","value":"The queue_outbound hook"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The first hook that is called prior to queueing an outbound mail is the\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"queue_outbound"}]},{"type":"text","value":" hook. Only if all these hooks return "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"CONT"}]},{"type":"text","value":" (or if there are\nno hooks) will the mail be queued for outbound delivery. A return of "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"OK"}]},{"type":"text","value":" will\nindicate that the mail has been queued in some custom manner for outbound\ndelivery. Any of the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"DENY"}]},{"type":"text","value":" return codes will cause the message to be\nappropriately rejected."}]},{"type":"element","tag":"h3","props":{"id":"the-send_email-hook"},"children":[{"type":"text","value":"The send_email hook"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Parameters: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next, hmail"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Called just as the email is about to be sent."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Respond with "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next(DELAY, delay_seconds)"}]},{"type":"text","value":" to defer sending the email at this time."}]},{"type":"element","tag":"h3","props":{"id":"the-get_mx-hook"},"children":[{"type":"text","value":"The get_mx hook"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Parameters: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next, hmail, domain"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Upon starting delivery the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"get_mx"}]},{"type":"text","value":" hook is called, with the parameter set to\nthe domain in question (for example a mail to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"user@example.com"}]},{"type":"text","value":" will call the\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"get_mx"}]},{"type":"text","value":" hook with "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"(next, hmail, domain)"}]},{"type":"text","value":" as parameters). This is to allow\nyou to implement a custom handler to find MX records. For most installations\nthere is no reason to implement this hook - Haraka will find the correct MX\nrecords for you."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The MX record is sent via next(OK, mx) and can be one of:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"A string of one of the following formats:"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hostname"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hostname:port"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"ipaddress"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"ipaddress:port"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"An MX object of the form: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"{priority: 0, exchange: hostname}"}]},{"type":"text","value":" with the\nfollowing optional properies:\n* "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"port"}]},{"type":"text","value":" to specify an alternate port\n* "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"bind"}]},{"type":"text","value":" to specify an outbound IP address to bind to\n* "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"bind_helo"}]},{"type":"text","value":" to specify an outbound helo for IP address to bind to\n* "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"using_lmtp"}]},{"type":"text","value":" boolean to specify that delivery should be attempted using\nLMTP instead of SMTP.\n*  "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"auth_user"}]},{"type":"text","value":" to specify an AUTH username (required if AUTH is desired)\n*  "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"auth_pass"}]},{"type":"text","value":" to specify an AUTH password (required if AUTH is desired)\n*  "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"auth_type"}]},{"type":"text","value":" to specify an AUTH type that should be used with the MX.\nIf this is not specified then Haraka will pick an appropriate method."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"A list of MX objects in an array, each in the same format as above."}]}]},{"type":"element","tag":"h3","props":{"id":"the-deferred-hook"},"children":[{"type":"text","value":"The deferred hook"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Parameters: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next, hmail, {delay: ..., err: ...}"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If the mail is temporarily deferred, the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"deferred"}]},{"type":"text","value":" hook is called. The hook\nparameter is an object with keys: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"delay"}]},{"type":"text","value":" and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"err"}]},{"type":"text","value":", which explain the delay\n(in seconds) and error message."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you want to stop at this point, and drop the mail completely, then you\ncan call "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next(OK)"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you want to change the delay, then call "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next(DENYSOFT, delay_in_seconds)"}]},{"type":"text","value":".\nUsing this you can define a custom delay algorithm indexed by\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"hmail.num_failures"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h3","props":{"id":"the-bounce-hook"},"children":[{"type":"text","value":"The bounce hook"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Parameters: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next, hmail, error"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If the mail completely bounces then the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"bounce"}]},{"type":"text","value":" hook is called. This is "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"not"}]},{"type":"text","value":"\ncalled if the mail is issued a temporary failure (a 4xx error code). The hook\nparameter is the error message received from the remote end as an "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Error"}]},{"type":"text","value":" object.\nThe object may also have the following properties:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"mx - the MX object that caused the bounce"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"deferred_rcpt - the deferred recipients that eventually bounced"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"bounced_rcpt - the bounced recipients"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you do not wish to have a bounce message sent to the originating sender of the\nemail then you can return "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"OK"}]},{"type":"text","value":" from this hook to stop it from sending a bounce message."}]},{"type":"element","tag":"h3","props":{"id":"the-delivered-hook"},"children":[{"type":"text","value":"The delivered hook"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Parameters: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next, hmail, params"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Params is a list of: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[host, ip, response, delay, port, mode, ok_recips, secured]"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When mails are successfully delivered to the remote end then the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"delivered"}]},{"type":"text","value":"\nhook is called. The return codes from this hook have no effect, so it is only\nuseful for logging the fact that a successful delivery occurred."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"host"}]},{"type":"text","value":" - Hostname of the MX that the message was delivered to,"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"ip"}]},{"type":"text","value":" - IP address of the host that the message was delivered to,"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"response"}]},{"type":"text","value":" - Variable contains the SMTP response text returned by the host\nthat received the message and will typically contain the remote queue ID and"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"delay"}]},{"type":"text","value":" - Time taken between the queue file being created and the\nmessage being delivered."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"port"}]},{"type":"text","value":" - Port number that the message was delivered to."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"mode"}]},{"type":"text","value":" - Shows whether SMTP or LMTP was used to deliver the mail."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"ok_recips"}]},{"type":"text","value":" - an "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Address"}]},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"1"}]},{"type":"text","value":" array containing all of the recipients that were\nsuccessfully delivered to."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"secured"}]},{"type":"text","value":" - A boolean denoting if the connection used TLS or not."}]}]},{"type":"element","tag":"h2","props":{"id":"outbound-ip-address"},"children":[{"type":"text","value":"Outbound IP address"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Normally the OS will decide which IP address will be used for outbound\nconnections using the IP routing table."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"There are instances where you may want to separate outbound traffic on\ndifferent IP addresses based on sender, domain or some other identifier."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nTo do this, the IP address that you want to use "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"must"}]},{"type":"text","value":" be bound to an\ninterface (or alias) on the local system."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"As described above the outbound IP can be set using the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"bind"}]},{"type":"text","value":" parameter\nand also the outbound helo for the IP can be set using the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"bind_ehlo"}]},{"type":"text","value":"\nparameter returned my the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"get_mx"}]},{"type":"text","value":" hook or during the reception of the message\nyou can set a transaction note in a plugin to tell Haraka which outbound IP\naddress you would like it to use when it tries to deliver the message:"}]},{"type":"element","tag":"code","props":{"code":"connection.transaction.notes.outbound_ip = '1.2.3.4';\nconnection.transaction.notes.outbound_helo = 'mail-2.example.com';\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"connection.transaction.notes.outbound_ip = '1.2.3.4';\nconnection.transaction.notes.outbound_helo = 'mail-2.example.com';\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Note: if the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"get_mx"}]},{"type":"text","value":" hook returns a "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"bind"}]},{"type":"text","value":" and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"bind_helo"}]},{"type":"text","value":" parameter, then\nthis will be used in preference to the transaction note."}]},{"type":"element","tag":"h2","props":{"id":"auth"},"children":[{"type":"text","value":"AUTH"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you wish to use AUTH for a particular domain or domains, or you wish to\nforce all mail to an outbound service or smart host that requires authentication\nthen you can use the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"get_mx"}]},{"type":"text","value":" hook documented above to do this by supplying\nboth "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"auth_user"}]},{"type":"text","value":" and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"auth_pass"}]},{"type":"text","value":" properties in an MX object."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If AUTH properties are supplied and the remote end does not offer AUTH or there\nare no compatible AUTH methods, then the message will be sent without AUTH and\na warning will be logged."}]},{"type":"element","tag":"h2","props":{"id":"bounce-messages"},"children":[{"type":"text","value":"Bounce Messages"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The contents of the bounce message are configured by a file called\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/outbound.bounce_message"}]},{"type":"text","value":". If you look at this file you will see it\ncontains several template entries wrapped in curly brackets. These will be\npopulated as follows:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Optional: Possibility to add HTML code (with optional image) to the bounce message is possible\nby adding the files "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/outbound.bounce_message_html"}]},{"type":"text","value":". An image can be attached\nto the mail by using "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/outbound.bounce_message_image"}]},{"type":"text","value":"."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"pid - the current process id"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"date - the current date when the bounce occurred"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"me - the contents of "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/me"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"from - the originating sender of the message"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"msgid - a uuid for the mail"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"to - the end recipient of the message, or the first recipient if it was to\nmultiple people"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"reason - the text from the remote server indicating why it bounced"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Following the bounce message itself will be a copy of the entire original\nmessage."}]},{"type":"element","tag":"h2","props":{"id":"creating-a-mail-internally-for-outbound-delivery"},"children":[{"type":"text","value":"Creating a mail internally for outbound delivery"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Sometimes it is necessary to generate a new mail from within a plugin."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To do that, you can use the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"outbound"}]},{"type":"text","value":" module directly:"}]},{"type":"element","tag":"code","props":{"code":"var outbound = require('./outbound');\n\nvar plugin = this;\n\nvar to = 'user@example.com';\nvar from = 'sender@example.com';\n\nvar contents = [\n    \"From: \" + from,\n    \"To: \" + to,\n    \"MIME-Version: 1.0\",\n    \"Content-type: text/plain; charset=us-ascii\",\n    \"Subject: Some subject here\",\n    \"\",\n    \"Some email body here\",\n    \"\"].join(\"\\n\");\n    \nvar outnext = function (code, msg) {\n    switch (code) {\n        case DENY:  plugin.logerror(\"Sending mail failed: \" + msg);\n                    break;\n        case OK:    plugin.loginfo(\"mail sent\");\n                    next();\n                    break;\n        default:    plugin.logerror(\"Unrecognized return code from sending email: \" + msg);\n                    next();\n    }\n};\n\noutbound.send_email(from, to, contents, outnext);\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"var outbound = require('./outbound');\n\nvar plugin = this;\n\nvar to = 'user@example.com';\nvar from = 'sender@example.com';\n\nvar contents = [\n    \"From: \" + from,\n    \"To: \" + to,\n    \"MIME-Version: 1.0\",\n    \"Content-type: text/plain; charset=us-ascii\",\n    \"Subject: Some subject here\",\n    \"\",\n    \"Some email body here\",\n    \"\"].join(\"\\n\");\n    \nvar outnext = function (code, msg) {\n    switch (code) {\n        case DENY:  plugin.logerror(\"Sending mail failed: \" + msg);\n                    break;\n        case OK:    plugin.loginfo(\"mail sent\");\n                    next();\n                    break;\n        default:    plugin.logerror(\"Unrecognized return code from sending email: \" + msg);\n                    next();\n    }\n};\n\noutbound.send_email(from, to, contents, outnext);\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The callback on "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"send_email()"}]},{"type":"text","value":" is passed "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"OK"}]},{"type":"text","value":" if the mail is successfully\nqueued to disk, not when it is successfully delivered. To check delivery\nstatus you still need to hook "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"delivered"}]},{"type":"text","value":" and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"bounce"}]},{"type":"text","value":" to know if it was\nsuccessfully delivered."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The callback parameter may be omitted if you don't need to handle errors\nshould queueing to disk fail e.g:"}]},{"type":"element","tag":"code","props":{"code":"outbound.send_email(from, to, contents);\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"outbound.send_email(from, to, contents);\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can pass various options to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"outbound.send_email"}]},{"type":"text","value":" like so:"}]},{"type":"element","tag":"code","props":{"code":"outbound.send_email(from, to, contents, outnext, options);\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"outbound.send_email(from, to, contents, outnext, options);\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Where "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"options"}]},{"type":"text","value":" is a Object that may contain the following keys:"}]},{"type":"element","tag":"table","props":{},"children":[{"type":"element","tag":"thead","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"th","props":{"align":null},"children":[{"type":"text","value":"Key/Value"}]},{"type":"element","tag":"th","props":{"align":null},"children":[{"type":"text","value":"Description"}]}]}]},{"type":"element","tag":"tbody","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"dot_stuffed: true"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Use this if you are passing your content dot-stuffed (a dot at the start of a line is doubled, like it is in SMTP conversation, see "},{"type":"element","tag":"a","props":{"href":"https://tools.ietf.org/html/rfc2821#section-4.5.2","rel":["nofollow"]},"children":[{"type":"text","value":"RFC 2821"}]},{"type":"text","value":"."}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"notes: { key: value}"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"In case you need notes in the new transaction that "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"send_email()"}]},{"type":"text","value":" creates."}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"remove_msgid: true"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Remove any Message-Id header found in the message.  If you are reading a message in from the filesystem and you want to ensure that a generated Message-Id header is used in preference over the original.  This is useful if you are releasing mail from a quarantine."}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"remove_date: true"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Remove any Date header found in the message.  If you are reading a message in from the filesystem and you want to ensure that a generated Date header is used in preference over the original.  This is useful if you are releasing mail from a quarantine."}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"origin: Object"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Adds object as argument to logger.log calls inside outbound.send_email. Useful for tracking which Plugin/Connection/HMailItem object generated email."}]}]}]}]},{"type":"element","tag":"code","props":{"code":"    outbound.send_email(from, to, contents, outnext, { notes: transaction.notes });\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"    outbound.send_email(from, to, contents, outnext, { notes: transaction.notes });\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"1"}]},{"type":"text","value":": "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Address"}]},{"type":"text","value":" objects are "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/node-address-rfc2821","rel":["nofollow"]},"children":[{"type":"text","value":"address-rfc2821 objects"}]},{"type":"text","value":"."}]}]},"navigation":{"title":"Outbound"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"outbound-mail"},"children":[{"type":"text","value":"Outbound Mail"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A default installation of Haraka will queue outbound mail for delivery in the\nqueue directory. Those mails will be delivered to the appropriate MX record\nfor that domain. Mails are queued onto your disk, and will deal appropriately\nwith temporary failures to retry delivery later."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Outbound mails are defined as those that have set the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"connection.relaying"}]},{"type":"text","value":"\nflag to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"true"}]},{"type":"text","value":" via a plugin. The simplest way of doing that is to use SMTP\nAUTH, and have the client authenticate. For example using the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"auth/flat_file"}]},{"type":"text","value":"\nplugin. However it is very simple to write a custom plugin to do this."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For statistics on outbound mail use the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"process_title"}]},{"type":"text","value":" plugin. See the\ndocumentation for that plugin for details."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To flush the outbound queue (for temporary failed mails) hit the Haraka master\nprocess with the SIGHUP signal (via the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"kill"}]},{"type":"text","value":" command line tool)."}]},{"type":"element","tag":"h2","props":{"id":"outbound-configuration-files"},"children":[{"type":"text","value":"Outbound Configuration Files"}]},{"type":"element","tag":"h3","props":{"id":"outboundini"},"children":[{"type":"text","value":"outbound.ini"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"disabled"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Default: false. Allows one to temporarily disable outbound delivery, while\nstill receiving and queuing emails. This can be changed while Haraka is\nrunning."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"concurrency_max"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Default: 100. Specifies the maximum concurrent connections to make. Note that\nif using cluster (multiple CPUs) then this will be multiplied by the number\nof CPUs that you have."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"enable_tls"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Default: true. Switch to false to disable TLS for outbound mail."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This uses the same "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"tls_key.pem"}]},{"type":"text","value":" and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"tls_cert.pem"}]},{"type":"text","value":" files that the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"tls"}]},{"type":"text","value":"\nplugin uses, along with other values in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"tls.ini"}]},{"type":"text","value":". See the "},{"type":"element","tag":"a","props":{"href":"http://haraka.github.io/manual/plugins/tls.html","rel":["nofollow"]},"children":[{"type":"text","value":"tls plugin\ndocs"}]},{"type":"text","value":" for information on generating those\nfiles."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Within "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"tls.ini"}]},{"type":"text","value":" you can specify global options for the values "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"ciphers"}]},{"type":"text","value":",\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"requestCert"}]},{"type":"text","value":" and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"rejectUnauthorized"}]},{"type":"text","value":", alternatively you can provide\nseparate values by putting them under a key: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[outbound]"}]},{"type":"text","value":", such as:"}]},{"type":"element","tag":"code","props":{"code":"[outbound]\nciphers=!DES\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"[outbound]\nciphers=!DES"}]}]}]}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"ipv6_enabled"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When this has a \"true\" value inside (usually a "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"), it defaults to an 'AAAA'\nlookup first for each MX record, and uses those hosts to send email via."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"always_split"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Default: false. By default, Haraka groups message recipients by domain so that\nmessages with multiple recipients at the same domain get sent in a single SMTP\nsession. When "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"always_split"}]},{"type":"text","value":" is enabled, each recipient gets a queue entry and\ndelivery in its own SMTP session. This carries a performance penalty but\nenables more flexibility in mail delivery and bounce handling."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"received_header"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Default: \"Haraka outbound\". If this text is any string except "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"disabled"}]},{"type":"text","value":", the\nstring is attached as a "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Received"}]},{"type":"text","value":" header to all outbound mail just before it is queued."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"connect_timeout"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Timeout for connecting to remote servers. Default: 30s"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"pool_timeout"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Outbound mail uses \"pooled\" connections. An unused pool connection will send\na QUIT after this time. Default: 50s"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Pooled connections means that a mail to a particular IP address will hold that\nconnection open and use it the next time it is requested. This helps with\nlarge scale outbound mail. If you don't send lots of mail it is advised to\nlower the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"pool_timeout"}]},{"type":"text","value":" value since it may upset receiving mail servers."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Setting this value to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"0"}]},{"type":"text","value":" will effectively disable the use of pools. You may\nwish to set this if you have a "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"get_mx"}]},{"type":"text","value":" hook that picks outbound servers on\na per-email basis (rather than per-domain)."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"pool_concurrency_max"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Set this to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"0"}]},{"type":"text","value":" to completely disable the pooling code."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This value determines how many concurrent connections can be made to a single\nIP address (destination) in the pool. Default: 10 connections."}]},{"type":"element","tag":"h3","props":{"id":"outboundbounce_message"},"children":[{"type":"text","value":"outbound.bounce_message"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"See \"Bounce Messages\" below for details."}]},{"type":"element","tag":"h2","props":{"id":"the-hmail-object"},"children":[{"type":"text","value":"The HMail Object"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Many hooks (see below) pass in a "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"hmail"}]},{"type":"text","value":" object."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You likely won't ever need to call methods on this object, so they are left\nundocumented here."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The attributes of an "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"hmail"}]},{"type":"text","value":" object that may be of use are:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"path - the full path to the queue file"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"filename - the filename within the queue dir"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"num_failures - the number of times this mail has been temp failed"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"notes - notes you can store on a hmail object (similar to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"transaction.notes"}]},{"type":"text","value":")\nto allow you to pass information between outbound hooks"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"todo - see below"}]}]},{"type":"element","tag":"h2","props":{"id":"the-todo-object"},"children":[{"type":"text","value":"The ToDo Object"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"todo"}]},{"type":"text","value":" object contains information about how to deliver this mail. Keys\nyou may be interested in are:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"rcpt_to - an Array of "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Address"}]},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"1"}]},{"type":"text","value":" objects - the rfc.2821 recipients of this mail"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"mail_from - an "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Address"}]},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"1"}]},{"type":"text","value":" object - the rfc.2821 sender of this mail"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"domain - the domain this mail is going to (see "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"always_split"}]},{"type":"text","value":" above)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"notes - the original transaction.notes for this mail, also contains the\nfollowing useful keys:\n** outbound_ip - the IP address to bind to (note do not set this manually,\nuse the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"get_mx"}]},{"type":"text","value":" hook)\n** outbound_helo - the EHLO domain to use (again, do not set manually)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"queue_time - the epoch milliseconds time when this mail was queued"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"uuid - the original transaction.uuid"}]}]},{"type":"element","tag":"h2","props":{"id":"outbound-mail-hooks"},"children":[{"type":"text","value":"Outbound Mail Hooks"}]},{"type":"element","tag":"h3","props":{"id":"the-queue_outbound-hook"},"children":[{"type":"text","value":"The queue_outbound hook"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The first hook that is called prior to queueing an outbound mail is the\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"queue_outbound"}]},{"type":"text","value":" hook. Only if all these hooks return "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"CONT"}]},{"type":"text","value":" (or if there are\nno hooks) will the mail be queued for outbound delivery. A return of "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"OK"}]},{"type":"text","value":" will\nindicate that the mail has been queued in some custom manner for outbound\ndelivery. Any of the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"DENY"}]},{"type":"text","value":" return codes will cause the message to be\nappropriately rejected."}]},{"type":"element","tag":"h3","props":{"id":"the-send_email-hook"},"children":[{"type":"text","value":"The send_email hook"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Parameters: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next, hmail"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Called just as the email is about to be sent."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Respond with "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next(DELAY, delay_seconds)"}]},{"type":"text","value":" to defer sending the email at this time."}]},{"type":"element","tag":"h3","props":{"id":"the-get_mx-hook"},"children":[{"type":"text","value":"The get_mx hook"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Parameters: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next, hmail, domain"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Upon starting delivery the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"get_mx"}]},{"type":"text","value":" hook is called, with the parameter set to\nthe domain in question (for example a mail to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"user@example.com"}]},{"type":"text","value":" will call the\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"get_mx"}]},{"type":"text","value":" hook with "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"(next, hmail, domain)"}]},{"type":"text","value":" as parameters). This is to allow\nyou to implement a custom handler to find MX records. For most installations\nthere is no reason to implement this hook - Haraka will find the correct MX\nrecords for you."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The MX record is sent via next(OK, mx) and can be one of:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"A string of one of the following formats:"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hostname"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hostname:port"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"ipaddress"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"ipaddress:port"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"An MX object of the form: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"{priority: 0, exchange: hostname}"}]},{"type":"text","value":" with the\nfollowing optional properies:\n* "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"port"}]},{"type":"text","value":" to specify an alternate port\n* "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"bind"}]},{"type":"text","value":" to specify an outbound IP address to bind to\n* "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"bind_helo"}]},{"type":"text","value":" to specify an outbound helo for IP address to bind to\n* "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"using_lmtp"}]},{"type":"text","value":" boolean to specify that delivery should be attempted using\nLMTP instead of SMTP.\n*  "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"auth_user"}]},{"type":"text","value":" to specify an AUTH username (required if AUTH is desired)\n*  "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"auth_pass"}]},{"type":"text","value":" to specify an AUTH password (required if AUTH is desired)\n*  "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"auth_type"}]},{"type":"text","value":" to specify an AUTH type that should be used with the MX.\nIf this is not specified then Haraka will pick an appropriate method."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"A list of MX objects in an array, each in the same format as above."}]}]},{"type":"element","tag":"h3","props":{"id":"the-deferred-hook"},"children":[{"type":"text","value":"The deferred hook"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Parameters: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next, hmail, {delay: ..., err: ...}"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If the mail is temporarily deferred, the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"deferred"}]},{"type":"text","value":" hook is called. The hook\nparameter is an object with keys: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"delay"}]},{"type":"text","value":" and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"err"}]},{"type":"text","value":", which explain the delay\n(in seconds) and error message."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you want to stop at this point, and drop the mail completely, then you\ncan call "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next(OK)"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you want to change the delay, then call "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next(DENYSOFT, delay_in_seconds)"}]},{"type":"text","value":".\nUsing this you can define a custom delay algorithm indexed by\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"hmail.num_failures"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h3","props":{"id":"the-bounce-hook"},"children":[{"type":"text","value":"The bounce hook"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Parameters: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next, hmail, error"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If the mail completely bounces then the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"bounce"}]},{"type":"text","value":" hook is called. This is "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"not"}]},{"type":"text","value":"\ncalled if the mail is issued a temporary failure (a 4xx error code). The hook\nparameter is the error message received from the remote end as an "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Error"}]},{"type":"text","value":" object.\nThe object may also have the following properties:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"mx - the MX object that caused the bounce"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"deferred_rcpt - the deferred recipients that eventually bounced"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"bounced_rcpt - the bounced recipients"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you do not wish to have a bounce message sent to the originating sender of the\nemail then you can return "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"OK"}]},{"type":"text","value":" from this hook to stop it from sending a bounce message."}]},{"type":"element","tag":"h3","props":{"id":"the-delivered-hook"},"children":[{"type":"text","value":"The delivered hook"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Parameters: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next, hmail, params"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Params is a list of: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[host, ip, response, delay, port, mode, ok_recips, secured]"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When mails are successfully delivered to the remote end then the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"delivered"}]},{"type":"text","value":"\nhook is called. The return codes from this hook have no effect, so it is only\nuseful for logging the fact that a successful delivery occurred."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"host"}]},{"type":"text","value":" - Hostname of the MX that the message was delivered to,"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"ip"}]},{"type":"text","value":" - IP address of the host that the message was delivered to,"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"response"}]},{"type":"text","value":" - Variable contains the SMTP response text returned by the host\nthat received the message and will typically contain the remote queue ID and"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"delay"}]},{"type":"text","value":" - Time taken between the queue file being created and the\nmessage being delivered."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"port"}]},{"type":"text","value":" - Port number that the message was delivered to."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"mode"}]},{"type":"text","value":" - Shows whether SMTP or LMTP was used to deliver the mail."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"ok_recips"}]},{"type":"text","value":" - an "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Address"}]},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"1"}]},{"type":"text","value":" array containing all of the recipients that were\nsuccessfully delivered to."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"secured"}]},{"type":"text","value":" - A boolean denoting if the connection used TLS or not."}]}]},{"type":"element","tag":"h2","props":{"id":"outbound-ip-address"},"children":[{"type":"text","value":"Outbound IP address"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Normally the OS will decide which IP address will be used for outbound\nconnections using the IP routing table."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"There are instances where you may want to separate outbound traffic on\ndifferent IP addresses based on sender, domain or some other identifier."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nTo do this, the IP address that you want to use "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"must"}]},{"type":"text","value":" be bound to an\ninterface (or alias) on the local system."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"As described above the outbound IP can be set using the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"bind"}]},{"type":"text","value":" parameter\nand also the outbound helo for the IP can be set using the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"bind_ehlo"}]},{"type":"text","value":"\nparameter returned my the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"get_mx"}]},{"type":"text","value":" hook or during the reception of the message\nyou can set a transaction note in a plugin to tell Haraka which outbound IP\naddress you would like it to use when it tries to deliver the message:"}]},{"type":"element","tag":"code","props":{"code":"connection.transaction.notes.outbound_ip = '1.2.3.4';\nconnection.transaction.notes.outbound_helo = 'mail-2.example.com';\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"connection.transaction.notes.outbound_ip = '1.2.3.4';\nconnection.transaction.notes.outbound_helo = 'mail-2.example.com';"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Note: if the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"get_mx"}]},{"type":"text","value":" hook returns a "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"bind"}]},{"type":"text","value":" and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"bind_helo"}]},{"type":"text","value":" parameter, then\nthis will be used in preference to the transaction note."}]},{"type":"element","tag":"h2","props":{"id":"auth"},"children":[{"type":"text","value":"AUTH"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you wish to use AUTH for a particular domain or domains, or you wish to\nforce all mail to an outbound service or smart host that requires authentication\nthen you can use the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"get_mx"}]},{"type":"text","value":" hook documented above to do this by supplying\nboth "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"auth_user"}]},{"type":"text","value":" and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"auth_pass"}]},{"type":"text","value":" properties in an MX object."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If AUTH properties are supplied and the remote end does not offer AUTH or there\nare no compatible AUTH methods, then the message will be sent without AUTH and\na warning will be logged."}]},{"type":"element","tag":"h2","props":{"id":"bounce-messages"},"children":[{"type":"text","value":"Bounce Messages"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The contents of the bounce message are configured by a file called\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/outbound.bounce_message"}]},{"type":"text","value":". If you look at this file you will see it\ncontains several template entries wrapped in curly brackets. These will be\npopulated as follows:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Optional: Possibility to add HTML code (with optional image) to the bounce message is possible\nby adding the files "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/outbound.bounce_message_html"}]},{"type":"text","value":". An image can be attached\nto the mail by using "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/outbound.bounce_message_image"}]},{"type":"text","value":"."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"pid - the current process id"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"date - the current date when the bounce occurred"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"me - the contents of "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/me"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"from - the originating sender of the message"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"msgid - a uuid for the mail"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"to - the end recipient of the message, or the first recipient if it was to\nmultiple people"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"reason - the text from the remote server indicating why it bounced"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Following the bounce message itself will be a copy of the entire original\nmessage."}]},{"type":"element","tag":"h2","props":{"id":"creating-a-mail-internally-for-outbound-delivery"},"children":[{"type":"text","value":"Creating a mail internally for outbound delivery"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Sometimes it is necessary to generate a new mail from within a plugin."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To do that, you can use the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"outbound"}]},{"type":"text","value":" module directly:"}]},{"type":"element","tag":"code","props":{"code":"var outbound = require('./outbound');\n\nvar plugin = this;\n\nvar to = 'user@example.com';\nvar from = 'sender@example.com';\n\nvar contents = [\n    \"From: \" + from,\n    \"To: \" + to,\n    \"MIME-Version: 1.0\",\n    \"Content-type: text/plain; charset=us-ascii\",\n    \"Subject: Some subject here\",\n    \"\",\n    \"Some email body here\",\n    \"\"].join(\"\\n\");\n    \nvar outnext = function (code, msg) {\n    switch (code) {\n        case DENY:  plugin.logerror(\"Sending mail failed: \" + msg);\n                    break;\n        case OK:    plugin.loginfo(\"mail sent\");\n                    next();\n                    break;\n        default:    plugin.logerror(\"Unrecognized return code from sending email: \" + msg);\n                    next();\n    }\n};\n\noutbound.send_email(from, to, contents, outnext);\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-771d3c"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":" outbound "}]},{"type":"element","tag":"span","props":{"class":"ct-771d3c"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-447e71"},"children":[{"type":"text","value":"require"}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-d3d8d4"},"children":[{"type":"text","value":"'./outbound'"}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":");"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-771d3c"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":" plugin "}]},{"type":"element","tag":"span","props":{"class":"ct-771d3c"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-447e71"},"children":[{"type":"text","value":"this"}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-771d3c"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":" to "}]},{"type":"element","tag":"span","props":{"class":"ct-771d3c"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-d3d8d4"},"children":[{"type":"text","value":"'user@example.com'"}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-771d3c"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":" from "}]},{"type":"element","tag":"span","props":{"class":"ct-771d3c"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-d3d8d4"},"children":[{"type":"text","value":"'sender@example.com'"}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-771d3c"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":" contents "}]},{"type":"element","tag":"span","props":{"class":"ct-771d3c"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":" ["}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-d3d8d4"},"children":[{"type":"text","value":"\"From: \""}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-771d3c"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":" from,"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-d3d8d4"},"children":[{"type":"text","value":"\"To: \""}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-771d3c"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":" to,"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-d3d8d4"},"children":[{"type":"text","value":"\"MIME-Version: 1.0\""}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":","}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-d3d8d4"},"children":[{"type":"text","value":"\"Content-type: text/plain; charset=us-ascii\""}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":","}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-d3d8d4"},"children":[{"type":"text","value":"\"Subject: Some subject here\""}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":","}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-d3d8d4"},"children":[{"type":"text","value":"\"\""}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":","}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-d3d8d4"},"children":[{"type":"text","value":"\"Some email body here\""}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":","}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-d3d8d4"},"children":[{"type":"text","value":"\"\""}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":"]."}]},{"type":"element","tag":"span","props":{"class":"ct-e5089c"},"children":[{"type":"text","value":"join"}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-d3d8d4"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"class":"ct-447e71"},"children":[{"type":"text","value":"\\n"}]},{"type":"element","tag":"span","props":{"class":"ct-d3d8d4"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":");"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":"    "}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-771d3c"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e5089c"},"children":[{"type":"text","value":"outnext"}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-771d3c"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-771d3c"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-f1ef17"},"children":[{"type":"text","value":"code"}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-f1ef17"},"children":[{"type":"text","value":"msg"}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":") {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-771d3c"},"children":[{"type":"text","value":"switch"}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":" (code) {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-771d3c"},"children":[{"type":"text","value":"case"}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-447e71"},"children":[{"type":"text","value":"DENY"}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":":  plugin."}]},{"type":"element","tag":"span","props":{"class":"ct-e5089c"},"children":[{"type":"text","value":"logerror"}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-d3d8d4"},"children":[{"type":"text","value":"\"Sending mail failed: \""}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-771d3c"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":" msg);"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":"                    "}]},{"type":"element","tag":"span","props":{"class":"ct-771d3c"},"children":[{"type":"text","value":"break"}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-771d3c"},"children":[{"type":"text","value":"case"}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-447e71"},"children":[{"type":"text","value":"OK"}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":":    plugin."}]},{"type":"element","tag":"span","props":{"class":"ct-e5089c"},"children":[{"type":"text","value":"loginfo"}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-d3d8d4"},"children":[{"type":"text","value":"\"mail sent\""}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":");"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":"                    "}]},{"type":"element","tag":"span","props":{"class":"ct-e5089c"},"children":[{"type":"text","value":"next"}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":"();"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":"                    "}]},{"type":"element","tag":"span","props":{"class":"ct-771d3c"},"children":[{"type":"text","value":"break"}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-771d3c"},"children":[{"type":"text","value":"default"}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":":    plugin."}]},{"type":"element","tag":"span","props":{"class":"ct-e5089c"},"children":[{"type":"text","value":"logerror"}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-d3d8d4"},"children":[{"type":"text","value":"\"Unrecognized return code from sending email: \""}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-771d3c"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":" msg);"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":"                    "}]},{"type":"element","tag":"span","props":{"class":"ct-e5089c"},"children":[{"type":"text","value":"next"}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":"();"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":"    }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":"};"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":"outbound."}]},{"type":"element","tag":"span","props":{"class":"ct-e5089c"},"children":[{"type":"text","value":"send_email"}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":"(from, to, contents, outnext);"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The callback on "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"send_email()"}]},{"type":"text","value":" is passed "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"OK"}]},{"type":"text","value":" if the mail is successfully\nqueued to disk, not when it is successfully delivered. To check delivery\nstatus you still need to hook "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"delivered"}]},{"type":"text","value":" and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"bounce"}]},{"type":"text","value":" to know if it was\nsuccessfully delivered."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The callback parameter may be omitted if you don't need to handle errors\nshould queueing to disk fail e.g:"}]},{"type":"element","tag":"code","props":{"code":"outbound.send_email(from, to, contents);\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":"outbound."}]},{"type":"element","tag":"span","props":{"class":"ct-e5089c"},"children":[{"type":"text","value":"send_email"}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":"(from, to, contents);"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can pass various options to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"outbound.send_email"}]},{"type":"text","value":" like so:"}]},{"type":"element","tag":"code","props":{"code":"outbound.send_email(from, to, contents, outnext, options);\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":"outbound."}]},{"type":"element","tag":"span","props":{"class":"ct-e5089c"},"children":[{"type":"text","value":"send_email"}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":"(from, to, contents, outnext, options);"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Where "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"options"}]},{"type":"text","value":" is a Object that may contain the following keys:"}]},{"type":"element","tag":"table","props":{},"children":[{"type":"element","tag":"thead","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"th","props":{"align":null},"children":[{"type":"text","value":"Key/Value"}]},{"type":"element","tag":"th","props":{"align":null},"children":[{"type":"text","value":"Description"}]}]}]},{"type":"element","tag":"tbody","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"dot_stuffed: true"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Use this if you are passing your content dot-stuffed (a dot at the start of a line is doubled, like it is in SMTP conversation, see "},{"type":"element","tag":"a","props":{"href":"https://tools.ietf.org/html/rfc2821#section-4.5.2","rel":["nofollow"]},"children":[{"type":"text","value":"RFC 2821"}]},{"type":"text","value":"."}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"notes: { key: value}"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"In case you need notes in the new transaction that "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"send_email()"}]},{"type":"text","value":" creates."}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"remove_msgid: true"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Remove any Message-Id header found in the message.  If you are reading a message in from the filesystem and you want to ensure that a generated Message-Id header is used in preference over the original.  This is useful if you are releasing mail from a quarantine."}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"remove_date: true"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Remove any Date header found in the message.  If you are reading a message in from the filesystem and you want to ensure that a generated Date header is used in preference over the original.  This is useful if you are releasing mail from a quarantine."}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"origin: Object"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Adds object as argument to logger.log calls inside outbound.send_email. Useful for tracking which Plugin/Connection/HMailItem object generated email."}]}]}]}]},{"type":"element","tag":"code","props":{"code":"    outbound.send_email(from, to, contents, outnext, { notes: transaction.notes });\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":"    outbound."}]},{"type":"element","tag":"span","props":{"class":"ct-e5089c"},"children":[{"type":"text","value":"send_email"}]},{"type":"element","tag":"span","props":{"class":"ct-6ffd9a"},"children":[{"type":"text","value":"(from, to, contents, outnext, { notes: transaction.notes });"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"1"}]},{"type":"text","value":": "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Address"}]},{"type":"text","value":" objects are "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/node-address-rfc2821","rel":["nofollow"]},"children":[{"type":"text","value":"address-rfc2821 objects"}]},{"type":"text","value":"."}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-f1ef17{color:#953800}\n.ct-e5089c{color:#8250DF}\n.ct-d3d8d4{color:#0A3069}\n.ct-447e71{color:#0550AE}\n.ct-6ffd9a{color:#24292F}\n.ct-771d3c{color:#CF222E}\n.dark .ct-771d3c{color:#FF7B72}\n.dark .ct-6ffd9a{color:#C9D1D9}\n.dark .ct-447e71{color:#79C0FF}\n.dark .ct-d3d8d4{color:#A5D6FF}\n.dark .ct-e5089c{color:#D2A8FF}\n.dark .ct-f1ef17{color:#FFA657}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"outbound-configuration-files","depth":2,"text":"Outbound Configuration Files","children":[{"id":"outboundini","depth":3,"text":"outbound.ini"},{"id":"outboundbounce_message","depth":3,"text":"outbound.bounce_message"}]},{"id":"the-hmail-object","depth":2,"text":"The HMail Object"},{"id":"the-todo-object","depth":2,"text":"The ToDo Object"},{"id":"outbound-mail-hooks","depth":2,"text":"Outbound Mail Hooks","children":[{"id":"the-queue_outbound-hook","depth":3,"text":"The queue_outbound hook"},{"id":"the-send_email-hook","depth":3,"text":"The send_email hook"},{"id":"the-get_mx-hook","depth":3,"text":"The get_mx hook"},{"id":"the-deferred-hook","depth":3,"text":"The deferred hook"},{"id":"the-bounce-hook","depth":3,"text":"The bounce hook"},{"id":"the-delivered-hook","depth":3,"text":"The delivered hook"}]},{"id":"outbound-ip-address","depth":2,"text":"Outbound IP address"},{"id":"auth","depth":2,"text":"AUTH"},{"id":"bounce-messages","depth":2,"text":"Bounce Messages"},{"id":"creating-a-mail-internally-for-outbound-delivery","depth":2,"text":"Creating a mail internally for outbound delivery"}]}},"_type":"markdown","_id":"content:6.core:12.Outbound.md","_source":"content","_file":"6.core/12.Outbound.md","_extension":"md"},{"_path":"/core/Plugins","_dir":"core","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"Plugins","description":"Most aspects of receiving an email in Haraka are controlled by plugins. Mail cannot even be received unless at least a 'rcpt' and 'queue' plugin are\nenabled.","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"plugins"},"children":[{"type":"text","value":"Plugins"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Most aspects of receiving an email in Haraka are controlled by plugins. Mail cannot even be received unless at least a 'rcpt' and 'queue' plugin are\nenabled."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Recipient ("},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"rcpt"}]},{"type":"text","value":") plugins determine if a particular recipient is allowed to be relayed or received for. A "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"queue"}]},{"type":"text","value":" plugin queues the message somewhere - normally to disk or to an another SMTP server."}]},{"type":"element","tag":"h2","props":{"id":"plugin-lists"},"children":[{"type":"text","value":"Plugin Lists"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Get a list of installed plugins by running "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"haraka -l"}]},{"type":"text","value":". To include locally installed plugins, add the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"-c /path/to/config"}]},{"type":"text","value":" option."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We also have a "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/Plugins.md","rel":["nofollow"]},"children":[{"type":"text","value":"registry of known plugins"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Display the help text for a plugin by running:"}]},{"type":"element","tag":"code","props":{"code":"haraka -h <name> -c /path/to/config`\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"haraka -h <name> -c /path/to/config`\n"}]}]}]},{"type":"element","tag":"h1","props":{"id":"writing-haraka-plugins"},"children":[{"type":"text","value":"Writing Haraka Plugins"}]},{"type":"element","tag":"h2","props":{"id":"anatomy-of-a-plugin"},"children":[{"type":"text","value":"Anatomy of a Plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Plugins in Haraka are JS files in the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"plugins"}]},{"type":"text","value":" directory (legacy) and npm\nmodules in the node_modules directory. See \"Plugins as Modules\" below."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Plugins can be installed in the Haraka global directory (default:\n/$os/$specific/lib/node_modules/Haraka) or in the Haraka install directory\n(whatever you chose when you typed "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"haraka -i"}]},{"type":"text","value":". Example: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"haraka -i /etc/haraka"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To enable a plugin, add its name to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/plugins"}]},{"type":"text","value":". For npm packaged plugins, the name does not include the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"haraka-plugin"}]},{"type":"text","value":" prefix."}]},{"type":"element","tag":"h3","props":{"id":"register"},"children":[{"type":"text","value":"Register"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Register is the only plugin function that is syncronous and receives no arguments. Its primary purpose is enabling your plugin to register SMTP hooks. It is also used for syncronous initialization tasks such as "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-config","rel":["nofollow"]},"children":[{"type":"text","value":"loading a config file"}]},{"type":"text","value":". For heavier initialization tasks such as establishing database connections, look to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"init_master"}]},{"type":"text","value":" and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"init_child"}]},{"type":"text","value":" instead."}]},{"type":"element","tag":"h3","props":{"id":"register-a-hook"},"children":[{"type":"text","value":"Register a Hook"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"There are two ways for plugins to register hooks. Both examples register a function on the "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"rcpt"}]},{"type":"text","value":" hook:"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"register_hook"}]},{"type":"text","value":" function in register():"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"exports.register = function() {\nthis.register_hook('rcpt', 'my_rcpt_validate');\n};"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"exports.my_rcpt_validate = function (next, connection, params) {\n// do processing\nnext();\n};"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The hook_"},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"$name"}]},{"type":"text","value":" syntax:"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"exports.hook_rcpt = function (next, connection, params) {\n// do processing\nnext();\n};"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The register_hook function within "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"register()"}]},{"type":"text","value":" offers a few advantages:"}]},{"type":"element","tag":"code","props":{"code":"1. register a hook multiple times (see below)\n2. a unique function name in stack traces\n3. [a better function name](https://google.com/search?q=programming%20good%20function%20names)\n4. hooks can be registered conditionally (ie, based on a config setting)\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"1. register a hook multiple times (see below)\n2. a unique function name in stack traces\n3. [a better function name](https://google.com/search?q=programming%20good%20function%20names)\n4. hooks can be registered conditionally (ie, based on a config setting)\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"register-a-hook-multiple-times"},"children":[{"type":"text","value":"Register a Hook Multiple Times"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To register the same hook more than once, call "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"register_hook()"}]},{"type":"text","value":" multiple times with the same hook name:"}]},{"type":"element","tag":"code","props":{"code":"exports.register = function() {\n    this.register_hook('queue', 'try_queue_my_way');\n    this.register_hook('queue', 'try_queue_highway');\n};\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"exports.register = function() {\n    this.register_hook('queue', 'try_queue_my_way');\n    this.register_hook('queue', 'try_queue_highway');\n};\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"try_queue_my_way()"}]},{"type":"text","value":" calls "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next()"}]},{"type":"text","value":", the next function registered on hook "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"queue"}]},{"type":"text","value":" will be called, in this case, "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"try_queue_highway()"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h4","props":{"id":"determine-hook-name"},"children":[{"type":"text","value":"Determine hook name"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When a single function runs on multiple hooks, the function can check the\n"},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"hook"}]},{"type":"text","value":" property of the "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"connection"}]},{"type":"text","value":" or "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"hmail"}]},{"type":"text","value":" argument to determine which hook it is running on:"}]},{"type":"element","tag":"code","props":{"code":"exports.register = function() {\n    this.register_hook('rcpt',    'my_rcpt');\n    this.register_hook('rcpt_ok', 'my_rcpt');\n};\n \nexports.my_rcpt = function (next, connection, params) {\n    var hook_name = connection.hook; // rcpt or rcpt_ok\n    // email address is in params[0]\n    // do processing\n}\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"exports.register = function() {\n    this.register_hook('rcpt',    'my_rcpt');\n    this.register_hook('rcpt_ok', 'my_rcpt');\n};\n \nexports.my_rcpt = function (next, connection, params) {\n    var hook_name = connection.hook; // rcpt or rcpt_ok\n    // email address is in params[0]\n    // do processing\n}\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"next"},"children":[{"type":"text","value":"Next()"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"After registering a hook, functions are called with that hooks arguments (see "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Available Hooks"}]},{"type":"text","value":" below. The first argument is a callback function, conventionally named "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next"}]},{"type":"text","value":". When the function is completed, it calls "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next()"}]},{"type":"text","value":" and the connection continues. Failing to call "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next()"}]},{"type":"text","value":" will result in the connection hanging until that plugin's timer expires."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next([code, msg])"}]},{"type":"text","value":" accepts two optional parameters:"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"code"}]},{"type":"text","value":" is one of the listed return codes."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"msg"}]},{"type":"text","value":" is a string to send to the client in case of a failure. Use an array to send a multi-line message. "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"msg"}]},{"type":"text","value":" should NOT contain the code number - that is handled by Haraka."}]}]},{"type":"element","tag":"h4","props":{"id":"next-return-codes"},"children":[{"type":"text","value":"Next() Return Codes"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"These constants are in your plugin when it is loaded, you do not\nneed to define them:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"CONT"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Continue and let other plugins handle this particular hook. This is the\ndefault. These are identical: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next()"}]},{"type":"text","value":" and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next(CONT)"}]},{"type":"text","value":";"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"DENY - Reject with a 5xx error."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"DENYSOFT - Reject with a 4xx error."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"DENYDISCONNECT - Reject with a 5xx error and immediately disconnect."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"DISCONNECT - Immediately disconnect"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"OK"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Required by "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"rcpt"}]},{"type":"text","value":" plugins to accept a recipient and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"queue"}]},{"type":"text","value":" plugins when the queue was successful."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"After a plugin calls "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next(OK)"}]},{"type":"text","value":", no further plugins on that hook will run."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Exceptions to next(OK):"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connect_init and disconnect hooks are "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"always called"}]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"On the deny hook, "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next(OK)"}]},{"type":"text","value":" overrides the default CONT."}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"HOOK_NEXT"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"HOOK_NEXT is only available on the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"unrecognized_command"}]},{"type":"text","value":" hook. It instructs Haraka to run a different plugin hook. The "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"msg"}]},{"type":"text","value":" argument must be set to the name of the hook to be run. Ex: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next(HOOK_NEXT, 'rcpt_ok');"}]}]}]},{"type":"element","tag":"h2","props":{"id":"available-hooks"},"children":[{"type":"text","value":"Available Hooks"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"These are the hook and their parameters (next excluded):"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"init_master - called when the main (master) process is started"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"init_child - in cluster, called when a child process is started"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"init_http - called when Haraka is started."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"init_wss - called after init_http"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connect_init - used to init data structures, called for "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"every"}]},{"type":"text","value":" connection"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"lookup_rdns - called to look up the rDNS - return the rDNS via "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next(OK, rdns)"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connect - called after we got rDNS"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"capabilities - called to get the ESMTP capabilities (such as STARTTLS)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"unrecognized_command - called when the remote end sends a command we don't recognise"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"disconnect - called upon disconnect"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"helo (hostname)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"ehlo (hostname)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"quit"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"vrfy"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"noop"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"rset"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"mail ("},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"from, esmtp_params"}]},{"type":"text","value":")"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"rcpt ("},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"to,   esmtp_params"}]},{"type":"text","value":")"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"rcpt_ok (to)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"data - called at the DATA command"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"data_post - called at the end-of-data marker"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"max_data_exceeded - called when the message exceeds connection.max_bytes"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"queue - called to queue the mail"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"queue_outbound - called to queue the mail when connection.relaying is set"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"queue_ok - called when a mail has been queued successfully"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"reset_transaction - called before the transaction is reset (via RSET, or MAIL)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"deny - called when a plugin returns DENY, DENYSOFT or DENYDISCONNECT"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"get_mx (hmail, domain) - called by outbound to resolve the MX record"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"deferred (hmail, params) - called when an outbound message is deferred"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"bounce (hmail, err) - called when an outbound message bounces"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"delivered (hmail, "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"host, ip, response, delay, port, mode, ok_recips, secured, authenticated"}]},{"type":"text","value":") - called when outbound mail is delivered"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"send_email (hmail) - called when outbound is about to be sent"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"pre_send_trans_email (fake_connection) - called just before an email is queued to disk with a faked connection object"}]}]},{"type":"element","tag":"h3","props":{"id":"rcpt"},"children":[{"type":"text","value":"rcpt"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"rcpt"}]},{"type":"text","value":" hook is slightly special."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"connection.relaying == false"}]},{"type":"text","value":" (the default, to avoid being an open relay), a rcpt plugin MUST return "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next(OK)"}]},{"type":"text","value":" or the sender will receive the error message \"I cannot deliver for that user\". The default "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"rcpt"}]},{"type":"text","value":" plugin  is "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"rcpt_to.in_host_list"}]},{"type":"text","value":", which lists the domains for which to accept email."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"After a "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"rcpt"}]},{"type":"text","value":" plugin calls "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next(OK)"}]},{"type":"text","value":", the "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"rcpt_ok"}]},{"type":"text","value":" hook is run."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If a plugin prior to the "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"rcpt"}]},{"type":"text","value":" hook sets "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"connection.relaying = true"}]},{"type":"text","value":", then it is not necessary for a rcpt plugin to call "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next(OK)"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h3","props":{"id":"connect_init"},"children":[{"type":"text","value":"connect_init"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"connect_init"}]},{"type":"text","value":" hook is unique in that all return codes are ignored. This is so that plugins that need to do initialization for every connection can be assured they will run. Return values are ignored."}]},{"type":"element","tag":"h3","props":{"id":"hook_init_http-next-server"},"children":[{"type":"text","value":"hook_init_http (next, Server)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If http listeners are are enabled in http.ini and the express module loaded, the express library will be located at Server.http.express. More importantly, the express "},{"type":"element","tag":"a","props":{"href":"http://expressjs.com/4x/api.html#app","rel":["nofollow"]},"children":[{"type":"text","value":"app / instance"}]},{"type":"text","value":" will be located at Server.http.app. Plugins can register routes on the app just as they would with any "},{"type":"element","tag":"a","props":{"href":"http://expressjs.com/","rel":["nofollow"]},"children":[{"type":"text","value":"Express.js"}]},{"type":"text","value":" app."}]},{"type":"element","tag":"h3","props":{"id":"hook_init_wss-next-server"},"children":[{"type":"text","value":"hook_init_wss (next, Server)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If express loaded, an attempt is made to load "},{"type":"element","tag":"a","props":{"href":"https://www.npmjs.com/package/ws","rel":["nofollow"]},"children":[{"type":"text","value":"ws"}]},{"type":"text","value":", the websocket server. If it succeeds, the wss server will be located at Server.http.wss. Because of how websockets work, only one websocket plugin will work at a time. One plugin using wss is "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/tree/master/plugins/watch","rel":["nofollow"]},"children":[{"type":"text","value":"watch"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h3","props":{"id":"pre_send_trans_email-next-fake_connection"},"children":[{"type":"text","value":"pre_send_trans_email (next, fake_connection)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"fake"}]},{"type":"text","value":" connection here is a holder for a new transaction object. It only has the log methods and a "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"transaction"}]},{"type":"text","value":" property\nso don't expect it to behave like a a real connection object. This hook is designed so you can add headers and modify mails\nsent via "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"outbound.send_email()"}]},{"type":"text","value":", see the dkim_sign plugin for an example."}]},{"type":"element","tag":"h2","props":{"id":"hook-order"},"children":[{"type":"text","value":"Hook Order"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The ordering of hooks is determined by the SMTP protocol. Knowledge of "},{"type":"element","tag":"a","props":{"href":"http://tools.ietf.org/html/rfc5321","rel":["nofollow"]},"children":[{"type":"text","value":"RFC 5321"}]},{"type":"text","value":" is beneficial."}]},{"type":"element","tag":"h5","props":{"id":"typical-inbound-connection"},"children":[{"type":"text","value":"Typical Inbound Connection"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hook_connect_init"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hook_lookup_rdns"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hook_connect"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hook_helo "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"OR"}]},{"type":"text","value":" hook_ehlo (EHLO is sent when ESMTP is desired which allows extensions\nsuch as STARTTLS, AUTH, SIZE etc.)"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hook_helo"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hook_ehlo"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hook_capabilities"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"hook_unrecognized_command"}]},{"type":"text","value":" is run for each ESMTP extension the client requests\ne.g. STARTTLS, AUTH etc.)"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hook_mail"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hook_rcpt (once per-recipient)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hook_rcpt_ok (for every recipient that hook_rcpt returned "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next(OK)"}]},{"type":"text","value":" for)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hook_data"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"em","props":{},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"attachment hooks"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hook_data_post"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hook_queue "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"OR"}]},{"type":"text","value":" hook_queue_outbound"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hook_queue_ok (called if hook_queue or hook_queue_outbound returns "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next(OK)"}]},{"type":"text","value":")"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hook_quit "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"OR"}]},{"type":"text","value":" hook_rset "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"OR"}]},{"type":"text","value":" hook_helo "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"OR"}]},{"type":"text","value":" hook_ehlo (after a message has been sent or rejected, the client can disconnect or start a new transaction with RSET, EHLO or HELO)"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hook_reset_transaction"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hook_disconnect"}]}]},{"type":"element","tag":"h5","props":{"id":"typical-outbound-mail"},"children":[{"type":"text","value":"Typical Outbound mail"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"By 'outbound' we mean messages using Haraka's built-in queue and delivery\nmechanism. The Outbound queue is used when "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"connection.relaying = true"}]},{"type":"text","value":" is set during the  transaction and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"hook_queue_outbound"}]},{"type":"text","value":" is called to queue the message."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The Outbound hook ordering mirrors the Inbound hook order above until after "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"hook_queue_outbound"}]},{"type":"text","value":", which is followed by:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hook_send_email"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hook_get_mx"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"at least one of:"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hook_delivered  (once per delivery domain with at least one successful recipient)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hook_deferred  (once per delivery domain where at least one recipient or connection was deferred)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hook_bounce  (once per delivery domain where the recipient(s) or message was rejected by the destination)"}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"plugin-run-order"},"children":[{"type":"text","value":"Plugin Run Order"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Plugins are run on each hook in the order that they are specified in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/plugins"}]},{"type":"text","value":". When a plugin returns anything other than "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next()"}]},{"type":"text","value":" on a hook, all subsequent plugins due to run on that hook are skipped (exceptions: connect_init, disconnect)."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This is important as some plugins might rely on "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"results"}]},{"type":"text","value":" or "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"notes"}]},{"type":"text","value":" that have been set by plugins that need to run before them. This should be noted in the plugins documentation. Make sure to read it."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you are writing a complex plugin, you may have to split it into multiple plugins to run in a specific order e.g. you want hook_deny to run last after all other plugins and hook_lookup_rdns to run first, then you can explicitly register your hooks and provide a "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"priority"}]},{"type":"text","value":" value which is an integer between -100 (highest priority) to 100 (lowest priority) which defaults to 0 (zero) if not supplied.  You can apply a priority to your hook in the following way:"}]},{"type":"element","tag":"code","props":{"code":"exports.register = function() {\n    var plugin = this;\n    plugin.register_hook('connect',  'hook_connect', -100);\n}\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"exports.register = function() {\n    var plugin = this;\n    plugin.register_hook('connect',  'hook_connect', -100);\n}\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This would ensure that your hook_connect function will run before any other\nplugins registered on the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"connect"}]},{"type":"text","value":" hook, regardless of the order it was\nspecified in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/plugins"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Check the order that the plugins will run on each hook by running:"}]},{"type":"element","tag":"code","props":{"code":"haraka -o -c /path/to/config\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"haraka -o -c /path/to/config\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"skipping-plugins"},"children":[{"type":"text","value":"Skipping Plugins"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Plugins can be skipped at runtime by pushing the name of the plugin into the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"skip_plugins"}]},{"type":"text","value":" array in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"transaction.notes"}]},{"type":"text","value":".  This array is reset for every transaction and once a plugin is added to the list, it will not run any hooks in that plugin for the remainder of the transaction.  For example, one could create a whitelist plugin that skipped "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"spamassassin"}]},{"type":"text","value":" if the sender was in a whitelist."}]},{"type":"element","tag":"h2","props":{"id":"logging"},"children":[{"type":"text","value":"Logging"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Plugins inherit all the logging methods of "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"logger.js"}]},{"type":"text","value":", which are:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"logprotocol"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"logdebug"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"loginfo"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"lognotice"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"logwarn"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"logerror"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"logcrit"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"logalert"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"logemerg"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If plugins throw an exception when in a hook, the exception will be caught\nand generate a logcrit level error. However, exceptions will not be caught\nas gracefully when plugins are running async code. Use error codes for that,\nlog the error, and run your next() function appropriately."}]},{"type":"element","tag":"h2","props":{"id":"sharing-state"},"children":[{"type":"text","value":"Sharing State"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"There are several cases where you might need to share information between\nplugins.  This is done using "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"notes"}]},{"type":"text","value":" - there are three types available:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"server.notes"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Available in all plugins.  This is created at PID start-up and is shared\namongst all plugins on the same PID and listener.\nTypical uses for notes at this level would be to share database\nconnections between multiple plugins or connection pools etc."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connection.notes"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Available on any hook that passes 'connection' as a function parameter.\nThis is shared amongst all plugins for a single connection and is\ndestroyed after the client disconnects.\nTypical uses for notes at this level would be to store information\nabout the connected client e.g. rDNS names, HELO/EHLO, white/black\nlist status etc."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connection.transaction.notes"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Available on any hook that passes 'connection' as a function parameter\nbetween hook_mail and hook_data_post.\nThis is shared amongst all plugins for this transaction (e.g. MAIL FROM\nthrough until a message is received or the connection is reset).\nTypical uses for notes at this level would be to store information\non things like greylisting which uses client, sender and recipient\ninformation etc."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hmail.todo.notes"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Available on any outbound hook that passes "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"hmail"}]},{"type":"text","value":" as a function parameter.\nThis is the same object as 'connection.transaction.notes', so anything\nyou store in the transaction notes is automatically available in the\noutbound functions here."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"All of these notes are JS objects - use them as simple key/value store e.g."}]},{"type":"element","tag":"code","props":{"code":"connection.transaction.notes.test = 'testing';\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"connection.transaction.notes.test = 'testing';\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"plugins-as-modules"},"children":[{"type":"text","value":"Plugins as Modules"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Plugins as NPM modules are named with the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"haraka-plugin"}]},{"type":"text","value":" prefix. Therefore, a\nplugin that frobnobricates might be called "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"haraka-plugin-frobnobricate"}]},{"type":"text","value":" and\npublished to NPM with that name. The prefix is not required in the\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/plugins"}]},{"type":"text","value":" file."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Plugins loaded as NPM modules behave slightly different than plugins loaded\nas plain JS files."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Plain JS plugins have a custom "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"require()"}]},{"type":"text","value":" which allows loading core Haraka\nmodules via specifying "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"require('./name')"}]},{"type":"text","value":" (note the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"./"}]},{"type":"text","value":" prefix). Although\nthe core modules aren't in the same folder, the custom "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"require"}]},{"type":"text","value":" intercepts\nthis and look for core modules. Note that if there is a module in your plugins\nfolder of the same name that will not take preference, so avoid using names\nsimilar to core modules."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Plugins loaded as modules do not have the special "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"require()"}]},{"type":"text","value":". To load\na core Haraka module you must use "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"this.haraka_require('name')"}]},{"type":"text","value":".\nThis should also be preferred for plain JS plugins, as the\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"./"}]},{"type":"text","value":" hack is likely to be removed in the future."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Plugins loaded as modules are not compiled in the Haraka plugin sandbox,\nwhich blocks access to certain globals and provides a global "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"server"}]},{"type":"text","value":" object.\nTo access the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"server"}]},{"type":"text","value":" object, use "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"connection.server"}]},{"type":"text","value":" instead."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Module plugins support default config in their local "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config"}]},{"type":"text","value":" directory. See the\n\"Default Config and Overrides\" section in "},{"type":"element","tag":"a","props":{"href":"Config"},"children":[{"type":"text","value":"Config"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h2","props":{"id":"shutdown"},"children":[{"type":"text","value":"Shutdown"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"On graceful reload, Haraka will call a plugin's "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"shutdown"}]},{"type":"text","value":" method."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This is so you can clear any timers or intervals, or shut down any connections\nto remote servers. See "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/issues/2024","rel":["nofollow"]},"children":[{"type":"text","value":"Issue 2024"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"e.g."}]},{"type":"element","tag":"code","props":{"code":"exports.shutdown = function () {\n    clearInterval(this._interval);\n}\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"exports.shutdown = function () {\n    clearInterval(this._interval);\n}\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you don't implement this in your plugin and have a connection open or a\ntimer running then Haraka will take 30 seconds to shut down and have to\nforcibly kill your process."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Note: This only applies when running with a "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"nodes=..."}]},{"type":"text","value":" value in smtp.ini."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"See also, "},{"type":"element","tag":"a","props":{"href":"Results"},"children":[{"type":"text","value":"Results"}]}]},{"type":"element","tag":"h2","props":{"id":"further-reading"},"children":[{"type":"text","value":"Further Reading"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Read about the "},{"type":"element","tag":"a","props":{"href":"Connection"},"children":[{"type":"text","value":"Connection"}]},{"type":"text","value":" object."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Outbound hooks are "},{"type":"element","tag":"a","props":{"href":"Outbound"},"children":[{"type":"text","value":"also documented"}]},{"type":"text","value":"."}]}]},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"plugins"},"children":[{"type":"text","value":"Plugins"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Most aspects of receiving an email in Haraka are controlled by plugins. Mail cannot even be received unless at least a 'rcpt' and 'queue' plugin are\nenabled."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Recipient ("},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"rcpt"}]},{"type":"text","value":") plugins determine if a particular recipient is allowed to be relayed or received for. A "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"queue"}]},{"type":"text","value":" plugin queues the message somewhere - normally to disk or to an another SMTP server."}]},{"type":"element","tag":"h2","props":{"id":"plugin-lists"},"children":[{"type":"text","value":"Plugin Lists"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Get a list of installed plugins by running "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"haraka -l"}]},{"type":"text","value":". To include locally installed plugins, add the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"-c /path/to/config"}]},{"type":"text","value":" option."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We also have a "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/Plugins.md","rel":["nofollow"]},"children":[{"type":"text","value":"registry of known plugins"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Display the help text for a plugin by running:"}]},{"type":"element","tag":"code","props":{"code":"haraka -h <name> -c /path/to/config`\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":"haraka -h "}]},{"type":"element","tag":"span","props":{"class":"ct-690281"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":"name"}]},{"type":"element","tag":"span","props":{"class":"ct-690281"},"children":[{"type":"text","value":">"}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":" -c /path/to/config"}]},{"type":"element","tag":"span","props":{"class":"ct-14ddb8"},"children":[{"type":"text","value":"`"}]}]}]}]}]},{"type":"element","tag":"h1","props":{"id":"writing-haraka-plugins"},"children":[{"type":"text","value":"Writing Haraka Plugins"}]},{"type":"element","tag":"h2","props":{"id":"anatomy-of-a-plugin"},"children":[{"type":"text","value":"Anatomy of a Plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Plugins in Haraka are JS files in the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"plugins"}]},{"type":"text","value":" directory (legacy) and npm\nmodules in the node_modules directory. See \"Plugins as Modules\" below."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Plugins can be installed in the Haraka global directory (default:\n/$os/$specific/lib/node_modules/Haraka) or in the Haraka install directory\n(whatever you chose when you typed "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"haraka -i"}]},{"type":"text","value":". Example: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"haraka -i /etc/haraka"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To enable a plugin, add its name to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/plugins"}]},{"type":"text","value":". For npm packaged plugins, the name does not include the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"haraka-plugin"}]},{"type":"text","value":" prefix."}]},{"type":"element","tag":"h3","props":{"id":"register"},"children":[{"type":"text","value":"Register"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Register is the only plugin function that is syncronous and receives no arguments. Its primary purpose is enabling your plugin to register SMTP hooks. It is also used for syncronous initialization tasks such as "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-config","rel":["nofollow"]},"children":[{"type":"text","value":"loading a config file"}]},{"type":"text","value":". For heavier initialization tasks such as establishing database connections, look to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"init_master"}]},{"type":"text","value":" and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"init_child"}]},{"type":"text","value":" instead."}]},{"type":"element","tag":"h3","props":{"id":"register-a-hook"},"children":[{"type":"text","value":"Register a Hook"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"There are two ways for plugins to register hooks. Both examples register a function on the "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"rcpt"}]},{"type":"text","value":" hook:"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"register_hook"}]},{"type":"text","value":" function in register():"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"exports.register = function() {\nthis.register_hook('rcpt', 'my_rcpt_validate');\n};"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"exports.my_rcpt_validate = function (next, connection, params) {\n// do processing\nnext();\n};"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The hook_"},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"$name"}]},{"type":"text","value":" syntax:"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"exports.hook_rcpt = function (next, connection, params) {\n// do processing\nnext();\n};"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The register_hook function within "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"register()"}]},{"type":"text","value":" offers a few advantages:"}]},{"type":"element","tag":"code","props":{"code":"1. register a hook multiple times (see below)\n2. a unique function name in stack traces\n3. [a better function name](https://google.com/search?q=programming%20good%20function%20names)\n4. hooks can be registered conditionally (ie, based on a config setting)\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"1. register a hook multiple times (see below)\n2. a unique function name in stack traces\n3. [a better function name](https://google.com/search?q=programming%20good%20function%20names)\n4. hooks can be registered conditionally (ie, based on a config setting)"}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"register-a-hook-multiple-times"},"children":[{"type":"text","value":"Register a Hook Multiple Times"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To register the same hook more than once, call "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"register_hook()"}]},{"type":"text","value":" multiple times with the same hook name:"}]},{"type":"element","tag":"code","props":{"code":"exports.register = function() {\n    this.register_hook('queue', 'try_queue_my_way');\n    this.register_hook('queue', 'try_queue_highway');\n};\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d6ea5b"},"children":[{"type":"text","value":"exports"}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-c469e4"},"children":[{"type":"text","value":"register"}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-690281"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-690281"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":"() {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-d6ea5b"},"children":[{"type":"text","value":"this"}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-c469e4"},"children":[{"type":"text","value":"register_hook"}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-14ddb8"},"children":[{"type":"text","value":"'queue'"}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-14ddb8"},"children":[{"type":"text","value":"'try_queue_my_way'"}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":");"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-d6ea5b"},"children":[{"type":"text","value":"this"}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-c469e4"},"children":[{"type":"text","value":"register_hook"}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-14ddb8"},"children":[{"type":"text","value":"'queue'"}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-14ddb8"},"children":[{"type":"text","value":"'try_queue_highway'"}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":");"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":"};"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"try_queue_my_way()"}]},{"type":"text","value":" calls "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next()"}]},{"type":"text","value":", the next function registered on hook "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"queue"}]},{"type":"text","value":" will be called, in this case, "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"try_queue_highway()"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h4","props":{"id":"determine-hook-name"},"children":[{"type":"text","value":"Determine hook name"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When a single function runs on multiple hooks, the function can check the\n"},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"hook"}]},{"type":"text","value":" property of the "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"connection"}]},{"type":"text","value":" or "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"hmail"}]},{"type":"text","value":" argument to determine which hook it is running on:"}]},{"type":"element","tag":"code","props":{"code":"exports.register = function() {\n    this.register_hook('rcpt',    'my_rcpt');\n    this.register_hook('rcpt_ok', 'my_rcpt');\n};\n \nexports.my_rcpt = function (next, connection, params) {\n    var hook_name = connection.hook; // rcpt or rcpt_ok\n    // email address is in params[0]\n    // do processing\n}\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d6ea5b"},"children":[{"type":"text","value":"exports"}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-c469e4"},"children":[{"type":"text","value":"register"}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-690281"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-690281"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":"() {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-d6ea5b"},"children":[{"type":"text","value":"this"}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-c469e4"},"children":[{"type":"text","value":"register_hook"}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-14ddb8"},"children":[{"type":"text","value":"'rcpt'"}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":",    "}]},{"type":"element","tag":"span","props":{"class":"ct-14ddb8"},"children":[{"type":"text","value":"'my_rcpt'"}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":");"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-d6ea5b"},"children":[{"type":"text","value":"this"}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-c469e4"},"children":[{"type":"text","value":"register_hook"}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-14ddb8"},"children":[{"type":"text","value":"'rcpt_ok'"}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-14ddb8"},"children":[{"type":"text","value":"'my_rcpt'"}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":");"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":"};"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":" "}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d6ea5b"},"children":[{"type":"text","value":"exports"}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-c469e4"},"children":[{"type":"text","value":"my_rcpt"}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-690281"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-690281"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-5b037a"},"children":[{"type":"text","value":"next"}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-5b037a"},"children":[{"type":"text","value":"connection"}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-5b037a"},"children":[{"type":"text","value":"params"}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":") {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-690281"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":" hook_name "}]},{"type":"element","tag":"span","props":{"class":"ct-690281"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":" connection.hook; "}]},{"type":"element","tag":"span","props":{"class":"ct-1387db"},"children":[{"type":"text","value":"// rcpt or rcpt_ok"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-1387db"},"children":[{"type":"text","value":"// email address is in params[0]"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-1387db"},"children":[{"type":"text","value":"// do processing"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"next"},"children":[{"type":"text","value":"Next()"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"After registering a hook, functions are called with that hooks arguments (see "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Available Hooks"}]},{"type":"text","value":" below. The first argument is a callback function, conventionally named "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next"}]},{"type":"text","value":". When the function is completed, it calls "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next()"}]},{"type":"text","value":" and the connection continues. Failing to call "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next()"}]},{"type":"text","value":" will result in the connection hanging until that plugin's timer expires."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next([code, msg])"}]},{"type":"text","value":" accepts two optional parameters:"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"code"}]},{"type":"text","value":" is one of the listed return codes."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"msg"}]},{"type":"text","value":" is a string to send to the client in case of a failure. Use an array to send a multi-line message. "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"msg"}]},{"type":"text","value":" should NOT contain the code number - that is handled by Haraka."}]}]},{"type":"element","tag":"h4","props":{"id":"next-return-codes"},"children":[{"type":"text","value":"Next() Return Codes"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"These constants are in your plugin when it is loaded, you do not\nneed to define them:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"CONT"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Continue and let other plugins handle this particular hook. This is the\ndefault. These are identical: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next()"}]},{"type":"text","value":" and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next(CONT)"}]},{"type":"text","value":";"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"DENY - Reject with a 5xx error."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"DENYSOFT - Reject with a 4xx error."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"DENYDISCONNECT - Reject with a 5xx error and immediately disconnect."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"DISCONNECT - Immediately disconnect"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"OK"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Required by "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"rcpt"}]},{"type":"text","value":" plugins to accept a recipient and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"queue"}]},{"type":"text","value":" plugins when the queue was successful."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"After a plugin calls "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next(OK)"}]},{"type":"text","value":", no further plugins on that hook will run."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Exceptions to next(OK):"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connect_init and disconnect hooks are "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"always called"}]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"On the deny hook, "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next(OK)"}]},{"type":"text","value":" overrides the default CONT."}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"HOOK_NEXT"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"HOOK_NEXT is only available on the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"unrecognized_command"}]},{"type":"text","value":" hook. It instructs Haraka to run a different plugin hook. The "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"msg"}]},{"type":"text","value":" argument must be set to the name of the hook to be run. Ex: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next(HOOK_NEXT, 'rcpt_ok');"}]}]}]},{"type":"element","tag":"h2","props":{"id":"available-hooks"},"children":[{"type":"text","value":"Available Hooks"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"These are the hook and their parameters (next excluded):"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"init_master - called when the main (master) process is started"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"init_child - in cluster, called when a child process is started"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"init_http - called when Haraka is started."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"init_wss - called after init_http"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connect_init - used to init data structures, called for "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"every"}]},{"type":"text","value":" connection"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"lookup_rdns - called to look up the rDNS - return the rDNS via "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next(OK, rdns)"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connect - called after we got rDNS"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"capabilities - called to get the ESMTP capabilities (such as STARTTLS)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"unrecognized_command - called when the remote end sends a command we don't recognise"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"disconnect - called upon disconnect"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"helo (hostname)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"ehlo (hostname)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"quit"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"vrfy"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"noop"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"rset"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"mail ("},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"from, esmtp_params"}]},{"type":"text","value":")"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"rcpt ("},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"to,   esmtp_params"}]},{"type":"text","value":")"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"rcpt_ok (to)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"data - called at the DATA command"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"data_post - called at the end-of-data marker"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"max_data_exceeded - called when the message exceeds connection.max_bytes"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"queue - called to queue the mail"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"queue_outbound - called to queue the mail when connection.relaying is set"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"queue_ok - called when a mail has been queued successfully"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"reset_transaction - called before the transaction is reset (via RSET, or MAIL)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"deny - called when a plugin returns DENY, DENYSOFT or DENYDISCONNECT"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"get_mx (hmail, domain) - called by outbound to resolve the MX record"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"deferred (hmail, params) - called when an outbound message is deferred"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"bounce (hmail, err) - called when an outbound message bounces"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"delivered (hmail, "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"host, ip, response, delay, port, mode, ok_recips, secured, authenticated"}]},{"type":"text","value":") - called when outbound mail is delivered"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"send_email (hmail) - called when outbound is about to be sent"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"pre_send_trans_email (fake_connection) - called just before an email is queued to disk with a faked connection object"}]}]},{"type":"element","tag":"h3","props":{"id":"rcpt"},"children":[{"type":"text","value":"rcpt"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"rcpt"}]},{"type":"text","value":" hook is slightly special."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"connection.relaying == false"}]},{"type":"text","value":" (the default, to avoid being an open relay), a rcpt plugin MUST return "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next(OK)"}]},{"type":"text","value":" or the sender will receive the error message \"I cannot deliver for that user\". The default "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"rcpt"}]},{"type":"text","value":" plugin  is "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"rcpt_to.in_host_list"}]},{"type":"text","value":", which lists the domains for which to accept email."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"After a "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"rcpt"}]},{"type":"text","value":" plugin calls "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next(OK)"}]},{"type":"text","value":", the "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"rcpt_ok"}]},{"type":"text","value":" hook is run."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If a plugin prior to the "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"rcpt"}]},{"type":"text","value":" hook sets "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"connection.relaying = true"}]},{"type":"text","value":", then it is not necessary for a rcpt plugin to call "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next(OK)"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h3","props":{"id":"connect_init"},"children":[{"type":"text","value":"connect_init"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"connect_init"}]},{"type":"text","value":" hook is unique in that all return codes are ignored. This is so that plugins that need to do initialization for every connection can be assured they will run. Return values are ignored."}]},{"type":"element","tag":"h3","props":{"id":"hook_init_http-next-server"},"children":[{"type":"text","value":"hook_init_http (next, Server)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If http listeners are are enabled in http.ini and the express module loaded, the express library will be located at Server.http.express. More importantly, the express "},{"type":"element","tag":"a","props":{"href":"http://expressjs.com/4x/api.html#app","rel":["nofollow"]},"children":[{"type":"text","value":"app / instance"}]},{"type":"text","value":" will be located at Server.http.app. Plugins can register routes on the app just as they would with any "},{"type":"element","tag":"a","props":{"href":"http://expressjs.com/","rel":["nofollow"]},"children":[{"type":"text","value":"Express.js"}]},{"type":"text","value":" app."}]},{"type":"element","tag":"h3","props":{"id":"hook_init_wss-next-server"},"children":[{"type":"text","value":"hook_init_wss (next, Server)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If express loaded, an attempt is made to load "},{"type":"element","tag":"a","props":{"href":"https://www.npmjs.com/package/ws","rel":["nofollow"]},"children":[{"type":"text","value":"ws"}]},{"type":"text","value":", the websocket server. If it succeeds, the wss server will be located at Server.http.wss. Because of how websockets work, only one websocket plugin will work at a time. One plugin using wss is "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/tree/master/plugins/watch","rel":["nofollow"]},"children":[{"type":"text","value":"watch"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h3","props":{"id":"pre_send_trans_email-next-fake_connection"},"children":[{"type":"text","value":"pre_send_trans_email (next, fake_connection)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"fake"}]},{"type":"text","value":" connection here is a holder for a new transaction object. It only has the log methods and a "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"transaction"}]},{"type":"text","value":" property\nso don't expect it to behave like a a real connection object. This hook is designed so you can add headers and modify mails\nsent via "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"outbound.send_email()"}]},{"type":"text","value":", see the dkim_sign plugin for an example."}]},{"type":"element","tag":"h2","props":{"id":"hook-order"},"children":[{"type":"text","value":"Hook Order"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The ordering of hooks is determined by the SMTP protocol. Knowledge of "},{"type":"element","tag":"a","props":{"href":"http://tools.ietf.org/html/rfc5321","rel":["nofollow"]},"children":[{"type":"text","value":"RFC 5321"}]},{"type":"text","value":" is beneficial."}]},{"type":"element","tag":"h5","props":{"id":"typical-inbound-connection"},"children":[{"type":"text","value":"Typical Inbound Connection"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hook_connect_init"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hook_lookup_rdns"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hook_connect"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hook_helo "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"OR"}]},{"type":"text","value":" hook_ehlo (EHLO is sent when ESMTP is desired which allows extensions\nsuch as STARTTLS, AUTH, SIZE etc.)"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hook_helo"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hook_ehlo"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hook_capabilities"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"hook_unrecognized_command"}]},{"type":"text","value":" is run for each ESMTP extension the client requests\ne.g. STARTTLS, AUTH etc.)"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hook_mail"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hook_rcpt (once per-recipient)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hook_rcpt_ok (for every recipient that hook_rcpt returned "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next(OK)"}]},{"type":"text","value":" for)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hook_data"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"em","props":{},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"attachment hooks"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hook_data_post"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hook_queue "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"OR"}]},{"type":"text","value":" hook_queue_outbound"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hook_queue_ok (called if hook_queue or hook_queue_outbound returns "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next(OK)"}]},{"type":"text","value":")"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hook_quit "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"OR"}]},{"type":"text","value":" hook_rset "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"OR"}]},{"type":"text","value":" hook_helo "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"OR"}]},{"type":"text","value":" hook_ehlo (after a message has been sent or rejected, the client can disconnect or start a new transaction with RSET, EHLO or HELO)"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hook_reset_transaction"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hook_disconnect"}]}]},{"type":"element","tag":"h5","props":{"id":"typical-outbound-mail"},"children":[{"type":"text","value":"Typical Outbound mail"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"By 'outbound' we mean messages using Haraka's built-in queue and delivery\nmechanism. The Outbound queue is used when "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"connection.relaying = true"}]},{"type":"text","value":" is set during the  transaction and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"hook_queue_outbound"}]},{"type":"text","value":" is called to queue the message."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The Outbound hook ordering mirrors the Inbound hook order above until after "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"hook_queue_outbound"}]},{"type":"text","value":", which is followed by:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hook_send_email"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hook_get_mx"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"at least one of:"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hook_delivered  (once per delivery domain with at least one successful recipient)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hook_deferred  (once per delivery domain where at least one recipient or connection was deferred)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hook_bounce  (once per delivery domain where the recipient(s) or message was rejected by the destination)"}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"plugin-run-order"},"children":[{"type":"text","value":"Plugin Run Order"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Plugins are run on each hook in the order that they are specified in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/plugins"}]},{"type":"text","value":". When a plugin returns anything other than "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next()"}]},{"type":"text","value":" on a hook, all subsequent plugins due to run on that hook are skipped (exceptions: connect_init, disconnect)."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This is important as some plugins might rely on "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"results"}]},{"type":"text","value":" or "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"notes"}]},{"type":"text","value":" that have been set by plugins that need to run before them. This should be noted in the plugins documentation. Make sure to read it."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you are writing a complex plugin, you may have to split it into multiple plugins to run in a specific order e.g. you want hook_deny to run last after all other plugins and hook_lookup_rdns to run first, then you can explicitly register your hooks and provide a "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"priority"}]},{"type":"text","value":" value which is an integer between -100 (highest priority) to 100 (lowest priority) which defaults to 0 (zero) if not supplied.  You can apply a priority to your hook in the following way:"}]},{"type":"element","tag":"code","props":{"code":"exports.register = function() {\n    var plugin = this;\n    plugin.register_hook('connect',  'hook_connect', -100);\n}\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d6ea5b"},"children":[{"type":"text","value":"exports"}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-c469e4"},"children":[{"type":"text","value":"register"}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-690281"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-690281"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":"() {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-690281"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":" plugin "}]},{"type":"element","tag":"span","props":{"class":"ct-690281"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-d6ea5b"},"children":[{"type":"text","value":"this"}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":"    plugin."}]},{"type":"element","tag":"span","props":{"class":"ct-c469e4"},"children":[{"type":"text","value":"register_hook"}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-14ddb8"},"children":[{"type":"text","value":"'connect'"}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":",  "}]},{"type":"element","tag":"span","props":{"class":"ct-14ddb8"},"children":[{"type":"text","value":"'hook_connect'"}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-690281"},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"span","props":{"class":"ct-d6ea5b"},"children":[{"type":"text","value":"100"}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":");"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This would ensure that your hook_connect function will run before any other\nplugins registered on the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"connect"}]},{"type":"text","value":" hook, regardless of the order it was\nspecified in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/plugins"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Check the order that the plugins will run on each hook by running:"}]},{"type":"element","tag":"code","props":{"code":"haraka -o -c /path/to/config\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":"haraka -o -c /path/to/config"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"skipping-plugins"},"children":[{"type":"text","value":"Skipping Plugins"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Plugins can be skipped at runtime by pushing the name of the plugin into the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"skip_plugins"}]},{"type":"text","value":" array in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"transaction.notes"}]},{"type":"text","value":".  This array is reset for every transaction and once a plugin is added to the list, it will not run any hooks in that plugin for the remainder of the transaction.  For example, one could create a whitelist plugin that skipped "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"spamassassin"}]},{"type":"text","value":" if the sender was in a whitelist."}]},{"type":"element","tag":"h2","props":{"id":"logging"},"children":[{"type":"text","value":"Logging"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Plugins inherit all the logging methods of "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"logger.js"}]},{"type":"text","value":", which are:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"logprotocol"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"logdebug"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"loginfo"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"lognotice"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"logwarn"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"logerror"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"logcrit"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"logalert"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"logemerg"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If plugins throw an exception when in a hook, the exception will be caught\nand generate a logcrit level error. However, exceptions will not be caught\nas gracefully when plugins are running async code. Use error codes for that,\nlog the error, and run your next() function appropriately."}]},{"type":"element","tag":"h2","props":{"id":"sharing-state"},"children":[{"type":"text","value":"Sharing State"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"There are several cases where you might need to share information between\nplugins.  This is done using "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"notes"}]},{"type":"text","value":" - there are three types available:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"server.notes"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Available in all plugins.  This is created at PID start-up and is shared\namongst all plugins on the same PID and listener.\nTypical uses for notes at this level would be to share database\nconnections between multiple plugins or connection pools etc."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connection.notes"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Available on any hook that passes 'connection' as a function parameter.\nThis is shared amongst all plugins for a single connection and is\ndestroyed after the client disconnects.\nTypical uses for notes at this level would be to store information\nabout the connected client e.g. rDNS names, HELO/EHLO, white/black\nlist status etc."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connection.transaction.notes"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Available on any hook that passes 'connection' as a function parameter\nbetween hook_mail and hook_data_post.\nThis is shared amongst all plugins for this transaction (e.g. MAIL FROM\nthrough until a message is received or the connection is reset).\nTypical uses for notes at this level would be to store information\non things like greylisting which uses client, sender and recipient\ninformation etc."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hmail.todo.notes"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Available on any outbound hook that passes "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"hmail"}]},{"type":"text","value":" as a function parameter.\nThis is the same object as 'connection.transaction.notes', so anything\nyou store in the transaction notes is automatically available in the\noutbound functions here."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"All of these notes are JS objects - use them as simple key/value store e.g."}]},{"type":"element","tag":"code","props":{"code":"connection.transaction.notes.test = 'testing';\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":"connection.transaction.notes.test "}]},{"type":"element","tag":"span","props":{"class":"ct-690281"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-14ddb8"},"children":[{"type":"text","value":"'testing'"}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":";"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"plugins-as-modules"},"children":[{"type":"text","value":"Plugins as Modules"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Plugins as NPM modules are named with the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"haraka-plugin"}]},{"type":"text","value":" prefix. Therefore, a\nplugin that frobnobricates might be called "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"haraka-plugin-frobnobricate"}]},{"type":"text","value":" and\npublished to NPM with that name. The prefix is not required in the\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/plugins"}]},{"type":"text","value":" file."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Plugins loaded as NPM modules behave slightly different than plugins loaded\nas plain JS files."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Plain JS plugins have a custom "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"require()"}]},{"type":"text","value":" which allows loading core Haraka\nmodules via specifying "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"require('./name')"}]},{"type":"text","value":" (note the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"./"}]},{"type":"text","value":" prefix). Although\nthe core modules aren't in the same folder, the custom "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"require"}]},{"type":"text","value":" intercepts\nthis and look for core modules. Note that if there is a module in your plugins\nfolder of the same name that will not take preference, so avoid using names\nsimilar to core modules."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Plugins loaded as modules do not have the special "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"require()"}]},{"type":"text","value":". To load\na core Haraka module you must use "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"this.haraka_require('name')"}]},{"type":"text","value":".\nThis should also be preferred for plain JS plugins, as the\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"./"}]},{"type":"text","value":" hack is likely to be removed in the future."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Plugins loaded as modules are not compiled in the Haraka plugin sandbox,\nwhich blocks access to certain globals and provides a global "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"server"}]},{"type":"text","value":" object.\nTo access the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"server"}]},{"type":"text","value":" object, use "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"connection.server"}]},{"type":"text","value":" instead."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Module plugins support default config in their local "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config"}]},{"type":"text","value":" directory. See the\n\"Default Config and Overrides\" section in "},{"type":"element","tag":"a","props":{"href":"Config"},"children":[{"type":"text","value":"Config"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h2","props":{"id":"shutdown"},"children":[{"type":"text","value":"Shutdown"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"On graceful reload, Haraka will call a plugin's "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"shutdown"}]},{"type":"text","value":" method."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This is so you can clear any timers or intervals, or shut down any connections\nto remote servers. See "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/issues/2024","rel":["nofollow"]},"children":[{"type":"text","value":"Issue 2024"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"e.g."}]},{"type":"element","tag":"code","props":{"code":"exports.shutdown = function () {\n    clearInterval(this._interval);\n}\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d6ea5b"},"children":[{"type":"text","value":"exports"}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-c469e4"},"children":[{"type":"text","value":"shutdown"}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-690281"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-690281"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":" () {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-d6ea5b"},"children":[{"type":"text","value":"clearInterval"}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-d6ea5b"},"children":[{"type":"text","value":"this"}]},{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":"._interval);"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-22779c"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you don't implement this in your plugin and have a connection open or a\ntimer running then Haraka will take 30 seconds to shut down and have to\nforcibly kill your process."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Note: This only applies when running with a "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"nodes=..."}]},{"type":"text","value":" value in smtp.ini."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"See also, "},{"type":"element","tag":"a","props":{"href":"Results"},"children":[{"type":"text","value":"Results"}]}]},{"type":"element","tag":"h2","props":{"id":"further-reading"},"children":[{"type":"text","value":"Further Reading"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Read about the "},{"type":"element","tag":"a","props":{"href":"Connection"},"children":[{"type":"text","value":"Connection"}]},{"type":"text","value":" object."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Outbound hooks are "},{"type":"element","tag":"a","props":{"href":"Outbound"},"children":[{"type":"text","value":"also documented"}]},{"type":"text","value":"."}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-1387db{color:#6E7781}\n.ct-5b037a{color:#953800}\n.ct-c469e4{color:#8250DF}\n.ct-d6ea5b{color:#0550AE}\n.ct-14ddb8{color:#0A3069}\n.ct-690281{color:#CF222E}\n.ct-22779c{color:#24292F}\n.dark .ct-22779c{color:#C9D1D9}\n.dark .ct-690281{color:#FF7B72}\n.dark .ct-14ddb8{color:#A5D6FF}\n.dark .ct-d6ea5b{color:#79C0FF}\n.dark .ct-c469e4{color:#D2A8FF}\n.dark .ct-5b037a{color:#FFA657}\n.dark .ct-1387db{color:#8B949E}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"plugin-lists","depth":2,"text":"Plugin Lists"},{"id":"anatomy-of-a-plugin","depth":2,"text":"Anatomy of a Plugin","children":[{"id":"register","depth":3,"text":"Register"},{"id":"register-a-hook","depth":3,"text":"Register a Hook"},{"id":"register-a-hook-multiple-times","depth":3,"text":"Register a Hook Multiple Times"},{"id":"next","depth":3,"text":"Next()"}]},{"id":"available-hooks","depth":2,"text":"Available Hooks","children":[{"id":"rcpt","depth":3,"text":"rcpt"},{"id":"connect_init","depth":3,"text":"connect_init"},{"id":"hook_init_http-next-server","depth":3,"text":"hook_init_http (next, Server)"},{"id":"hook_init_wss-next-server","depth":3,"text":"hook_init_wss (next, Server)"},{"id":"pre_send_trans_email-next-fake_connection","depth":3,"text":"pre_send_trans_email (next, fake_connection)"}]},{"id":"hook-order","depth":2,"text":"Hook Order"},{"id":"plugin-run-order","depth":2,"text":"Plugin Run Order"},{"id":"skipping-plugins","depth":2,"text":"Skipping Plugins"},{"id":"logging","depth":2,"text":"Logging"},{"id":"sharing-state","depth":2,"text":"Sharing State"},{"id":"plugins-as-modules","depth":2,"text":"Plugins as Modules"},{"id":"shutdown","depth":2,"text":"Shutdown"},{"id":"further-reading","depth":2,"text":"Further Reading"}]}},"_type":"markdown","_id":"content:6.core:13.Plugins.md","_source":"content","_file":"6.core/13.Plugins.md","_extension":"md"},{"_path":"/core/Results","_dir":"core","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"Results","description":"Add, log, retrieve, and share the results of plugin tests.","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"results"},"children":[{"type":"text","value":"Results"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Add, log, retrieve, and share the results of plugin tests."}]},{"type":"element","tag":"h2","props":{"id":"synopsis"},"children":[{"type":"text","value":"Synopsis"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Moved to "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-results","rel":["nofollow"]},"children":[{"type":"text","value":"https://github.com/haraka/haraka-results"}]}]}]},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"results"},"children":[{"type":"text","value":"Results"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Add, log, retrieve, and share the results of plugin tests."}]},{"type":"element","tag":"h2","props":{"id":"synopsis"},"children":[{"type":"text","value":"Synopsis"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Moved to "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-results","rel":["nofollow"]},"children":[{"type":"text","value":"https://github.com/haraka/haraka-results"}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"synopsis","depth":2,"text":"Synopsis"}]}},"_type":"markdown","_id":"content:6.core:14.Results.md","_source":"content","_file":"6.core/14.Results.md","_extension":"md"},{"_path":"/core/Transaction","_dir":"core","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"Transaction Object","description":"An SMTP transaction is valid from MAIL FROM time until RSET or \"final-dot\".","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"transaction-object"},"children":[{"type":"text","value":"Transaction Object"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"An SMTP transaction is valid from MAIL FROM time until RSET or \"final-dot\"."}]},{"type":"element","tag":"h2","props":{"id":"api"},"children":[{"type":"text","value":"API"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"transaction.uuid"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A unique UUID for this transaction. Is equal to the connection.uuid + '.N'\nwhere N increments for each transaction on this connection."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"transaction.mail_from"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The value of the MAIL FROM command as an "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Address"}]},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"1"}]},{"type":"text","value":" object."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"transaction.rcpt_to"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"An Array of "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Address"}]},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"1"}]},{"type":"text","value":" objects of recipients from the RCPT TO command."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"transaction.message_stream"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A node.js Readable Stream object for the message."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You use it like this:"}]},{"type":"element","tag":"code","props":{"code":"transaction.message_stream.pipe(WritableStream, options)\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"transaction.message_stream.pipe(WritableStream, options)\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Where WritableStream is a node.js Writable Stream object such as a\nnet.socket, fs.writableStream, process.stdout/stderr or custom stream."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The options argument should be an object that overrides the following\nproperties:"}]},{"type":"element","tag":"code","props":{"code":"    * line_endings (default: \"\\r\\n\")\n    * dot_stuffing (default: false)\n    * ending_dot   (default: false)\n    * end          (default: true)\n    * buffer_size  (default: 65535)\n    * clamd_style  (default: false)\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"    * line_endings (default: \"\\r\\n\")\n    * dot_stuffing (default: false)\n    * ending_dot   (default: false)\n    * end          (default: true)\n    * buffer_size  (default: 65535)\n    * clamd_style  (default: false)\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"e.g."}]},{"type":"element","tag":"code","props":{"code":"transaction.message_stream.pipe(socket, { dot_stuffing: true, ending_dot: true });\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"transaction.message_stream.pipe(socket, { dot_stuffing: true, ending_dot: true });\n"}]}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"transaction.data_bytes"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The number of bytes in the email after DATA."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"transaction.add_data(line)"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Adds a line of data to the email. Note this is RAW email - it isn't useful\nfor adding banners to the email."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"transaction.notes"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A safe place to store transaction specific values. See also "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-results","rel":["nofollow"]},"children":[{"type":"text","value":"haraka-results"}]},{"type":"text","value":" and "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-notes","rel":["nofollow"]},"children":[{"type":"text","value":"haraka-notes"}]},{"type":"text","value":"."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"transaction.add_leading_header(key, value)"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Adds a header to the top of the header list.  This should only be used in\nvery specific cases.  Most people will want to use "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"add_header()"}]},{"type":"text","value":" instead."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"transaction.add_header(key, value)"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Adds a header to the email."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"transaction.remove_header(key)"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Deletes a header from the email."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"transaction.header"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The header of the email. See "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Header Object"}]},{"type":"text","value":"."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"transaction.parse_body = true|false "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"default: false"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Set to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"true"}]},{"type":"text","value":" to enable parsing of the mail body. Make sure you set this in\nhook_data or before."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"transaction.body"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The body of the email if you set "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"parse_body"}]},{"type":"text","value":" above. See "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Body Object"}]},{"type":"text","value":"."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"transaction.attachment_hooks(start)"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Sets a callback for when we see an attachment if "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"parse_body"}]},{"type":"text","value":" has been set."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"start"}]},{"type":"text","value":" event will receive "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"(content_type, filename, body, stream)"}]},{"type":"text","value":" as\nparameters."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The stream is a "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"ReadableStream"}]},{"type":"text","value":" - see "},{"type":"element","tag":"a","props":{"href":"http://nodejs.org/api/stream.html","rel":["nofollow"]},"children":[{"type":"text","value":"http://nodejs.org/api/stream.html"}]},{"type":"text","value":" for\ndetails on how this works."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you set stream.connection then the stream will apply backpressure to the\nconnection, allowing you to process attachments before the connection has\nended. Here is an example which stores attachments in temporary files using\nthe "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"tmp"}]},{"type":"text","value":" library from npm and tells us the size of the file:"}]},{"type":"element","tag":"code","props":{"code":"exports.hook_data = function (next, connection) {\n    // enable mail body parsing\n    connection.transaction.parse_body = true;\n    connection.transaction.attachment_hooks(\n        function (ct, fn, body, stream) {\n            start_att(connection, ct, fn, body, stream)\n        }\n    );\n    next();\n}\n\nfunction start_att (connection, ct, fn, body, stream) {\n    connection.loginfo(\"Got attachment: \" + ct + \", \" + fn + \" for user id: \" + connection.transaction.notes.hubdoc_user.email);\n    connection.transaction.notes.attachment_count++;\n\n    stream.connection = connection; // Allow backpressure\n    stream.pause();\n\n    var tmp = require('tmp');\n\n    tmp.file(function (err, path, fd) {\n        connection.loginfo(\"Got tempfile: \" + path + \" (\" + fd + \")\");\n        var ws = fs.createWriteStream(path);\n        stream.pipe(ws);\n        stream.resume();\n        ws.on('close', function () {\n            connection.loginfo(\"End of stream reached\");\n            fs.fstat(fd, function (err, stats) {\n                connection.loginfo(\"Got data of length: \" + stats.size);\n                // Close the tmp file descriptor\n                fs.close(fd, function(){});\n            });\n        });\n    });\n}\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"exports.hook_data = function (next, connection) {\n    // enable mail body parsing\n    connection.transaction.parse_body = true;\n    connection.transaction.attachment_hooks(\n        function (ct, fn, body, stream) {\n            start_att(connection, ct, fn, body, stream)\n        }\n    );\n    next();\n}\n\nfunction start_att (connection, ct, fn, body, stream) {\n    connection.loginfo(\"Got attachment: \" + ct + \", \" + fn + \" for user id: \" + connection.transaction.notes.hubdoc_user.email);\n    connection.transaction.notes.attachment_count++;\n\n    stream.connection = connection; // Allow backpressure\n    stream.pause();\n\n    var tmp = require('tmp');\n\n    tmp.file(function (err, path, fd) {\n        connection.loginfo(\"Got tempfile: \" + path + \" (\" + fd + \")\");\n        var ws = fs.createWriteStream(path);\n        stream.pipe(ws);\n        stream.resume();\n        ws.on('close', function () {\n            connection.loginfo(\"End of stream reached\");\n            fs.fstat(fd, function (err, stats) {\n                connection.loginfo(\"Got data of length: \" + stats.size);\n                // Close the tmp file descriptor\n                fs.close(fd, function(){});\n            });\n        });\n    });\n}\n"}]}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"transaction.discard_data = true|false "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"default: false"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Set this flag to true to discard all data as it arrives and not store in\nmemory or on disk (in the message_stream property). You can still access\nthe attachments and body if you set parse_body to true. This is useful\nfor systems which do not need the full email, just the attachments or\nmail text."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"transaction.set_banner(text, html)"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Sets a banner to be added to the end of the email. If the html part is not\ngiven (optional) then the text part will have each line ending replaced with\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"<br/>"}]},{"type":"text","value":" when being inserted into HTML parts."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"transaction.add_body_filter(ct_match, filter)"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Adds a filter to be applied to body parts in the email.  ct_match should be a\nregular expression to match against the full content-type line, or a string to\nmatch at the start, e.g. "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/^text\\/html/"}]},{"type":"text","value":" or "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"'text/plain'"}]},{"type":"text","value":".  filter will be\ncalled when each body part matching ct_match is complete.  It receives three\nparameters, the content-type line, the encoding name, and a buffer with the\nfull body part.  It should return a buffer with the desired contents of the\nbody in the same encoding."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"transaction.results"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Store results of processing in a structured format. See "},{"type":"element","tag":"a","props":{"href":"http://haraka.github.io/manual/Results.html","rel":["nofollow"]},"children":[{"type":"text","value":"docs/Results"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"1"}]},{"type":"text","value":": "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Address"}]},{"type":"text","value":" objects are address-rfc2821 objects. See "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/node-address-rfc2821","rel":["nofollow"]},"children":[{"type":"text","value":"https://github.com/haraka/node-address-rfc2821"}]}]}]},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"transaction-object"},"children":[{"type":"text","value":"Transaction Object"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"An SMTP transaction is valid from MAIL FROM time until RSET or \"final-dot\"."}]},{"type":"element","tag":"h2","props":{"id":"api"},"children":[{"type":"text","value":"API"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"transaction.uuid"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A unique UUID for this transaction. Is equal to the connection.uuid + '.N'\nwhere N increments for each transaction on this connection."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"transaction.mail_from"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The value of the MAIL FROM command as an "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Address"}]},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"1"}]},{"type":"text","value":" object."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"transaction.rcpt_to"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"An Array of "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Address"}]},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"1"}]},{"type":"text","value":" objects of recipients from the RCPT TO command."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"transaction.message_stream"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A node.js Readable Stream object for the message."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You use it like this:"}]},{"type":"element","tag":"code","props":{"code":"transaction.message_stream.pipe(WritableStream, options)\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"transaction.message_stream."}]},{"type":"element","tag":"span","props":{"class":"ct-cec9c8"},"children":[{"type":"text","value":"pipe"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"(WritableStream, options)"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Where WritableStream is a node.js Writable Stream object such as a\nnet.socket, fs.writableStream, process.stdout/stderr or custom stream."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The options argument should be an object that overrides the following\nproperties:"}]},{"type":"element","tag":"code","props":{"code":"    * line_endings (default: \"\\r\\n\")\n    * dot_stuffing (default: false)\n    * ending_dot   (default: false)\n    * end          (default: true)\n    * buffer_size  (default: 65535)\n    * clamd_style  (default: false)\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-0534d6"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-cec9c8"},"children":[{"type":"text","value":"line_endings"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":" (default: "}]},{"type":"element","tag":"span","props":{"class":"ct-da06f6"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"class":"ct-c89de8"},"children":[{"type":"text","value":"\\r\\n"}]},{"type":"element","tag":"span","props":{"class":"ct-da06f6"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":")"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-0534d6"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-cec9c8"},"children":[{"type":"text","value":"dot_stuffing"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":" (default: "}]},{"type":"element","tag":"span","props":{"class":"ct-c89de8"},"children":[{"type":"text","value":"false"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":")"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-0534d6"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-cec9c8"},"children":[{"type":"text","value":"ending_dot"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"   (default: "}]},{"type":"element","tag":"span","props":{"class":"ct-c89de8"},"children":[{"type":"text","value":"false"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":")"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-0534d6"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-cec9c8"},"children":[{"type":"text","value":"end"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"          (default: "}]},{"type":"element","tag":"span","props":{"class":"ct-c89de8"},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":")"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-0534d6"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-cec9c8"},"children":[{"type":"text","value":"buffer_size"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"  (default: "}]},{"type":"element","tag":"span","props":{"class":"ct-c89de8"},"children":[{"type":"text","value":"65535"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":")"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-0534d6"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-cec9c8"},"children":[{"type":"text","value":"clamd_style"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"  (default: "}]},{"type":"element","tag":"span","props":{"class":"ct-c89de8"},"children":[{"type":"text","value":"false"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":")"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"e.g."}]},{"type":"element","tag":"code","props":{"code":"transaction.message_stream.pipe(socket, { dot_stuffing: true, ending_dot: true });\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"transaction.message_stream."}]},{"type":"element","tag":"span","props":{"class":"ct-cec9c8"},"children":[{"type":"text","value":"pipe"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"(socket, { dot_stuffing: "}]},{"type":"element","tag":"span","props":{"class":"ct-c89de8"},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":", ending_dot: "}]},{"type":"element","tag":"span","props":{"class":"ct-c89de8"},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":" });"}]}]}]}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"transaction.data_bytes"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The number of bytes in the email after DATA."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"transaction.add_data(line)"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Adds a line of data to the email. Note this is RAW email - it isn't useful\nfor adding banners to the email."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"transaction.notes"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A safe place to store transaction specific values. See also "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-results","rel":["nofollow"]},"children":[{"type":"text","value":"haraka-results"}]},{"type":"text","value":" and "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-notes","rel":["nofollow"]},"children":[{"type":"text","value":"haraka-notes"}]},{"type":"text","value":"."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"transaction.add_leading_header(key, value)"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Adds a header to the top of the header list.  This should only be used in\nvery specific cases.  Most people will want to use "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"add_header()"}]},{"type":"text","value":" instead."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"transaction.add_header(key, value)"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Adds a header to the email."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"transaction.remove_header(key)"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Deletes a header from the email."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"transaction.header"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The header of the email. See "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Header Object"}]},{"type":"text","value":"."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"transaction.parse_body = true|false "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"default: false"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Set to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"true"}]},{"type":"text","value":" to enable parsing of the mail body. Make sure you set this in\nhook_data or before."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"transaction.body"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The body of the email if you set "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"parse_body"}]},{"type":"text","value":" above. See "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Body Object"}]},{"type":"text","value":"."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"transaction.attachment_hooks(start)"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Sets a callback for when we see an attachment if "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"parse_body"}]},{"type":"text","value":" has been set."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"start"}]},{"type":"text","value":" event will receive "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"(content_type, filename, body, stream)"}]},{"type":"text","value":" as\nparameters."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The stream is a "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"ReadableStream"}]},{"type":"text","value":" - see "},{"type":"element","tag":"a","props":{"href":"http://nodejs.org/api/stream.html","rel":["nofollow"]},"children":[{"type":"text","value":"http://nodejs.org/api/stream.html"}]},{"type":"text","value":" for\ndetails on how this works."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you set stream.connection then the stream will apply backpressure to the\nconnection, allowing you to process attachments before the connection has\nended. Here is an example which stores attachments in temporary files using\nthe "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"tmp"}]},{"type":"text","value":" library from npm and tells us the size of the file:"}]},{"type":"element","tag":"code","props":{"code":"exports.hook_data = function (next, connection) {\n    // enable mail body parsing\n    connection.transaction.parse_body = true;\n    connection.transaction.attachment_hooks(\n        function (ct, fn, body, stream) {\n            start_att(connection, ct, fn, body, stream)\n        }\n    );\n    next();\n}\n\nfunction start_att (connection, ct, fn, body, stream) {\n    connection.loginfo(\"Got attachment: \" + ct + \", \" + fn + \" for user id: \" + connection.transaction.notes.hubdoc_user.email);\n    connection.transaction.notes.attachment_count++;\n\n    stream.connection = connection; // Allow backpressure\n    stream.pause();\n\n    var tmp = require('tmp');\n\n    tmp.file(function (err, path, fd) {\n        connection.loginfo(\"Got tempfile: \" + path + \" (\" + fd + \")\");\n        var ws = fs.createWriteStream(path);\n        stream.pipe(ws);\n        stream.resume();\n        ws.on('close', function () {\n            connection.loginfo(\"End of stream reached\");\n            fs.fstat(fd, function (err, stats) {\n                connection.loginfo(\"Got data of length: \" + stats.size);\n                // Close the tmp file descriptor\n                fs.close(fd, function(){});\n            });\n        });\n    });\n}\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-c89de8"},"children":[{"type":"text","value":"exports"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-cec9c8"},"children":[{"type":"text","value":"hook_data"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0534d6"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0534d6"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-75eedc"},"children":[{"type":"text","value":"next"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-75eedc"},"children":[{"type":"text","value":"connection"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":") {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-e6becc"},"children":[{"type":"text","value":"// enable mail body parsing"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"    connection.transaction.parse_body "}]},{"type":"element","tag":"span","props":{"class":"ct-0534d6"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-c89de8"},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"    connection.transaction."}]},{"type":"element","tag":"span","props":{"class":"ct-cec9c8"},"children":[{"type":"text","value":"attachment_hooks"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"("}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-0534d6"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-75eedc"},"children":[{"type":"text","value":"ct"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-75eedc"},"children":[{"type":"text","value":"fn"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-75eedc"},"children":[{"type":"text","value":"body"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-75eedc"},"children":[{"type":"text","value":"stream"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":") {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"            "}]},{"type":"element","tag":"span","props":{"class":"ct-cec9c8"},"children":[{"type":"text","value":"start_att"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"(connection, ct, fn, body, stream)"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"        }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"    );"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-cec9c8"},"children":[{"type":"text","value":"next"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"();"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"}"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0534d6"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-cec9c8"},"children":[{"type":"text","value":"start_att"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-75eedc"},"children":[{"type":"text","value":"connection"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-75eedc"},"children":[{"type":"text","value":"ct"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-75eedc"},"children":[{"type":"text","value":"fn"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-75eedc"},"children":[{"type":"text","value":"body"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-75eedc"},"children":[{"type":"text","value":"stream"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":") {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"    connection."}]},{"type":"element","tag":"span","props":{"class":"ct-cec9c8"},"children":[{"type":"text","value":"loginfo"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-da06f6"},"children":[{"type":"text","value":"\"Got attachment: \""}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0534d6"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":" ct "}]},{"type":"element","tag":"span","props":{"class":"ct-0534d6"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-da06f6"},"children":[{"type":"text","value":"\", \""}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0534d6"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":" fn "}]},{"type":"element","tag":"span","props":{"class":"ct-0534d6"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-da06f6"},"children":[{"type":"text","value":"\" for user id: \""}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0534d6"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":" connection.transaction.notes.hubdoc_user.email);"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"    connection.transaction.notes.attachment_count"}]},{"type":"element","tag":"span","props":{"class":"ct-0534d6"},"children":[{"type":"text","value":"++"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"    stream.connection "}]},{"type":"element","tag":"span","props":{"class":"ct-0534d6"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":" connection; "}]},{"type":"element","tag":"span","props":{"class":"ct-e6becc"},"children":[{"type":"text","value":"// Allow backpressure"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"    stream."}]},{"type":"element","tag":"span","props":{"class":"ct-cec9c8"},"children":[{"type":"text","value":"pause"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"();"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-0534d6"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":" tmp "}]},{"type":"element","tag":"span","props":{"class":"ct-0534d6"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-c89de8"},"children":[{"type":"text","value":"require"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-da06f6"},"children":[{"type":"text","value":"'tmp'"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":");"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"    tmp."}]},{"type":"element","tag":"span","props":{"class":"ct-cec9c8"},"children":[{"type":"text","value":"file"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-0534d6"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-75eedc"},"children":[{"type":"text","value":"err"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-75eedc"},"children":[{"type":"text","value":"path"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-75eedc"},"children":[{"type":"text","value":"fd"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":") {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"        connection."}]},{"type":"element","tag":"span","props":{"class":"ct-cec9c8"},"children":[{"type":"text","value":"loginfo"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-da06f6"},"children":[{"type":"text","value":"\"Got tempfile: \""}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0534d6"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":" path "}]},{"type":"element","tag":"span","props":{"class":"ct-0534d6"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-da06f6"},"children":[{"type":"text","value":"\" (\""}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0534d6"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":" fd "}]},{"type":"element","tag":"span","props":{"class":"ct-0534d6"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-da06f6"},"children":[{"type":"text","value":"\")\""}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":");"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-0534d6"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":" ws "}]},{"type":"element","tag":"span","props":{"class":"ct-0534d6"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":" fs."}]},{"type":"element","tag":"span","props":{"class":"ct-cec9c8"},"children":[{"type":"text","value":"createWriteStream"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"(path);"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"        stream."}]},{"type":"element","tag":"span","props":{"class":"ct-cec9c8"},"children":[{"type":"text","value":"pipe"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"(ws);"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"        stream."}]},{"type":"element","tag":"span","props":{"class":"ct-cec9c8"},"children":[{"type":"text","value":"resume"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"();"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"        ws."}]},{"type":"element","tag":"span","props":{"class":"ct-cec9c8"},"children":[{"type":"text","value":"on"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-da06f6"},"children":[{"type":"text","value":"'close'"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-0534d6"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":" () {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"            connection."}]},{"type":"element","tag":"span","props":{"class":"ct-cec9c8"},"children":[{"type":"text","value":"loginfo"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-da06f6"},"children":[{"type":"text","value":"\"End of stream reached\""}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":");"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"            fs."}]},{"type":"element","tag":"span","props":{"class":"ct-cec9c8"},"children":[{"type":"text","value":"fstat"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"(fd, "}]},{"type":"element","tag":"span","props":{"class":"ct-0534d6"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-75eedc"},"children":[{"type":"text","value":"err"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-75eedc"},"children":[{"type":"text","value":"stats"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":") {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"                connection."}]},{"type":"element","tag":"span","props":{"class":"ct-cec9c8"},"children":[{"type":"text","value":"loginfo"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-da06f6"},"children":[{"type":"text","value":"\"Got data of length: \""}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0534d6"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":" stats.size);"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"                "}]},{"type":"element","tag":"span","props":{"class":"ct-e6becc"},"children":[{"type":"text","value":"// Close the tmp file descriptor"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"                fs."}]},{"type":"element","tag":"span","props":{"class":"ct-cec9c8"},"children":[{"type":"text","value":"close"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"(fd, "}]},{"type":"element","tag":"span","props":{"class":"ct-0534d6"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"(){});"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"            });"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"        });"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"    });"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-de5a0b"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"transaction.discard_data = true|false "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"default: false"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Set this flag to true to discard all data as it arrives and not store in\nmemory or on disk (in the message_stream property). You can still access\nthe attachments and body if you set parse_body to true. This is useful\nfor systems which do not need the full email, just the attachments or\nmail text."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"transaction.set_banner(text, html)"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Sets a banner to be added to the end of the email. If the html part is not\ngiven (optional) then the text part will have each line ending replaced with\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"<br/>"}]},{"type":"text","value":" when being inserted into HTML parts."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"transaction.add_body_filter(ct_match, filter)"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Adds a filter to be applied to body parts in the email.  ct_match should be a\nregular expression to match against the full content-type line, or a string to\nmatch at the start, e.g. "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/^text\\/html/"}]},{"type":"text","value":" or "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"'text/plain'"}]},{"type":"text","value":".  filter will be\ncalled when each body part matching ct_match is complete.  It receives three\nparameters, the content-type line, the encoding name, and a buffer with the\nfull body part.  It should return a buffer with the desired contents of the\nbody in the same encoding."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"transaction.results"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Store results of processing in a structured format. See "},{"type":"element","tag":"a","props":{"href":"http://haraka.github.io/manual/Results.html","rel":["nofollow"]},"children":[{"type":"text","value":"docs/Results"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"1"}]},{"type":"text","value":": "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Address"}]},{"type":"text","value":" objects are address-rfc2821 objects. See "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/node-address-rfc2821","rel":["nofollow"]},"children":[{"type":"text","value":"https://github.com/haraka/node-address-rfc2821"}]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-e6becc{color:#6E7781}\n.ct-75eedc{color:#953800}\n.ct-c89de8{color:#0550AE}\n.ct-da06f6{color:#0A3069}\n.ct-0534d6{color:#CF222E}\n.ct-cec9c8{color:#8250DF}\n.ct-de5a0b{color:#24292F}\n.dark .ct-de5a0b{color:#C9D1D9}\n.dark .ct-cec9c8{color:#D2A8FF}\n.dark .ct-0534d6{color:#FF7B72}\n.dark .ct-da06f6{color:#A5D6FF}\n.dark .ct-c89de8{color:#79C0FF}\n.dark .ct-75eedc{color:#FFA657}\n.dark .ct-e6becc{color:#8B949E}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"api","depth":2,"text":"API"}]}},"_type":"markdown","_id":"content:6.core:15.Transaction.md","_source":"content","_file":"6.core/15.Transaction.md","_extension":"md"},{"_path":"/tutorials/_dir","_dir":"tutorials","_draft":false,"_partial":true,"_locale":"en","title":"Tutorials","_id":"content:7.tutorials:_dir.yml","_type":"yaml","_source":"content","_file":"7.tutorials/_dir.yml","_extension":"yml"},{"_path":"/tutorials/migrating_from_v1_to_v2","_dir":"tutorials","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"Migrating from Haraka v1.x to v2.x","description":"Haraka v2.x contains two significant changes to the v1.x API related to\nstreams.","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"migrating-from-haraka-v1x-to-v2x"},"children":[{"type":"text","value":"Migrating from Haraka v1.x to v2.x"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Haraka v2.x contains two significant changes to the v1.x API related to\nstreams."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Streams are an abstraction over a data flow that is provided by Node core\nand is used throughout node to \"pipe\" data between two places or more. This\nmakes programming very easy, and is hence why we started using them in Haraka\nstarting with version 2.0.0."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For more information about the Stream API, see\n"},{"type":"element","tag":"a","props":{"href":"http://nodejs.org/api/stream.html","rel":["nofollow"]},"children":[{"type":"text","value":"http://nodejs.org/api/stream.html"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It's important to note that if you are using standard Haraka plugins then\nit's very unlikely you will need to change anything. Though you may want\nto configure "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"spool_dir"}]},{"type":"text","value":" and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"spool_after"}]},{"type":"text","value":" in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/smtp.ini"}]},{"type":"text","value":". However if\nyou have written custom plugins, continue reading."}]},{"type":"element","tag":"h2","props":{"id":"changes-to-look-for"},"children":[{"type":"text","value":"Changes To Look For"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Firstly, the incoming data in an email (the email body) is now stored in an\nobject which you can treat as a ReadableStream. To find if this is relevant\nfor you, look for instances of "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"data_lines"}]},{"type":"text","value":" in your plugins."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Secondly, if you parse the mail body, attachments are now provided as a\nstream, rather than custom start/data/end events. To find if this is relevant\nfor you, look for instances of "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"attachment_hooks"}]},{"type":"text","value":" in your plugins."}]},{"type":"element","tag":"h2","props":{"id":"fixing-data_lines-plugins"},"children":[{"type":"text","value":"Fixing data_lines plugins"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Any plugins now working on each line of data will need to change to using a\nstream. The stream is called "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"transaction.message_stream"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"These changes may be complicated if you are iterating over each line and\ndoing something with the strings therein. However if you are piping the data\nto an application or over a network, your code will become significantly\nsimpler (and a lot faster)."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In v1.x Haraka populated the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"transaction.data_lines"}]},{"type":"text","value":" array for each line of\ndata received.  If you were writing the data to a socket then you had to handle backpressure manually by checking the return of "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"write()"}]},{"type":"text","value":" and adding\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"on('drain')"}]},{"type":"text","value":" handlers like so:"}]},{"type":"element","tag":"code","props":{"code":"var data_marker = 0;\nvar in_data = false;\nvar end_pending = true;\nvar send_data = function () {\n    in_data = true;\n    var wrote_all = true;\n    while (wrote_all && (data_marker < connection.transaction.data_lines.length)) {\n        var line = connection.transaction.data_lines[data_marker];\n        data_marker++;\n        wrote_all = socket.write(Buffer.from(line.replace(/^\\./, '..').replace(/\\r?\\n/g, '\\r\\n')), 'binary');\n        if (!wrote_all) return;\n    }\n    // we get here if wrote_all still true, and we got to end of data_lines\n    if (end_pending) {\n        end_pending = false;\n        // Finished...\n        socket.send_command('dot');\n    }\n};\nsocket.on('drain', function () {\n    if (end_pending && in_data) {\n        setImmediate(function () { send_data() });\n    }\n});\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"var data_marker = 0;\nvar in_data = false;\nvar end_pending = true;\nvar send_data = function () {\n    in_data = true;\n    var wrote_all = true;\n    while (wrote_all && (data_marker < connection.transaction.data_lines.length)) {\n        var line = connection.transaction.data_lines[data_marker];\n        data_marker++;\n        wrote_all = socket.write(Buffer.from(line.replace(/^\\./, '..').replace(/\\r?\\n/g, '\\r\\n')), 'binary');\n        if (!wrote_all) return;\n    }\n    // we get here if wrote_all still true, and we got to end of data_lines\n    if (end_pending) {\n        end_pending = false;\n        // Finished...\n        socket.send_command('dot');\n    }\n};\nsocket.on('drain', function () {\n    if (end_pending && in_data) {\n        setImmediate(function () { send_data() });\n    }\n});\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In v2.x this now becomes:"}]},{"type":"element","tag":"code","props":{"code":"connection.transaction.message_stream.pipe(socket, {dot_stuffing: true, ending_dot: true});\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"connection.transaction.message_stream.pipe(socket, {dot_stuffing: true, ending_dot: true});\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This automatically chunks the data, handles backpressure and will apply any\nnecessary format changes.  See "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"docs/Transaction.md"}]},{"type":"text","value":" for the full details."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you need to handle the input data by line, then you will need to create\nyour own writable stream and then pipe the message to the stream and then\nextract the lines from the stream of data.  See "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"plugins/dkim_sign.js"}]},{"type":"text","value":" for\nan example."}]},{"type":"element","tag":"h2","props":{"id":"fixing-attachment_hooks-plugins"},"children":[{"type":"text","value":"Fixing attachment_hooks plugins"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For v1.x you passed in functions to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"transaction.attachment_hooks()"}]},{"type":"text","value":" as\nfollows:"}]},{"type":"element","tag":"code","props":{"code":"transaction.attachment_hooks(\n    function (ctype, filename, body) {...}, // start\n    function (buf) {...}, // data\n    function () {...} // end\n);\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"transaction.attachment_hooks(\n    function (ctype, filename, body) {...}, // start\n    function (buf) {...}, // data\n    function () {...} // end\n);\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"That has now changed to:"}]},{"type":"element","tag":"code","props":{"code":"transaction.attachment_hooks(\n    function (ctype, filename, body, stream) {...}, // start\n);\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"transaction.attachment_hooks(\n    function (ctype, filename, body, stream) {...}, // start\n);\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This allows you to attach the stream to other streams via "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"stream.pipe(dest)"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Sometimes destination streams will apply backpressure on the sending stream,\nfor example if you are sending attachments to a remote service. In order\nfor this backpressure to apply to the connection itself (so that we don't\nhave to buffer up data in memory), we need to provide the connection object\nto the stream:"}]},{"type":"element","tag":"code","props":{"code":"var transaction = connection.transaction;\ntransaction.attachment_hooks(\n    function (ctype, filename, body, stream) {\n        stream.connection = connection;\n        ...\n    }\n);\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"var transaction = connection.transaction;\ntransaction.attachment_hooks(\n    function (ctype, filename, body, stream) {\n        stream.connection = connection;\n        ...\n    }\n);\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For a full example of using attachment streams, see the Transaction.md\ndocumentation file."}]}]},"navigation":{"title":"Migrating from v1 to v2"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"migrating-from-haraka-v1x-to-v2x"},"children":[{"type":"text","value":"Migrating from Haraka v1.x to v2.x"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Haraka v2.x contains two significant changes to the v1.x API related to\nstreams."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Streams are an abstraction over a data flow that is provided by Node core\nand is used throughout node to \"pipe\" data between two places or more. This\nmakes programming very easy, and is hence why we started using them in Haraka\nstarting with version 2.0.0."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For more information about the Stream API, see\n"},{"type":"element","tag":"a","props":{"href":"http://nodejs.org/api/stream.html","rel":["nofollow"]},"children":[{"type":"text","value":"http://nodejs.org/api/stream.html"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It's important to note that if you are using standard Haraka plugins then\nit's very unlikely you will need to change anything. Though you may want\nto configure "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"spool_dir"}]},{"type":"text","value":" and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"spool_after"}]},{"type":"text","value":" in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/smtp.ini"}]},{"type":"text","value":". However if\nyou have written custom plugins, continue reading."}]},{"type":"element","tag":"h2","props":{"id":"changes-to-look-for"},"children":[{"type":"text","value":"Changes To Look For"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Firstly, the incoming data in an email (the email body) is now stored in an\nobject which you can treat as a ReadableStream. To find if this is relevant\nfor you, look for instances of "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"data_lines"}]},{"type":"text","value":" in your plugins."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Secondly, if you parse the mail body, attachments are now provided as a\nstream, rather than custom start/data/end events. To find if this is relevant\nfor you, look for instances of "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"attachment_hooks"}]},{"type":"text","value":" in your plugins."}]},{"type":"element","tag":"h2","props":{"id":"fixing-data_lines-plugins"},"children":[{"type":"text","value":"Fixing data_lines plugins"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Any plugins now working on each line of data will need to change to using a\nstream. The stream is called "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"transaction.message_stream"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"These changes may be complicated if you are iterating over each line and\ndoing something with the strings therein. However if you are piping the data\nto an application or over a network, your code will become significantly\nsimpler (and a lot faster)."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In v1.x Haraka populated the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"transaction.data_lines"}]},{"type":"text","value":" array for each line of\ndata received.  If you were writing the data to a socket then you had to handle backpressure manually by checking the return of "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"write()"}]},{"type":"text","value":" and adding\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"on('drain')"}]},{"type":"text","value":" handlers like so:"}]},{"type":"element","tag":"code","props":{"code":"var data_marker = 0;\nvar in_data = false;\nvar end_pending = true;\nvar send_data = function () {\n    in_data = true;\n    var wrote_all = true;\n    while (wrote_all && (data_marker < connection.transaction.data_lines.length)) {\n        var line = connection.transaction.data_lines[data_marker];\n        data_marker++;\n        wrote_all = socket.write(Buffer.from(line.replace(/^\\./, '..').replace(/\\r?\\n/g, '\\r\\n')), 'binary');\n        if (!wrote_all) return;\n    }\n    // we get here if wrote_all still true, and we got to end of data_lines\n    if (end_pending) {\n        end_pending = false;\n        // Finished...\n        socket.send_command('dot');\n    }\n};\nsocket.on('drain', function () {\n    if (end_pending && in_data) {\n        setImmediate(function () { send_data() });\n    }\n});\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-15a497"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":" data_marker "}]},{"type":"element","tag":"span","props":{"class":"ct-15a497"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-b54bc4"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-15a497"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":" in_data "}]},{"type":"element","tag":"span","props":{"class":"ct-15a497"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-b54bc4"},"children":[{"type":"text","value":"false"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-15a497"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":" end_pending "}]},{"type":"element","tag":"span","props":{"class":"ct-15a497"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-b54bc4"},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-15a497"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-55ef0e"},"children":[{"type":"text","value":"send_data"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-15a497"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-15a497"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":" () {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"    in_data "}]},{"type":"element","tag":"span","props":{"class":"ct-15a497"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-b54bc4"},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-15a497"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":" wrote_all "}]},{"type":"element","tag":"span","props":{"class":"ct-15a497"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-b54bc4"},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-15a497"},"children":[{"type":"text","value":"while"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":" (wrote_all "}]},{"type":"element","tag":"span","props":{"class":"ct-15a497"},"children":[{"type":"text","value":"&&"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":" (data_marker "}]},{"type":"element","tag":"span","props":{"class":"ct-15a497"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":" connection.transaction.data_lines."}]},{"type":"element","tag":"span","props":{"class":"ct-b54bc4"},"children":[{"type":"text","value":"length"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":")) {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-15a497"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":" line "}]},{"type":"element","tag":"span","props":{"class":"ct-15a497"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":" connection.transaction.data_lines[data_marker];"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"        data_marker"}]},{"type":"element","tag":"span","props":{"class":"ct-15a497"},"children":[{"type":"text","value":"++"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"        wrote_all "}]},{"type":"element","tag":"span","props":{"class":"ct-15a497"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":" socket."}]},{"type":"element","tag":"span","props":{"class":"ct-55ef0e"},"children":[{"type":"text","value":"write"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"(Buffer."}]},{"type":"element","tag":"span","props":{"class":"ct-55ef0e"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"(line."}]},{"type":"element","tag":"span","props":{"class":"ct-55ef0e"},"children":[{"type":"text","value":"replace"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-1216a3"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-15a497"},"children":[{"type":"text","value":"^"}]},{"type":"element","tag":"span","props":{"class":"ct-7c1d70"},"children":[{"type":"text","value":"\\."}]},{"type":"element","tag":"span","props":{"class":"ct-1216a3"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-1216a3"},"children":[{"type":"text","value":"'..'"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":")."}]},{"type":"element","tag":"span","props":{"class":"ct-55ef0e"},"children":[{"type":"text","value":"replace"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-1216a3"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-b54bc4"},"children":[{"type":"text","value":"\\r"}]},{"type":"element","tag":"span","props":{"class":"ct-15a497"},"children":[{"type":"text","value":"?"}]},{"type":"element","tag":"span","props":{"class":"ct-b54bc4"},"children":[{"type":"text","value":"\\n"}]},{"type":"element","tag":"span","props":{"class":"ct-1216a3"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-15a497"},"children":[{"type":"text","value":"g"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-1216a3"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"class":"ct-b54bc4"},"children":[{"type":"text","value":"\\r\\n"}]},{"type":"element","tag":"span","props":{"class":"ct-1216a3"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":")), "}]},{"type":"element","tag":"span","props":{"class":"ct-1216a3"},"children":[{"type":"text","value":"'binary'"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":");"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-15a497"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-15a497"},"children":[{"type":"text","value":"!"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"wrote_all) "}]},{"type":"element","tag":"span","props":{"class":"ct-15a497"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"    }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-b299cf"},"children":[{"type":"text","value":"// we get here if wrote_all still true, and we got to end of data_lines"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-15a497"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":" (end_pending) {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"        end_pending "}]},{"type":"element","tag":"span","props":{"class":"ct-15a497"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-b54bc4"},"children":[{"type":"text","value":"false"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-b299cf"},"children":[{"type":"text","value":"// Finished..."}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"        socket."}]},{"type":"element","tag":"span","props":{"class":"ct-55ef0e"},"children":[{"type":"text","value":"send_command"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-1216a3"},"children":[{"type":"text","value":"'dot'"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":");"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"    }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"};"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"socket."}]},{"type":"element","tag":"span","props":{"class":"ct-55ef0e"},"children":[{"type":"text","value":"on"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-1216a3"},"children":[{"type":"text","value":"'drain'"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-15a497"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":" () {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-15a497"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":" (end_pending "}]},{"type":"element","tag":"span","props":{"class":"ct-15a497"},"children":[{"type":"text","value":"&&"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":" in_data) {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-55ef0e"},"children":[{"type":"text","value":"setImmediate"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-15a497"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":" () { "}]},{"type":"element","tag":"span","props":{"class":"ct-55ef0e"},"children":[{"type":"text","value":"send_data"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"() });"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"    }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"});"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In v2.x this now becomes:"}]},{"type":"element","tag":"code","props":{"code":"connection.transaction.message_stream.pipe(socket, {dot_stuffing: true, ending_dot: true});\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"connection.transaction.message_stream."}]},{"type":"element","tag":"span","props":{"class":"ct-55ef0e"},"children":[{"type":"text","value":"pipe"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"(socket, {dot_stuffing: "}]},{"type":"element","tag":"span","props":{"class":"ct-b54bc4"},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":", ending_dot: "}]},{"type":"element","tag":"span","props":{"class":"ct-b54bc4"},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"});"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This automatically chunks the data, handles backpressure and will apply any\nnecessary format changes.  See "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"docs/Transaction.md"}]},{"type":"text","value":" for the full details."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you need to handle the input data by line, then you will need to create\nyour own writable stream and then pipe the message to the stream and then\nextract the lines from the stream of data.  See "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"plugins/dkim_sign.js"}]},{"type":"text","value":" for\nan example."}]},{"type":"element","tag":"h2","props":{"id":"fixing-attachment_hooks-plugins"},"children":[{"type":"text","value":"Fixing attachment_hooks plugins"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For v1.x you passed in functions to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"transaction.attachment_hooks()"}]},{"type":"text","value":" as\nfollows:"}]},{"type":"element","tag":"code","props":{"code":"transaction.attachment_hooks(\n    function (ctype, filename, body) {...}, // start\n    function (buf) {...}, // data\n    function () {...} // end\n);\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"transaction."}]},{"type":"element","tag":"span","props":{"class":"ct-55ef0e"},"children":[{"type":"text","value":"attachment_hooks"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"("}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-15a497"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-fcf89c"},"children":[{"type":"text","value":"ctype"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-fcf89c"},"children":[{"type":"text","value":"filename"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-fcf89c"},"children":[{"type":"text","value":"body"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":") {"}]},{"type":"element","tag":"span","props":{"class":"ct-15a497"},"children":[{"type":"text","value":"..."}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"}, "}]},{"type":"element","tag":"span","props":{"class":"ct-b299cf"},"children":[{"type":"text","value":"// start"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-15a497"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-fcf89c"},"children":[{"type":"text","value":"buf"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":") {"}]},{"type":"element","tag":"span","props":{"class":"ct-15a497"},"children":[{"type":"text","value":"..."}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"}, "}]},{"type":"element","tag":"span","props":{"class":"ct-b299cf"},"children":[{"type":"text","value":"// data"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-15a497"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":" () {"}]},{"type":"element","tag":"span","props":{"class":"ct-15a497"},"children":[{"type":"text","value":"..."}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"} "}]},{"type":"element","tag":"span","props":{"class":"ct-b299cf"},"children":[{"type":"text","value":"// end"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":");"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"That has now changed to:"}]},{"type":"element","tag":"code","props":{"code":"transaction.attachment_hooks(\n    function (ctype, filename, body, stream) {...}, // start\n);\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"transaction."}]},{"type":"element","tag":"span","props":{"class":"ct-55ef0e"},"children":[{"type":"text","value":"attachment_hooks"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"("}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-15a497"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-fcf89c"},"children":[{"type":"text","value":"ctype"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-fcf89c"},"children":[{"type":"text","value":"filename"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-fcf89c"},"children":[{"type":"text","value":"body"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-fcf89c"},"children":[{"type":"text","value":"stream"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":") {"}]},{"type":"element","tag":"span","props":{"class":"ct-15a497"},"children":[{"type":"text","value":"..."}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"}, "}]},{"type":"element","tag":"span","props":{"class":"ct-b299cf"},"children":[{"type":"text","value":"// start"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":");"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This allows you to attach the stream to other streams via "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"stream.pipe(dest)"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Sometimes destination streams will apply backpressure on the sending stream,\nfor example if you are sending attachments to a remote service. In order\nfor this backpressure to apply to the connection itself (so that we don't\nhave to buffer up data in memory), we need to provide the connection object\nto the stream:"}]},{"type":"element","tag":"code","props":{"code":"var transaction = connection.transaction;\ntransaction.attachment_hooks(\n    function (ctype, filename, body, stream) {\n        stream.connection = connection;\n        ...\n    }\n);\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-15a497"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":" transaction "}]},{"type":"element","tag":"span","props":{"class":"ct-15a497"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":" connection.transaction;"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"transaction."}]},{"type":"element","tag":"span","props":{"class":"ct-55ef0e"},"children":[{"type":"text","value":"attachment_hooks"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"("}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-15a497"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-fcf89c"},"children":[{"type":"text","value":"ctype"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-fcf89c"},"children":[{"type":"text","value":"filename"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-fcf89c"},"children":[{"type":"text","value":"body"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-fcf89c"},"children":[{"type":"text","value":"stream"}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":") {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"        stream.connection "}]},{"type":"element","tag":"span","props":{"class":"ct-15a497"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":" connection;"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-15a497"},"children":[{"type":"text","value":"..."}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":"    }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d061d4"},"children":[{"type":"text","value":");"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For a full example of using attachment streams, see the Transaction.md\ndocumentation file."}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-fcf89c{color:#953800}\n.ct-b299cf{color:#6E7781}\n.ct-7c1d70{color:#116329}\n.ct-1216a3{color:#0A3069}\n.ct-55ef0e{color:#8250DF}\n.ct-b54bc4{color:#0550AE}\n.ct-d061d4{color:#24292F}\n.ct-15a497{color:#CF222E}\n.dark .ct-15a497{color:#FF7B72}\n.dark .ct-d061d4{color:#C9D1D9}\n.dark .ct-b54bc4{color:#79C0FF}\n.dark .ct-55ef0e{color:#D2A8FF}\n.dark .ct-1216a3{color:#A5D6FF}\n.dark .ct-7c1d70{color:#7EE787}\n.dark .ct-b299cf{color:#8B949E}\n.dark .ct-fcf89c{color:#FFA657}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"changes-to-look-for","depth":2,"text":"Changes To Look For"},{"id":"fixing-data_lines-plugins","depth":2,"text":"Fixing data_lines plugins"},{"id":"fixing-attachment_hooks-plugins","depth":2,"text":"Fixing attachment_hooks plugins"}]}},"_type":"markdown","_id":"content:7.tutorials:Migrating_from_v1_to_v2.md","_source":"content","_file":"7.tutorials/Migrating_from_v1_to_v2.md","_extension":"md"},{"_path":"/tutorials/settingupoutbound","_dir":"tutorials","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"Configuring Haraka For Outbound Email","description":"It is trivially easy to configure Haraka as an outbound email server. But\nfirst there are external things you may want to sort out:","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"configuring-outbound-email"},"children":[{"type":"text","value":"Configuring Outbound Email"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It is trivially easy to configure Haraka as an outbound email server. But\nfirst there are external things you may want to sort out:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Get your DNS PTR record working - make sure it matches the A record of the\nhost you are sending from."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Consider implementing an SPF record. I don't personally do this, but some\npeople seem to think it helps."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"There's lots of information elsewhere on the internet about getting these\nthings working, and they are specific to your network and your DNS hosting."}]},{"type":"element","tag":"h2","props":{"id":"first-some-background"},"children":[{"type":"text","value":"First Some Background"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Sending outbound mail through Haraka is called \"relaying\", and that is the\nterm the internals use. The process is simple - if a plugin in Haraka tells\nthe internals that this mail is to be relayed, then it gets queued in the\n\"queue\" directory for delivery. Then it will go through several delivery\nattempts until it is either successful or fails hard for some reason. A\nhard failure will result in a bounce email being sent to the \"MAIL FROM\"\naddress used when connecting to Haraka. If that address also bounces then\nit is considered a \"double bounce\" and Haraka will log an error and drop it\non the floor."}]},{"type":"element","tag":"h2","props":{"id":"the-setup"},"children":[{"type":"text","value":"The Setup"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Outbound mail servers should run on port 587 and enforce authentication. This\nis slightly different from the \"old\" model where there would simply be a\ncheck based on the connecting IP address to see if it was valid to relay.\nNote however that Haraka doesn't stop you doing it this way - we just don't\nprovide a plugin to do that by default - you will have to write one. The\nreason is purely based on security and personal preference."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Let's create a new Haraka instance:"}]},{"type":"element","tag":"code","props":{"code":"haraka -i haraka-outbound\ncd haraka-outbound\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"haraka -i haraka-outbound\ncd haraka-outbound\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now edit config/smtp.ini - change the port to 587."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Next we setup our plugins - all we need is the tls and auth plugin. AUTH capability is only advertised after TLS/SSL negotiation (except for connections from the local host):"}]},{"type":"element","tag":"code","props":{"code":"echo \"tls\nauth/flat_file\" > config/plugins\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"echo \"tls\nauth/flat_file\" > config/plugins\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now edit the flat file password file, and put in an appropriate username\nand password:"}]},{"type":"element","tag":"code","props":{"code":"vi config/auth_flat_file.ini\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"vi config/auth_flat_file.ini\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"See the documentation in docs/plugins/auth/flat_file.md for information about\nwhat can go in that file."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now you can start Haraka. That's all the configuration you need."}]},{"type":"element","tag":"code","props":{"code":"haraka -c .\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"haraka -c .\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now in another window you can run swaks to test this - be sure to substitute\nan email address you can monitor in place of "},{"type":"element","tag":"a","props":{"href":"mailto:youremail@yourdomain.com"},"children":[{"type":"text","value":"youremail@yourdomain.com"}]},{"type":"text","value":", and the\nusername and password you added for the --auth-user and --auth-password params:"}]},{"type":"element","tag":"code","props":{"code":"swaks --to youremail@yourdomain.com --from test@example.com --server localhost \\\n  --port 587 --auth-user testuser --auth-password testpassword\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"swaks --to youremail@yourdomain.com --from test@example.com --server localhost \\\n  --port 587 --auth-user testuser --auth-password testpassword\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Watch the output of swaks and ensure no errors have occurred. Then watch\nthe recipient email address (easiest to make this your webmail account) and\nsee that the email arrived."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You are done!"}]}]},"navigation":{"title":"Configuring Outbound"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"configuring-outbound-email"},"children":[{"type":"text","value":"Configuring Outbound Email"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It is trivially easy to configure Haraka as an outbound email server. But\nfirst there are external things you may want to sort out:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Get your DNS PTR record working - make sure it matches the A record of the\nhost you are sending from."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Consider implementing an SPF record. I don't personally do this, but some\npeople seem to think it helps."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"There's lots of information elsewhere on the internet about getting these\nthings working, and they are specific to your network and your DNS hosting."}]},{"type":"element","tag":"h2","props":{"id":"first-some-background"},"children":[{"type":"text","value":"First Some Background"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Sending outbound mail through Haraka is called \"relaying\", and that is the\nterm the internals use. The process is simple - if a plugin in Haraka tells\nthe internals that this mail is to be relayed, then it gets queued in the\n\"queue\" directory for delivery. Then it will go through several delivery\nattempts until it is either successful or fails hard for some reason. A\nhard failure will result in a bounce email being sent to the \"MAIL FROM\"\naddress used when connecting to Haraka. If that address also bounces then\nit is considered a \"double bounce\" and Haraka will log an error and drop it\non the floor."}]},{"type":"element","tag":"h2","props":{"id":"the-setup"},"children":[{"type":"text","value":"The Setup"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Outbound mail servers should run on port 587 and enforce authentication. This\nis slightly different from the \"old\" model where there would simply be a\ncheck based on the connecting IP address to see if it was valid to relay.\nNote however that Haraka doesn't stop you doing it this way - we just don't\nprovide a plugin to do that by default - you will have to write one. The\nreason is purely based on security and personal preference."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Let's create a new Haraka instance:"}]},{"type":"element","tag":"code","props":{"code":"haraka -i haraka-outbound\ncd haraka-outbound\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"haraka -i haraka-outbound\ncd haraka-outbound"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now edit config/smtp.ini - change the port to 587."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Next we setup our plugins - all we need is the tls and auth plugin. AUTH capability is only advertised after TLS/SSL negotiation (except for connections from the local host):"}]},{"type":"element","tag":"code","props":{"code":"echo \"tls\nauth/flat_file\" > config/plugins\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"echo \"tls\nauth/flat_file\" > config/plugins"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now edit the flat file password file, and put in an appropriate username\nand password:"}]},{"type":"element","tag":"code","props":{"code":"vi config/auth_flat_file.ini\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"vi config/auth_flat_file.ini"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"See the documentation in docs/plugins/auth/flat_file.md for information about\nwhat can go in that file."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now you can start Haraka. That's all the configuration you need."}]},{"type":"element","tag":"code","props":{"code":"haraka -c .\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"haraka -c ."}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now in another window you can run swaks to test this - be sure to substitute\nan email address you can monitor in place of "},{"type":"element","tag":"a","props":{"href":"mailto:youremail@yourdomain.com"},"children":[{"type":"text","value":"youremail@yourdomain.com"}]},{"type":"text","value":", and the\nusername and password you added for the --auth-user and --auth-password params:"}]},{"type":"element","tag":"code","props":{"code":"swaks --to youremail@yourdomain.com --from test@example.com --server localhost \\\n  --port 587 --auth-user testuser --auth-password testpassword\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"swaks --to youremail@yourdomain.com --from test@example.com --server localhost \\\n  --port 587 --auth-user testuser --auth-password testpassword"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Watch the output of swaks and ensure no errors have occurred. Then watch\nthe recipient email address (easiest to make this your webmail account) and\nsee that the email arrived."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You are done!"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"first-some-background","depth":2,"text":"First Some Background"},{"id":"the-setup","depth":2,"text":"The Setup"}]}},"_type":"markdown","_id":"content:7.tutorials:SettingUpOutbound.md","_source":"content","_file":"7.tutorials/SettingUpOutbound.md","_extension":"md"},{"_path":"/tutorials/tutorial","_dir":"tutorials","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"Writing Haraka Plugins","description":"Part of the joy of using Haraka as your main mail server is having a strong\nplugin based system which means you control all aspects of how your mail is\nprocessed, accepted, and delivered.","excerpt":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Part of the joy of using Haraka as your main mail server is having a strong\nplugin based system which means you control all aspects of how your mail is\nprocessed, accepted, and delivered."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Of course in order to control this you may at some point need to edit some\nsort of plugin file of your own to customise how things work. The good news\nis that writing plugins in Haraka is simple, even for novice coders. You\njust need a little knowledge of Javascript (and maybe some understanding of\nNode.js) and the world is your oyster."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This tutorial will run through a simple plugin which allows you to have\nemail addresses that expire in a short period of time. This is handy if you\nwant a "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"disposable email address"}]},{"type":"text","value":" to use to sign up for a web site that you\ndon't wish to continually receive communication from."}]},{"type":"element","tag":"h2","props":{"id":"the-design"},"children":[{"type":"text","value":"The Design"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In order to make this simple, we are going to simply let you have tagged\nemail addresses such as "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"user-20120515@domain.com"}]},{"type":"text","value":" which will expire on the\n15th May, 2012. Haraka will then check the email has yet to expire, and\nreject mails to that address after the expiry date. If the address hasn't\nexpired yet it will re-write the address to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"user@domain.com"}]},{"type":"text","value":" before onward\ndelivery."}]},{"type":"element","tag":"h2","props":{"id":"what-you-will-need"},"children":[{"type":"text","value":"What You Will Need"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Node.js and npm"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Haraka"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"A text editor"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://jetmore.org/john/code/swaks/","rel":["nofollow"]},"children":[{"type":"text","value":"swaks"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"A screwdriver"}]}]},{"type":"element","tag":"h2","props":{"id":"getting-started"},"children":[{"type":"text","value":"Getting Started"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"First install Haraka via npm if you haven't already:"}]},{"type":"element","tag":"code","props":{"code":"sudo npm -g install Haraka\n","language":"sh"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"sudo npm -g install Haraka\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now we can create our project directory to get started with:"}]},{"type":"element","tag":"code","props":{"code":"haraka -i /path/to/new_project\n","language":"sh"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"haraka -i /path/to/new_project\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Make sure you use a directory that doesn't exist for your project."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Next, let's create a new plugin:"}]},{"type":"element","tag":"code","props":{"code":"haraka -c /path/to/new_project -p rcpt_to.disposable\n","language":"sh"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"haraka -c /path/to/new_project -p rcpt_to.disposable\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This should output a bunch of information about files it has created:"}]},{"type":"element","tag":"code","props":{"code":"Plugin rcpt_to.disposable created\nNow edit javascript in:    /path/to/new_project/plugins/rcpt_to.disposable.js\nAdd the plugin to config:  /path/to/new_project/config/plugins\nAnd edit documentation in: /path/to/new_project/docs/plugins/rcpt_to.disposable.md\n","language":"sh"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"Plugin rcpt_to.disposable created\nNow edit javascript in:    /path/to/new_project/plugins/rcpt_to.disposable.js\nAdd the plugin to config:  /path/to/new_project/config/plugins\nAnd edit documentation in: /path/to/new_project/docs/plugins/rcpt_to.disposable.md\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"So let's do the second part now - load up the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/plugins"}]},{"type":"text","value":" file and lets\nset this up to test things. Comment out most of the plugins, except for\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"rcpt_to.in_host_list"}]},{"type":"text","value":" and add in our new plugin, and change the queue\nplugin to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"test_queue"}]},{"type":"text","value":". The final file should look like this:"}]},{"type":"element","tag":"code","props":{"code":"# default list of plugins\n\n# block mails from known bad hosts (see config/dnsbl.zones for the DNS zones queried)\n#dnsbl\n\n# allow bad mail signatures from the config/data.signatures file.\n#data.signatures\n\n# block mail from some known bad HELOs - see config/helo.checks.ini for configuration\n#helo.checks\n\n# block mail from known bad email addresses you put in config/mail_from.blocklist\n#mail_from.blocklist\n\n# Only accept mail where the MAIL FROM domain is resolvable to an MX record\n#mail_from.is_resolvable\n\n# Allow dated tagged addresses\nrcpt_to.disposable\n\n# Only accept mail for your personal list of hosts\nrcpt_to.in_host_list\n\n# Queue mail via qmail-queue\n#queue/qmail-queue\n\nqueue/test\n","language":"ini"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"# default list of plugins\n\n# block mails from known bad hosts (see config/dnsbl.zones for the DNS zones queried)\n#dnsbl\n\n# allow bad mail signatures from the config/data.signatures file.\n#data.signatures\n\n# block mail from some known bad HELOs - see config/helo.checks.ini for configuration\n#helo.checks\n\n# block mail from known bad email addresses you put in config/mail_from.blocklist\n#mail_from.blocklist\n\n# Only accept mail where the MAIL FROM domain is resolvable to an MX record\n#mail_from.is_resolvable\n\n# Allow dated tagged addresses\nrcpt_to.disposable\n\n# Only accept mail for your personal list of hosts\nrcpt_to.in_host_list\n\n# Queue mail via qmail-queue\n#queue/qmail-queue\n\nqueue/test\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Remember that the ordering here is important - our new plugin has to come\nbefore "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"rcpt_to.in_host_list"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now fire up your favourite editor and put the following into\nthe "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"plugins/rcpt_to.disposable.js"}]},{"type":"text","value":" file:"}]},{"type":"element","tag":"code","props":{"code":"exports.hook_rcpt = function (next, connection, params) {\n    var rcpt = params[0];\n    this.loginfo(\"Got recipient: \" + rcpt);\n    next();\n}\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"exports.hook_rcpt = function (next, connection, params) {\n    var rcpt = params[0];\n    this.loginfo(\"Got recipient: \" + rcpt);\n    next();\n}\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"All we are doing here is logging the fact that we got the recipient."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Check this works. You'll need two terminal windows. In window 1:"}]},{"type":"element","tag":"code","props":{"code":"echo LOGDEBUG > config/loglevel\necho myserver.com >> config/host_list\nsudo haraka -c /path/to/new_project\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"echo LOGDEBUG > config/loglevel\necho myserver.com >> config/host_list\nsudo haraka -c /path/to/new_project\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"And in window 2:"}]},{"type":"element","tag":"code","props":{"code":"swaks -h domain.com -t booya@myserver.com -f somewhere@example.com \\\n-s localhost -p 25\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"swaks -h domain.com -t booya@myserver.com -f somewhere@example.com \\\n-s localhost -p 25\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In the logs you should see:"}]},{"type":"element","tag":"code","props":{"code":"[INFO] [rcpt_to.disposable] Got recipient: <booya@myserver.com>\n","language":"sh"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"[INFO] [rcpt_to.disposable] Got recipient: <booya@myserver.com>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Which indicates everything is working. You should also have a file\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/tmp/mail.eml"}]},{"type":"text","value":" containing the email that swaks sent."}]},{"type":"element","tag":"h2","props":{"id":"parsing-out-the-date"},"children":[{"type":"text","value":"Parsing Out The Date"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now lets check for emails with an expire date in them and turn them into\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Date"}]},{"type":"text","value":" objects. Edit your plugin file as follows:"}]},{"type":"element","tag":"code","props":{"code":"exports.hook_rcpt = function (next, connection, params) {\n    var rcpt = params[0];\n    this.loginfo(\"Got recipient: \" + rcpt);\n    \n    // Check user matches regex 'user-YYYYMMDD':\n    var match = /^(.*)-(\\d{4})(\\d{2})(\\d{2})$/.exec(rcpt.user);\n    if (!match) {\n        return next();\n    }\n    \n    // get date - note Date constructor takes month-1 (i.e. Dec == 11).\n    var expiry_date = new Date(match[2], match[3]-1, match[4]);\n    \n    this.loginfo(\"Email expires on: \" + expiry_date);\n    \n    next();\n}\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"exports.hook_rcpt = function (next, connection, params) {\n    var rcpt = params[0];\n    this.loginfo(\"Got recipient: \" + rcpt);\n    \n    // Check user matches regex 'user-YYYYMMDD':\n    var match = /^(.*)-(\\d{4})(\\d{2})(\\d{2})$/.exec(rcpt.user);\n    if (!match) {\n        return next();\n    }\n    \n    // get date - note Date constructor takes month-1 (i.e. Dec == 11).\n    var expiry_date = new Date(match[2], match[3]-1, match[4]);\n    \n    this.loginfo(\"Email expires on: \" + expiry_date);\n    \n    next();\n}\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Start haraka again and pass it the following email via swaks:"}]},{"type":"element","tag":"code","props":{"code":"swaks -h domain.com -t booya-20120101@myserver.com \\\n  -f somewhere@example.com -s localhost -p 25\n","language":"sh"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"swaks -h domain.com -t booya-20120101@myserver.com \\\n  -f somewhere@example.com -s localhost -p 25\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"And you should see now in the logs:"}]},{"type":"element","tag":"code","props":{"code":"[INFO] [rcpt_to.disposable] Got recipient: <booya-20120101@myserver.com>\n[INFO] [rcpt_to.disposable] Email expires on: Sun, 01 Jan 2012 05:00:00 GMT\n","language":"sh"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"[INFO] [rcpt_to.disposable] Got recipient: <booya-20120101@myserver.com>\n[INFO] [rcpt_to.disposable] Email expires on: Sun, 01 Jan 2012 05:00:00 GMT\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The exact time may vary depending on your timezone, but it should be obvious\nwe now have a date object, which we can now compare to the current date."}]},{"type":"element","tag":"h2","props":{"id":"rejecting-expired-emails"},"children":[{"type":"text","value":"Rejecting Expired Emails"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The next edit we have to do is to add in code to compare to the current date\nand reject expired emails. Again, this is very simple:"}]},{"type":"element","tag":"code","props":{"code":"exports.hook_rcpt = function (next, connection, params) {\n    var rcpt = params[0];\n    this.loginfo(\"Got recipient: \" + rcpt);\n\n    // Check user matches regex 'user-YYYYMMDD':\n    var match = /^(.*)-(\\d{4})(\\d{2})(\\d{2})$/.exec(rcpt.user);\n    if (!match) {\n        return next();\n    }\n\n    // get date - note Date constructor takes month-1 (i.e. Dec == 11).\n    var expiry_date = new Date(match[2], match[3]-1, match[4]);\n\n    this.loginfo(\"Email expires on: \" + expiry_date);\n    \n    var today = new Date();\n    \n    if (expiry_date < today) {\n        // If we get here, the email address has expired\n        return next(DENY, \"Expired email address\");\n    }\n    \n    next();\n}\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"exports.hook_rcpt = function (next, connection, params) {\n    var rcpt = params[0];\n    this.loginfo(\"Got recipient: \" + rcpt);\n\n    // Check user matches regex 'user-YYYYMMDD':\n    var match = /^(.*)-(\\d{4})(\\d{2})(\\d{2})$/.exec(rcpt.user);\n    if (!match) {\n        return next();\n    }\n\n    // get date - note Date constructor takes month-1 (i.e. Dec == 11).\n    var expiry_date = new Date(match[2], match[3]-1, match[4]);\n\n    this.loginfo(\"Email expires on: \" + expiry_date);\n    \n    var today = new Date();\n    \n    if (expiry_date < today) {\n        // If we get here, the email address has expired\n        return next(DENY, \"Expired email address\");\n    }\n    \n    next();\n}\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"And we can easily check that with swaks (remember to restart Haraka):"}]},{"type":"element","tag":"code","props":{"code":"swaks -h foo.com -t booya-20110101@haraka.local -f somewhere@example.com \\\n  -s localhost -p 25\n=== Trying localhost:25...\n=== Connected to localhost.\n<-  220 sergeant.org ESMTP Haraka 0.3 ready\n -> EHLO foo.com\n<-  250-Haraka says hi Unknown [127.0.0.1]\n<-  250-PIPELINING\n<-  250-8BITMIME\n<-  250 SIZE 500000\n -> MAIL FROM:<somewhere@example.com>\n<-  250 From address is OK\n -> RCPT TO:<booya-20110101@haraka.local>\n<** 550 Expired email address\n -> QUIT\n<-  221 closing connection. Have a jolly good day.\n=== Connection closed with remote host.\n","language":"sh"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"swaks -h foo.com -t booya-20110101@haraka.local -f somewhere@example.com \\\n  -s localhost -p 25\n=== Trying localhost:25...\n=== Connected to localhost.\n<-  220 sergeant.org ESMTP Haraka 0.3 ready\n -> EHLO foo.com\n<-  250-Haraka says hi Unknown [127.0.0.1]\n<-  250-PIPELINING\n<-  250-8BITMIME\n<-  250 SIZE 500000\n -> MAIL FROM:<somewhere@example.com>\n<-  250 From address is OK\n -> RCPT TO:<booya-20110101@haraka.local>\n<** 550 Expired email address\n -> QUIT\n<-  221 closing connection. Have a jolly good day.\n=== Connection closed with remote host.\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now we need to do one more thing..."}]},{"type":"element","tag":"h2","props":{"id":"fixing-up-unexpired-emails"},"children":[{"type":"text","value":"Fixing Up Unexpired Emails"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The last thing we need to do, is if we have an email that isn't expired, we\nneed to normalise it back to the real email address, because wherever we\ndeliver this to is unlikely to recognise these new email addresses."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Here's how our final plugin will look:"}]},{"type":"element","tag":"code","props":{"code":"exports.hook_rcpt = function (next, connection, params) {\n    var rcpt = params[0];\n    this.loginfo(\"Got recipient: \" + rcpt);\n\n    // Check user matches regex 'user-YYYYMMDD':\n    var match = /^(.*)-(\\d{4})(\\d{2})(\\d{2})$/.exec(rcpt.user);\n    if (!match) {\n        return next();\n    }\n\n    // get date - note Date constructor takes month-1 (i.e. Dec == 11).\n    var expiry_date = new Date(match[2], match[3]-1, match[4]);\n\n    this.loginfo(\"Email expires on: \" + expiry_date);\n\n    var today = new Date();\n\n    if (expiry_date < today) {\n        // If we get here, the email address has expired\n        return next(DENY, \"Expired email address\");\n    }\n    \n    // now get rid of the extension:\n    rcpt.user = match[1];\n    this.loginfo(\"Email address now: \" + rcpt);\n    \n    next();\n}\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"exports.hook_rcpt = function (next, connection, params) {\n    var rcpt = params[0];\n    this.loginfo(\"Got recipient: \" + rcpt);\n\n    // Check user matches regex 'user-YYYYMMDD':\n    var match = /^(.*)-(\\d{4})(\\d{2})(\\d{2})$/.exec(rcpt.user);\n    if (!match) {\n        return next();\n    }\n\n    // get date - note Date constructor takes month-1 (i.e. Dec == 11).\n    var expiry_date = new Date(match[2], match[3]-1, match[4]);\n\n    this.loginfo(\"Email expires on: \" + expiry_date);\n\n    var today = new Date();\n\n    if (expiry_date < today) {\n        // If we get here, the email address has expired\n        return next(DENY, \"Expired email address\");\n    }\n    \n    // now get rid of the extension:\n    rcpt.user = match[1];\n    this.loginfo(\"Email address now: \" + rcpt);\n    \n    next();\n}\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"And when we test this with an unexpired address via swaks:"}]},{"type":"element","tag":"code","props":{"code":"swaks -h foo.com -t booya-20120101@haraka.local \\\n      -f somewhere@example.com -s localhost -p 25\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"swaks -h foo.com -t booya-20120101@haraka.local \\\n      -f somewhere@example.com -s localhost -p 25\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We get in the logs:"}]},{"type":"element","tag":"code","props":{"code":"[INFO] [rcpt_to.disposable] Got recipient: <booya-20120101@haraka.local>\n[INFO] [rcpt_to.disposable] Email expires on: Sun Jan 01 2012 00:00:00 GMT-0500 (EST)\n[INFO] [rcpt_to.disposable] Email address now: <booya@haraka.local>\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"[INFO] [rcpt_to.disposable] Got recipient: <booya-20120101@haraka.local>\n[INFO] [rcpt_to.disposable] Email expires on: Sun Jan 01 2012 00:00:00 GMT-0500 (EST)\n[INFO] [rcpt_to.disposable] Email address now: <booya@haraka.local>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Which indicates that we have successfully modified the email address."}]},{"type":"element","tag":"h1","props":{"id":"further-reading"},"children":[{"type":"text","value":"Further Reading"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"There are many more features of the Haraka API to explore, including access\nto the body of the email and the headers, access to the HELO string, and\nimplementing ESMTP extensions, among many others."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"There are two good places to read up on these. Firstly is the documentation\nin the Haraka \"docs\" directory. Start with the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Plugins.md"}]},{"type":"text","value":" file, and work\nyour way through the API from there."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The second place is simply reading the source code for the plugins themselves.\nThe plugins that Haraka ships with use almost all parts of the API and so\nshould give you a good starting point if you want to implement a particular\npiece of functionality. Even the most complicated plugins are under 200 lines\nof code, so don't be intimidated by them! The simplest one is a mere 5 lines\nof code."}]}]},"navigation":{"title":"Writing Plugins"},"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Part of the joy of using Haraka as your main mail server is having a strong\nplugin based system which means you control all aspects of how your mail is\nprocessed, accepted, and delivered."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Of course in order to control this you may at some point need to edit some\nsort of plugin file of your own to customise how things work. The good news\nis that writing plugins in Haraka is simple, even for novice coders. You\njust need a little knowledge of Javascript (and maybe some understanding of\nNode.js) and the world is your oyster."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This tutorial will run through a simple plugin which allows you to have\nemail addresses that expire in a short period of time. This is handy if you\nwant a "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"disposable email address"}]},{"type":"text","value":" to use to sign up for a web site that you\ndon't wish to continually receive communication from."}]},{"type":"element","tag":"h2","props":{"id":"the-design"},"children":[{"type":"text","value":"The Design"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In order to make this simple, we are going to simply let you have tagged\nemail addresses such as "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"user-20120515@domain.com"}]},{"type":"text","value":" which will expire on the\n15th May, 2012. Haraka will then check the email has yet to expire, and\nreject mails to that address after the expiry date. If the address hasn't\nexpired yet it will re-write the address to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"user@domain.com"}]},{"type":"text","value":" before onward\ndelivery."}]},{"type":"element","tag":"h2","props":{"id":"what-you-will-need"},"children":[{"type":"text","value":"What You Will Need"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Node.js and npm"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Haraka"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"A text editor"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://jetmore.org/john/code/swaks/","rel":["nofollow"]},"children":[{"type":"text","value":"swaks"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"A screwdriver"}]}]},{"type":"element","tag":"h2","props":{"id":"getting-started"},"children":[{"type":"text","value":"Getting Started"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"First install Haraka via npm if you haven't already:"}]},{"type":"element","tag":"code","props":{"code":"sudo npm -g install Haraka\n","language":"sh"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"sudo npm -g install Haraka"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now we can create our project directory to get started with:"}]},{"type":"element","tag":"code","props":{"code":"haraka -i /path/to/new_project\n","language":"sh"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"haraka -i /path/to/new_project"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Make sure you use a directory that doesn't exist for your project."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Next, let's create a new plugin:"}]},{"type":"element","tag":"code","props":{"code":"haraka -c /path/to/new_project -p rcpt_to.disposable\n","language":"sh"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"haraka -c /path/to/new_project -p rcpt_to.disposable"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This should output a bunch of information about files it has created:"}]},{"type":"element","tag":"code","props":{"code":"Plugin rcpt_to.disposable created\nNow edit javascript in:    /path/to/new_project/plugins/rcpt_to.disposable.js\nAdd the plugin to config:  /path/to/new_project/config/plugins\nAnd edit documentation in: /path/to/new_project/docs/plugins/rcpt_to.disposable.md\n","language":"sh"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"Plugin rcpt_to.disposable created"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"Now edit javascript in:    /path/to/new_project/plugins/rcpt_to.disposable.js"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"Add the plugin to config:  /path/to/new_project/config/plugins"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"And edit documentation in: /path/to/new_project/docs/plugins/rcpt_to.disposable.md"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"So let's do the second part now - load up the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/plugins"}]},{"type":"text","value":" file and lets\nset this up to test things. Comment out most of the plugins, except for\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"rcpt_to.in_host_list"}]},{"type":"text","value":" and add in our new plugin, and change the queue\nplugin to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"test_queue"}]},{"type":"text","value":". The final file should look like this:"}]},{"type":"element","tag":"code","props":{"code":"# default list of plugins\n\n# block mails from known bad hosts (see config/dnsbl.zones for the DNS zones queried)\n#dnsbl\n\n# allow bad mail signatures from the config/data.signatures file.\n#data.signatures\n\n# block mail from some known bad HELOs - see config/helo.checks.ini for configuration\n#helo.checks\n\n# block mail from known bad email addresses you put in config/mail_from.blocklist\n#mail_from.blocklist\n\n# Only accept mail where the MAIL FROM domain is resolvable to an MX record\n#mail_from.is_resolvable\n\n# Allow dated tagged addresses\nrcpt_to.disposable\n\n# Only accept mail for your personal list of hosts\nrcpt_to.in_host_list\n\n# Queue mail via qmail-queue\n#queue/qmail-queue\n\nqueue/test\n","language":"ini"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-78da41"},"children":[{"type":"text","value":"# default list of plugins"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-78da41"},"children":[{"type":"text","value":"# block mails from known bad hosts (see config/dnsbl.zones for the DNS zones queried)"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-78da41"},"children":[{"type":"text","value":"#dnsbl"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-78da41"},"children":[{"type":"text","value":"# allow bad mail signatures from the config/data.signatures file."}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-78da41"},"children":[{"type":"text","value":"#data.signatures"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-78da41"},"children":[{"type":"text","value":"# block mail from some known bad HELOs - see config/helo.checks.ini for configuration"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-78da41"},"children":[{"type":"text","value":"#helo.checks"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-78da41"},"children":[{"type":"text","value":"# block mail from known bad email addresses you put in config/mail_from.blocklist"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-78da41"},"children":[{"type":"text","value":"#mail_from.blocklist"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-78da41"},"children":[{"type":"text","value":"# Only accept mail where the MAIL FROM domain is resolvable to an MX record"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-78da41"},"children":[{"type":"text","value":"#mail_from.is_resolvable"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-78da41"},"children":[{"type":"text","value":"# Allow dated tagged addresses"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"rcpt_to.disposable"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-78da41"},"children":[{"type":"text","value":"# Only accept mail for your personal list of hosts"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"rcpt_to.in_host_list"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-78da41"},"children":[{"type":"text","value":"# Queue mail via qmail-queue"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-78da41"},"children":[{"type":"text","value":"#queue/qmail-queue"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"queue/test"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Remember that the ordering here is important - our new plugin has to come\nbefore "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"rcpt_to.in_host_list"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now fire up your favourite editor and put the following into\nthe "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"plugins/rcpt_to.disposable.js"}]},{"type":"text","value":" file:"}]},{"type":"element","tag":"code","props":{"code":"exports.hook_rcpt = function (next, connection, params) {\n    var rcpt = params[0];\n    this.loginfo(\"Got recipient: \" + rcpt);\n    next();\n}\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"exports"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-d7d70c"},"children":[{"type":"text","value":"hook_rcpt"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-2a5a40"},"children":[{"type":"text","value":"next"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-2a5a40"},"children":[{"type":"text","value":"connection"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-2a5a40"},"children":[{"type":"text","value":"params"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":") {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" rcpt "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" params["}]},{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"];"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"this"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-d7d70c"},"children":[{"type":"text","value":"loginfo"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-13c1f3"},"children":[{"type":"text","value":"\"Got recipient: \""}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" rcpt);"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-d7d70c"},"children":[{"type":"text","value":"next"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"();"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"All we are doing here is logging the fact that we got the recipient."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Check this works. You'll need two terminal windows. In window 1:"}]},{"type":"element","tag":"code","props":{"code":"echo LOGDEBUG > config/loglevel\necho myserver.com >> config/host_list\nsudo haraka -c /path/to/new_project\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"echo"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" LOGDEBUG "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":">"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" config/loglevel"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"echo"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" myserver.com "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":">>"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" config/host_list"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"sudo haraka -c /path/to/new_project"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"And in window 2:"}]},{"type":"element","tag":"code","props":{"code":"swaks -h domain.com -t booya@myserver.com -f somewhere@example.com \\\n-s localhost -p 25\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"swaks -h domain.com -t booya@myserver.com -f somewhere@example.com \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"-s localhost -p 25"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In the logs you should see:"}]},{"type":"element","tag":"code","props":{"code":"[INFO] [rcpt_to.disposable] Got recipient: <booya@myserver.com>\n","language":"sh"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"[INFO] [rcpt_to.disposable] Got recipient: "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"booya@myserver.com"}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":">"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Which indicates everything is working. You should also have a file\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/tmp/mail.eml"}]},{"type":"text","value":" containing the email that swaks sent."}]},{"type":"element","tag":"h2","props":{"id":"parsing-out-the-date"},"children":[{"type":"text","value":"Parsing Out The Date"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now lets check for emails with an expire date in them and turn them into\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Date"}]},{"type":"text","value":" objects. Edit your plugin file as follows:"}]},{"type":"element","tag":"code","props":{"code":"exports.hook_rcpt = function (next, connection, params) {\n    var rcpt = params[0];\n    this.loginfo(\"Got recipient: \" + rcpt);\n    \n    // Check user matches regex 'user-YYYYMMDD':\n    var match = /^(.*)-(\\d{4})(\\d{2})(\\d{2})$/.exec(rcpt.user);\n    if (!match) {\n        return next();\n    }\n    \n    // get date - note Date constructor takes month-1 (i.e. Dec == 11).\n    var expiry_date = new Date(match[2], match[3]-1, match[4]);\n    \n    this.loginfo(\"Email expires on: \" + expiry_date);\n    \n    next();\n}\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"exports"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-d7d70c"},"children":[{"type":"text","value":"hook_rcpt"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-2a5a40"},"children":[{"type":"text","value":"next"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-2a5a40"},"children":[{"type":"text","value":"connection"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-2a5a40"},"children":[{"type":"text","value":"params"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":") {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" rcpt "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" params["}]},{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"];"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"this"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-d7d70c"},"children":[{"type":"text","value":"loginfo"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-13c1f3"},"children":[{"type":"text","value":"\"Got recipient: \""}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" rcpt);"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    "}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-78da41"},"children":[{"type":"text","value":"// Check user matches regex 'user-YYYYMMDD':"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" match "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-13c1f3"},"children":[{"type":"text","value":" /"}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"^"}]},{"type":"element","tag":"span","props":{"class":"ct-13c1f3"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-13c1f3"},"children":[{"type":"text","value":")-("}]},{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"\\d"}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"{4}"}]},{"type":"element","tag":"span","props":{"class":"ct-13c1f3"},"children":[{"type":"text","value":")("}]},{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"\\d"}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"{2}"}]},{"type":"element","tag":"span","props":{"class":"ct-13c1f3"},"children":[{"type":"text","value":")("}]},{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"\\d"}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"{2}"}]},{"type":"element","tag":"span","props":{"class":"ct-13c1f3"},"children":[{"type":"text","value":")"}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"$"}]},{"type":"element","tag":"span","props":{"class":"ct-13c1f3"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-d7d70c"},"children":[{"type":"text","value":"exec"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"(rcpt.user);"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"!"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"match) {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-d7d70c"},"children":[{"type":"text","value":"next"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"();"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    "}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-78da41"},"children":[{"type":"text","value":"// get date - note Date constructor takes month-1 (i.e. Dec == 11)."}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" expiry_date "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"new"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"Date"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"(match["}]},{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"], match["}]},{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"3"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"]"}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":", match["}]},{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"4"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"]);"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    "}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"this"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-d7d70c"},"children":[{"type":"text","value":"loginfo"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-13c1f3"},"children":[{"type":"text","value":"\"Email expires on: \""}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" expiry_date);"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    "}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-d7d70c"},"children":[{"type":"text","value":"next"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"();"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Start haraka again and pass it the following email via swaks:"}]},{"type":"element","tag":"code","props":{"code":"swaks -h domain.com -t booya-20120101@myserver.com \\\n  -f somewhere@example.com -s localhost -p 25\n","language":"sh"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"swaks -h domain.com -t booya-20120101@myserver.com \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"  -f somewhere@example.com -s localhost -p 25"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"And you should see now in the logs:"}]},{"type":"element","tag":"code","props":{"code":"[INFO] [rcpt_to.disposable] Got recipient: <booya-20120101@myserver.com>\n[INFO] [rcpt_to.disposable] Email expires on: Sun, 01 Jan 2012 05:00:00 GMT\n","language":"sh"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"[INFO] [rcpt_to.disposable] Got recipient: "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"booya-20120101@myserver.com"}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":">"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"[INFO] [rcpt_to.disposable] Email expires on: Sun, 01 Jan 2012 05:00:00 GMT"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The exact time may vary depending on your timezone, but it should be obvious\nwe now have a date object, which we can now compare to the current date."}]},{"type":"element","tag":"h2","props":{"id":"rejecting-expired-emails"},"children":[{"type":"text","value":"Rejecting Expired Emails"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The next edit we have to do is to add in code to compare to the current date\nand reject expired emails. Again, this is very simple:"}]},{"type":"element","tag":"code","props":{"code":"exports.hook_rcpt = function (next, connection, params) {\n    var rcpt = params[0];\n    this.loginfo(\"Got recipient: \" + rcpt);\n\n    // Check user matches regex 'user-YYYYMMDD':\n    var match = /^(.*)-(\\d{4})(\\d{2})(\\d{2})$/.exec(rcpt.user);\n    if (!match) {\n        return next();\n    }\n\n    // get date - note Date constructor takes month-1 (i.e. Dec == 11).\n    var expiry_date = new Date(match[2], match[3]-1, match[4]);\n\n    this.loginfo(\"Email expires on: \" + expiry_date);\n    \n    var today = new Date();\n    \n    if (expiry_date < today) {\n        // If we get here, the email address has expired\n        return next(DENY, \"Expired email address\");\n    }\n    \n    next();\n}\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"exports"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-d7d70c"},"children":[{"type":"text","value":"hook_rcpt"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-2a5a40"},"children":[{"type":"text","value":"next"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-2a5a40"},"children":[{"type":"text","value":"connection"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-2a5a40"},"children":[{"type":"text","value":"params"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":") {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" rcpt "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" params["}]},{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"];"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"this"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-d7d70c"},"children":[{"type":"text","value":"loginfo"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-13c1f3"},"children":[{"type":"text","value":"\"Got recipient: \""}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" rcpt);"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-78da41"},"children":[{"type":"text","value":"// Check user matches regex 'user-YYYYMMDD':"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" match "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-13c1f3"},"children":[{"type":"text","value":" /"}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"^"}]},{"type":"element","tag":"span","props":{"class":"ct-13c1f3"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-13c1f3"},"children":[{"type":"text","value":")-("}]},{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"\\d"}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"{4}"}]},{"type":"element","tag":"span","props":{"class":"ct-13c1f3"},"children":[{"type":"text","value":")("}]},{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"\\d"}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"{2}"}]},{"type":"element","tag":"span","props":{"class":"ct-13c1f3"},"children":[{"type":"text","value":")("}]},{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"\\d"}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"{2}"}]},{"type":"element","tag":"span","props":{"class":"ct-13c1f3"},"children":[{"type":"text","value":")"}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"$"}]},{"type":"element","tag":"span","props":{"class":"ct-13c1f3"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-d7d70c"},"children":[{"type":"text","value":"exec"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"(rcpt.user);"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"!"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"match) {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-d7d70c"},"children":[{"type":"text","value":"next"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"();"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-78da41"},"children":[{"type":"text","value":"// get date - note Date constructor takes month-1 (i.e. Dec == 11)."}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" expiry_date "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"new"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"Date"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"(match["}]},{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"], match["}]},{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"3"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"]"}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":", match["}]},{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"4"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"]);"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"this"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-d7d70c"},"children":[{"type":"text","value":"loginfo"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-13c1f3"},"children":[{"type":"text","value":"\"Email expires on: \""}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" expiry_date);"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    "}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" today "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"new"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"Date"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"();"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    "}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" (expiry_date "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" today) {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-78da41"},"children":[{"type":"text","value":"// If we get here, the email address has expired"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-d7d70c"},"children":[{"type":"text","value":"next"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"DENY"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-13c1f3"},"children":[{"type":"text","value":"\"Expired email address\""}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":");"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    "}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-d7d70c"},"children":[{"type":"text","value":"next"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"();"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"And we can easily check that with swaks (remember to restart Haraka):"}]},{"type":"element","tag":"code","props":{"code":"swaks -h foo.com -t booya-20110101@haraka.local -f somewhere@example.com \\\n  -s localhost -p 25\n=== Trying localhost:25...\n=== Connected to localhost.\n<-  220 sergeant.org ESMTP Haraka 0.3 ready\n -> EHLO foo.com\n<-  250-Haraka says hi Unknown [127.0.0.1]\n<-  250-PIPELINING\n<-  250-8BITMIME\n<-  250 SIZE 500000\n -> MAIL FROM:<somewhere@example.com>\n<-  250 From address is OK\n -> RCPT TO:<booya-20110101@haraka.local>\n<** 550 Expired email address\n -> QUIT\n<-  221 closing connection. Have a jolly good day.\n=== Connection closed with remote host.\n","language":"sh"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"swaks -h foo.com -t booya-20110101@haraka.local -f somewhere@example.com \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"  -s localhost -p 25"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"=== Trying localhost:25..."}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"=== Connected to localhost."}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"-  220 sergeant.org ESMTP Haraka 0.3 ready"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" -"}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":">"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" EHLO foo.com"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"-  250-Haraka says hi Unknown [127.0.0.1]"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"-  250-PIPELINING"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"-  250-8BITMIME"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"-  250 SIZE 500000"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" -"}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":">"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" MAIL FROM:"}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"somewhere@example.com"}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":">"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"-  250 From address is OK"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" -"}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":">"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" RCPT TO:"}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"booya-20110101@haraka.local"}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":">"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"<**"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" 550 Expired email address"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" -"}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":">"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" QUIT"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"-  221 closing connection. Have a jolly good day."}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"=== Connection closed with remote host."}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now we need to do one more thing..."}]},{"type":"element","tag":"h2","props":{"id":"fixing-up-unexpired-emails"},"children":[{"type":"text","value":"Fixing Up Unexpired Emails"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The last thing we need to do, is if we have an email that isn't expired, we\nneed to normalise it back to the real email address, because wherever we\ndeliver this to is unlikely to recognise these new email addresses."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Here's how our final plugin will look:"}]},{"type":"element","tag":"code","props":{"code":"exports.hook_rcpt = function (next, connection, params) {\n    var rcpt = params[0];\n    this.loginfo(\"Got recipient: \" + rcpt);\n\n    // Check user matches regex 'user-YYYYMMDD':\n    var match = /^(.*)-(\\d{4})(\\d{2})(\\d{2})$/.exec(rcpt.user);\n    if (!match) {\n        return next();\n    }\n\n    // get date - note Date constructor takes month-1 (i.e. Dec == 11).\n    var expiry_date = new Date(match[2], match[3]-1, match[4]);\n\n    this.loginfo(\"Email expires on: \" + expiry_date);\n\n    var today = new Date();\n\n    if (expiry_date < today) {\n        // If we get here, the email address has expired\n        return next(DENY, \"Expired email address\");\n    }\n    \n    // now get rid of the extension:\n    rcpt.user = match[1];\n    this.loginfo(\"Email address now: \" + rcpt);\n    \n    next();\n}\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"exports"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-d7d70c"},"children":[{"type":"text","value":"hook_rcpt"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-2a5a40"},"children":[{"type":"text","value":"next"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-2a5a40"},"children":[{"type":"text","value":"connection"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-2a5a40"},"children":[{"type":"text","value":"params"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":") {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" rcpt "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" params["}]},{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"];"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"this"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-d7d70c"},"children":[{"type":"text","value":"loginfo"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-13c1f3"},"children":[{"type":"text","value":"\"Got recipient: \""}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" rcpt);"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-78da41"},"children":[{"type":"text","value":"// Check user matches regex 'user-YYYYMMDD':"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" match "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-13c1f3"},"children":[{"type":"text","value":" /"}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"^"}]},{"type":"element","tag":"span","props":{"class":"ct-13c1f3"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-13c1f3"},"children":[{"type":"text","value":")-("}]},{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"\\d"}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"{4}"}]},{"type":"element","tag":"span","props":{"class":"ct-13c1f3"},"children":[{"type":"text","value":")("}]},{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"\\d"}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"{2}"}]},{"type":"element","tag":"span","props":{"class":"ct-13c1f3"},"children":[{"type":"text","value":")("}]},{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"\\d"}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"{2}"}]},{"type":"element","tag":"span","props":{"class":"ct-13c1f3"},"children":[{"type":"text","value":")"}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"$"}]},{"type":"element","tag":"span","props":{"class":"ct-13c1f3"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-d7d70c"},"children":[{"type":"text","value":"exec"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"(rcpt.user);"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"!"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"match) {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-d7d70c"},"children":[{"type":"text","value":"next"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"();"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-78da41"},"children":[{"type":"text","value":"// get date - note Date constructor takes month-1 (i.e. Dec == 11)."}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" expiry_date "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"new"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"Date"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"(match["}]},{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"], match["}]},{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"3"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"]"}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":", match["}]},{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"4"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"]);"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"this"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-d7d70c"},"children":[{"type":"text","value":"loginfo"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-13c1f3"},"children":[{"type":"text","value":"\"Email expires on: \""}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" expiry_date);"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" today "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"new"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"Date"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"();"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" (expiry_date "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" today) {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-78da41"},"children":[{"type":"text","value":"// If we get here, the email address has expired"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-d7d70c"},"children":[{"type":"text","value":"next"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"DENY"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-13c1f3"},"children":[{"type":"text","value":"\"Expired email address\""}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":");"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    "}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-78da41"},"children":[{"type":"text","value":"// now get rid of the extension:"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    rcpt.user "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" match["}]},{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"];"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-9e667f"},"children":[{"type":"text","value":"this"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-d7d70c"},"children":[{"type":"text","value":"loginfo"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-13c1f3"},"children":[{"type":"text","value":"\"Email address now: \""}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-8aa359"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":" rcpt);"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    "}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-d7d70c"},"children":[{"type":"text","value":"next"}]},{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"();"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"And when we test this with an unexpired address via swaks:"}]},{"type":"element","tag":"code","props":{"code":"swaks -h foo.com -t booya-20120101@haraka.local \\\n      -f somewhere@example.com -s localhost -p 25\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"swaks -h foo.com -t booya-20120101@haraka.local \\"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-50c17c"},"children":[{"type":"text","value":"      -f somewhere@example.com -s localhost -p 25"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We get in the logs:"}]},{"type":"element","tag":"code","props":{"code":"[INFO] [rcpt_to.disposable] Got recipient: <booya-20120101@haraka.local>\n[INFO] [rcpt_to.disposable] Email expires on: Sun Jan 01 2012 00:00:00 GMT-0500 (EST)\n[INFO] [rcpt_to.disposable] Email address now: <booya@haraka.local>\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"[INFO] [rcpt_to.disposable] Got recipient: <booya-20120101@haraka.local>\n[INFO] [rcpt_to.disposable] Email expires on: Sun Jan 01 2012 00:00:00 GMT-0500 (EST)\n[INFO] [rcpt_to.disposable] Email address now: <booya@haraka.local>"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Which indicates that we have successfully modified the email address."}]},{"type":"element","tag":"h1","props":{"id":"further-reading"},"children":[{"type":"text","value":"Further Reading"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"There are many more features of the Haraka API to explore, including access\nto the body of the email and the headers, access to the HELO string, and\nimplementing ESMTP extensions, among many others."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"There are two good places to read up on these. Firstly is the documentation\nin the Haraka \"docs\" directory. Start with the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Plugins.md"}]},{"type":"text","value":" file, and work\nyour way through the API from there."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The second place is simply reading the source code for the plugins themselves.\nThe plugins that Haraka ships with use almost all parts of the API and so\nshould give you a good starting point if you want to implement a particular\npiece of functionality. Even the most complicated plugins are under 200 lines\nof code, so don't be intimidated by them! The simplest one is a mere 5 lines\nof code."}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-13c1f3{color:#0A3069}\n.ct-2a5a40{color:#953800}\n.ct-8aa359{color:#CF222E}\n.ct-d7d70c{color:#8250DF}\n.ct-9e667f{color:#0550AE}\n.ct-78da41{color:#6E7781}\n.ct-50c17c{color:#24292F}\n.dark .ct-50c17c{color:#C9D1D9}\n.dark .ct-78da41{color:#8B949E}\n.dark .ct-9e667f{color:#79C0FF}\n.dark .ct-d7d70c{color:#D2A8FF}\n.dark .ct-8aa359{color:#FF7B72}\n.dark .ct-2a5a40{color:#FFA657}\n.dark .ct-13c1f3{color:#A5D6FF}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"the-design","depth":2,"text":"The Design"},{"id":"what-you-will-need","depth":2,"text":"What You Will Need"},{"id":"getting-started","depth":2,"text":"Getting Started"},{"id":"parsing-out-the-date","depth":2,"text":"Parsing Out The Date"},{"id":"rejecting-expired-emails","depth":2,"text":"Rejecting Expired Emails"},{"id":"fixing-up-unexpired-emails","depth":2,"text":"Fixing Up Unexpired Emails"}]}},"_type":"markdown","_id":"content:7.tutorials:Tutorial.md","_source":"content","_file":"7.tutorials/Tutorial.md","_extension":"md"},{"_path":"/plugins","_dir":"","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"Plugins","description":"Plugins is a collection of plugins for Haraka that extend its functionality.","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"plugins"},"children":[{"type":"text","value":"Plugins"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To create your own plugin, see:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"the "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-template","rel":["nofollow"]},"children":[{"type":"text","value":"plugin template"}]},{"type":"text","value":" that includes all the boilerplate"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"the "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/wiki/Write-a-Plugin","rel":["nofollow"]},"children":[{"type":"text","value":"Write a Plugin"}]},{"type":"text","value":" tutorial"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"the "},{"type":"element","tag":"a","props":{"href":"/core/Plugins"},"children":[{"type":"text","value":"Plugins"}]},{"type":"text","value":" section of the manual"}]}]},{"type":"element","tag":"h2","props":{"id":"installing-npm-packaged-plugins"},"children":[{"type":"text","value":"Installing NPM packaged plugins"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"NPM packaged plugins can be installed in the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"npm"}]},{"type":"text","value":" directory where Haraka was installed (where depends on your OS platform and whether you specified "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"-g"}]},{"type":"text","value":") or the Haraka install directory (haraka -i this_path). This example installs "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"my-great-plugin"}]},{"type":"text","value":" in the Haraka install directory:"}]},{"type":"element","tag":"code","props":{"code":"cd /etc/haraka\nnpm install haraka-plugin-my-great-plugin\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"cd /etc/haraka\nnpm install haraka-plugin-my-great-plugin\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"NPM then installs the plugin and its dependencies in a "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"node_modules"}]},{"type":"text","value":" directory within the Haraka install directory."}]},{"type":"element","tag":"h2","props":{"id":"plugin-registry"},"children":[{"type":"text","value":"Plugin Registry"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A mostly comprehensive list of plugins known to be working and maintained.\nCreate a PR adding yours to this list."}]},{"type":"element","tag":"table","props":{},"children":[{"type":"element","tag":"thead","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"th","props":{"align":null},"children":[{"type":"text","value":"Plugin"}]},{"type":"element","tag":"th","props":{"align":null},"children":[{"type":"text","value":"Description"}]}]}]},{"type":"element","tag":"tbody","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-access","rel":["nofollow"]},"children":[{"type":"text","value":"access"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"ACLs based on IPs, domains, email addrs, etc."}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/acharkizakaria/haraka-plugin-accounting-files/blob/master/README.md","rel":["nofollow"]},"children":[{"type":"text","value":"accounting_files"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Retrieve, Store and Archive custom information of outbound traffic"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/aliases.md","rel":["nofollow"]},"children":[{"type":"text","value":"aliases"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Email aliases"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-asn","rel":["nofollow"]},"children":[{"type":"text","value":"ASN"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Get ASN info for remote senders"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/attachment.md","rel":["nofollow"]},"children":[{"type":"text","value":"attachment"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Restrict attachment types"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/AuspeXeu/haraka-plugin-auth-enc-file","rel":["nofollow"]},"children":[{"type":"text","value":"auth-enc-file"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Auth against user/pass in an encrypted file"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"auth/"},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/auth/flat_file.md","rel":["nofollow"]},"children":[{"type":"text","value":"flat_file"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Auth against user/pass in a file"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"auth/"},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/auth/auth_bridge.md","rel":["nofollow"]},"children":[{"type":"text","value":"auth_bridge"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Auth against remote MTA"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-auth-imap","rel":["nofollow"]},"children":[{"type":"text","value":"auth-imap"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Auth against IMAP server"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"auth/"},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-auth-ldap","rel":["nofollow"]},"children":[{"type":"text","value":"auth_ldap"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Auth against LDAP"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"auth/"},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/auth/auth_proxy.md","rel":["nofollow"]},"children":[{"type":"text","value":"auth_proxy"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Auth against remote MTA"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"auth/"},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/auth/auth_vpopmaild.md","rel":["nofollow"]},"children":[{"type":"text","value":"auth_vpopmaild"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Auth against vpopmaild"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/avg.md","rel":["nofollow"]},"children":[{"type":"text","value":"avg"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"AVG antivirus scanner"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/backscatterer.md","rel":["nofollow"]},"children":[{"type":"text","value":"backscatterer"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Check remote IP against ips.backscatterer.org"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/block_me.md","rel":["nofollow"]},"children":[{"type":"text","value":"block_me"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Populate block list via forwarded emails"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/bounce.md","rel":["nofollow"]},"children":[{"type":"text","value":"bounce"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Many options for bounce processing"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/clamd.md","rel":["nofollow"]},"children":[{"type":"text","value":"clamd"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Anti-Virus scanning with ClamAV"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-p0f","rel":["nofollow"]},"children":[{"type":"text","value":"connect.p0f"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"TCP Fingerprinting"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/data.signatures.md","rel":["nofollow"]},"children":[{"type":"text","value":"data.signatures"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Block emails whose bodies match signatures"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/data.uribl.md","rel":["nofollow"]},"children":[{"type":"text","value":"data.uribl"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Block based on URI blacklists"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-dcc","rel":["nofollow"]},"children":[{"type":"text","value":"dcc"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Distributed Checksum Clearinghouse"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/delay_deny.md","rel":["nofollow"]},"children":[{"type":"text","value":"delay_deny"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Delays all pre-DATA 'deny' results"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/dkim_sign.md","rel":["nofollow"]},"children":[{"type":"text","value":"dkim_sign"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"DKIM sign outbound messages"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/dkim_verify.md","rel":["nofollow"]},"children":[{"type":"text","value":"dkim_verify"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Verify DKIM signatures on incoming messages"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://www.npmjs.com/package/haraka-plugin-opendkim","rel":["nofollow"]},"children":[{"type":"text","value":"opendkim"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"DKIM sign and verify email messages"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/dnsbl.md","rel":["nofollow"]},"children":[{"type":"text","value":"dnsbl"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Check remote MTAs against DNS blacklists"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/dnswl.md","rel":["nofollow"]},"children":[{"type":"text","value":"dnswl"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Check remote MTAs against DNS whitelists"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-dovecot","rel":["nofollow"]},"children":[{"type":"text","value":"dovecot"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Recipient validation & SMTP AUTH against dovecot"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/early_talker.md","rel":["nofollow"]},"children":[{"type":"text","value":"early_talker"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Reject remotes that talk early"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/esets.md","rel":["nofollow"]},"children":[{"type":"text","value":"esets"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Virus scanning with ESET Mail Security"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-fcrdns","rel":["nofollow"]},"children":[{"type":"text","value":"fcrdns"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Forward Confirmed reverse DNS"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-geoip","rel":["nofollow"]},"children":[{"type":"text","value":"geoip"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"get geographic information about mail senders"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/greylist.md","rel":["nofollow"]},"children":[{"type":"text","value":"greylist"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Greylisting"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-headers","rel":["nofollow"]},"children":[{"type":"text","value":"headers"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Inspect and verify various email headers"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/helo.checks.md","rel":["nofollow"]},"children":[{"type":"text","value":"helo.checks"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Validaty checks of the HELO string"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-karma","rel":["nofollow"]},"children":[{"type":"text","value":"karma"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Dynamic scoring of incoming connections"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-known-senders","rel":["nofollow"]},"children":[{"type":"text","value":"known-senders"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Reward emails from those you send mail to"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-ldap","rel":["nofollow"]},"children":[{"type":"text","value":"LDAP"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Aliases, Auth, and Recipient validation from LDAP"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-limit","rel":["nofollow"]},"children":[{"type":"text","value":"Limit"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Apply many types of limits to SMTP connections"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-elasticsearch/","rel":["nofollow"]},"children":[{"type":"text","value":"log.elasticsearch"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Store message metadata in Elasticsearch"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-log-reader","rel":["nofollow"]},"children":[{"type":"text","value":"log reader"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"extract log entries from the haraka log file"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-syslog","rel":["nofollow"]},"children":[{"type":"text","value":"syslog"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Log to syslog"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/mail_from.is_resolvable.md","rel":["nofollow"]},"children":[{"type":"text","value":"mail_from.is_resolvable"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Verifies the MAIL FROM domain resolves to a MX"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/messagesniffer.md","rel":["nofollow"]},"children":[{"type":"text","value":"messagesniffer"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Anti-spam via "},{"type":"element","tag":"a","props":{"href":"http://www.armresearch.com/Products/","rel":["nofollow"]},"children":[{"type":"text","value":"MessageSniffer"}]}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-milter","rel":["nofollow"]},"children":[{"type":"text","value":"milter"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"milter support"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/Helpmonks/haraka-plugin-mongodb","rel":["nofollow"]},"children":[{"type":"text","value":"mongodb"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Queue emails to MongoDB"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/prevent_credential_leaks.md","rel":["nofollow"]},"children":[{"type":"text","value":"prevent_credential_leaks"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Prevent users from emailing their credentials"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/process_title.md","rel":["nofollow"]},"children":[{"type":"text","value":"process_title"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Populate "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"ps"}]},{"type":"text","value":" output with activity counters"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"queue/"},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/queue/discard.md","rel":["nofollow"]},"children":[{"type":"text","value":"discard"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"queues messages to /dev/null"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"queue/"},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/queue/lmtp.md","rel":["nofollow"]},"children":[{"type":"text","value":"lmtp"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"deliver queued messages via LMTP"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"queue/"},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/queue/qmail-queue.md","rel":["nofollow"]},"children":[{"type":"text","value":"qmail-queue"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"queue to qmail"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"queue/"},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/queue/quarantine.md","rel":["nofollow"]},"children":[{"type":"text","value":"quarantine"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"queue to a quarantine directory"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"queue/"},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/queue/rabbitmq.md","rel":["nofollow"]},"children":[{"type":"text","value":"rabbitmq"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"queue to RabbitMQ"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"queue/"},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/queue/rabbitmq_amqplib.md","rel":["nofollow"]},"children":[{"type":"text","value":"rabbitmq_amqplib"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"queue to RabbitMQ using amqplib"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"queue/"},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/queue/smtp_bridge.md","rel":["nofollow"]},"children":[{"type":"text","value":"smtp_bridge"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Bridge SMTP sessions to another MTA"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"queue/"},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/queue/smtp_forward.md","rel":["nofollow"]},"children":[{"type":"text","value":"smtp_forward"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Forward emails to another MTA"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"queue/"},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/queue/smtp_proxy.md","rel":["nofollow"]},"children":[{"type":"text","value":"smtp_proxy"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Proxy SMTP connections to another MTA"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-recipient-routes","rel":["nofollow"]},"children":[{"type":"text","value":"recipient-routes"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Route emails based on their recipient(s)"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-redis","rel":["nofollow"]},"children":[{"type":"text","value":"redis"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"multi-purpose Redis db connection(s)"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/rcpt_to.in_host_list.md","rel":["nofollow"]},"children":[{"type":"text","value":"rcpt_to.in_host_list"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Define local email domains in a file"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-rcpt-ldap","rel":["nofollow"]},"children":[{"type":"text","value":"rcpt_to.ldap"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Validate recipients against LDAP"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-rcpt-postgresql","rel":["nofollow"]},"children":[{"type":"text","value":"rcpt-postgresql"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"validate recipients against PostgreSQL"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-qmail-deliverable","rel":["nofollow"]},"children":[{"type":"text","value":"rcpt_to.qmail_deliverable"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Validate recipients against Qmail-Deliverable"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/record_envelope_addresses.md","rel":["nofollow"]},"children":[{"type":"text","value":"record_envelope_addresses"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Adds message headers with ENV recips"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/relay.md","rel":["nofollow"]},"children":[{"type":"text","value":"relay"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Manage relay permissions"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/reseed_rng.md","rel":["nofollow"]},"children":[{"type":"text","value":"reseed_rng"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Reseed the RNG"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-rspamd","rel":["nofollow"]},"children":[{"type":"text","value":"rspamd"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Scan emails with rspamd"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/spamassassin.md","rel":["nofollow"]},"children":[{"type":"text","value":"spamassassin"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Scan emails with SpamAssassin"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/spf.md","rel":["nofollow"]},"children":[{"type":"text","value":"spf"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Perform SPF checks"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/swerter/haraka-plugins/blob/master/plugins/srs.js","rel":["nofollow"]},"children":[{"type":"text","value":"srs"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Sender Rewriting Scheme"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/tarpit.md","rel":["nofollow"]},"children":[{"type":"text","value":"tarpit"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Slow down connections"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/tls.md","rel":["nofollow"]},"children":[{"type":"text","value":"tls"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Implements TLS"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/toobusy.md","rel":["nofollow"]},"children":[{"type":"text","value":"toobusy"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Defers connections when too busy"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-vmta/blob/master/README.md","rel":["nofollow"]},"children":[{"type":"text","value":"vmta"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Virtual MTA management"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-watch","rel":["nofollow"]},"children":[{"type":"text","value":"watch"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Watch live SMTP traffic in a web interface"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/nodemailer/haraka-plugin-wildduck","rel":["nofollow"]},"children":[{"type":"text","value":"wildduck"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"provides recipient checks against Wild Duck"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/xclient.md","rel":["nofollow"]},"children":[{"type":"text","value":"xclient"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Implements XCLIENT"}]}]}]}]}]},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"plugins"},"children":[{"type":"text","value":"Plugins"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To create your own plugin, see:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"the "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-template","rel":["nofollow"]},"children":[{"type":"text","value":"plugin template"}]},{"type":"text","value":" that includes all the boilerplate"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"the "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/wiki/Write-a-Plugin","rel":["nofollow"]},"children":[{"type":"text","value":"Write a Plugin"}]},{"type":"text","value":" tutorial"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"the "},{"type":"element","tag":"a","props":{"href":"/core/Plugins"},"children":[{"type":"text","value":"Plugins"}]},{"type":"text","value":" section of the manual"}]}]},{"type":"element","tag":"h2","props":{"id":"installing-npm-packaged-plugins"},"children":[{"type":"text","value":"Installing NPM packaged plugins"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"NPM packaged plugins can be installed in the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"npm"}]},{"type":"text","value":" directory where Haraka was installed (where depends on your OS platform and whether you specified "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"-g"}]},{"type":"text","value":") or the Haraka install directory (haraka -i this_path). This example installs "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"my-great-plugin"}]},{"type":"text","value":" in the Haraka install directory:"}]},{"type":"element","tag":"code","props":{"code":"cd /etc/haraka\nnpm install haraka-plugin-my-great-plugin\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"cd /etc/haraka\nnpm install haraka-plugin-my-great-plugin"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"NPM then installs the plugin and its dependencies in a "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"node_modules"}]},{"type":"text","value":" directory within the Haraka install directory."}]},{"type":"element","tag":"h2","props":{"id":"plugin-registry"},"children":[{"type":"text","value":"Plugin Registry"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A mostly comprehensive list of plugins known to be working and maintained.\nCreate a PR adding yours to this list."}]},{"type":"element","tag":"table","props":{},"children":[{"type":"element","tag":"thead","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"th","props":{"align":null},"children":[{"type":"text","value":"Plugin"}]},{"type":"element","tag":"th","props":{"align":null},"children":[{"type":"text","value":"Description"}]}]}]},{"type":"element","tag":"tbody","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-access","rel":["nofollow"]},"children":[{"type":"text","value":"access"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"ACLs based on IPs, domains, email addrs, etc."}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/acharkizakaria/haraka-plugin-accounting-files/blob/master/README.md","rel":["nofollow"]},"children":[{"type":"text","value":"accounting_files"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Retrieve, Store and Archive custom information of outbound traffic"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/aliases.md","rel":["nofollow"]},"children":[{"type":"text","value":"aliases"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Email aliases"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-asn","rel":["nofollow"]},"children":[{"type":"text","value":"ASN"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Get ASN info for remote senders"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/attachment.md","rel":["nofollow"]},"children":[{"type":"text","value":"attachment"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Restrict attachment types"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/AuspeXeu/haraka-plugin-auth-enc-file","rel":["nofollow"]},"children":[{"type":"text","value":"auth-enc-file"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Auth against user/pass in an encrypted file"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"auth/"},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/auth/flat_file.md","rel":["nofollow"]},"children":[{"type":"text","value":"flat_file"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Auth against user/pass in a file"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"auth/"},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/auth/auth_bridge.md","rel":["nofollow"]},"children":[{"type":"text","value":"auth_bridge"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Auth against remote MTA"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-auth-imap","rel":["nofollow"]},"children":[{"type":"text","value":"auth-imap"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Auth against IMAP server"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"auth/"},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-auth-ldap","rel":["nofollow"]},"children":[{"type":"text","value":"auth_ldap"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Auth against LDAP"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"auth/"},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/auth/auth_proxy.md","rel":["nofollow"]},"children":[{"type":"text","value":"auth_proxy"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Auth against remote MTA"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"auth/"},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/auth/auth_vpopmaild.md","rel":["nofollow"]},"children":[{"type":"text","value":"auth_vpopmaild"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Auth against vpopmaild"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/avg.md","rel":["nofollow"]},"children":[{"type":"text","value":"avg"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"AVG antivirus scanner"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/backscatterer.md","rel":["nofollow"]},"children":[{"type":"text","value":"backscatterer"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Check remote IP against ips.backscatterer.org"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/block_me.md","rel":["nofollow"]},"children":[{"type":"text","value":"block_me"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Populate block list via forwarded emails"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/bounce.md","rel":["nofollow"]},"children":[{"type":"text","value":"bounce"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Many options for bounce processing"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/clamd.md","rel":["nofollow"]},"children":[{"type":"text","value":"clamd"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Anti-Virus scanning with ClamAV"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-p0f","rel":["nofollow"]},"children":[{"type":"text","value":"connect.p0f"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"TCP Fingerprinting"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/data.signatures.md","rel":["nofollow"]},"children":[{"type":"text","value":"data.signatures"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Block emails whose bodies match signatures"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/data.uribl.md","rel":["nofollow"]},"children":[{"type":"text","value":"data.uribl"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Block based on URI blacklists"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-dcc","rel":["nofollow"]},"children":[{"type":"text","value":"dcc"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Distributed Checksum Clearinghouse"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/delay_deny.md","rel":["nofollow"]},"children":[{"type":"text","value":"delay_deny"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Delays all pre-DATA 'deny' results"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/dkim_sign.md","rel":["nofollow"]},"children":[{"type":"text","value":"dkim_sign"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"DKIM sign outbound messages"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/dkim_verify.md","rel":["nofollow"]},"children":[{"type":"text","value":"dkim_verify"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Verify DKIM signatures on incoming messages"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://www.npmjs.com/package/haraka-plugin-opendkim","rel":["nofollow"]},"children":[{"type":"text","value":"opendkim"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"DKIM sign and verify email messages"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/dnsbl.md","rel":["nofollow"]},"children":[{"type":"text","value":"dnsbl"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Check remote MTAs against DNS blacklists"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/dnswl.md","rel":["nofollow"]},"children":[{"type":"text","value":"dnswl"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Check remote MTAs against DNS whitelists"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-dovecot","rel":["nofollow"]},"children":[{"type":"text","value":"dovecot"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Recipient validation & SMTP AUTH against dovecot"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/early_talker.md","rel":["nofollow"]},"children":[{"type":"text","value":"early_talker"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Reject remotes that talk early"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/esets.md","rel":["nofollow"]},"children":[{"type":"text","value":"esets"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Virus scanning with ESET Mail Security"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-fcrdns","rel":["nofollow"]},"children":[{"type":"text","value":"fcrdns"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Forward Confirmed reverse DNS"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-geoip","rel":["nofollow"]},"children":[{"type":"text","value":"geoip"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"get geographic information about mail senders"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/greylist.md","rel":["nofollow"]},"children":[{"type":"text","value":"greylist"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Greylisting"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-headers","rel":["nofollow"]},"children":[{"type":"text","value":"headers"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Inspect and verify various email headers"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/helo.checks.md","rel":["nofollow"]},"children":[{"type":"text","value":"helo.checks"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Validaty checks of the HELO string"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-karma","rel":["nofollow"]},"children":[{"type":"text","value":"karma"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Dynamic scoring of incoming connections"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-known-senders","rel":["nofollow"]},"children":[{"type":"text","value":"known-senders"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Reward emails from those you send mail to"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-ldap","rel":["nofollow"]},"children":[{"type":"text","value":"LDAP"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Aliases, Auth, and Recipient validation from LDAP"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-limit","rel":["nofollow"]},"children":[{"type":"text","value":"Limit"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Apply many types of limits to SMTP connections"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-elasticsearch/","rel":["nofollow"]},"children":[{"type":"text","value":"log.elasticsearch"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Store message metadata in Elasticsearch"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-log-reader","rel":["nofollow"]},"children":[{"type":"text","value":"log reader"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"extract log entries from the haraka log file"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-syslog","rel":["nofollow"]},"children":[{"type":"text","value":"syslog"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Log to syslog"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/mail_from.is_resolvable.md","rel":["nofollow"]},"children":[{"type":"text","value":"mail_from.is_resolvable"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Verifies the MAIL FROM domain resolves to a MX"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/messagesniffer.md","rel":["nofollow"]},"children":[{"type":"text","value":"messagesniffer"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Anti-spam via "},{"type":"element","tag":"a","props":{"href":"http://www.armresearch.com/Products/","rel":["nofollow"]},"children":[{"type":"text","value":"MessageSniffer"}]}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-milter","rel":["nofollow"]},"children":[{"type":"text","value":"milter"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"milter support"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/Helpmonks/haraka-plugin-mongodb","rel":["nofollow"]},"children":[{"type":"text","value":"mongodb"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Queue emails to MongoDB"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/prevent_credential_leaks.md","rel":["nofollow"]},"children":[{"type":"text","value":"prevent_credential_leaks"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Prevent users from emailing their credentials"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/process_title.md","rel":["nofollow"]},"children":[{"type":"text","value":"process_title"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Populate "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"ps"}]},{"type":"text","value":" output with activity counters"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"queue/"},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/queue/discard.md","rel":["nofollow"]},"children":[{"type":"text","value":"discard"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"queues messages to /dev/null"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"queue/"},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/queue/lmtp.md","rel":["nofollow"]},"children":[{"type":"text","value":"lmtp"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"deliver queued messages via LMTP"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"queue/"},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/queue/qmail-queue.md","rel":["nofollow"]},"children":[{"type":"text","value":"qmail-queue"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"queue to qmail"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"queue/"},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/queue/quarantine.md","rel":["nofollow"]},"children":[{"type":"text","value":"quarantine"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"queue to a quarantine directory"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"queue/"},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/queue/rabbitmq.md","rel":["nofollow"]},"children":[{"type":"text","value":"rabbitmq"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"queue to RabbitMQ"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"queue/"},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/queue/rabbitmq_amqplib.md","rel":["nofollow"]},"children":[{"type":"text","value":"rabbitmq_amqplib"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"queue to RabbitMQ using amqplib"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"queue/"},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/queue/smtp_bridge.md","rel":["nofollow"]},"children":[{"type":"text","value":"smtp_bridge"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Bridge SMTP sessions to another MTA"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"queue/"},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/queue/smtp_forward.md","rel":["nofollow"]},"children":[{"type":"text","value":"smtp_forward"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Forward emails to another MTA"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"queue/"},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/queue/smtp_proxy.md","rel":["nofollow"]},"children":[{"type":"text","value":"smtp_proxy"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Proxy SMTP connections to another MTA"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-recipient-routes","rel":["nofollow"]},"children":[{"type":"text","value":"recipient-routes"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Route emails based on their recipient(s)"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-redis","rel":["nofollow"]},"children":[{"type":"text","value":"redis"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"multi-purpose Redis db connection(s)"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/rcpt_to.in_host_list.md","rel":["nofollow"]},"children":[{"type":"text","value":"rcpt_to.in_host_list"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Define local email domains in a file"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-rcpt-ldap","rel":["nofollow"]},"children":[{"type":"text","value":"rcpt_to.ldap"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Validate recipients against LDAP"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-rcpt-postgresql","rel":["nofollow"]},"children":[{"type":"text","value":"rcpt-postgresql"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"validate recipients against PostgreSQL"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-qmail-deliverable","rel":["nofollow"]},"children":[{"type":"text","value":"rcpt_to.qmail_deliverable"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Validate recipients against Qmail-Deliverable"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/record_envelope_addresses.md","rel":["nofollow"]},"children":[{"type":"text","value":"record_envelope_addresses"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Adds message headers with ENV recips"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/relay.md","rel":["nofollow"]},"children":[{"type":"text","value":"relay"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Manage relay permissions"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/reseed_rng.md","rel":["nofollow"]},"children":[{"type":"text","value":"reseed_rng"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Reseed the RNG"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-rspamd","rel":["nofollow"]},"children":[{"type":"text","value":"rspamd"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Scan emails with rspamd"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/spamassassin.md","rel":["nofollow"]},"children":[{"type":"text","value":"spamassassin"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Scan emails with SpamAssassin"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/spf.md","rel":["nofollow"]},"children":[{"type":"text","value":"spf"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Perform SPF checks"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/swerter/haraka-plugins/blob/master/plugins/srs.js","rel":["nofollow"]},"children":[{"type":"text","value":"srs"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Sender Rewriting Scheme"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/tarpit.md","rel":["nofollow"]},"children":[{"type":"text","value":"tarpit"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Slow down connections"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/tls.md","rel":["nofollow"]},"children":[{"type":"text","value":"tls"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Implements TLS"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/toobusy.md","rel":["nofollow"]},"children":[{"type":"text","value":"toobusy"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Defers connections when too busy"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-vmta/blob/master/README.md","rel":["nofollow"]},"children":[{"type":"text","value":"vmta"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Virtual MTA management"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-watch","rel":["nofollow"]},"children":[{"type":"text","value":"watch"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Watch live SMTP traffic in a web interface"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/nodemailer/haraka-plugin-wildduck","rel":["nofollow"]},"children":[{"type":"text","value":"wildduck"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"provides recipient checks against Wild Duck"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/plugins/xclient.md","rel":["nofollow"]},"children":[{"type":"text","value":"xclient"}]}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Implements XCLIENT"}]}]}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"installing-npm-packaged-plugins","depth":2,"text":"Installing NPM packaged plugins"},{"id":"plugin-registry","depth":2,"text":"Plugin Registry"}]}},"_type":"markdown","_id":"content:8.plugins.md","_source":"content","_file":"8.plugins.md","_extension":"md"},{"_path":"/plugins/_dir","_dir":"plugins","_draft":false,"_partial":true,"_locale":"en","title":"Plugins","_id":"content:8.plugins:_dir.yml","_type":"yaml","_source":"content","_file":"8.plugins/_dir.yml","_extension":"yml"},{"_path":"/plugins/access","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"access - ACLs for Haraka plugin for Haraka","description":"Haraka access plugin - ACLs for Haraka","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"access-plugin"},"children":[{"type":"text","value":"Access plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Repackaged as "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-access","rel":["nofollow"]},"children":[{"type":"text","value":"haraka-plugin-access"}]},{"type":"text","value":"."}]}]},"navigation":{"title":"access"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"access-plugin"},"children":[{"type":"text","value":"Access plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Repackaged as "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-access","rel":["nofollow"]},"children":[{"type":"text","value":"haraka-plugin-access"}]},{"type":"text","value":"."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:8.plugins:access.md","_source":"content","_file":"8.plugins/access.md","_extension":"md"},{"_path":"/plugins/aliases","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"aliases - Alias plugin for Haraka","description":"Haraka aliases plugin - Alias plugin for Haraka","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"aliases-plugin"},"children":[{"type":"text","value":"Aliases plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin allows one to configure aliases that may perform an action or\nchange the RCPT address in a number of ways.  All aliases are specified in\na JSON formatted configuration file, and must have at very least an action.\nAny syntax error found in the JSON format config file will stop the server\nfrom running."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"IMPORTANT: this plugin must appear in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/plugins"}]},{"type":"text","value":" before other plugins\nthat run on hook_rcpt"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"WARNING: DO NOT USE THIS PLUGIN WITH queue/smtp_proxy."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"aliases"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"JSON formatted configuration file that must contain, at very least, a key\nto match against RCPT address, and a value that is an associative array\nwith an \"action\" : \""},{"type":"element","tag":"action","props":{},"children":[{"type":"text","value":"\" key, value pair.  An example:"}]},{"type":"element","tag":"code","props":{"code":"  { \"test1\" : { \"action\" : \"drop\" } } \n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"  { \"test1\" : { \"action\" : \"drop\" } } \n"}]}]}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"In the above example the \"test1\" alias will drop any message that matches\ntest1, or test1-* or test1+* (wildcard '-' or '+', see below).  Actions\nmay in turn have 0 or more options listed with them like so:"},{"type":"element","tag":"code","props":{"code":"  { \"test3\" : { \"action\" : \"alias\", \"to\" : \"test3-works\" } }\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"  { \"test3\" : { \"action\" : \"alias\", \"to\" : \"test3-works\" } }\n"}]}]}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"In the above example the \"test3\" alias has an action of \"alias\", and\na required \"to\" field.  If this \"to\" field were missing the alias would\nfail to run, and an error would be printed in the logs."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Now aliases of 'user', '@host' and 'user@host' possible:"},{"type":"element","tag":"code","props":{"code":"  { \"demo\" : { \"action\" : \"drop\" } }\n  or\n  { \"@example.com\" : { \"action\" : \"drop\" } } \n  or\n  { \"demo@example.com\" : { \"action\" : \"drop\" } } \n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"  { \"demo\" : { \"action\" : \"drop\" } }\n  or\n  { \"@example.com\" : { \"action\" : \"drop\" } } \n  or\n  { \"demo@example.com\" : { \"action\" : \"drop\" } } \n"}]}]}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Aliases may also be exploded to multiple recipients:"},{"type":"element","tag":"code","props":{"code":"  { \"sales@example.com\": { \"action: \"alias\", \"to\": [\"alice@example.com\", \"bob@example.com\"] } }\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"  { \"sales@example.com\": { \"action: \"alias\", \"to\": [\"alice@example.com\", \"bob@example.com\"] } }\n"}]}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"wildcard notation"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"In an effort to match some of the functionality of other alias parsers\nwe've allowed wildcard matching of the alias against the right most\nstring of a RCPT address.  The characters '-' and '+' are commonly used\nfor subaddressing and this plugin has built-in support to alias the\n\"user\" part of the email address."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"That is, if our address were "},{"type":"element","tag":"a","props":{"href":"mailto:test2-testing@example.com"},"children":[{"type":"text","value":"test2-testing@example.com"}]},{"type":"text","value":" (or\n"},{"type":"element","tag":"a","props":{"href":"mailto:test2+testing@example.com"},"children":[{"type":"text","value":"test2+testing@example.com"}]},{"type":"text","value":"), the below alias would match:"},{"type":"element","tag":"code","props":{"code":"  { \"test2\" : { \"action\" : \"drop\" } }\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"  { \"test2\" : { \"action\" : \"drop\" } }\n"}]}]}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The larger, and more specific alias, should always match first when\nusing wildcard '-' notation.  So if the above RCPT were put up against\nthis alias config, it would not drop, but rather map to another\naddress:"},{"type":"element","tag":"code","props":{"code":"  {\n      \"test2\" : { \"action\" : \"drop\" },\n      \"test2-testing\" : { \"action\" : \"alias\", \"to\" : \"test@foo.com\" }\n  }\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"  {\n      \"test2\" : { \"action\" : \"drop\" },\n      \"test2-testing\" : { \"action\" : \"alias\", \"to\" : \"test@foo.com\" }\n  }\n"}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"chaining and circuits"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"In short, we do not allow chaining of aliases at this time.  As a\nside-effect, we enjoy protections against alias circuits."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"optional one line formatting"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Any valid JSON will due, however, please consider keeping each alias\non its own line so that others that wish to grep the aliases file\nhave an easier time finding the full configuration for an alias."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"nondeterministic duplicate matches"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"This plugin was written with speed in mind.  That means every lookup\nhashes into the alias file for its match.  While the act of doing so\nis fast, it does mean that any duplicate alias entries will match\nnondeterministically.  That is, we cannot predict what will happen\nhere:"},{"type":"element","tag":"code","props":{"code":"  {\n      \"coinflip\" : { \"action\" : \"alias\", \"to\" : \"heads@coin.com\" },\n      \"coinflip\" : { \"action\" : \"alias\", \"to\" : \"tails@coin.com\" }\n  }\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"  {\n      \"coinflip\" : { \"action\" : \"alias\", \"to\" : \"heads@coin.com\" },\n      \"coinflip\" : { \"action\" : \"alias\", \"to\" : \"tails@coin.com\" }\n  }\n"}]}]}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Truth be told, one result will likely always be chosen over the other,\nso this is not exactly a coinflip.  We simply cannot say what the\nlanguage implementation will do here, it could change tomorrow."}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"action (required)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The following is a list of supported actions, and the options they require."},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"drop"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"This action simply drops a message, while pretending everything was\nokay to the sender.  This acts much like an alias to /dev/null in\nother servers."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"alias"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"This action will map the alias key to the address specified in the\n\"to\" option.  A note about matching in addition to the note\nabout wildcard '-' above.  When we match an alias, we store the\nhostname of the match for a shortcut substitution syntax later."},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"to (required)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"This option is the full address, or local part at matched hostname\nthat the RCPT address will be re-written to.  For an example of\nan alias to a full address consider the following:"},{"type":"element","tag":"code","props":{"code":"  { \"test5\" : { \"action\" : \"alias\", \"to\" : \"test5@foo.com\" } }\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"  { \"test5\" : { \"action\" : \"alias\", \"to\" : \"test5@foo.com\" } }\n"}]}]}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"This will map RCPT matches for \"test5\" to \""},{"type":"element","tag":"a","props":{"href":"mailto:test5-works@foo.com"},"children":[{"type":"text","value":"test5-works@foo.com"}]},{"type":"text","value":"\".\nThis would map \""},{"type":"element","tag":"a","props":{"href":"mailto:test5@somedomain.com"},"children":[{"type":"text","value":"test5@somedomain.com"}]},{"type":"text","value":"\" to \""},{"type":"element","tag":"a","props":{"href":"mailto:test5-works@foo.com"},"children":[{"type":"text","value":"test5-works@foo.com"}]},{"type":"text","value":"\"\nevery time.  Now compare this notation with its shortcut\ncounterpart, best used when the \"to\" address is at the same\ndomain as the match:"},{"type":"element","tag":"code","props":{"code":"  { \"test4\" : { \"action\" : \"alias\", \"to\" : \"test4\" } }\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"  { \"test4\" : { \"action\" : \"alias\", \"to\" : \"test4\" } }\n"}]}]}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Clearly, this notation is more compact, but what does it do.  Well,\nmail to \""},{"type":"element","tag":"a","props":{"href":"mailto:test4-foo@anydomain.com"},"children":[{"type":"text","value":"test4-foo@anydomain.com"}]},{"type":"text","value":"\" will map to \""},{"type":"element","tag":"a","props":{"href":"mailto:test4@anydomain.com"},"children":[{"type":"text","value":"test4@anydomain.com"}]},{"type":"text","value":"\".\nOne can see the clear benefit of using this notation with lots of\naliases on a single domain that map to other local parts at the\nsame domain."}]}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"example-configuration"},"children":[{"type":"text","value":"Example Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"{\n\"test1\" : { \"action\" : \"drop\" },\n\"test2\" : { \"action\" : \"drop\" },\n\"test3\" : { \"action\" : \"alias\", \"to\" : \"test3-works\" },\n\"test4\" : { \"action\" : \"alias\", \"to\" : \"test4\" },\n\"test5\" : { \"action\" : \"alias\", \"to\" : \""},{"type":"element","tag":"a","props":{"href":"mailto:test5-works@success.com"},"children":[{"type":"text","value":"test5-works@success.com"}]},{"type":"text","value":"\" },\n\"test6\" : { \"action\" : \"alias\", \"to\" : \""},{"type":"element","tag":"a","props":{"href":"mailto:test6-works@success.com"},"children":[{"type":"text","value":"test6-works@success.com"}]},{"type":"text","value":"\" }\n}"}]}]},"navigation":{"title":"aliases"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"aliases-plugin"},"children":[{"type":"text","value":"Aliases plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin allows one to configure aliases that may perform an action or\nchange the RCPT address in a number of ways.  All aliases are specified in\na JSON formatted configuration file, and must have at very least an action.\nAny syntax error found in the JSON format config file will stop the server\nfrom running."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"IMPORTANT: this plugin must appear in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/plugins"}]},{"type":"text","value":" before other plugins\nthat run on hook_rcpt"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"WARNING: DO NOT USE THIS PLUGIN WITH queue/smtp_proxy."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"aliases"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"JSON formatted configuration file that must contain, at very least, a key\nto match against RCPT address, and a value that is an associative array\nwith an \"action\" : \""},{"type":"element","tag":"action","props":{},"children":[{"type":"text","value":"\" key, value pair.  An example:"}]},{"type":"element","tag":"code","props":{"code":"  { \"test1\" : { \"action\" : \"drop\" } } \n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"  { \"test1\" : { \"action\" : \"drop\" } } "}]}]}]}]}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"In the above example the \"test1\" alias will drop any message that matches\ntest1, or test1-* or test1+* (wildcard '-' or '+', see below).  Actions\nmay in turn have 0 or more options listed with them like so:"},{"type":"element","tag":"code","props":{"code":"  { \"test3\" : { \"action\" : \"alias\", \"to\" : \"test3-works\" } }\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"  { \"test3\" : { \"action\" : \"alias\", \"to\" : \"test3-works\" } }"}]}]}]}]}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"In the above example the \"test3\" alias has an action of \"alias\", and\na required \"to\" field.  If this \"to\" field were missing the alias would\nfail to run, and an error would be printed in the logs."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Now aliases of 'user', '@host' and 'user@host' possible:"},{"type":"element","tag":"code","props":{"code":"  { \"demo\" : { \"action\" : \"drop\" } }\n  or\n  { \"@example.com\" : { \"action\" : \"drop\" } } \n  or\n  { \"demo@example.com\" : { \"action\" : \"drop\" } } \n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"  { \"demo\" : { \"action\" : \"drop\" } }\n  or\n  { \"@example.com\" : { \"action\" : \"drop\" } } \n  or\n  { \"demo@example.com\" : { \"action\" : \"drop\" } } "}]}]}]}]}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Aliases may also be exploded to multiple recipients:"},{"type":"element","tag":"code","props":{"code":"  { \"sales@example.com\": { \"action: \"alias\", \"to\": [\"alice@example.com\", \"bob@example.com\"] } }\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"  { \"sales@example.com\": { \"action: \"alias\", \"to\": [\"alice@example.com\", \"bob@example.com\"] } }"}]}]}]}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"wildcard notation"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"In an effort to match some of the functionality of other alias parsers\nwe've allowed wildcard matching of the alias against the right most\nstring of a RCPT address.  The characters '-' and '+' are commonly used\nfor subaddressing and this plugin has built-in support to alias the\n\"user\" part of the email address."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"That is, if our address were "},{"type":"element","tag":"a","props":{"href":"mailto:test2-testing@example.com"},"children":[{"type":"text","value":"test2-testing@example.com"}]},{"type":"text","value":" (or\n"},{"type":"element","tag":"a","props":{"href":"mailto:test2+testing@example.com"},"children":[{"type":"text","value":"test2+testing@example.com"}]},{"type":"text","value":"), the below alias would match:"},{"type":"element","tag":"code","props":{"code":"  { \"test2\" : { \"action\" : \"drop\" } }\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"  { \"test2\" : { \"action\" : \"drop\" } }"}]}]}]}]}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The larger, and more specific alias, should always match first when\nusing wildcard '-' notation.  So if the above RCPT were put up against\nthis alias config, it would not drop, but rather map to another\naddress:"},{"type":"element","tag":"code","props":{"code":"  {\n      \"test2\" : { \"action\" : \"drop\" },\n      \"test2-testing\" : { \"action\" : \"alias\", \"to\" : \"test@foo.com\" }\n  }\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"  {\n      \"test2\" : { \"action\" : \"drop\" },\n      \"test2-testing\" : { \"action\" : \"alias\", \"to\" : \"test@foo.com\" }\n  }"}]}]}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"chaining and circuits"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"In short, we do not allow chaining of aliases at this time.  As a\nside-effect, we enjoy protections against alias circuits."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"optional one line formatting"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Any valid JSON will due, however, please consider keeping each alias\non its own line so that others that wish to grep the aliases file\nhave an easier time finding the full configuration for an alias."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"nondeterministic duplicate matches"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"This plugin was written with speed in mind.  That means every lookup\nhashes into the alias file for its match.  While the act of doing so\nis fast, it does mean that any duplicate alias entries will match\nnondeterministically.  That is, we cannot predict what will happen\nhere:"},{"type":"element","tag":"code","props":{"code":"  {\n      \"coinflip\" : { \"action\" : \"alias\", \"to\" : \"heads@coin.com\" },\n      \"coinflip\" : { \"action\" : \"alias\", \"to\" : \"tails@coin.com\" }\n  }\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"  {\n      \"coinflip\" : { \"action\" : \"alias\", \"to\" : \"heads@coin.com\" },\n      \"coinflip\" : { \"action\" : \"alias\", \"to\" : \"tails@coin.com\" }\n  }"}]}]}]}]}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Truth be told, one result will likely always be chosen over the other,\nso this is not exactly a coinflip.  We simply cannot say what the\nlanguage implementation will do here, it could change tomorrow."}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"action (required)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The following is a list of supported actions, and the options they require."},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"drop"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"This action simply drops a message, while pretending everything was\nokay to the sender.  This acts much like an alias to /dev/null in\nother servers."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"alias"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"This action will map the alias key to the address specified in the\n\"to\" option.  A note about matching in addition to the note\nabout wildcard '-' above.  When we match an alias, we store the\nhostname of the match for a shortcut substitution syntax later."},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"to (required)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"This option is the full address, or local part at matched hostname\nthat the RCPT address will be re-written to.  For an example of\nan alias to a full address consider the following:"},{"type":"element","tag":"code","props":{"code":"  { \"test5\" : { \"action\" : \"alias\", \"to\" : \"test5@foo.com\" } }\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"  { \"test5\" : { \"action\" : \"alias\", \"to\" : \"test5@foo.com\" } }"}]}]}]}]}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"This will map RCPT matches for \"test5\" to \""},{"type":"element","tag":"a","props":{"href":"mailto:test5-works@foo.com"},"children":[{"type":"text","value":"test5-works@foo.com"}]},{"type":"text","value":"\".\nThis would map \""},{"type":"element","tag":"a","props":{"href":"mailto:test5@somedomain.com"},"children":[{"type":"text","value":"test5@somedomain.com"}]},{"type":"text","value":"\" to \""},{"type":"element","tag":"a","props":{"href":"mailto:test5-works@foo.com"},"children":[{"type":"text","value":"test5-works@foo.com"}]},{"type":"text","value":"\"\nevery time.  Now compare this notation with its shortcut\ncounterpart, best used when the \"to\" address is at the same\ndomain as the match:"},{"type":"element","tag":"code","props":{"code":"  { \"test4\" : { \"action\" : \"alias\", \"to\" : \"test4\" } }\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"  { \"test4\" : { \"action\" : \"alias\", \"to\" : \"test4\" } }"}]}]}]}]}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Clearly, this notation is more compact, but what does it do.  Well,\nmail to \""},{"type":"element","tag":"a","props":{"href":"mailto:test4-foo@anydomain.com"},"children":[{"type":"text","value":"test4-foo@anydomain.com"}]},{"type":"text","value":"\" will map to \""},{"type":"element","tag":"a","props":{"href":"mailto:test4@anydomain.com"},"children":[{"type":"text","value":"test4@anydomain.com"}]},{"type":"text","value":"\".\nOne can see the clear benefit of using this notation with lots of\naliases on a single domain that map to other local parts at the\nsame domain."}]}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"example-configuration"},"children":[{"type":"text","value":"Example Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"{\n\"test1\" : { \"action\" : \"drop\" },\n\"test2\" : { \"action\" : \"drop\" },\n\"test3\" : { \"action\" : \"alias\", \"to\" : \"test3-works\" },\n\"test4\" : { \"action\" : \"alias\", \"to\" : \"test4\" },\n\"test5\" : { \"action\" : \"alias\", \"to\" : \""},{"type":"element","tag":"a","props":{"href":"mailto:test5-works@success.com"},"children":[{"type":"text","value":"test5-works@success.com"}]},{"type":"text","value":"\" },\n\"test6\" : { \"action\" : \"alias\", \"to\" : \""},{"type":"element","tag":"a","props":{"href":"mailto:test6-works@success.com"},"children":[{"type":"text","value":"test6-works@success.com"}]},{"type":"text","value":"\" }\n}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"configuration","depth":2,"text":"Configuration"},{"id":"example-configuration","depth":2,"text":"Example Configuration"}]}},"_type":"markdown","_id":"content:8.plugins:aliases.md","_source":"content","_file":"8.plugins/aliases.md","_extension":"md"},{"_path":"/plugins/attachment","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"attachment - Attachment plugin for Haraka","description":"Haraka attachment plugin - attachment handling for Haraka","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"attachment-plugin"},"children":[{"type":"text","value":"Attachment plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin allows you to reject messages based on Content-Type within\nthe message or any MIME parts or on the filename of any attachments."}]},{"type":"element","tag":"h2","props":{"id":"limitations"},"children":[{"type":"text","value":"Limitations"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin cannot detect forged MIME types where the sender is lying\nabout the type.  The type is not confirmed in any way currently."}]},{"type":"element","tag":"h2","props":{"id":"requirements"},"children":[{"type":"text","value":"Requirements"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To be able to check filenames inside archive files the npm module\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"tmp"}]},{"type":"text","value":" is required and the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"bsdtar"}]},{"type":"text","value":" binary must be available (in\n/bin /usr/bin or /usr/local/bin)."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If either "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"tmp"}]},{"type":"text","value":" or "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"bsdtar"}]},{"type":"text","value":" are unavailable then the plugin will\nautomatically disable expansion of archive files."}]},{"type":"element","tag":"h2","props":{"id":"logging"},"children":[{"type":"text","value":"Logging"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"At INFO level logging this plugin will output the filename and type\nof each attached file along with an MD5 checksum of the contents.\nThe MD5 checksum is useful to check against "},{"type":"element","tag":"a","props":{"href":"http://www.virustotal.com","rel":["nofollow"]},"children":[{"type":"text","value":"www.virustotal.com"}]}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"attachment.ini"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"archive_max_depth\n(default: 5)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The maximum level of nested archives that will be unpacked.\nIf this is exceeded the message will be rejected."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"archive_extns\n(default: .zip,.tar,.tgz,.taz,.z,.gz,.rar,.7z)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"File extensions that should be treated as archives.\nThis can be any file type supported by bsdtar."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"allow_encrypted_archives\n(default: false)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Allow archives that cannot be read by bsdtar because\nthey are encrypted."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"timeout\n(default: 30)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Timeout in seconds before the plugin will abort."}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"attachment.filename.regex"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"This file contains a list of regular expressions, one per line that\nwill be tested against each filename found within a message.\nThe first regexp to match will cause the message to be rejected."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nAny invalid regexps will be detected, reported and skipped."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"attachment.filename.wc"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"As above, except this expects wildcards instead of regular expressions."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"attachment.archive.filename.regex"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"This file contains a list of regular expressions, one per line that\nwill be tested against each filename found within an archive file.\nThe first regexp to match will cause the message to be rejected.\nAny invalid regexps will be detected, reported and skipped."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"attachment.archive.filename.wc"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"As above, except this expects wildcards instead of regular expressions."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"attachment.ctype.regex"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"This file contains a list of regular expressions, one per line that\nwill be tested against each MIME Content-Type header in the message.\nThe first regexp to match will cause the message to be rejected.\nAny invalid regexps will be detected, reported and skipped."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"attachiment.ctype.wc"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"As above, except this expects wildcards instead of regular expressions."}]}]}]},"navigation":{"title":"attachment"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"attachment-plugin"},"children":[{"type":"text","value":"Attachment plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin allows you to reject messages based on Content-Type within\nthe message or any MIME parts or on the filename of any attachments."}]},{"type":"element","tag":"h2","props":{"id":"limitations"},"children":[{"type":"text","value":"Limitations"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin cannot detect forged MIME types where the sender is lying\nabout the type.  The type is not confirmed in any way currently."}]},{"type":"element","tag":"h2","props":{"id":"requirements"},"children":[{"type":"text","value":"Requirements"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To be able to check filenames inside archive files the npm module\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"tmp"}]},{"type":"text","value":" is required and the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"bsdtar"}]},{"type":"text","value":" binary must be available (in\n/bin /usr/bin or /usr/local/bin)."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If either "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"tmp"}]},{"type":"text","value":" or "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"bsdtar"}]},{"type":"text","value":" are unavailable then the plugin will\nautomatically disable expansion of archive files."}]},{"type":"element","tag":"h2","props":{"id":"logging"},"children":[{"type":"text","value":"Logging"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"At INFO level logging this plugin will output the filename and type\nof each attached file along with an MD5 checksum of the contents.\nThe MD5 checksum is useful to check against "},{"type":"element","tag":"a","props":{"href":"http://www.virustotal.com","rel":["nofollow"]},"children":[{"type":"text","value":"www.virustotal.com"}]}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"attachment.ini"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"archive_max_depth\n(default: 5)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The maximum level of nested archives that will be unpacked.\nIf this is exceeded the message will be rejected."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"archive_extns\n(default: .zip,.tar,.tgz,.taz,.z,.gz,.rar,.7z)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"File extensions that should be treated as archives.\nThis can be any file type supported by bsdtar."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"allow_encrypted_archives\n(default: false)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Allow archives that cannot be read by bsdtar because\nthey are encrypted."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"timeout\n(default: 30)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Timeout in seconds before the plugin will abort."}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"attachment.filename.regex"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"This file contains a list of regular expressions, one per line that\nwill be tested against each filename found within a message.\nThe first regexp to match will cause the message to be rejected."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nAny invalid regexps will be detected, reported and skipped."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"attachment.filename.wc"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"As above, except this expects wildcards instead of regular expressions."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"attachment.archive.filename.regex"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"This file contains a list of regular expressions, one per line that\nwill be tested against each filename found within an archive file.\nThe first regexp to match will cause the message to be rejected.\nAny invalid regexps will be detected, reported and skipped."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"attachment.archive.filename.wc"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"As above, except this expects wildcards instead of regular expressions."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"attachment.ctype.regex"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"This file contains a list of regular expressions, one per line that\nwill be tested against each MIME Content-Type header in the message.\nThe first regexp to match will cause the message to be rejected.\nAny invalid regexps will be detected, reported and skipped."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"attachiment.ctype.wc"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"As above, except this expects wildcards instead of regular expressions."}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"limitations","depth":2,"text":"Limitations"},{"id":"requirements","depth":2,"text":"Requirements"},{"id":"logging","depth":2,"text":"Logging"},{"id":"configuration","depth":2,"text":"Configuration"}]}},"_type":"markdown","_id":"content:8.plugins:attachment.md","_source":"content","_file":"8.plugins/attachment.md","_extension":"md"},{"_path":"/plugins/auth/auth_bridge","_dir":"auth","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"auth/auth_bridge - Authenticate users against an external service","description":"Haraka auth/auth_bridge plugin - Authenticate users against an external service","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"authauth_bridge-plugin"},"children":[{"type":"text","value":"auth/auth_bridge plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin allows you to authenticate users to remote SMTP servers\nbridging the original user and password to the remote server,\nand proxy the result back to authenticate the client."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin is meant to be used with the plugin "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"queue/smtp_bridge"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It is different than "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"auth/auth_proxy"}]},{"type":"text","value":" because it doesn't require\nthe AUTH user in "},{"type":"element","tag":"a","props":{"href":"mailto:user@domain.com"},"children":[{"type":"text","value":"user@domain.com"}]},{"type":"text","value":" format, and it doesn't check that\nthe domain is the configuration file. This plugins simply takes\nthe original user and password and tries to authenticate it in the\nremote SMTP server."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Configuration is stored in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/smtp_bridge.ini"}]},{"type":"text","value":" and uses the INI\nstyle formatting."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The configuration of this plugin is simple:"}]},{"type":"element","tag":"code","props":{"code":"host=localhost\n#port=\n#auth_type=\n#priority=10\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"host=localhost\n#port=\n#auth_type=\n#priority=10\n"}]}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"host: the host where you will be authenticating and posting,\nfor example "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"smtp.host.tld"}]},{"type":"text","value":". This is the only setting required."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If needed you can also set"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"port: default to empty and Haraka will use 25."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The options "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"auth_type"}]},{"type":"text","value":" and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"priority"}]},{"type":"text","value":" will be used by "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"queue/smtp_bridge"}]}]}]},"navigation":{"title":"auth/auth_bridge"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"authauth_bridge-plugin"},"children":[{"type":"text","value":"auth/auth_bridge plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin allows you to authenticate users to remote SMTP servers\nbridging the original user and password to the remote server,\nand proxy the result back to authenticate the client."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin is meant to be used with the plugin "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"queue/smtp_bridge"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It is different than "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"auth/auth_proxy"}]},{"type":"text","value":" because it doesn't require\nthe AUTH user in "},{"type":"element","tag":"a","props":{"href":"mailto:user@domain.com"},"children":[{"type":"text","value":"user@domain.com"}]},{"type":"text","value":" format, and it doesn't check that\nthe domain is the configuration file. This plugins simply takes\nthe original user and password and tries to authenticate it in the\nremote SMTP server."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Configuration is stored in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/smtp_bridge.ini"}]},{"type":"text","value":" and uses the INI\nstyle formatting."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The configuration of this plugin is simple:"}]},{"type":"element","tag":"code","props":{"code":"host=localhost\n#port=\n#auth_type=\n#priority=10\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"host=localhost\n#port=\n#auth_type=\n#priority=10"}]}]}]}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"host: the host where you will be authenticating and posting,\nfor example "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"smtp.host.tld"}]},{"type":"text","value":". This is the only setting required."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If needed you can also set"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"port: default to empty and Haraka will use 25."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The options "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"auth_type"}]},{"type":"text","value":" and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"priority"}]},{"type":"text","value":" will be used by "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"queue/smtp_bridge"}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"configuration","depth":2,"text":"Configuration"}]}},"_type":"markdown","_id":"content:8.plugins:auth:auth_bridge.md","_source":"content","_file":"8.plugins/auth/auth_bridge.md","_extension":"md"},{"_path":"/plugins/auth/auth_ldap","_dir":"auth","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"auth/auth_ldap - Authenticate users against an LDAP server","description":"Haraka auth/auth_ldap plugin - Authenticate users against an LDAP server","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"authauth_ldap-plugin"},"children":[{"type":"text","value":"auth/auth_ldap plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"auth/auth_ldap"}]},{"type":"text","value":" plugin uses an LDAP bind to authenticate a user. Currently\nonly one server and multiple DNs can be configured. If any of the DN binds succeed,\nthe user is authenticated."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Configuration is stored in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/auth_ldap.ini"}]},{"type":"text","value":" and uses the INI\nstyle formatting."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Only the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"LOGIN"}]},{"type":"text","value":" authentication method is supported assuming that passwords in the\nLDAP database are not stored in cleartext (which would allow for CRAM-MD5). Note\nthat this means passwords will be sent in the clear to the LDAP server unless\nan "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"ldaps://"}]},{"type":"text","value":" conection is used."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Current configuration options in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[core]"}]},{"type":"text","value":" are:"}]},{"type":"element","tag":"code","props":{"code":"server - the url of the LDAP server (ldap:// or ldaps://)\ntimeout - time in miliseconds to wait for the server resonse before giving up\nrejectUnauthorized - boolean (true or false) as to whether to reject connections\n    not verified against a CA. Meaning, a \"false\" allows non-verified.  \n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"server - the url of the LDAP server (ldap:// or ldaps://)\ntimeout - time in miliseconds to wait for the server resonse before giving up\nrejectUnauthorized - boolean (true or false) as to whether to reject connections\n    not verified against a CA. Meaning, a \"false\" allows non-verified.  \n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Example:"}]},{"type":"element","tag":"code","props":{"code":"[core]\nserver=ldaps://ldap.opoet.com\ntimeout=5000\nrejectUnauthorized=false  \n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"[core]\nserver=ldaps://ldap.opoet.com\ntimeout=5000\nrejectUnauthorized=false  \n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[dns]"}]},{"type":"text","value":" section (that is plural DN and not domain name system), is a list of DNs to use\nto bind. The "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"%u"}]},{"type":"text","value":" in the strings is substituted with the user name used in the SMTP\nauthentication. Note that the keys have no meaning and the DNs are tried in series until\nthe first successful bind. The LDAP RFC does not allow for parallel binds on a connection,\nso it is suggested that the most commonly used DN be placed earlier in the list."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Example:"}]},{"type":"element","tag":"code","props":{"code":"[dns]\ndn1=uid=%u,ou=Users,dc=opoet,dc=com\ndn2=uid=%u,ou=people,dc=opoet,dc=com \n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"[dns]\ndn1=uid=%u,ou=Users,dc=opoet,dc=com\ndn2=uid=%u,ou=people,dc=opoet,dc=com \n"}]}]}]}]},"navigation":{"title":"auth/auth_ldap"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"authauth_ldap-plugin"},"children":[{"type":"text","value":"auth/auth_ldap plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"auth/auth_ldap"}]},{"type":"text","value":" plugin uses an LDAP bind to authenticate a user. Currently\nonly one server and multiple DNs can be configured. If any of the DN binds succeed,\nthe user is authenticated."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Configuration is stored in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/auth_ldap.ini"}]},{"type":"text","value":" and uses the INI\nstyle formatting."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Only the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"LOGIN"}]},{"type":"text","value":" authentication method is supported assuming that passwords in the\nLDAP database are not stored in cleartext (which would allow for CRAM-MD5). Note\nthat this means passwords will be sent in the clear to the LDAP server unless\nan "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"ldaps://"}]},{"type":"text","value":" conection is used."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Current configuration options in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[core]"}]},{"type":"text","value":" are:"}]},{"type":"element","tag":"code","props":{"code":"server - the url of the LDAP server (ldap:// or ldaps://)\ntimeout - time in miliseconds to wait for the server resonse before giving up\nrejectUnauthorized - boolean (true or false) as to whether to reject connections\n    not verified against a CA. Meaning, a \"false\" allows non-verified.  \n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"server - the url of the LDAP server (ldap:// or ldaps://)\ntimeout - time in miliseconds to wait for the server resonse before giving up\nrejectUnauthorized - boolean (true or false) as to whether to reject connections\n    not verified against a CA. Meaning, a \"false\" allows non-verified.  "}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Example:"}]},{"type":"element","tag":"code","props":{"code":"[core]\nserver=ldaps://ldap.opoet.com\ntimeout=5000\nrejectUnauthorized=false  \n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"[core]\nserver=ldaps://ldap.opoet.com\ntimeout=5000\nrejectUnauthorized=false  "}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[dns]"}]},{"type":"text","value":" section (that is plural DN and not domain name system), is a list of DNs to use\nto bind. The "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"%u"}]},{"type":"text","value":" in the strings is substituted with the user name used in the SMTP\nauthentication. Note that the keys have no meaning and the DNs are tried in series until\nthe first successful bind. The LDAP RFC does not allow for parallel binds on a connection,\nso it is suggested that the most commonly used DN be placed earlier in the list."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Example:"}]},{"type":"element","tag":"code","props":{"code":"[dns]\ndn1=uid=%u,ou=Users,dc=opoet,dc=com\ndn2=uid=%u,ou=people,dc=opoet,dc=com \n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"[dns]\ndn1=uid=%u,ou=Users,dc=opoet,dc=com\ndn2=uid=%u,ou=people,dc=opoet,dc=com "}]}]}]}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"configuration","depth":2,"text":"Configuration"}]}},"_type":"markdown","_id":"content:8.plugins:auth:auth_ldap.md","_source":"content","_file":"8.plugins/auth/auth_ldap.md","_extension":"md"},{"_path":"/plugins/auth/auth_proxy","_dir":"auth","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"auth/auth_proxy - Authenticate users against an external service","description":"Haraka auth/auth_proxy plugin - Authenticate users against an external service","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"authauth_proxy-plugin"},"children":[{"type":"text","value":"auth/auth_proxy plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin allows you to authenticate users by domain to remote SMTP servers\nand proxy the result back to authenticate the client."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For this to work - the AUTH username "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"must"}]},{"type":"text","value":" be in "},{"type":"element","tag":"a","props":{"href":"mailto:user@domain.com"},"children":[{"type":"text","value":"user@domain.com"}]},{"type":"text","value":" format\nregardless as to whether the remote SMTP server requires it in this format.\nThe domain part of the username is used to look-up which SMTP servers should\nbe used to authenticate users for that domain.\nWhen sending the AUTH credentials to the remote server, this plugin will try\nand send the full username e.g. "},{"type":"element","tag":"a","props":{"href":"mailto:user@domain.com"},"children":[{"type":"text","value":"user@domain.com"}]},{"type":"text","value":" first and if this fails it\nwill then strip the @domain.com part and just send the unqualified username."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Due to the way this plugin works - it can only support PLAIN and LOGIN\nauthentication methods and for this reason it requires that STARTTLS be\nused via the tls plugin before it will advertise AUTH capabilities by the\nEHLO command.  When connecting to the remote SMTP systems it will always\nattempt STARTTLS if it is offered, but it does "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"not"}]},{"type":"text","value":" require it, so caution\nshould be exercised."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Configuration is stored in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/auth_proxy.ini"}]},{"type":"text","value":" and uses the INI\nstyle formatting."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The configuration of this plugin is simple:"}]},{"type":"element","tag":"code","props":{"code":"[domains]\ndomain.com = server1.domain.com:587 server2.domain.com\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"[domains]\ndomain.com = server1.domain.com:587 server2.domain.com\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Where domain.com is the domain-part of the username equals a list of hosts\nthat should be consulted in host:port format.  The "},{"type":"element","tag":"port","props":{},"children":[]},{"type":"text","value":" is optional and will\ndefault to 25.  The list of hosts can be space, semi-colon or comma separated."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If more than host is specified, then subsequent hosts will only be tested if\nthere is some sort of error e.g. timeout, connection or protocol error."}]}]},"navigation":{"title":"auth/auth_proxy"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"authauth_proxy-plugin"},"children":[{"type":"text","value":"auth/auth_proxy plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin allows you to authenticate users by domain to remote SMTP servers\nand proxy the result back to authenticate the client."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For this to work - the AUTH username "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"must"}]},{"type":"text","value":" be in "},{"type":"element","tag":"a","props":{"href":"mailto:user@domain.com"},"children":[{"type":"text","value":"user@domain.com"}]},{"type":"text","value":" format\nregardless as to whether the remote SMTP server requires it in this format.\nThe domain part of the username is used to look-up which SMTP servers should\nbe used to authenticate users for that domain.\nWhen sending the AUTH credentials to the remote server, this plugin will try\nand send the full username e.g. "},{"type":"element","tag":"a","props":{"href":"mailto:user@domain.com"},"children":[{"type":"text","value":"user@domain.com"}]},{"type":"text","value":" first and if this fails it\nwill then strip the @domain.com part and just send the unqualified username."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Due to the way this plugin works - it can only support PLAIN and LOGIN\nauthentication methods and for this reason it requires that STARTTLS be\nused via the tls plugin before it will advertise AUTH capabilities by the\nEHLO command.  When connecting to the remote SMTP systems it will always\nattempt STARTTLS if it is offered, but it does "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"not"}]},{"type":"text","value":" require it, so caution\nshould be exercised."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Configuration is stored in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/auth_proxy.ini"}]},{"type":"text","value":" and uses the INI\nstyle formatting."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The configuration of this plugin is simple:"}]},{"type":"element","tag":"code","props":{"code":"[domains]\ndomain.com = server1.domain.com:587 server2.domain.com\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"[domains]\ndomain.com = server1.domain.com:587 server2.domain.com"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Where domain.com is the domain-part of the username equals a list of hosts\nthat should be consulted in host:port format.  The "},{"type":"element","tag":"port","props":{},"children":[]},{"type":"text","value":" is optional and will\ndefault to 25.  The list of hosts can be space, semi-colon or comma separated."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If more than host is specified, then subsequent hosts will only be tested if\nthere is some sort of error e.g. timeout, connection or protocol error."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"configuration","depth":2,"text":"Configuration"}]}},"_type":"markdown","_id":"content:8.plugins:auth:auth_proxy.md","_source":"content","_file":"8.plugins/auth/auth_proxy.md","_extension":"md"},{"_path":"/plugins/auth/auth_vpopmaild","_dir":"auth","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"auth/auth_vpopmaild - Authenticate users against vpopmaild","description":"Haraka auth/auth_vpopmaild plugin - Authenticate users against vpopmaild","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"authauth_vpopmaild-plugin"},"children":[{"type":"text","value":"auth/auth_vpopmaild plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"auth/vpopmaild"}]},{"type":"text","value":" plugin allows you to authenticate against a vpopmaild\ndaemon."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Configuration is stored in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/auth_vpopmaild.ini"}]},{"type":"text","value":" and uses INI\nstyle formatting."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"There are three configuration settings:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"host: The host/IP that vpopmaild is listening on (default: localhost)."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"port: The TCP port that vpopmaild is listening on (default: 89)."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"sysadmin: A colon separated username:password of a vpopmail user with\nSYSADMIN privileges (see vpopmail/bin/vmoduser -S). This is "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"only"}]},{"type":"text","value":"\nnecessary to support CRAM-MD5 which requires access to the clear text\npassword. On new installs, it's best not to use CRAM-MD5, as it requires\nstoring clear text passwords. Legacy clients with MUAs configured\nto authenticate with CRAM-MD5 will need this enabled."}]}]},{"type":"element","tag":"h3","props":{"id":"per-domain-configuration"},"children":[{"type":"text","value":"Per-domain Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Additionally, domains can each have their own configuration for connecting\nto vpopmaild. The defaults are the same, so only the differences needs to\nbe declared. Example:"}]},{"type":"element","tag":"code","props":{"code":"[example.com]\nhost=192.168.0.1\nport=999\n\n[example2.com]\nhost=192.168.0.2\nsysadmin=postmaster@example2.com:sekret\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"[example.com]\nhost=192.168.0.1\nport=999\n\n[example2.com]\nhost=192.168.0.2\nsysadmin=postmaster@example2.com:sekret\n"}]}]}]}]},"navigation":{"title":"auth/auth_vpopmaild"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"authauth_vpopmaild-plugin"},"children":[{"type":"text","value":"auth/auth_vpopmaild plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"auth/vpopmaild"}]},{"type":"text","value":" plugin allows you to authenticate against a vpopmaild\ndaemon."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Configuration is stored in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/auth_vpopmaild.ini"}]},{"type":"text","value":" and uses INI\nstyle formatting."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"There are three configuration settings:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"host: The host/IP that vpopmaild is listening on (default: localhost)."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"port: The TCP port that vpopmaild is listening on (default: 89)."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"sysadmin: A colon separated username:password of a vpopmail user with\nSYSADMIN privileges (see vpopmail/bin/vmoduser -S). This is "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"only"}]},{"type":"text","value":"\nnecessary to support CRAM-MD5 which requires access to the clear text\npassword. On new installs, it's best not to use CRAM-MD5, as it requires\nstoring clear text passwords. Legacy clients with MUAs configured\nto authenticate with CRAM-MD5 will need this enabled."}]}]},{"type":"element","tag":"h3","props":{"id":"per-domain-configuration"},"children":[{"type":"text","value":"Per-domain Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Additionally, domains can each have their own configuration for connecting\nto vpopmaild. The defaults are the same, so only the differences needs to\nbe declared. Example:"}]},{"type":"element","tag":"code","props":{"code":"[example.com]\nhost=192.168.0.1\nport=999\n\n[example2.com]\nhost=192.168.0.2\nsysadmin=postmaster@example2.com:sekret\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"[example.com]\nhost=192.168.0.1\nport=999\n\n[example2.com]\nhost=192.168.0.2\nsysadmin=postmaster@example2.com:sekret"}]}]}]}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"configuration","depth":2,"text":"Configuration","children":[{"id":"per-domain-configuration","depth":3,"text":"Per-domain Configuration"}]}]}},"_type":"markdown","_id":"content:8.plugins:auth:auth_vpopmaild.md","_source":"content","_file":"8.plugins/auth/auth_vpopmaild.md","_extension":"md"},{"_path":"/plugins/auth/flat_file","_dir":"auth","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"auth/flat_file - Authenticate users against a flat file","description":"Haraka auth/flat_file plugin - Authenticate users against a flat file","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"authflat_file-plugin"},"children":[{"type":"text","value":"auth/flat_file plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"auth/flat_file"}]},{"type":"text","value":" plugin allows you to create a file containing username\nand password combinations, and have relaying users authenticate from that\nfile."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Note that passwords are stored in clear-text, so this may not be a great idea\nfor large scale systems. However the plugin would be a good start for someone\nlooking to implement authentication using some other form of auth."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Security"}]},{"type":"text","value":" - it is recommended to switch to "},{"type":"element","tag":"a","props":{"href":"https://github.com/AuspeXeu/haraka-plugin-auth-enc-file","rel":["nofollow"]},"children":[{"type":"text","value":"auth-encfile"}]},{"type":"text","value":"\nto protect your user credentials."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"IMPORANT NOTE"}]},{"type":"text","value":" - this plugin requires that STARTTLS be used via the tls plugin\nbefore it will advertise AUTH capabilities by the EHLO command.  This is to\nimprove security out-of-the-box.   Localhost and any IP in RFC1918 ranges\nare automatically exempt from this rule."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Configuration is stored in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/auth_flat_file.ini"}]},{"type":"text","value":" and uses the INI\nstyle formatting."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Authentication methods are listed in the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[core]"}]},{"type":"text","value":" section under "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"methods"}]},{"type":"text","value":"\nparameter. Lists of authentification methods are comma separated. Currently\nsupported methods are: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"CRAM-MD5"}]},{"type":"text","value":", "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"PLAIN"}]},{"type":"text","value":" and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"LOGIN"}]},{"type":"text","value":". The "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"PLAIN"}]},{"type":"text","value":"\nand "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"LOGIN"}]},{"type":"text","value":" methods are not secure. That is why TLS is required before AUTH is\noffered."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Example:"}]},{"type":"element","tag":"code","props":{"code":"[core]\nmethods=PLAIN,LOGIN,CRAM-MD5\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"[core]\nmethods=PLAIN,LOGIN,CRAM-MD5\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Users are stored in the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[users]"}]},{"type":"text","value":" section."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Example:"}]},{"type":"element","tag":"code","props":{"code":"[users]\nuser1=password1\nuser@domain.com=password2\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"[users]\nuser1=password1\nuser@domain.com=password2\n"}]}]}]}]},"navigation":{"title":"auth/flat_file"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"authflat_file-plugin"},"children":[{"type":"text","value":"auth/flat_file plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"auth/flat_file"}]},{"type":"text","value":" plugin allows you to create a file containing username\nand password combinations, and have relaying users authenticate from that\nfile."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Note that passwords are stored in clear-text, so this may not be a great idea\nfor large scale systems. However the plugin would be a good start for someone\nlooking to implement authentication using some other form of auth."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Security"}]},{"type":"text","value":" - it is recommended to switch to "},{"type":"element","tag":"a","props":{"href":"https://github.com/AuspeXeu/haraka-plugin-auth-enc-file","rel":["nofollow"]},"children":[{"type":"text","value":"auth-encfile"}]},{"type":"text","value":"\nto protect your user credentials."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"IMPORANT NOTE"}]},{"type":"text","value":" - this plugin requires that STARTTLS be used via the tls plugin\nbefore it will advertise AUTH capabilities by the EHLO command.  This is to\nimprove security out-of-the-box.   Localhost and any IP in RFC1918 ranges\nare automatically exempt from this rule."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Configuration is stored in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/auth_flat_file.ini"}]},{"type":"text","value":" and uses the INI\nstyle formatting."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Authentication methods are listed in the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[core]"}]},{"type":"text","value":" section under "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"methods"}]},{"type":"text","value":"\nparameter. Lists of authentification methods are comma separated. Currently\nsupported methods are: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"CRAM-MD5"}]},{"type":"text","value":", "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"PLAIN"}]},{"type":"text","value":" and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"LOGIN"}]},{"type":"text","value":". The "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"PLAIN"}]},{"type":"text","value":"\nand "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"LOGIN"}]},{"type":"text","value":" methods are not secure. That is why TLS is required before AUTH is\noffered."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Example:"}]},{"type":"element","tag":"code","props":{"code":"[core]\nmethods=PLAIN,LOGIN,CRAM-MD5\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"[core]\nmethods=PLAIN,LOGIN,CRAM-MD5"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Users are stored in the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[users]"}]},{"type":"text","value":" section."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Example:"}]},{"type":"element","tag":"code","props":{"code":"[users]\nuser1=password1\nuser@domain.com=password2\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"[users]\nuser1=password1\nuser@domain.com=password2"}]}]}]}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"configuration","depth":2,"text":"Configuration"}]}},"_type":"markdown","_id":"content:8.plugins:auth:flat_file.md","_source":"content","_file":"8.plugins/auth/flat_file.md","_extension":"md"},{"_path":"/plugins/avg","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"avg - Anti-Virus scanner plugin for Haraka","description":"Haraka avg plugin - Anti-Virus scanner","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"avg-plugin"},"children":[{"type":"text","value":"Avg plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Implement virus scanning with AVG's TCPD daemon, available for Linux/FreeBSD. AVG linux is "},{"type":"element","tag":"a","props":{"href":"http://www.avg.com/gb-en/faq.pnuid-faq_v3_linux","rel":["nofollow"]},"children":[{"type":"text","value":"free for personal or commercial use"}]},{"type":"text","value":" and can be downloaded from "},{"type":"element","tag":"a","props":{"href":"http://free.avg.com/gb-en/download.prd-alf","rel":["nofollow"]},"children":[{"type":"text","value":"free.avg.com"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Messages that AVG detects as infected are rejected. Errors will cause the plugin to return temporary failures unless the defer options are changed (see below)."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The following options can be set in avg.ini:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"port (default: 54322)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"TCP port to communicate with the AVG TCPD on."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"tmpdir (default: /tmp)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"AVG TCPD requires that the message be written to disk and scanned.  This setting configures where any temporary files are written to. After scanning, the temporary files are automatically removed."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connect_timeout (default: 10)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Maximum seconds to wait for the socket to connect. Connections taking longer will cause a temporary failure to be sent to the remote MTA."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"session_timeout"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Maximum number of seconds to wait for a reply to a command before failing.  A timeout will cause a temporary failure to be sent to the remote MTA."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"defer"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"By default, this plugin defers when errors or timeouts are encountered. To\nfail open (let messages pass when errors are enounctered), set the error\nand/or timeout values to false."}]},{"type":"element","tag":"code","props":{"code":"[defer]\nerror=true\ntimeout=true\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"[defer]\nerror=true\ntimeout=true\n"}]}]}]}]},"navigation":{"title":"avg"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"avg-plugin"},"children":[{"type":"text","value":"Avg plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Implement virus scanning with AVG's TCPD daemon, available for Linux/FreeBSD. AVG linux is "},{"type":"element","tag":"a","props":{"href":"http://www.avg.com/gb-en/faq.pnuid-faq_v3_linux","rel":["nofollow"]},"children":[{"type":"text","value":"free for personal or commercial use"}]},{"type":"text","value":" and can be downloaded from "},{"type":"element","tag":"a","props":{"href":"http://free.avg.com/gb-en/download.prd-alf","rel":["nofollow"]},"children":[{"type":"text","value":"free.avg.com"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Messages that AVG detects as infected are rejected. Errors will cause the plugin to return temporary failures unless the defer options are changed (see below)."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The following options can be set in avg.ini:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"port (default: 54322)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"TCP port to communicate with the AVG TCPD on."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"tmpdir (default: /tmp)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"AVG TCPD requires that the message be written to disk and scanned.  This setting configures where any temporary files are written to. After scanning, the temporary files are automatically removed."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connect_timeout (default: 10)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Maximum seconds to wait for the socket to connect. Connections taking longer will cause a temporary failure to be sent to the remote MTA."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"session_timeout"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Maximum number of seconds to wait for a reply to a command before failing.  A timeout will cause a temporary failure to be sent to the remote MTA."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"defer"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"By default, this plugin defers when errors or timeouts are encountered. To\nfail open (let messages pass when errors are enounctered), set the error\nand/or timeout values to false."}]},{"type":"element","tag":"code","props":{"code":"[defer]\nerror=true\ntimeout=true\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"[defer]\nerror=true\ntimeout=true"}]}]}]}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"configuration","depth":2,"text":"Configuration"}]}},"_type":"markdown","_id":"content:8.plugins:avg.md","_source":"content","_file":"8.plugins/avg.md","_extension":"md"},{"_path":"/plugins/backscatterer","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"backscatterer - Backscatterer plugin for Haraka","description":"Haraka backscatterer plugin - Detects and rejects backscatter","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"backscatterer-plugin"},"children":[{"type":"text","value":"backscatterer plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This is a very basic pluign that checks the connecting IP against\nips.backscatterer.org when the envelope-from is null or postmaster@\nas per the instructions at "},{"type":"element","tag":"a","props":{"href":"http://www.backscatterer.org/?target=usage","rel":["nofollow"]},"children":[{"type":"text","value":"http://www.backscatterer.org/?target=usage"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin is used to reject misdirected bounces and autoresponders\nand sender callouts from abusive systems which can happen when a\nlocal domain is spoofed and used as the envelope-from in a spam run."}]}]},"navigation":{"title":"backscatterer"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"backscatterer-plugin"},"children":[{"type":"text","value":"backscatterer plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This is a very basic pluign that checks the connecting IP against\nips.backscatterer.org when the envelope-from is null or postmaster@\nas per the instructions at "},{"type":"element","tag":"a","props":{"href":"http://www.backscatterer.org/?target=usage","rel":["nofollow"]},"children":[{"type":"text","value":"http://www.backscatterer.org/?target=usage"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin is used to reject misdirected bounces and autoresponders\nand sender callouts from abusive systems which can happen when a\nlocal domain is spoofed and used as the envelope-from in a spam run."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:8.plugins:backscatterer.md","_source":"content","_file":"8.plugins/backscatterer.md","_extension":"md"},{"_path":"/plugins/block_me","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"block_me - Block Me plugin for Haraka","description":"Haraka block_me plugin - Blocks mail from a specific IP address","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"block-me-plugin"},"children":[{"type":"text","value":"Block Me plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin allows you to configure an address which mail sent to will be\nparsed for a From: address in the body of the message, and will add that\nfrom address to the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"mail_from.blocklist"}]},{"type":"text","value":" config file."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Effectively this allows your users to forward spams that got through to a\nparticular mailbox to block them in the future."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Note that this is a system-wide block, and not per-user. Be careful with this."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/block_me.recipient"}]},{"type":"text","value":" - a file containing the address to email to\nget something blocked. For example: "},{"type":"element","tag":"strong","props":{},"children":[{"type":"element","tag":"a","props":{"href":"mailto:spam@domain.com"},"children":[{"type":"text","value":"spam@domain.com"}]}]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/block_me.senders"}]},{"type":"text","value":" - a file containing a list of email addresses\nthat are allowed to email the dropbox."}]}]}]},"navigation":{"title":"block_me"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"block-me-plugin"},"children":[{"type":"text","value":"Block Me plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin allows you to configure an address which mail sent to will be\nparsed for a From: address in the body of the message, and will add that\nfrom address to the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"mail_from.blocklist"}]},{"type":"text","value":" config file."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Effectively this allows your users to forward spams that got through to a\nparticular mailbox to block them in the future."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Note that this is a system-wide block, and not per-user. Be careful with this."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/block_me.recipient"}]},{"type":"text","value":" - a file containing the address to email to\nget something blocked. For example: "},{"type":"element","tag":"strong","props":{},"children":[{"type":"element","tag":"a","props":{"href":"mailto:spam@domain.com"},"children":[{"type":"text","value":"spam@domain.com"}]}]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/block_me.senders"}]},{"type":"text","value":" - a file containing a list of email addresses\nthat are allowed to email the dropbox."}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"configuration","depth":2,"text":"Configuration"}]}},"_type":"markdown","_id":"content:8.plugins:block_me.md","_source":"content","_file":"8.plugins/block_me.md","_extension":"md"},{"_path":"/plugins/bounce","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"bounce - Bounce plugin for Haraka","description":"Haraka bounce plugin - Bounces mail to a specific address","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"bounce-plugin"},"children":[{"type":"text","value":"Bounce plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Provide options for bounce processing."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Each feature can be enabled/disabled with a true/false toggle in the "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"check"}]},{"type":"text","value":"\nsection of "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/bounce.ini"}]},{"type":"text","value":":"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Some features can have rejections disabled in the "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"reject"}]},{"type":"text","value":" section."}]},{"type":"element","tag":"code","props":{"code":"[check]\nreject_all=false\nsingle_recipient=true\nempty_return_path=true\nbad_rcpt=true\nbounce_spf=true\nnon_local_msgid=true\n\n[reject]\nsingle_recipient=true\nempty_return_path=true\nbounce_spf=false\nnon_local_msgid=false\n","language":"ini"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"[check]\nreject_all=false\nsingle_recipient=true\nempty_return_path=true\nbad_rcpt=true\nbounce_spf=true\nnon_local_msgid=true\n\n[reject]\nsingle_recipient=true\nempty_return_path=true\nbounce_spf=false\nnon_local_msgid=false\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"features"},"children":[{"type":"text","value":"Features"}]},{"type":"element","tag":"h3","props":{"id":"reject_all"},"children":[{"type":"text","value":"reject_all"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When enabled, blocks all bounce messages using the simple rule of checking\nfor "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"MAIL FROM:<>"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It is generally a bad idea to block all bounces. This option can be useful\nfor mail servers at domains with frequent spoofing and few or no human users."}]},{"type":"element","tag":"h3","props":{"id":"single_recipient"},"children":[{"type":"text","value":"single_recipient"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Valid bounces have a single recipient. Assure that the message really is a\nbounce by enforcing bounces to be addressed to a single recipient."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This check is skipped for relays or hosts with a private IP, this is because\nMicrosoft Exchange distribution lists will send messages to list members with\na null return-path when the 'Do not send delivery reports' option is enabled\n(yes, really...)."}]},{"type":"element","tag":"h3","props":{"id":"empty_return_path"},"children":[{"type":"text","value":"empty_return_path"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Valid bounces should have an empty return path. Test for the presence of the\nReturn-Path header in bounces and disallow."}]},{"type":"element","tag":"h3","props":{"id":"bad_rcpt"},"children":[{"type":"text","value":"bad_rcpt"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Disallow bounces to email addresses listed in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/bounce_bad_rcpt"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Include email addresses in that file that should "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"never"}]},{"type":"text","value":" receive bounce\nmessages. Examples of email addresses that should be listed are:\nautoresponders, "},{"type":"element","tag":"a","props":{"href":"mailto:do-not-reply@example.com"},"children":[{"type":"text","value":"do-not-reply@example.com"}]},{"type":"text","value":", "},{"type":"element","tag":"a","props":{"href":"mailto:dmarc-feedback@example.com"},"children":[{"type":"text","value":"dmarc-feedback@example.com"}]},{"type":"text","value":", and\nany other email addresses used solely for machine generated messages."}]},{"type":"element","tag":"h3","props":{"id":"bounce_spf"},"children":[{"type":"text","value":"bounce_spf"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Parses the message body and any MIME parts for Received: headers and\nstrips out the IP addresses of each Received hop and then checks what\nthe SPF result would have been if bounced message had been sent by that\nhop."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If no 'Pass' result is found, then this test will fail.\nIf SPF returns 'None', 'TempError' or 'PermError' then the test will\nbe skipped."}]}]},"navigation":{"title":"bounce"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"bounce-plugin"},"children":[{"type":"text","value":"Bounce plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Provide options for bounce processing."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Each feature can be enabled/disabled with a true/false toggle in the "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"check"}]},{"type":"text","value":"\nsection of "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/bounce.ini"}]},{"type":"text","value":":"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Some features can have rejections disabled in the "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"reject"}]},{"type":"text","value":" section."}]},{"type":"element","tag":"code","props":{"code":"[check]\nreject_all=false\nsingle_recipient=true\nempty_return_path=true\nbad_rcpt=true\nbounce_spf=true\nnon_local_msgid=true\n\n[reject]\nsingle_recipient=true\nempty_return_path=true\nbounce_spf=false\nnon_local_msgid=false\n","language":"ini"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7b2240"},"children":[{"type":"text","value":"[check]"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f9aef9"},"children":[{"type":"text","value":"reject_all"}]},{"type":"element","tag":"span","props":{"class":"ct-35f141"},"children":[{"type":"text","value":"=false"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f9aef9"},"children":[{"type":"text","value":"single_recipient"}]},{"type":"element","tag":"span","props":{"class":"ct-35f141"},"children":[{"type":"text","value":"=true"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f9aef9"},"children":[{"type":"text","value":"empty_return_path"}]},{"type":"element","tag":"span","props":{"class":"ct-35f141"},"children":[{"type":"text","value":"=true"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f9aef9"},"children":[{"type":"text","value":"bad_rcpt"}]},{"type":"element","tag":"span","props":{"class":"ct-35f141"},"children":[{"type":"text","value":"=true"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f9aef9"},"children":[{"type":"text","value":"bounce_spf"}]},{"type":"element","tag":"span","props":{"class":"ct-35f141"},"children":[{"type":"text","value":"=true"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f9aef9"},"children":[{"type":"text","value":"non_local_msgid"}]},{"type":"element","tag":"span","props":{"class":"ct-35f141"},"children":[{"type":"text","value":"=true"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7b2240"},"children":[{"type":"text","value":"[reject]"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f9aef9"},"children":[{"type":"text","value":"single_recipient"}]},{"type":"element","tag":"span","props":{"class":"ct-35f141"},"children":[{"type":"text","value":"=true"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f9aef9"},"children":[{"type":"text","value":"empty_return_path"}]},{"type":"element","tag":"span","props":{"class":"ct-35f141"},"children":[{"type":"text","value":"=true"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f9aef9"},"children":[{"type":"text","value":"bounce_spf"}]},{"type":"element","tag":"span","props":{"class":"ct-35f141"},"children":[{"type":"text","value":"=false"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f9aef9"},"children":[{"type":"text","value":"non_local_msgid"}]},{"type":"element","tag":"span","props":{"class":"ct-35f141"},"children":[{"type":"text","value":"=false"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"features"},"children":[{"type":"text","value":"Features"}]},{"type":"element","tag":"h3","props":{"id":"reject_all"},"children":[{"type":"text","value":"reject_all"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When enabled, blocks all bounce messages using the simple rule of checking\nfor "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"MAIL FROM:<>"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It is generally a bad idea to block all bounces. This option can be useful\nfor mail servers at domains with frequent spoofing and few or no human users."}]},{"type":"element","tag":"h3","props":{"id":"single_recipient"},"children":[{"type":"text","value":"single_recipient"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Valid bounces have a single recipient. Assure that the message really is a\nbounce by enforcing bounces to be addressed to a single recipient."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This check is skipped for relays or hosts with a private IP, this is because\nMicrosoft Exchange distribution lists will send messages to list members with\na null return-path when the 'Do not send delivery reports' option is enabled\n(yes, really...)."}]},{"type":"element","tag":"h3","props":{"id":"empty_return_path"},"children":[{"type":"text","value":"empty_return_path"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Valid bounces should have an empty return path. Test for the presence of the\nReturn-Path header in bounces and disallow."}]},{"type":"element","tag":"h3","props":{"id":"bad_rcpt"},"children":[{"type":"text","value":"bad_rcpt"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Disallow bounces to email addresses listed in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/bounce_bad_rcpt"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Include email addresses in that file that should "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"never"}]},{"type":"text","value":" receive bounce\nmessages. Examples of email addresses that should be listed are:\nautoresponders, "},{"type":"element","tag":"a","props":{"href":"mailto:do-not-reply@example.com"},"children":[{"type":"text","value":"do-not-reply@example.com"}]},{"type":"text","value":", "},{"type":"element","tag":"a","props":{"href":"mailto:dmarc-feedback@example.com"},"children":[{"type":"text","value":"dmarc-feedback@example.com"}]},{"type":"text","value":", and\nany other email addresses used solely for machine generated messages."}]},{"type":"element","tag":"h3","props":{"id":"bounce_spf"},"children":[{"type":"text","value":"bounce_spf"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Parses the message body and any MIME parts for Received: headers and\nstrips out the IP addresses of each Received hop and then checks what\nthe SPF result would have been if bounced message had been sent by that\nhop."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If no 'Pass' result is found, then this test will fail.\nIf SPF returns 'None', 'TempError' or 'PermError' then the test will\nbe skipped."}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-35f141{color:#24292F}\n.ct-f9aef9{color:#CF222E}\n.ct-7b2240{color:#953800}\n.dark .ct-7b2240{color:#FFA657}\n.dark .ct-f9aef9{color:#FF7B72}\n.dark .ct-35f141{color:#C9D1D9}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"configuration","depth":2,"text":"Configuration"},{"id":"features","depth":2,"text":"Features","children":[{"id":"reject_all","depth":3,"text":"reject_all"},{"id":"single_recipient","depth":3,"text":"single_recipient"},{"id":"empty_return_path","depth":3,"text":"empty_return_path"},{"id":"bad_rcpt","depth":3,"text":"bad_rcpt"},{"id":"bounce_spf","depth":3,"text":"bounce_spf"}]}]}},"_type":"markdown","_id":"content:8.plugins:bounce.md","_source":"content","_file":"8.plugins/bounce.md","_extension":"md"},{"_path":"/plugins/clamd","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"clamd - ClamAV plugin for Haraka","description":"Haraka clamd plugin - ClamAV anti-virus plugin","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"clamd-plugin"},"children":[{"type":"text","value":"clamd plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plug-in implements Anti-Virus scanning with ClamAV using the "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"clamd"}]},{"type":"text","value":"\ndaemon."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The plug-in will reject any message that ClamAV considers to be a virus.\nIf an error occurs (e.g. clamd not running or a timeout), the\nmessage will be deferred with a temporary failure."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The following options can be defined in clamd.ini;"}]},{"type":"element","tag":"h3","props":{"id":"clamd_socket-default-localhost3310"},"children":[{"type":"text","value":"clamd_socket (default: localhost:3310)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"N.N.N.N:port, "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"ipv6::literal"}]},{"type":"text","value":":port, host:port or /path/to/socket of\nthe clamd daemon."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Multiple hosts can be listed separated by comma, semi-colon or spaces."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If "},{"type":"element","tag":"port","props":{},"children":[]},{"type":"text","value":" is omitted it defaults to 3310."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"On connection error or timeout the next host in the list will be tried.\nWhen the host list is exhausted, the message will be deferred with\na temporary failure."}]},{"type":"element","tag":"h3","props":{"id":"randomize_host_order-default-false"},"children":[{"type":"text","value":"randomize_host_order (default: false)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If this is set then the list of hosts with be randomized before a\nconnection is attempted."}]},{"type":"element","tag":"h3","props":{"id":"only_with_attachments-default-false"},"children":[{"type":"text","value":"only_with_attachments                         (default: false)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Set this option to only scan messages that contain non-textual\nattachments.  This is a performance optimization, however it will\nprevent ClamAV from detecting threats such as Phishing in plain-text\nor HTML messages."}]},{"type":"element","tag":"h3","props":{"id":"connect_timeout-default-10"},"children":[{"type":"text","value":"connect_timeout                               (default: 10)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Timeout connection to host after this many seconds.  A timeout will\ncause the next host in the list to be tried.  Once all hosts have\nbeen tried then a temporary failure will be returned."}]},{"type":"element","tag":"h3","props":{"id":"timeout-default-30"},"children":[{"type":"text","value":"timeout                                       (default: 30)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Post-connection timeout if there is no activity on the socket after\nthis many seconds.  A timeout will cause the message to be rejected\nwith a tempoary failure."}]},{"type":"element","tag":"h3","props":{"id":"max_size-default-26214400"},"children":[{"type":"text","value":"max_size                                      (default: 26214400)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The maximum size of message that should be sent to clamd in bytes.\nThis option should not be larger than the StreamMaxLength value in\nclamd.conf as clamd will stop scanning once this limit is reached.\nIf the clamd limit is reached the plug-in will log a notice that\nthis has happened and will allow the message though."}]},{"type":"element","tag":"h3","props":{"id":"reject"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"reject"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"An optional reject section can offer control over when to reject connections.\nThe default settings are shown. ClamAV recommends that hits coming from\nSafeBrowsing / Phishing / Heuristics, Potentially Unwanted Applications, and\nUNOFFICIAL be used only for scoring."}]},{"type":"element","tag":"code","props":{"code":"* virus=true\n* error=true\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"* virus=true\n* error=true\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The following reject options are disabled by default in clamd.conf. With a\ndefault ClamAV install, these will have no effect. When an admin enables in\nclamd.conf, Haraka with then, by default, reject such messages. Adjust these\nsettings to suit."}]},{"type":"element","tag":"code","props":{"code":"* Broken.Executable=true\n* Structured=true\n* Encrypted=true\n* PUA=true\n* OLE2=true\n* Safebrowsing=true\n* UNOFFICIAL=true\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"* Broken.Executable=true\n* Structured=true\n* Encrypted=true\n* PUA=true\n* OLE2=true\n* Safebrowsing=true\n* UNOFFICIAL=true\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The following options are enabled by default in clamd but ClamAV suggests\nusing them only for scoring."}]},{"type":"element","tag":"code","props":{"code":"* Phishing=false\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"* Phishing=false\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"check"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"check"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The optional check section can allow skipping ClamAV check for remote connection\nmeeting following criteria."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"authenticated"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: true"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If true, messages from authenticated users will be scanned."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"private_ip"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: true"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If true, messages from private IPs will be scanned."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"local_ip"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: true"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If true, messages from localhost will be scanned."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"relay"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: true"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If true, messages that are to be relayed will be scanned."}]}]},{"type":"element","tag":"h2","props":{"id":"clamdexcludes"},"children":[{"type":"text","value":"clamd.excludes"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This file can contain a list of virus name patterns that when matched, are\nnot rejected by this plugin. An X-Haraka-Virus: header will be inserted\ncontaining the virus name. This header can then be used for scoring\nin other plugins."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The format of the file is one pattern per line. Comments are prefixed\nwith #. Matches are case-insensitive."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Patterns are expressed using wildcards (e.g. * and ?) or\nvia regexp by enclosing the pattern in //."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To negate a match (e.g. reject if it matches), prefix the match with !.\nNegative matches are always tested fist."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Example:"}]},{"type":"element","tag":"code","props":{"code":"# Always reject test signatures\n!*.TestSig_*\n# Skip all unofficial signatures\n*.UNOFFICIAL\n# Phishing\nHeuristics.Phishing.*\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"# Always reject test signatures\n!*.TestSig_*\n# Skip all unofficial signatures\n*.UNOFFICIAL\n# Phishing\nHeuristics.Phishing.*\n"}]}]}]}]},"navigation":{"title":"clamd"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"clamd-plugin"},"children":[{"type":"text","value":"clamd plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plug-in implements Anti-Virus scanning with ClamAV using the "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"clamd"}]},{"type":"text","value":"\ndaemon."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The plug-in will reject any message that ClamAV considers to be a virus.\nIf an error occurs (e.g. clamd not running or a timeout), the\nmessage will be deferred with a temporary failure."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The following options can be defined in clamd.ini;"}]},{"type":"element","tag":"h3","props":{"id":"clamd_socket-default-localhost3310"},"children":[{"type":"text","value":"clamd_socket (default: localhost:3310)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"N.N.N.N:port, "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"ipv6::literal"}]},{"type":"text","value":":port, host:port or /path/to/socket of\nthe clamd daemon."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Multiple hosts can be listed separated by comma, semi-colon or spaces."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If "},{"type":"element","tag":"port","props":{},"children":[]},{"type":"text","value":" is omitted it defaults to 3310."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"On connection error or timeout the next host in the list will be tried.\nWhen the host list is exhausted, the message will be deferred with\na temporary failure."}]},{"type":"element","tag":"h3","props":{"id":"randomize_host_order-default-false"},"children":[{"type":"text","value":"randomize_host_order (default: false)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If this is set then the list of hosts with be randomized before a\nconnection is attempted."}]},{"type":"element","tag":"h3","props":{"id":"only_with_attachments-default-false"},"children":[{"type":"text","value":"only_with_attachments                         (default: false)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Set this option to only scan messages that contain non-textual\nattachments.  This is a performance optimization, however it will\nprevent ClamAV from detecting threats such as Phishing in plain-text\nor HTML messages."}]},{"type":"element","tag":"h3","props":{"id":"connect_timeout-default-10"},"children":[{"type":"text","value":"connect_timeout                               (default: 10)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Timeout connection to host after this many seconds.  A timeout will\ncause the next host in the list to be tried.  Once all hosts have\nbeen tried then a temporary failure will be returned."}]},{"type":"element","tag":"h3","props":{"id":"timeout-default-30"},"children":[{"type":"text","value":"timeout                                       (default: 30)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Post-connection timeout if there is no activity on the socket after\nthis many seconds.  A timeout will cause the message to be rejected\nwith a tempoary failure."}]},{"type":"element","tag":"h3","props":{"id":"max_size-default-26214400"},"children":[{"type":"text","value":"max_size                                      (default: 26214400)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The maximum size of message that should be sent to clamd in bytes.\nThis option should not be larger than the StreamMaxLength value in\nclamd.conf as clamd will stop scanning once this limit is reached.\nIf the clamd limit is reached the plug-in will log a notice that\nthis has happened and will allow the message though."}]},{"type":"element","tag":"h3","props":{"id":"reject"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"reject"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"An optional reject section can offer control over when to reject connections.\nThe default settings are shown. ClamAV recommends that hits coming from\nSafeBrowsing / Phishing / Heuristics, Potentially Unwanted Applications, and\nUNOFFICIAL be used only for scoring."}]},{"type":"element","tag":"code","props":{"code":"* virus=true\n* error=true\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"* virus=true\n* error=true"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The following reject options are disabled by default in clamd.conf. With a\ndefault ClamAV install, these will have no effect. When an admin enables in\nclamd.conf, Haraka with then, by default, reject such messages. Adjust these\nsettings to suit."}]},{"type":"element","tag":"code","props":{"code":"* Broken.Executable=true\n* Structured=true\n* Encrypted=true\n* PUA=true\n* OLE2=true\n* Safebrowsing=true\n* UNOFFICIAL=true\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"* Broken.Executable=true\n* Structured=true\n* Encrypted=true\n* PUA=true\n* OLE2=true\n* Safebrowsing=true\n* UNOFFICIAL=true"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The following options are enabled by default in clamd but ClamAV suggests\nusing them only for scoring."}]},{"type":"element","tag":"code","props":{"code":"* Phishing=false\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"* Phishing=false"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"check"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"check"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The optional check section can allow skipping ClamAV check for remote connection\nmeeting following criteria."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"authenticated"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: true"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If true, messages from authenticated users will be scanned."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"private_ip"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: true"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If true, messages from private IPs will be scanned."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"local_ip"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: true"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If true, messages from localhost will be scanned."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"relay"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: true"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If true, messages that are to be relayed will be scanned."}]}]},{"type":"element","tag":"h2","props":{"id":"clamdexcludes"},"children":[{"type":"text","value":"clamd.excludes"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This file can contain a list of virus name patterns that when matched, are\nnot rejected by this plugin. An X-Haraka-Virus: header will be inserted\ncontaining the virus name. This header can then be used for scoring\nin other plugins."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The format of the file is one pattern per line. Comments are prefixed\nwith #. Matches are case-insensitive."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Patterns are expressed using wildcards (e.g. * and ?) or\nvia regexp by enclosing the pattern in //."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To negate a match (e.g. reject if it matches), prefix the match with !.\nNegative matches are always tested fist."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Example:"}]},{"type":"element","tag":"code","props":{"code":"# Always reject test signatures\n!*.TestSig_*\n# Skip all unofficial signatures\n*.UNOFFICIAL\n# Phishing\nHeuristics.Phishing.*\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"# Always reject test signatures\n!*.TestSig_*\n# Skip all unofficial signatures\n*.UNOFFICIAL\n# Phishing\nHeuristics.Phishing.*"}]}]}]}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"configuration","depth":2,"text":"Configuration","children":[{"id":"clamd_socket-default-localhost3310","depth":3,"text":"clamd_socket (default: localhost:3310)"},{"id":"randomize_host_order-default-false","depth":3,"text":"randomize_host_order (default: false)"},{"id":"only_with_attachments-default-false","depth":3,"text":"only_with_attachments                         (default: false)"},{"id":"connect_timeout-default-10","depth":3,"text":"connect_timeout                               (default: 10)"},{"id":"timeout-default-30","depth":3,"text":"timeout                                       (default: 30)"},{"id":"max_size-default-26214400","depth":3,"text":"max_size                                      (default: 26214400)"},{"id":"reject","depth":3,"text":"reject"}]},{"id":"check","depth":2,"text":"check"},{"id":"clamdexcludes","depth":2,"text":"clamd.excludes"}]}},"_type":"markdown","_id":"content:8.plugins:clamd.md","_source":"content","_file":"8.plugins/clamd.md","_extension":"md"},{"_path":"/plugins/connect.asn","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"connect.asn - get AS number of remote IP address plugin for Haraka","description":"Haraka connect.asn plugin - get AS number of remote","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"connectasn-plugin"},"children":[{"type":"text","value":"connect.asn plugin"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Use DNS queries to look up the ASN of the remote IP."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Inserts a result object with the ASN of the remote host."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The AS Number is the "},{"type":"element","tag":"a","props":{"href":"http://en.wikipedia.org/wiki/Autonomous_System_(Internet)","rel":["nofollow"]},"children":[{"type":"text","value":"Autonomous System Number"}]},{"type":"text","value":"\nthat represents the bailiwick or sphere of control of a network operator."}]},{"type":"element","tag":"h2","props":{"id":"faster-lookups"},"children":[{"type":"text","value":"Faster Lookups"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If your mail server is very busy:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Download the "},{"type":"element","tag":"a","props":{"href":"ftp://ftp.routeviews.org/dnszones/"},"children":[{"type":"text","value":"routeviews ASN zones"}]},{"type":"text","value":" and serve them on a local DNS server. If you use SpamAssassin, this is highly recommended as it looks up ASN using routeviews via DNS."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Use instead the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"connect.geoip"}]},{"type":"text","value":" plugin with the MaxMind backend. It caches the ASN database locally and gets the ASN without network traffic and delays."}]}]},{"type":"element","tag":"h2","props":{"id":"usage"},"children":[{"type":"text","value":"Usage"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The AS number can be accessed by plugins that run after "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"connect.asn"}]},{"type":"text","value":" like so:"}]},{"type":"element","tag":"code","props":{"code":"var asn = connection.results.get('connect.asn');\nif (asn && asn.asn) {\n    connection.loginfo(plugin, \"hey look, it's ASN: \" + asn.asn);\n}\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"var asn = connection.results.get('connect.asn');\nif (asn && asn.asn) {\n    connection.loginfo(plugin, \"hey look, it's ASN: \" + asn.asn);\n}\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The following settings can be set in config/connect.asn.ini."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"providers: comma separated list of DNS zones that provide IP to ASN lookups"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"origin.asn.cymru.com"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"origin.asn.spameatingmonkey.net"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"asn.routeviews.org"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"test_ip: (Default:"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"An IP address that maps to an ASN (any valid public IP should work)"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"timeout (in seconds): (Default: 4)"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"How long to wait for DNS results to return."}]},{"type":"element","tag":"h2","props":{"id":"headers"},"children":[{"type":"text","value":"Headers"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Optionally add headers to messages with ASN info."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"asn_header (Default: false)"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"add X-Haraka-ASN header with the ASN and if available, netmask."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"provider_header (Default: false)"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Add X-Haraka-ASN-"},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"provider"}]},{"type":"text","value":" header for each provider that returned results."}]},{"type":"element","tag":"h2","props":{"id":"theory"},"children":[{"type":"text","value":"Theory"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"An ASN is a very good approximation of the IP space under the control\nof a network operator. The theory behind ASN tracking is that good network\noperators police their networks, proactively limit abuse, and are less likely\nto be emitting abuse."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Not-so-good network operators are likely to emit a greater number of abusive\nconnections, and should be handled with increased scrutiny."}]},{"type":"element","tag":"h2","props":{"id":"research"},"children":[{"type":"text","value":"Research"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://www.cc.gatech.edu/~feamster/papers/snare-usenix09.pdf","rel":["nofollow"]},"children":[{"type":"text","value":"http://www.cc.gatech.edu/~feamster/papers/snare-usenix09.pdf"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"\"Performance based on AS number only...The classifier gets a false positive\nrate of 0.76% "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"and"}]},{"type":"text","value":" a 70% detection rate\""}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"\"AS numbers are more persistently associated with a sender's\nidentity than the IP address, for two reasons: (1) The spamming mail server\nmight be set up within specific ASes without the network administrator\nshutting it down. (2) Bots tend to aggregate within ASes, since the machines\nin the same ASes are likely to have the same vulnerability. It is not easy for\nspammers to move mail servers or the bot armies to a different AS; therefore,\nAS numbers are robust to indicate malicious hosts.\""}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"See also: "},{"type":"element","tag":"a","props":{"href":"http://www.bgpmon.net/using-bgp-data-to-find-spammers/","rel":["nofollow"]},"children":[{"type":"text","value":"Using BGP data to find spammers"}]}]},{"type":"element","tag":"h2","props":{"id":"consumers"},"children":[{"type":"text","value":"Consumers"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"a","props":{"href":"/plugins/karma"},"children":[{"type":"text","value":"karma"}]},{"type":"text","value":" plugin uses the ASN to maintain\nits network neighborhood reputation."}]}]},"navigation":{"title":"connect.asn"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"connectasn-plugin"},"children":[{"type":"text","value":"connect.asn plugin"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Use DNS queries to look up the ASN of the remote IP."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Inserts a result object with the ASN of the remote host."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The AS Number is the "},{"type":"element","tag":"a","props":{"href":"http://en.wikipedia.org/wiki/Autonomous_System_(Internet)","rel":["nofollow"]},"children":[{"type":"text","value":"Autonomous System Number"}]},{"type":"text","value":"\nthat represents the bailiwick or sphere of control of a network operator."}]},{"type":"element","tag":"h2","props":{"id":"faster-lookups"},"children":[{"type":"text","value":"Faster Lookups"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If your mail server is very busy:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Download the "},{"type":"element","tag":"a","props":{"href":"ftp://ftp.routeviews.org/dnszones/"},"children":[{"type":"text","value":"routeviews ASN zones"}]},{"type":"text","value":" and serve them on a local DNS server. If you use SpamAssassin, this is highly recommended as it looks up ASN using routeviews via DNS."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Use instead the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"connect.geoip"}]},{"type":"text","value":" plugin with the MaxMind backend. It caches the ASN database locally and gets the ASN without network traffic and delays."}]}]},{"type":"element","tag":"h2","props":{"id":"usage"},"children":[{"type":"text","value":"Usage"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The AS number can be accessed by plugins that run after "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"connect.asn"}]},{"type":"text","value":" like so:"}]},{"type":"element","tag":"code","props":{"code":"var asn = connection.results.get('connect.asn');\nif (asn && asn.asn) {\n    connection.loginfo(plugin, \"hey look, it's ASN: \" + asn.asn);\n}\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"var asn = connection.results.get('connect.asn');\nif (asn && asn.asn) {\n    connection.loginfo(plugin, \"hey look, it's ASN: \" + asn.asn);\n}"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The following settings can be set in config/connect.asn.ini."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"providers: comma separated list of DNS zones that provide IP to ASN lookups"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"origin.asn.cymru.com"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"origin.asn.spameatingmonkey.net"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"asn.routeviews.org"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"test_ip: (Default:"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"An IP address that maps to an ASN (any valid public IP should work)"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"timeout (in seconds): (Default: 4)"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"How long to wait for DNS results to return."}]},{"type":"element","tag":"h2","props":{"id":"headers"},"children":[{"type":"text","value":"Headers"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Optionally add headers to messages with ASN info."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"asn_header (Default: false)"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"add X-Haraka-ASN header with the ASN and if available, netmask."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"provider_header (Default: false)"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Add X-Haraka-ASN-"},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"provider"}]},{"type":"text","value":" header for each provider that returned results."}]},{"type":"element","tag":"h2","props":{"id":"theory"},"children":[{"type":"text","value":"Theory"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"An ASN is a very good approximation of the IP space under the control\nof a network operator. The theory behind ASN tracking is that good network\noperators police their networks, proactively limit abuse, and are less likely\nto be emitting abuse."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Not-so-good network operators are likely to emit a greater number of abusive\nconnections, and should be handled with increased scrutiny."}]},{"type":"element","tag":"h2","props":{"id":"research"},"children":[{"type":"text","value":"Research"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://www.cc.gatech.edu/~feamster/papers/snare-usenix09.pdf","rel":["nofollow"]},"children":[{"type":"text","value":"http://www.cc.gatech.edu/~feamster/papers/snare-usenix09.pdf"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"\"Performance based on AS number only...The classifier gets a false positive\nrate of 0.76% "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"and"}]},{"type":"text","value":" a 70% detection rate\""}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"\"AS numbers are more persistently associated with a sender's\nidentity than the IP address, for two reasons: (1) The spamming mail server\nmight be set up within specific ASes without the network administrator\nshutting it down. (2) Bots tend to aggregate within ASes, since the machines\nin the same ASes are likely to have the same vulnerability. It is not easy for\nspammers to move mail servers or the bot armies to a different AS; therefore,\nAS numbers are robust to indicate malicious hosts.\""}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"See also: "},{"type":"element","tag":"a","props":{"href":"http://www.bgpmon.net/using-bgp-data-to-find-spammers/","rel":["nofollow"]},"children":[{"type":"text","value":"Using BGP data to find spammers"}]}]},{"type":"element","tag":"h2","props":{"id":"consumers"},"children":[{"type":"text","value":"Consumers"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"a","props":{"href":"/plugins/karma"},"children":[{"type":"text","value":"karma"}]},{"type":"text","value":" plugin uses the ASN to maintain\nits network neighborhood reputation."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"faster-lookups","depth":2,"text":"Faster Lookups"},{"id":"usage","depth":2,"text":"Usage"},{"id":"configuration","depth":2,"text":"Configuration"},{"id":"headers","depth":2,"text":"Headers"},{"id":"theory","depth":2,"text":"Theory"},{"id":"research","depth":2,"text":"Research"},{"id":"consumers","depth":2,"text":"Consumers"}]}},"_type":"markdown","_id":"content:8.plugins:connect.asn.md","_source":"content","_file":"8.plugins/connect.asn.md","_extension":"md"},{"_path":"/plugins/connect.fcrdns","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"connect.fcrdns - Forward Confirmed Reverse DNS plugin for Haraka","description":"Haraka connect.fcrdns plugin - Forward Confirmed Reverse DNS","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"connectfcrdns-plugin"},"children":[{"type":"text","value":"connect.fcrdns plugin"}]},{"type":"element","tag":"h2","props":{"id":"description"},"children":[{"type":"text","value":"DESCRIPTION"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Determine if the SMTP sender has matching forward and reverse DNS."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"See "},{"type":"element","tag":"a","props":{"href":"http://en.wikipedia.org/wiki/FCrDNS","rel":["nofollow"]},"children":[{"type":"text","value":"FCrDNS at wikipedia"}]}]},{"type":"element","tag":"h2","props":{"id":"usage"},"children":[{"type":"text","value":"USAGE"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Other plugins can use FCrDNS results like this:"}]},{"type":"element","tag":"code","props":{"code":"var fcrdns = connection.results.get('connect.fcrdns');\nif (fcrdns) {\n    if (fcrdns.fcrdns) {\n        // they passed, reward them\n    }\n\n    var fails = fcrdns.fail;\n    if (connection.results.has('connect.fcrdns', 'fail', /^is_generic/) {\n        // their IP is in their hostname, unlikely to be MX, penalize\n    }\n}\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"var fcrdns = connection.results.get('connect.fcrdns');\nif (fcrdns) {\n    if (fcrdns.fcrdns) {\n        // they passed, reward them\n    }\n\n    var fails = fcrdns.fail;\n    if (connection.results.has('connect.fcrdns', 'fail', /^is_generic/) {\n        // their IP is in their hostname, unlikely to be MX, penalize\n    }\n}\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"CONFIGURATION"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Edit config/connect.fcrdns.ini"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin honors the whitelisting of IPs as set by the rdns_access plugin.\nFor that to work, rdns_access needs to be listed "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"before"}]},{"type":"text","value":" this plugin in\nconfig/plugins."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"timeout=30"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When performing DNS lookups, time out after this many seconds."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The following settings permit control of which test will block connections. To\nmimic the lookup_rdns.strict plugin, set no_rdns=true."}]},{"type":"element","tag":"code","props":{"code":"[reject]\n; reject if the IP address has no PTR record\nno_rdns=false\n\n; reject if the FCrDNS test fails\nno_fcrdns=false\n\n; reject if the PTR points to a hostname without a valid TLD\ninvalid_tld=false\n\n; reject if the rDNS is generic, examples:\n; 1.2.3.4.in.addr.arpa\n; c-67-171-0-90.hsd1.wa.comcast.net\ngeneric_rdns=false\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"[reject]\n; reject if the IP address has no PTR record\nno_rdns=false\n\n; reject if the FCrDNS test fails\nno_fcrdns=false\n\n; reject if the PTR points to a hostname without a valid TLD\ninvalid_tld=false\n\n; reject if the rDNS is generic, examples:\n; 1.2.3.4.in.addr.arpa\n; c-67-171-0-90.hsd1.wa.comcast.net\ngeneric_rdns=false\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"anti-spam-effects"},"children":[{"type":"text","value":"ANTI-SPAM EFFECTS"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The reverse DNS of zombie PCs in bot nets is out of the bot operators control.\nThis presents a significant hurdle for a large portion of the hosts that\nattempt spam delivery."}]},{"type":"element","tag":"h2","props":{"id":"how-it-works"},"children":[{"type":"text","value":"HOW IT WORKS"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"From Wikipedia: "},{"type":"element","tag":"a","props":{"href":"http://en.wikipedia.org/wiki/FCrDNS","rel":["nofollow"]},"children":[{"type":"text","value":"Forward Confirmed Reverse DNS"}]}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"First a reverse DNS lookup (PTR query) is performed on the IP address,\nwhich returns a list of zero or more PTR records."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"For each domain name returned in the PTR query results, a regular\n'forward' DNS lookup (type A or AAAA query) is then performed."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Any A or AAAA records returned by the second query are then compared\nagainst the original IP address. If there is a match, FCrDNS passes."}]}]},{"type":"element","tag":"h2","props":{"id":"iprev"},"children":[{"type":"text","value":"iprev"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The iprev results are added to the Authentication-Results header."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://www.ietf.org/rfc/rfc1912.txt","rel":["nofollow"]},"children":[{"type":"text","value":"RFC 1912"}]},{"type":"element","tag":"a","props":{"href":"http://www.ietf.org/rfc/rfc5451.txt","rel":["nofollow"]},"children":[{"type":"text","value":"RFC 5451"}]},{"type":"element","tag":"a","props":{"href":"http://tools.ietf.org/html/rfc7001#section-3","rel":["nofollow"]},"children":[{"type":"text","value":"RFC 7001"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"2.6.3.  \"iprev\" Results"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"pass:  The DNS evaluation succeeded, i.e., the \"reverse\" and\n\"forward\" lookup results were returned and were in agreement."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"fail:  The DNS evaluation failed.  In particular, the \"reverse\" and\n\"forward\" lookups each produced results, but they were not in\nagreement, or the \"forward\" query completed but produced no\nresult, e.g., a DNS RCODE of 3, commonly known as NXDOMAIN, or an\nRCODE of 0 (NOERROR) in a reply containing no answers, was\nreturned."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"temperror:  The DNS evaluation could not be completed due to some\nerror that is likely transient in nature, such as a temporary DNS\nerror, e.g., a DNS RCODE of 2, commonly known as SERVFAIL, or\nother error condition resulted.  A later attempt may produce a\nfinal result."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"permerror:  The DNS evaluation could not be completed because no PTR\ndata are published for the connecting IP address, e.g., a DNS\nRCODE of 3, commonly known as NXDOMAIN, or an RCODE of 0 (NOERROR)\nin a reply containing no answers, was returned.  This prevented\ncompletion of the evaluation.  A later attempt is unlikely to\nproduce a final result."}]}]},"navigation":{"title":"connect.fcrdns"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"connectfcrdns-plugin"},"children":[{"type":"text","value":"connect.fcrdns plugin"}]},{"type":"element","tag":"h2","props":{"id":"description"},"children":[{"type":"text","value":"DESCRIPTION"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Determine if the SMTP sender has matching forward and reverse DNS."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"See "},{"type":"element","tag":"a","props":{"href":"http://en.wikipedia.org/wiki/FCrDNS","rel":["nofollow"]},"children":[{"type":"text","value":"FCrDNS at wikipedia"}]}]},{"type":"element","tag":"h2","props":{"id":"usage"},"children":[{"type":"text","value":"USAGE"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Other plugins can use FCrDNS results like this:"}]},{"type":"element","tag":"code","props":{"code":"var fcrdns = connection.results.get('connect.fcrdns');\nif (fcrdns) {\n    if (fcrdns.fcrdns) {\n        // they passed, reward them\n    }\n\n    var fails = fcrdns.fail;\n    if (connection.results.has('connect.fcrdns', 'fail', /^is_generic/) {\n        // their IP is in their hostname, unlikely to be MX, penalize\n    }\n}\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"var fcrdns = connection.results.get('connect.fcrdns');\nif (fcrdns) {\n    if (fcrdns.fcrdns) {\n        // they passed, reward them\n    }\n\n    var fails = fcrdns.fail;\n    if (connection.results.has('connect.fcrdns', 'fail', /^is_generic/) {\n        // their IP is in their hostname, unlikely to be MX, penalize\n    }\n}"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"CONFIGURATION"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Edit config/connect.fcrdns.ini"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin honors the whitelisting of IPs as set by the rdns_access plugin.\nFor that to work, rdns_access needs to be listed "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"before"}]},{"type":"text","value":" this plugin in\nconfig/plugins."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"timeout=30"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When performing DNS lookups, time out after this many seconds."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The following settings permit control of which test will block connections. To\nmimic the lookup_rdns.strict plugin, set no_rdns=true."}]},{"type":"element","tag":"code","props":{"code":"[reject]\n; reject if the IP address has no PTR record\nno_rdns=false\n\n; reject if the FCrDNS test fails\nno_fcrdns=false\n\n; reject if the PTR points to a hostname without a valid TLD\ninvalid_tld=false\n\n; reject if the rDNS is generic, examples:\n; 1.2.3.4.in.addr.arpa\n; c-67-171-0-90.hsd1.wa.comcast.net\ngeneric_rdns=false\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"[reject]\n; reject if the IP address has no PTR record\nno_rdns=false\n\n; reject if the FCrDNS test fails\nno_fcrdns=false\n\n; reject if the PTR points to a hostname without a valid TLD\ninvalid_tld=false\n\n; reject if the rDNS is generic, examples:\n; 1.2.3.4.in.addr.arpa\n; c-67-171-0-90.hsd1.wa.comcast.net\ngeneric_rdns=false"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"anti-spam-effects"},"children":[{"type":"text","value":"ANTI-SPAM EFFECTS"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The reverse DNS of zombie PCs in bot nets is out of the bot operators control.\nThis presents a significant hurdle for a large portion of the hosts that\nattempt spam delivery."}]},{"type":"element","tag":"h2","props":{"id":"how-it-works"},"children":[{"type":"text","value":"HOW IT WORKS"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"From Wikipedia: "},{"type":"element","tag":"a","props":{"href":"http://en.wikipedia.org/wiki/FCrDNS","rel":["nofollow"]},"children":[{"type":"text","value":"Forward Confirmed Reverse DNS"}]}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"First a reverse DNS lookup (PTR query) is performed on the IP address,\nwhich returns a list of zero or more PTR records."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"For each domain name returned in the PTR query results, a regular\n'forward' DNS lookup (type A or AAAA query) is then performed."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Any A or AAAA records returned by the second query are then compared\nagainst the original IP address. If there is a match, FCrDNS passes."}]}]},{"type":"element","tag":"h2","props":{"id":"iprev"},"children":[{"type":"text","value":"iprev"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The iprev results are added to the Authentication-Results header."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://www.ietf.org/rfc/rfc1912.txt","rel":["nofollow"]},"children":[{"type":"text","value":"RFC 1912"}]},{"type":"element","tag":"a","props":{"href":"http://www.ietf.org/rfc/rfc5451.txt","rel":["nofollow"]},"children":[{"type":"text","value":"RFC 5451"}]},{"type":"element","tag":"a","props":{"href":"http://tools.ietf.org/html/rfc7001#section-3","rel":["nofollow"]},"children":[{"type":"text","value":"RFC 7001"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"2.6.3.  \"iprev\" Results"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"pass:  The DNS evaluation succeeded, i.e., the \"reverse\" and\n\"forward\" lookup results were returned and were in agreement."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"fail:  The DNS evaluation failed.  In particular, the \"reverse\" and\n\"forward\" lookups each produced results, but they were not in\nagreement, or the \"forward\" query completed but produced no\nresult, e.g., a DNS RCODE of 3, commonly known as NXDOMAIN, or an\nRCODE of 0 (NOERROR) in a reply containing no answers, was\nreturned."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"temperror:  The DNS evaluation could not be completed due to some\nerror that is likely transient in nature, such as a temporary DNS\nerror, e.g., a DNS RCODE of 2, commonly known as SERVFAIL, or\nother error condition resulted.  A later attempt may produce a\nfinal result."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"permerror:  The DNS evaluation could not be completed because no PTR\ndata are published for the connecting IP address, e.g., a DNS\nRCODE of 3, commonly known as NXDOMAIN, or an RCODE of 0 (NOERROR)\nin a reply containing no answers, was returned.  This prevented\ncompletion of the evaluation.  A later attempt is unlikely to\nproduce a final result."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"description","depth":2,"text":"DESCRIPTION"},{"id":"usage","depth":2,"text":"USAGE"},{"id":"configuration","depth":2,"text":"CONFIGURATION"},{"id":"anti-spam-effects","depth":2,"text":"ANTI-SPAM EFFECTS"},{"id":"how-it-works","depth":2,"text":"HOW IT WORKS"},{"id":"iprev","depth":2,"text":"iprev"}]}},"_type":"markdown","_id":"content:8.plugins:connect.fcrdns.md","_source":"content","_file":"8.plugins/connect.fcrdns.md","_extension":"md"},{"_path":"/plugins/connect.geoip","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"geoip - GeoIP lookup","description":"Haraka geoip plugin - GeoIP lookup","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"geoip-plugin"},"children":[{"type":"text","value":"geoip plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"provide geographic information about mail senders."}]},{"type":"element","tag":"h1","props":{"id":"synopsis"},"children":[{"type":"text","value":"SYNOPSIS"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Use MaxMind's GeoIP databases to report geographic information about senders. This plugin has support for both the "},{"type":"element","tag":"a","props":{"href":"https://github.com/runk/node-maxmind","rel":["nofollow"]},"children":[{"type":"text","value":"maxmind"}]},{"type":"text","value":" and "},{"type":"element","tag":"a","props":{"href":"https://github.com/bluesmoon/node-geoip","rel":["nofollow"]},"children":[{"type":"text","value":"geoip-lite"}]},{"type":"text","value":" node modules."}]},{"type":"element","tag":"h1","props":{"id":"install"},"children":[{"type":"text","value":"INSTALL"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Install the npm geoip module you prefer:"}]},{"type":"element","tag":"code","props":{"code":"npm install maxmind\n  or\nnpm install -g geoip-lite\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"npm install maxmind\n  or\nnpm install -g geoip-lite\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If both are installed, maxmind will be preferred as it's faster and also provides ASN data. The maxmind module requires manual download of the GeoIP databases. The npm module "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"maxmind-geolite-mirror"}]},{"type":"text","value":" will download the files and keep them up-to-date if you run it periodically."}]},{"type":"element","tag":"code","props":{"code":"mkdir -p /usr/local/share/GeoIP\nnpm install -g maxmind-geolite-mirror\n/usr/local/bin/maxmind-geolite-mirror\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"mkdir -p /usr/local/share/GeoIP\nnpm install -g maxmind-geolite-mirror\n/usr/local/bin/maxmind-geolite-mirror\n"}]}]}]},{"type":"element","tag":"h1","props":{"id":"description"},"children":[{"type":"text","value":"DESCRIPTION"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"GeoIP results are stored in connection.notes.geoip and connection."},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/Results.md","rel":["nofollow"]},"children":[{"type":"text","value":"results"}]},{"type":"text","value":" .connect.geoip. The following information is typically available:"}]},{"type":"element","tag":"code","props":{"code":"continent: NA,\ncountry:   US,\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"continent: NA,\ncountry:   US,\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If the GeoIP city database is available, the following may also be available:"}]},{"type":"element","tag":"code","props":{"code":"region:   CA,\ncity:     San Francisco,\nll:       [37.7484, -122.4156],\ndistance: 1539    // in kilometers\nrange:    [ 3479299040, 3479299071 ],\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"region:   CA,\ncity:     San Francisco,\nll:       [37.7484, -122.4156],\ndistance: 1539    // in kilometers\nrange:    [ 3479299040, 3479299071 ],\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"connect.geoip"}]},{"type":"text","value":" also adds entries like this to your logs:"}]},{"type":"element","tag":"code","props":{"code":"[connect.geoip] US\n[connect.geoip] US, WA\n[connect.geoip] US, WA, Seattle\n[connect.geoip] US, WA, Seattle, 1319km\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"[connect.geoip] US\n[connect.geoip] US, WA\n[connect.geoip] US, WA, Seattle\n[connect.geoip] US, WA, Seattle, 1319km\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Calculating the distance requires the public IP of this mail server. This may\nbe the IP that Haraka is bound to. If not, make sure that "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"utils.get_public_ip"}]},{"type":"text","value":"\ncan figure it out (via STUN or in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"smtp.ini"}]},{"type":"text","value":")."}]},{"type":"element","tag":"h1","props":{"id":"config"},"children":[{"type":"text","value":"CONFIG"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"distance"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Perform the geodesic distance calculations. Calculates the distance \"as the\ncrow flies\" from the remote mail server."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This calculation requires a 'from' IP address. This will typically be the\npublic IP of your mail server. If Haraka is bound to a private IP, net_utils\nwill attempt to determine your public IP. If that doesn't work, edit\nconfig/smtp.ini and set "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"public_ip"}]},{"type":"text","value":"."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"show_city"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"show city data in logs and headers. City data is less accurate than country."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"show_region in logs and headers. Regional data are US states, Canadian\nprovinces and such."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Set a connection result to true if the distance exceeds this many kilometers."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"too_far=4000"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"asn"}]},{"type":"text","value":"report_as"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Permits reporting the ASN as another plugin (such as connect.asn)."}]},{"type":"element","tag":"h1","props":{"id":"spam-prediction-with-distance"},"children":[{"type":"text","value":"SPAM PREDICTION WITH DISTANCE"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://www.cc.gatech.edu/~feamster/papers/snare-usenix09.pdf","rel":["nofollow"]},"children":[{"type":"text","value":"Spatio-temporal Network-level Automatic Reputation Engine"}]}]},{"type":"element","tag":"code","props":{"code":"\"For ham, 90% of the messages travel about 4,000 km or less. On the\nother hand, for spam, only 28% of messages stay within this range.\"\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"\"For ham, 90% of the messages travel about 4,000 km or less. On the\nother hand, for spam, only 28% of messages stay within this range.\"\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Observations in 2014 suggest that geodesic distance continues to be an\nexcellent predictor of spam."}]},{"type":"element","tag":"h1","props":{"id":"limitations"},"children":[{"type":"text","value":"LIMITATIONS"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The distance calculations are more concerned with being fast than\naccurate. The MaxMind location data is collected from whois and is of\nlimited accuracy. MaxMind offers more accurate data for a fee."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For distance calculations, the earth is considered a perfect sphere. In\nreality, it is not. Accuracy should be within 1%."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin does not update the GeoIP databases. You may want to."}]},{"type":"element","tag":"h1","props":{"id":"see-also"},"children":[{"type":"text","value":"SEE ALSO"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"MaxMind: "},{"type":"element","tag":"a","props":{"href":"http://www.maxmind.com/","rel":["nofollow"]},"children":[{"type":"text","value":"http://www.maxmind.com/"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Databases: "},{"type":"element","tag":"a","props":{"href":"http://geolite.maxmind.com/download/geoip/database","rel":["nofollow"]},"children":[{"type":"text","value":"http://geolite.maxmind.com/download/geoip/database"}]}]},{"type":"element","tag":"h1","props":{"id":"todo"},"children":[{"type":"text","value":"TODO"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Keep an eye on node-geoip and see if they add ASN support. This would be an\nalternative to connect.asn which uses a DNS lookup to retrieve the ASN."}]}]},"navigation":{"title":"geoip"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"geoip-plugin"},"children":[{"type":"text","value":"geoip plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"provide geographic information about mail senders."}]},{"type":"element","tag":"h1","props":{"id":"synopsis"},"children":[{"type":"text","value":"SYNOPSIS"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Use MaxMind's GeoIP databases to report geographic information about senders. This plugin has support for both the "},{"type":"element","tag":"a","props":{"href":"https://github.com/runk/node-maxmind","rel":["nofollow"]},"children":[{"type":"text","value":"maxmind"}]},{"type":"text","value":" and "},{"type":"element","tag":"a","props":{"href":"https://github.com/bluesmoon/node-geoip","rel":["nofollow"]},"children":[{"type":"text","value":"geoip-lite"}]},{"type":"text","value":" node modules."}]},{"type":"element","tag":"h1","props":{"id":"install"},"children":[{"type":"text","value":"INSTALL"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Install the npm geoip module you prefer:"}]},{"type":"element","tag":"code","props":{"code":"npm install maxmind\n  or\nnpm install -g geoip-lite\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"npm install maxmind\n  or\nnpm install -g geoip-lite"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If both are installed, maxmind will be preferred as it's faster and also provides ASN data. The maxmind module requires manual download of the GeoIP databases. The npm module "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"maxmind-geolite-mirror"}]},{"type":"text","value":" will download the files and keep them up-to-date if you run it periodically."}]},{"type":"element","tag":"code","props":{"code":"mkdir -p /usr/local/share/GeoIP\nnpm install -g maxmind-geolite-mirror\n/usr/local/bin/maxmind-geolite-mirror\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-bc5f6a"},"children":[{"type":"text","value":"mkdir -p /usr/local/share/GeoIP"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-bc5f6a"},"children":[{"type":"text","value":"npm install -g maxmind-geolite-mirror"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-bc5f6a"},"children":[{"type":"text","value":"/usr/local/bin/maxmind-geolite-mirror"}]}]}]}]}]},{"type":"element","tag":"h1","props":{"id":"description"},"children":[{"type":"text","value":"DESCRIPTION"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"GeoIP results are stored in connection.notes.geoip and connection."},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/Results.md","rel":["nofollow"]},"children":[{"type":"text","value":"results"}]},{"type":"text","value":" .connect.geoip. The following information is typically available:"}]},{"type":"element","tag":"code","props":{"code":"continent: NA,\ncountry:   US,\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"continent: NA,\ncountry:   US,"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If the GeoIP city database is available, the following may also be available:"}]},{"type":"element","tag":"code","props":{"code":"region:   CA,\ncity:     San Francisco,\nll:       [37.7484, -122.4156],\ndistance: 1539    // in kilometers\nrange:    [ 3479299040, 3479299071 ],\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"region:   CA,\ncity:     San Francisco,\nll:       [37.7484, -122.4156],\ndistance: 1539    // in kilometers\nrange:    [ 3479299040, 3479299071 ],"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"connect.geoip"}]},{"type":"text","value":" also adds entries like this to your logs:"}]},{"type":"element","tag":"code","props":{"code":"[connect.geoip] US\n[connect.geoip] US, WA\n[connect.geoip] US, WA, Seattle\n[connect.geoip] US, WA, Seattle, 1319km\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"[connect.geoip] US\n[connect.geoip] US, WA\n[connect.geoip] US, WA, Seattle\n[connect.geoip] US, WA, Seattle, 1319km"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Calculating the distance requires the public IP of this mail server. This may\nbe the IP that Haraka is bound to. If not, make sure that "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"utils.get_public_ip"}]},{"type":"text","value":"\ncan figure it out (via STUN or in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"smtp.ini"}]},{"type":"text","value":")."}]},{"type":"element","tag":"h1","props":{"id":"config"},"children":[{"type":"text","value":"CONFIG"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"distance"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Perform the geodesic distance calculations. Calculates the distance \"as the\ncrow flies\" from the remote mail server."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This calculation requires a 'from' IP address. This will typically be the\npublic IP of your mail server. If Haraka is bound to a private IP, net_utils\nwill attempt to determine your public IP. If that doesn't work, edit\nconfig/smtp.ini and set "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"public_ip"}]},{"type":"text","value":"."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"show_city"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"show city data in logs and headers. City data is less accurate than country."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"show_region in logs and headers. Regional data are US states, Canadian\nprovinces and such."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Set a connection result to true if the distance exceeds this many kilometers."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"too_far=4000"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"asn"}]},{"type":"text","value":"report_as"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Permits reporting the ASN as another plugin (such as connect.asn)."}]},{"type":"element","tag":"h1","props":{"id":"spam-prediction-with-distance"},"children":[{"type":"text","value":"SPAM PREDICTION WITH DISTANCE"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://www.cc.gatech.edu/~feamster/papers/snare-usenix09.pdf","rel":["nofollow"]},"children":[{"type":"text","value":"Spatio-temporal Network-level Automatic Reputation Engine"}]}]},{"type":"element","tag":"code","props":{"code":"\"For ham, 90% of the messages travel about 4,000 km or less. On the\nother hand, for spam, only 28% of messages stay within this range.\"\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\"For ham, 90% of the messages travel about 4,000 km or less. On the\nother hand, for spam, only 28% of messages stay within this range.\""}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Observations in 2014 suggest that geodesic distance continues to be an\nexcellent predictor of spam."}]},{"type":"element","tag":"h1","props":{"id":"limitations"},"children":[{"type":"text","value":"LIMITATIONS"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The distance calculations are more concerned with being fast than\naccurate. The MaxMind location data is collected from whois and is of\nlimited accuracy. MaxMind offers more accurate data for a fee."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For distance calculations, the earth is considered a perfect sphere. In\nreality, it is not. Accuracy should be within 1%."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin does not update the GeoIP databases. You may want to."}]},{"type":"element","tag":"h1","props":{"id":"see-also"},"children":[{"type":"text","value":"SEE ALSO"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"MaxMind: "},{"type":"element","tag":"a","props":{"href":"http://www.maxmind.com/","rel":["nofollow"]},"children":[{"type":"text","value":"http://www.maxmind.com/"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Databases: "},{"type":"element","tag":"a","props":{"href":"http://geolite.maxmind.com/download/geoip/database","rel":["nofollow"]},"children":[{"type":"text","value":"http://geolite.maxmind.com/download/geoip/database"}]}]},{"type":"element","tag":"h1","props":{"id":"todo"},"children":[{"type":"text","value":"TODO"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Keep an eye on node-geoip and see if they add ASN support. This would be an\nalternative to connect.asn which uses a DNS lookup to retrieve the ASN."}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-bc5f6a{color:#24292F}\n.dark .ct-bc5f6a{color:#C9D1D9}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:8.plugins:connect.geoip.md","_source":"content","_file":"8.plugins/connect.geoip.md","_extension":"md"},{"_path":"/plugins/connect.p0f","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"connect.p0f - TCP Fingerprinting plugin for Haraka","description":"Haraka connect.p0f plugin - TCP Fingerprinting","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"connectp0f-plugin"},"children":[{"type":"text","value":"connect.p0f plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Use TCP fingerprint info (remote computer OS, network distance, etc) to\nimplement more sophisticated anti-spam policies."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin inserts a "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"p0f"}]},{"type":"text","value":" connection note with information deduced\nfrom the TCP fingerprint. The note typically includes at least the link,\ndetail, distance, uptime, genre. Here's an example:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"genre    => FreeBSD\ndetail   => 8.x (1)\nuptime   => 1390\nlink     => ethernet/modem\ndistance => 17"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Which was parsed from this p0f fingerprint:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"24.18.227.2:39435 - FreeBSD 8.x (1) (up: 1390 hrs)\n-> 208.75.177.101:25 (distance 17, link: ethernet/modem)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The following additional values may also be available in\nthe "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"p0f"}]},{"type":"text","value":" connection note:"}]},{"type":"element","tag":"code","props":{"code":"magic, status, first_seen, last_seen, total_conn, uptime_min, up_mod_days, last_nat, last_chg, distance, bad_sw, os_match_q, os_name, os_flavor, http_name, http_flavor, link_type, and language.\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"magic, status, first_seen, last_seen, total_conn, uptime_min, up_mod_days, last_nat, last_chg, distance, bad_sw, os_match_q, os_name, os_flavor, http_name, http_flavor, link_type, and language.\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"start p0f"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Create a startup script for p0f that creates a communication socket when your\nserver starts up."}]},{"type":"element","tag":"code","props":{"code":"/usr/local/bin/p0f -u smtpd -d -s /tmp/.p0f_socket 'dst port 25 or dst port 587'\nchown smtpd /tmp/.p0f_socket\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"/usr/local/bin/p0f -u smtpd -d -s /tmp/.p0f_socket 'dst port 25 or dst port 587'\nchown smtpd /tmp/.p0f_socket\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"2. configure p0f plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"add an entry to config/plugins to enable p0f:"}]},{"type":"element","tag":"code","props":{"code":"connect.p0f\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"connect.p0f\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"3. review settings in config/connect.p0f.ini"}]},{"type":"element","tag":"h2","props":{"id":"startup"},"children":[{"type":"text","value":"Startup"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In the contrib/ubuntu-upstart directory is a config file (p0f.conf) for Ubuntu."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In the contrib/bsd-rc.d directory is a startup file for FreeBSD."}]}]},"navigation":{"title":"connect.p0f"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"connectp0f-plugin"},"children":[{"type":"text","value":"connect.p0f plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Use TCP fingerprint info (remote computer OS, network distance, etc) to\nimplement more sophisticated anti-spam policies."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin inserts a "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"p0f"}]},{"type":"text","value":" connection note with information deduced\nfrom the TCP fingerprint. The note typically includes at least the link,\ndetail, distance, uptime, genre. Here's an example:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"genre    => FreeBSD\ndetail   => 8.x (1)\nuptime   => 1390\nlink     => ethernet/modem\ndistance => 17"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Which was parsed from this p0f fingerprint:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"24.18.227.2:39435 - FreeBSD 8.x (1) (up: 1390 hrs)\n-> 208.75.177.101:25 (distance 17, link: ethernet/modem)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The following additional values may also be available in\nthe "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"p0f"}]},{"type":"text","value":" connection note:"}]},{"type":"element","tag":"code","props":{"code":"magic, status, first_seen, last_seen, total_conn, uptime_min, up_mod_days, last_nat, last_chg, distance, bad_sw, os_match_q, os_name, os_flavor, http_name, http_flavor, link_type, and language.\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"magic, status, first_seen, last_seen, total_conn, uptime_min, up_mod_days, last_nat, last_chg, distance, bad_sw, os_match_q, os_name, os_flavor, http_name, http_flavor, link_type, and language."}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"start p0f"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Create a startup script for p0f that creates a communication socket when your\nserver starts up."}]},{"type":"element","tag":"code","props":{"code":"/usr/local/bin/p0f -u smtpd -d -s /tmp/.p0f_socket 'dst port 25 or dst port 587'\nchown smtpd /tmp/.p0f_socket\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"/usr/local/bin/p0f -u smtpd -d -s /tmp/.p0f_socket 'dst port 25 or dst port 587'\nchown smtpd /tmp/.p0f_socket"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"2. configure p0f plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"add an entry to config/plugins to enable p0f:"}]},{"type":"element","tag":"code","props":{"code":"connect.p0f\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"connect.p0f"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"3. review settings in config/connect.p0f.ini"}]},{"type":"element","tag":"h2","props":{"id":"startup"},"children":[{"type":"text","value":"Startup"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In the contrib/ubuntu-upstart directory is a config file (p0f.conf) for Ubuntu."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In the contrib/bsd-rc.d directory is a startup file for FreeBSD."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"configuration","depth":2,"text":"Configuration"},{"id":"startup","depth":2,"text":"Startup"}]}},"_type":"markdown","_id":"content:8.plugins:connect.p0f.md","_source":"content","_file":"8.plugins/connect.p0f.md","_extension":"md"},{"_path":"/plugins/connect.rdns_access","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"connect.rdns_access - Reverse DNS Access Control plugin for Haraka","description":"Haraka connect.rdns_access plugin - Reverse DNS Access Control","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"connectrdns_access-plugin"},"children":[{"type":"text","value":"connect.rdns_access plugin"}]},{"type":"element","tag":"h2","props":{"id":"deprecation-notice"},"children":[{"type":"text","value":"DEPRECATION NOTICE"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"See the "},{"type":"element","tag":"a","props":{"href":"/plugins/access"},"children":[{"type":"text","value":"access"}]},{"type":"text","value":" plugin for upgrade instructions."}]},{"type":"element","tag":"h1","props":{"id":"connectrdns_access"},"children":[{"type":"text","value":"connect.rdns_access"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin will evaluate the remote IP address and the remote rDNS hostname\nagainst a set of white and black lists.  The lists are applied in the following\nway:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"connect.rdns_access.whitelist         (pass)\nconnect.rdns_access.whitelist_regex   (pass)\nconnect.rdns_access.blacklist         (block)\nconnect.rdns_access.blacklist_regex   (block)"}]},{"type":"element","tag":"h2","props":{"id":"configuration-connectrdns_accessini"},"children":[{"type":"text","value":"Configuration connect.rdns_access.ini"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"General configuration file for this plugin."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connect.rdns_access.general.deny_msg"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Text to send the user on reject (text)."}]}]},{"type":"element","tag":"h2","props":{"id":"configuration-connectrdns_accesswhitelist"},"children":[{"type":"text","value":"Configuration connect.rdns_access.whitelist"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The whitelist is mostly to counter blacklist entries that match more than\nwhat one would want.  This file should be used for a specific IP address\nor rDNS hostnames, one per line, that should bypass blacklist checks.\nNOTE: We heavily suggest tailoring blacklist entries to be as accurate as\npossible and never using whitelists.  Nevertheless, if you need whitelists,\nhere they are."}]},{"type":"element","tag":"h2","props":{"id":"configuration-connectrdns_accesswhitelist_regex"},"children":[{"type":"text","value":"Configuration connect.rdns_access.whitelist_regex"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Does the same thing as the whitelist file, but each line is a regex.\nEach line is also anchored for you, meaning '^' + regex + '$' is added for\nyou.  If you need to get around this restriction, you may use a '.*' at\neither the start or the end of your regex.  This should help prevent people\nfrom writing overly permissive rules on accident."}]},{"type":"element","tag":"h2","props":{"id":"configuration-connectrdns_accessblacklist"},"children":[{"type":"text","value":"Configuration connect.rdns_access.blacklist"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This file should be used for a specific IP address or rDNS hostnames, one\nper line, that should fail on connect."}]},{"type":"element","tag":"h2","props":{"id":"configuration-connectrdns_accessblacklist_regex"},"children":[{"type":"text","value":"Configuration connect.rdns_access.blacklist_regex"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Does the same thing as the blacklist file, but each line is a regex.\nEach line is also anchored for you, meaning '^' + regex + '$' is added for\nyou.  If you need to get around this restriction, you may use a '.*' at\neither the start or the end of your regex.  This should help prevent people\nfrom writing overly permissive rules on accident."}]}]},"navigation":{"title":"connect.rdns_access"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"connectrdns_access-plugin"},"children":[{"type":"text","value":"connect.rdns_access plugin"}]},{"type":"element","tag":"h2","props":{"id":"deprecation-notice"},"children":[{"type":"text","value":"DEPRECATION NOTICE"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"See the "},{"type":"element","tag":"a","props":{"href":"/plugins/access"},"children":[{"type":"text","value":"access"}]},{"type":"text","value":" plugin for upgrade instructions."}]},{"type":"element","tag":"h1","props":{"id":"connectrdns_access"},"children":[{"type":"text","value":"connect.rdns_access"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin will evaluate the remote IP address and the remote rDNS hostname\nagainst a set of white and black lists.  The lists are applied in the following\nway:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"connect.rdns_access.whitelist         (pass)\nconnect.rdns_access.whitelist_regex   (pass)\nconnect.rdns_access.blacklist         (block)\nconnect.rdns_access.blacklist_regex   (block)"}]},{"type":"element","tag":"h2","props":{"id":"configuration-connectrdns_accessini"},"children":[{"type":"text","value":"Configuration connect.rdns_access.ini"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"General configuration file for this plugin."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connect.rdns_access.general.deny_msg"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Text to send the user on reject (text)."}]}]},{"type":"element","tag":"h2","props":{"id":"configuration-connectrdns_accesswhitelist"},"children":[{"type":"text","value":"Configuration connect.rdns_access.whitelist"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The whitelist is mostly to counter blacklist entries that match more than\nwhat one would want.  This file should be used for a specific IP address\nor rDNS hostnames, one per line, that should bypass blacklist checks.\nNOTE: We heavily suggest tailoring blacklist entries to be as accurate as\npossible and never using whitelists.  Nevertheless, if you need whitelists,\nhere they are."}]},{"type":"element","tag":"h2","props":{"id":"configuration-connectrdns_accesswhitelist_regex"},"children":[{"type":"text","value":"Configuration connect.rdns_access.whitelist_regex"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Does the same thing as the whitelist file, but each line is a regex.\nEach line is also anchored for you, meaning '^' + regex + '$' is added for\nyou.  If you need to get around this restriction, you may use a '.*' at\neither the start or the end of your regex.  This should help prevent people\nfrom writing overly permissive rules on accident."}]},{"type":"element","tag":"h2","props":{"id":"configuration-connectrdns_accessblacklist"},"children":[{"type":"text","value":"Configuration connect.rdns_access.blacklist"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This file should be used for a specific IP address or rDNS hostnames, one\nper line, that should fail on connect."}]},{"type":"element","tag":"h2","props":{"id":"configuration-connectrdns_accessblacklist_regex"},"children":[{"type":"text","value":"Configuration connect.rdns_access.blacklist_regex"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Does the same thing as the blacklist file, but each line is a regex.\nEach line is also anchored for you, meaning '^' + regex + '$' is added for\nyou.  If you need to get around this restriction, you may use a '.*' at\neither the start or the end of your regex.  This should help prevent people\nfrom writing overly permissive rules on accident."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"deprecation-notice","depth":2,"text":"DEPRECATION NOTICE"},{"id":"configuration-connectrdns_accessini","depth":2,"text":"Configuration connect.rdns_access.ini"},{"id":"configuration-connectrdns_accesswhitelist","depth":2,"text":"Configuration connect.rdns_access.whitelist"},{"id":"configuration-connectrdns_accesswhitelist_regex","depth":2,"text":"Configuration connect.rdns_access.whitelist_regex"},{"id":"configuration-connectrdns_accessblacklist","depth":2,"text":"Configuration connect.rdns_access.blacklist"},{"id":"configuration-connectrdns_accessblacklist_regex","depth":2,"text":"Configuration connect.rdns_access.blacklist_regex"}]}},"_type":"markdown","_id":"content:8.plugins:connect.rdns_access.md","_source":"content","_file":"8.plugins/connect.rdns_access.md","_extension":"md"},{"_path":"/plugins/daemonize","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"daemonize - Daemonize plugin for Haraka","description":"Haraka daemonize plugin - Daemonize","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"daemonize-plugin"},"children":[{"type":"text","value":"daemonize plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"IMPORTANT NOTE: This plugin should not be used any more and it will\nthrow an error and prevent Haraka from starting."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nDaemonization is now built into Haraka.  If the 'daemon' module is\ninstalled you simply set daemonize=true in config/smtp.ini now."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To use this plugin you have to install the 'daemon' module by running\n'npm install daemon' in your Haraka configuration directory."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nIf daemon is not found then the plugin will log a notice and Haraka will\ncontinue running in the foreground."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin should be listed at the top of your config/plugins file so that\nHaraka goes into the background before any other plugins are run."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin looks for daemonize.ini in your configuration directory and the\nfollowing options can be set:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"log_file  (default: /var/log/haraka.log)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The file that STDOUT should be redirected to.  It is recommended that\nyou use this plugin with the log.syslog plugin instead."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"pid_file  (default: /var/run/haraka.pid)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"File where the master process PID should be written to.  If this file\ncannot be locked then start-up will fail."}]}]},{"type":"element","tag":"h2","props":{"id":"init-script"},"children":[{"type":"text","value":"Init-Script"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A RedHat/CentOS compatible init-script is provided for use with this module\nwhich can be found in the plugins directory called haraka.init."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nIt should be copied to /etc/init.d/haraka and registered with\n'chkconfig --add haraka' to activate haraka at system boot."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The init-script presumes that Haraka is installed as /usr/local/bin/haraka\nand main configuration file is /etc/haraka/config/smtp.ini."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nIf this is not the case on your system, then you should create the file\n/etc/sysconfig/haraka which accepts the following configuration:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"exec  (default: exec=/usr/local/bin/haraka)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The path to Haraka script"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"config  (default: config=/etc/haraka/config/smtp.ini)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The path to the Haraka smtp.ini configuration script"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"max_open_files  (default: 65535)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The maximum number of open files allowed per process.  If you are\nrunning Haraka using the 'cluster' module, then this is the per-child\nlimit."}]}]}]},"navigation":{"title":"daemonize"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"daemonize-plugin"},"children":[{"type":"text","value":"daemonize plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"IMPORTANT NOTE: This plugin should not be used any more and it will\nthrow an error and prevent Haraka from starting."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nDaemonization is now built into Haraka.  If the 'daemon' module is\ninstalled you simply set daemonize=true in config/smtp.ini now."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To use this plugin you have to install the 'daemon' module by running\n'npm install daemon' in your Haraka configuration directory."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nIf daemon is not found then the plugin will log a notice and Haraka will\ncontinue running in the foreground."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin should be listed at the top of your config/plugins file so that\nHaraka goes into the background before any other plugins are run."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin looks for daemonize.ini in your configuration directory and the\nfollowing options can be set:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"log_file  (default: /var/log/haraka.log)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The file that STDOUT should be redirected to.  It is recommended that\nyou use this plugin with the log.syslog plugin instead."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"pid_file  (default: /var/run/haraka.pid)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"File where the master process PID should be written to.  If this file\ncannot be locked then start-up will fail."}]}]},{"type":"element","tag":"h2","props":{"id":"init-script"},"children":[{"type":"text","value":"Init-Script"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A RedHat/CentOS compatible init-script is provided for use with this module\nwhich can be found in the plugins directory called haraka.init."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nIt should be copied to /etc/init.d/haraka and registered with\n'chkconfig --add haraka' to activate haraka at system boot."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The init-script presumes that Haraka is installed as /usr/local/bin/haraka\nand main configuration file is /etc/haraka/config/smtp.ini."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nIf this is not the case on your system, then you should create the file\n/etc/sysconfig/haraka which accepts the following configuration:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"exec  (default: exec=/usr/local/bin/haraka)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The path to Haraka script"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"config  (default: config=/etc/haraka/config/smtp.ini)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The path to the Haraka smtp.ini configuration script"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"max_open_files  (default: 65535)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The maximum number of open files allowed per process.  If you are\nrunning Haraka using the 'cluster' module, then this is the per-child\nlimit."}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"configuration","depth":2,"text":"Configuration"},{"id":"init-script","depth":2,"text":"Init-Script"}]}},"_type":"markdown","_id":"content:8.plugins:daemonize.md","_source":"content","_file":"8.plugins/daemonize.md","_extension":"md"},{"_path":"/plugins/data.headers","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"data.headers - Header Checks plugin for Haraka","description":"Haraka data.headers plugin - Header Checks","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"dataheaders-plugin"},"children":[{"type":"text","value":"data.headers plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Deprecated by "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-headers/","rel":["nofollow"]},"children":[{"type":"text","value":"haraka-plugin-headers"}]}]}]},"navigation":{"title":"data.headers"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"dataheaders-plugin"},"children":[{"type":"text","value":"data.headers plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Deprecated by "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-headers/","rel":["nofollow"]},"children":[{"type":"text","value":"haraka-plugin-headers"}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:8.plugins:data.headers.md","_source":"content","_file":"8.plugins/data.headers.md","_extension":"md"},{"_path":"/plugins/data.signatures","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"data.signatures - Signatures plugin for Haraka","description":"Haraka data.signatures plugin - Signatures","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"datasignatures-plugin"},"children":[{"type":"text","value":"data.signatures plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin allows you to add string signatures to a configuration file and\nhave this plugin scan the body text of an email for those strings. Mails\nmatching these signatures will be blocked."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"data.signatures"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"This file contains a list of strings (one per line) that will be matched."}]}]}]},"navigation":{"title":"data.signatures"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"datasignatures-plugin"},"children":[{"type":"text","value":"data.signatures plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin allows you to add string signatures to a configuration file and\nhave this plugin scan the body text of an email for those strings. Mails\nmatching these signatures will be blocked."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"data.signatures"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"This file contains a list of strings (one per line) that will be matched."}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"configuration","depth":2,"text":"Configuration"}]}},"_type":"markdown","_id":"content:8.plugins:data.signatures.md","_source":"content","_file":"8.plugins/data.signatures.md","_extension":"md"},{"_path":"/plugins/data.uribl","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"data.uribl - URI Blacklists plugin for Haraka","description":"Haraka data.uribl plugin - URI Blacklists","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"datauribl-plugin"},"children":[{"type":"text","value":"data.uribl plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin extracts URIs and feeds them to RHS based blacklists such as\n"},{"type":"element","tag":"a","props":{"href":"http://www.spamhaus.org/dbl","rel":["nofollow"]},"children":[{"type":"text","value":"DBL"}]},{"type":"text","value":" and "},{"type":"element","tag":"a","props":{"href":"http://spameatingmonkey.com/lists.html#SEM-FRESH","rel":["nofollow"]},"children":[{"type":"text","value":"SEM-FRESH"}]},{"type":"text","value":" and body URI based DNS blacklists such as\n"},{"type":"element","tag":"a","props":{"href":"http://www.surbl.org/","rel":["nofollow"]},"children":[{"type":"text","value":"SURBL"}]},{"type":"text","value":" and "},{"type":"element","tag":"a","props":{"href":"http://www.uribl.com/","rel":["nofollow"]},"children":[{"type":"text","value":"URIBL"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin will discard any domain name that does not have a valid TLD\nor any IP address within RFC1918, 127/8 or 169.254/16 (APIPA) and will\nconvert any URI ending in in-addr.arpa into an IP address lookup."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin reads configuration from data.uribl.ini."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The main section defines global settings for all lists and the blacklists\nzones are specified as INI section headings with the configuration for\neach zone within that section."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The main section can contain the following options:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"timeout"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: 30"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The total timeout in seconds for each group of lookups.  Any group of\nlookups that takes longer than this will be aborted and the session\nwill continue."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"max_uris_per_list"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: 20"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"This option limits the maximum number of unique lookups that will be\nsubmitted for each list after the input has been normalized into the\nquery format required for the list."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nAny lookups greater than the limit will be discarded."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"List sections should be named as the zone of the blacklist and can\ncontain the following options:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"At least one of the following must be set for any queries to be run for\nthe blacklist."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"rdns = 1 | true | yes | on | enabled"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Check any rDNS names against the list."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"helo = 1 | true | yes | on | enabled"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Check the EHLO/HELO argument against the list."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"envfrom = 1 | true | yes | on | enabled"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Check the MAIL FROM domain against the list."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"from = 1 | true | yes | on | enabled"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Check the domain portion of the From: header against the list."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"replyto = 1 | true | yes | on | enabled"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Check the domain portion of the Reply-To: header against the list."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"msgid = 1 | true | yes | on | enabled"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Check the RHS of the Message-Id: header against the list."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"body = 1 | true | yes | on | enabled"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Check any URIs found within the body of the message against the list."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The following are optional for each list:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"custom_msg"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"A custom rejection message that will be returned to the SMTP client\nif the list returns a positive result.  If found within the string\n{uri} will be replaced by the URI value looked up and {zone} will\nbe replaced by the blacklist zone name."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"validate"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"A regular expression that will be tested against the first A record\nreturned by the list.  If it does not evaluate to true then the positive\nresult will be discarded.  Example: ^(?!127.0.1.255)127. would check\nthat the IP address returned start with 127. and is not 127.0.1.255"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"bitmask"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"This is optionally used for lists such as "},{"type":"element","tag":"a","props":{"href":"http://www.surbl.org/","rel":["nofollow"]},"children":[{"type":"text","value":"SURBL"}]},{"type":"text","value":" and "},{"type":"element","tag":"a","props":{"href":"http://www.uribl.com/","rel":["nofollow"]},"children":[{"type":"text","value":"URIBL"}]},{"type":"text","value":" that\nreturn bitmask values in the last octet of the returned IP address to\ncombine multiple lists into a single zone.  Using this you may specify\nwhich lists within the zone you want use."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"no_ip_lookups = 1 | true | yes | on | enabled"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Specifies that no IP addresses should ever be check against this list.\nThis is required for dbl.spamhaus.org."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"strip_to_domain= 1 | true | yes | on | enabled"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Specifies that the list requires hostnames be stripped down to the\ndomain boundaries prior to querying the list.  This is required for\nthe "},{"type":"element","tag":"a","props":{"href":"http://www.surbl.org/","rel":["nofollow"]},"children":[{"type":"text","value":"SURBL"}]},{"type":"text","value":" and "},{"type":"element","tag":"a","props":{"href":"http://www.uribl.com/","rel":["nofollow"]},"children":[{"type":"text","value":"URIBL"}]},{"type":"text","value":" lists."}]}]},{"type":"element","tag":"h2","props":{"id":"other-files"},"children":[{"type":"text","value":"Other files"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"data.uribl.excludes"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"This contains a list of domains that should never be looked up in\nany blacklist as they are known good and will never be listed.\nThis helps to keep useless queries to a minimum."}]}]}]},"navigation":{"title":"data.uribl"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"datauribl-plugin"},"children":[{"type":"text","value":"data.uribl plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin extracts URIs and feeds them to RHS based blacklists such as\n"},{"type":"element","tag":"a","props":{"href":"http://www.spamhaus.org/dbl","rel":["nofollow"]},"children":[{"type":"text","value":"DBL"}]},{"type":"text","value":" and "},{"type":"element","tag":"a","props":{"href":"http://spameatingmonkey.com/lists.html#SEM-FRESH","rel":["nofollow"]},"children":[{"type":"text","value":"SEM-FRESH"}]},{"type":"text","value":" and body URI based DNS blacklists such as\n"},{"type":"element","tag":"a","props":{"href":"http://www.surbl.org/","rel":["nofollow"]},"children":[{"type":"text","value":"SURBL"}]},{"type":"text","value":" and "},{"type":"element","tag":"a","props":{"href":"http://www.uribl.com/","rel":["nofollow"]},"children":[{"type":"text","value":"URIBL"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin will discard any domain name that does not have a valid TLD\nor any IP address within RFC1918, 127/8 or 169.254/16 (APIPA) and will\nconvert any URI ending in in-addr.arpa into an IP address lookup."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin reads configuration from data.uribl.ini."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The main section defines global settings for all lists and the blacklists\nzones are specified as INI section headings with the configuration for\neach zone within that section."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The main section can contain the following options:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"timeout"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: 30"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The total timeout in seconds for each group of lookups.  Any group of\nlookups that takes longer than this will be aborted and the session\nwill continue."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"max_uris_per_list"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: 20"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"This option limits the maximum number of unique lookups that will be\nsubmitted for each list after the input has been normalized into the\nquery format required for the list."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nAny lookups greater than the limit will be discarded."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"List sections should be named as the zone of the blacklist and can\ncontain the following options:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"At least one of the following must be set for any queries to be run for\nthe blacklist."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"rdns = 1 | true | yes | on | enabled"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Check any rDNS names against the list."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"helo = 1 | true | yes | on | enabled"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Check the EHLO/HELO argument against the list."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"envfrom = 1 | true | yes | on | enabled"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Check the MAIL FROM domain against the list."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"from = 1 | true | yes | on | enabled"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Check the domain portion of the From: header against the list."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"replyto = 1 | true | yes | on | enabled"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Check the domain portion of the Reply-To: header against the list."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"msgid = 1 | true | yes | on | enabled"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Check the RHS of the Message-Id: header against the list."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"body = 1 | true | yes | on | enabled"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Check any URIs found within the body of the message against the list."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The following are optional for each list:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"custom_msg"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"A custom rejection message that will be returned to the SMTP client\nif the list returns a positive result.  If found within the string\n{uri} will be replaced by the URI value looked up and {zone} will\nbe replaced by the blacklist zone name."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"validate"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"A regular expression that will be tested against the first A record\nreturned by the list.  If it does not evaluate to true then the positive\nresult will be discarded.  Example: ^(?!127.0.1.255)127. would check\nthat the IP address returned start with 127. and is not 127.0.1.255"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"bitmask"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"This is optionally used for lists such as "},{"type":"element","tag":"a","props":{"href":"http://www.surbl.org/","rel":["nofollow"]},"children":[{"type":"text","value":"SURBL"}]},{"type":"text","value":" and "},{"type":"element","tag":"a","props":{"href":"http://www.uribl.com/","rel":["nofollow"]},"children":[{"type":"text","value":"URIBL"}]},{"type":"text","value":" that\nreturn bitmask values in the last octet of the returned IP address to\ncombine multiple lists into a single zone.  Using this you may specify\nwhich lists within the zone you want use."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"no_ip_lookups = 1 | true | yes | on | enabled"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Specifies that no IP addresses should ever be check against this list.\nThis is required for dbl.spamhaus.org."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"strip_to_domain= 1 | true | yes | on | enabled"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Specifies that the list requires hostnames be stripped down to the\ndomain boundaries prior to querying the list.  This is required for\nthe "},{"type":"element","tag":"a","props":{"href":"http://www.surbl.org/","rel":["nofollow"]},"children":[{"type":"text","value":"SURBL"}]},{"type":"text","value":" and "},{"type":"element","tag":"a","props":{"href":"http://www.uribl.com/","rel":["nofollow"]},"children":[{"type":"text","value":"URIBL"}]},{"type":"text","value":" lists."}]}]},{"type":"element","tag":"h2","props":{"id":"other-files"},"children":[{"type":"text","value":"Other files"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"data.uribl.excludes"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"This contains a list of domains that should never be looked up in\nany blacklist as they are known good and will never be listed.\nThis helps to keep useless queries to a minimum."}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"configuration","depth":2,"text":"Configuration"},{"id":"other-files","depth":2,"text":"Other files"}]}},"_type":"markdown","_id":"content:8.plugins:data.uribl.md","_source":"content","_file":"8.plugins/data.uribl.md","_extension":"md"},{"_path":"/plugins/dcc","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"dcc - DCC plugin for Haraka","description":"Haraka dcc plugin - DCC","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"dcc-plugin"},"children":[{"type":"text","value":"dcc plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"NOTE: this plugin is not feature complete."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The Distributed Checksum Clearinghouses or DCC is an anti-spam content filter.\nSee "},{"type":"element","tag":"a","props":{"href":"http://www.dcc-servers.net/dcc/","rel":["nofollow"]},"children":[{"type":"text","value":"http://www.dcc-servers.net/dcc/"}]},{"type":"text","value":" for details of how it works."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin implements the protocol used by the dccifd daemon to communicate\nwith DCC."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It requires that you install the DCC client and configure and start-up the\ndccifd daemon as per the documentation and expects the dccifd socket to be\n/var/dcc/dccifd."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Currently it only reports results to the logs, it does not reject, greylist\nor do anything with the results of any kind."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can report spam to DCC during reception by setting:\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"connection.transaction.notes.training_mode = 'spam'"}]}]}]},"navigation":{"title":"dcc"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"dcc-plugin"},"children":[{"type":"text","value":"dcc plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"NOTE: this plugin is not feature complete."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The Distributed Checksum Clearinghouses or DCC is an anti-spam content filter.\nSee "},{"type":"element","tag":"a","props":{"href":"http://www.dcc-servers.net/dcc/","rel":["nofollow"]},"children":[{"type":"text","value":"http://www.dcc-servers.net/dcc/"}]},{"type":"text","value":" for details of how it works."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin implements the protocol used by the dccifd daemon to communicate\nwith DCC."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It requires that you install the DCC client and configure and start-up the\ndccifd daemon as per the documentation and expects the dccifd socket to be\n/var/dcc/dccifd."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Currently it only reports results to the logs, it does not reject, greylist\nor do anything with the results of any kind."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can report spam to DCC during reception by setting:\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"connection.transaction.notes.training_mode = 'spam'"}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:8.plugins:dcc.md","_source":"content","_file":"8.plugins/dcc.md","_extension":"md"},{"_path":"/plugins/delay_deny","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"delay_deny - Connection Delays plugin for Haraka","description":"Haraka delay_deny plugin - Connection Delays","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"delay_deny-plugin"},"children":[{"type":"text","value":"delay_deny plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Delays all pre-DATA 'deny' results until the recipients are sent\nand all post-DATA commands until all hook_data_post plugins have run.\nThis allows relays and authenticated users to bypass pre-DATA rejections."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Configuration options are in config/delay_deny.ini."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin operates in one of two modes: included and excluded."}]},{"type":"element","tag":"h3","props":{"id":"included-plugins"},"children":[{"type":"text","value":"included plugins"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A comma or semicolon separated list of denials that are to be included.\nIn this mode, "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"only"}]},{"type":"text","value":" plugins in the list are bypassed. All other plugins\ncan immediately reject connections."}]},{"type":"element","tag":"h3","props":{"id":"excluded-plugins"},"children":[{"type":"text","value":"excluded plugins"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A comma or semicolon separated list of denials that are to be excluded.\nExcluded plugins that are not bypassed and can still immediately reject\nconnections."}]}]},"navigation":{"title":"delay_deny"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"delay_deny-plugin"},"children":[{"type":"text","value":"delay_deny plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Delays all pre-DATA 'deny' results until the recipients are sent\nand all post-DATA commands until all hook_data_post plugins have run.\nThis allows relays and authenticated users to bypass pre-DATA rejections."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Configuration options are in config/delay_deny.ini."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin operates in one of two modes: included and excluded."}]},{"type":"element","tag":"h3","props":{"id":"included-plugins"},"children":[{"type":"text","value":"included plugins"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A comma or semicolon separated list of denials that are to be included.\nIn this mode, "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"only"}]},{"type":"text","value":" plugins in the list are bypassed. All other plugins\ncan immediately reject connections."}]},{"type":"element","tag":"h3","props":{"id":"excluded-plugins"},"children":[{"type":"text","value":"excluded plugins"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A comma or semicolon separated list of denials that are to be excluded.\nExcluded plugins that are not bypassed and can still immediately reject\nconnections."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"configuration","depth":2,"text":"Configuration","children":[{"id":"included-plugins","depth":3,"text":"included plugins"},{"id":"excluded-plugins","depth":3,"text":"excluded plugins"}]}]}},"_type":"markdown","_id":"content:8.plugins:delay_deny.md","_source":"content","_file":"8.plugins/delay_deny.md","_extension":"md"},{"_path":"/plugins/dkim_sign","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"dkim_sign - DKIM Sign plugin for Haraka","description":"Haraka dkim_sign plugin - DKIM Sign","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"dkim_sign-plugin"},"children":[{"type":"text","value":"dkim_sign plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin implements the DKIM Core specification found at dkimcore.org"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"DKIM Core is a simplified subset of DKIM which is easier to understand\nand deploy, yet provides all the same delivery advantages as DKIM."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin can only "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"sign"}]},{"type":"text","value":" outbound messages.  It does not validate\nDKIM signatures."}]},{"type":"element","tag":"h2","props":{"id":"getting-started"},"children":[{"type":"text","value":"Getting Started"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Generate DKIM selector and keys:"}]},{"type":"element","tag":"code","props":{"code":"% cd /path/to/haraka/config/dkim\n./dkim_key_gen.sh example.org\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"% cd /path/to/haraka/config/dkim\n./dkim_key_gen.sh example.org\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Peek into the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"dkim_key_gen.sh"}]},{"type":"text","value":" shell script to see the commands used to\ncreate and format the DKIM public key. Within the config/dkim/example.org\ndirectory will be 4 files:"}]},{"type":"element","tag":"code","props":{"code":"% ls config/dkim/example.org/\ndns private public selector\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"% ls config/dkim/example.org/\ndns private public selector\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"private"}]},{"type":"text","value":" and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" files contain the DKIM keys, the selector is\nin the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"selector"}]},{"type":"text","value":" file and the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"dns"}]},{"type":"text","value":" file contains a formatted record of\nthe public key, as well as suggestions for DKIM, SPF, and DMARC policy\nrecords. The records in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"dns"}]},{"type":"text","value":" are ready to be copy/pasted into the DNS\nzone for example.org."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The DKIM DNS record will look like this:"}]},{"type":"element","tag":"code","props":{"code":"may2013._domainkey TXT \"v=DKIM1;p=[public key stripped of whitespace];\"\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"may2013._domainkey TXT \"v=DKIM1;p=[public key stripped of whitespace];\"\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"And the values in the address have the following meaning:"}]},{"type":"element","tag":"code","props":{"code":"hash: h=[ sha1 | sha256 ]\ntest; t=[ s | s:y ]\ngranularity: g=[ ]\nnotes: n=[ ]\nservices: s=[email]\nkeytypes: [ rsa ]\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"hash: h=[ sha1 | sha256 ]\ntest; t=[ s | s:y ]\ngranularity: g=[ ]\nnotes: n=[ ]\nservices: s=[email]\nkeytypes: [ rsa ]\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"key-size"},"children":[{"type":"text","value":"Key size"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The default key size created by "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"dkim_key_gen.sh"}]},{"type":"text","value":" is 2048. As of mid-2014, there are some DNS providers that do not support key sizes that long."}]},{"type":"element","tag":"h1","props":{"id":"what-to-sign"},"children":[{"type":"text","value":"What to sign"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The DKIM signing key for messages from example.org "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"should"}]},{"type":"text","value":" be signed with\na DKIM key for example.org. Failing to do so will result in messages not\nhaving an "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"aligned"}]},{"type":"text","value":" DKIM signature. For DMARC enabled domains, this will\nlikely result in deliverability problems."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For correct alignment, Haraka signs each message with that domains DKIM key.\nFor an alternative, see the legacy Single Domain Configuration below."}]},{"type":"element","tag":"h1","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin uses the configuration "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"dkim_sign.ini"}]},{"type":"text","value":" in INI format.\nAll configuration should appear within the 'main' block and is\nchecked for updates on every run."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"disabled = "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":" 1 | true | yes"}]},{"type":"text","value":"             (OPTIONAL)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Set this to disable DKIM signing"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"headers_to_sign = list, of; headers       (REQUIRED)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Set this to the list of headers that should be signed\nseparated by either a comma, colon or semi-colon.\nThis is to prevent any tampering of the specified headers.\nThe 'From' header is required to be present by the RFC and\nwill be added if it is missing."}]}]},{"type":"element","tag":"h2","props":{"id":"single-domain-configuration"},"children":[{"type":"text","value":"Single Domain Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To sign all messages with a single DKIM key, these two config settings\nare required."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"selector = name"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Set this to the selector name published in DNS under the\n_domainkey sub-domain of the domain referenced below."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"domain = name"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Set this to the domain name that will be used to sign messages\nwhich don't match a per-domain DKIM key.  The DNS TXT entry for:"},{"type":"element","tag":"code","props":{"code":"  <selector>._domainkey.<domain>\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"  <selector>._domainkey.<domain>\n"}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"dkim.private.key = filename"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Create a file "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"dkim.private.key"}]},{"type":"text","value":" in the config folder and paste\nyour private key in it."}]}]}]},"navigation":{"title":"dkim_sign"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"dkim_sign-plugin"},"children":[{"type":"text","value":"dkim_sign plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin implements the DKIM Core specification found at dkimcore.org"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"DKIM Core is a simplified subset of DKIM which is easier to understand\nand deploy, yet provides all the same delivery advantages as DKIM."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin can only "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"sign"}]},{"type":"text","value":" outbound messages.  It does not validate\nDKIM signatures."}]},{"type":"element","tag":"h2","props":{"id":"getting-started"},"children":[{"type":"text","value":"Getting Started"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Generate DKIM selector and keys:"}]},{"type":"element","tag":"code","props":{"code":"% cd /path/to/haraka/config/dkim\n./dkim_key_gen.sh example.org\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"% cd /path/to/haraka/config/dkim\n./dkim_key_gen.sh example.org"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Peek into the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"dkim_key_gen.sh"}]},{"type":"text","value":" shell script to see the commands used to\ncreate and format the DKIM public key. Within the config/dkim/example.org\ndirectory will be 4 files:"}]},{"type":"element","tag":"code","props":{"code":"% ls config/dkim/example.org/\ndns private public selector\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"% ls config/dkim/example.org/\ndns private public selector"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"private"}]},{"type":"text","value":" and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" files contain the DKIM keys, the selector is\nin the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"selector"}]},{"type":"text","value":" file and the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"dns"}]},{"type":"text","value":" file contains a formatted record of\nthe public key, as well as suggestions for DKIM, SPF, and DMARC policy\nrecords. The records in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"dns"}]},{"type":"text","value":" are ready to be copy/pasted into the DNS\nzone for example.org."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The DKIM DNS record will look like this:"}]},{"type":"element","tag":"code","props":{"code":"may2013._domainkey TXT \"v=DKIM1;p=[public key stripped of whitespace];\"\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"may2013._domainkey TXT \"v=DKIM1;p=[public key stripped of whitespace];\""}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"And the values in the address have the following meaning:"}]},{"type":"element","tag":"code","props":{"code":"hash: h=[ sha1 | sha256 ]\ntest; t=[ s | s:y ]\ngranularity: g=[ ]\nnotes: n=[ ]\nservices: s=[email]\nkeytypes: [ rsa ]\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"hash: h=[ sha1 | sha256 ]\ntest; t=[ s | s:y ]\ngranularity: g=[ ]\nnotes: n=[ ]\nservices: s=[email]\nkeytypes: [ rsa ]"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"key-size"},"children":[{"type":"text","value":"Key size"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The default key size created by "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"dkim_key_gen.sh"}]},{"type":"text","value":" is 2048. As of mid-2014, there are some DNS providers that do not support key sizes that long."}]},{"type":"element","tag":"h1","props":{"id":"what-to-sign"},"children":[{"type":"text","value":"What to sign"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The DKIM signing key for messages from example.org "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"should"}]},{"type":"text","value":" be signed with\na DKIM key for example.org. Failing to do so will result in messages not\nhaving an "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"aligned"}]},{"type":"text","value":" DKIM signature. For DMARC enabled domains, this will\nlikely result in deliverability problems."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For correct alignment, Haraka signs each message with that domains DKIM key.\nFor an alternative, see the legacy Single Domain Configuration below."}]},{"type":"element","tag":"h1","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin uses the configuration "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"dkim_sign.ini"}]},{"type":"text","value":" in INI format.\nAll configuration should appear within the 'main' block and is\nchecked for updates on every run."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"disabled = "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":" 1 | true | yes"}]},{"type":"text","value":"             (OPTIONAL)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Set this to disable DKIM signing"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"headers_to_sign = list, of; headers       (REQUIRED)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Set this to the list of headers that should be signed\nseparated by either a comma, colon or semi-colon.\nThis is to prevent any tampering of the specified headers.\nThe 'From' header is required to be present by the RFC and\nwill be added if it is missing."}]}]},{"type":"element","tag":"h2","props":{"id":"single-domain-configuration"},"children":[{"type":"text","value":"Single Domain Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To sign all messages with a single DKIM key, these two config settings\nare required."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"selector = name"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Set this to the selector name published in DNS under the\n_domainkey sub-domain of the domain referenced below."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"domain = name"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Set this to the domain name that will be used to sign messages\nwhich don't match a per-domain DKIM key.  The DNS TXT entry for:"},{"type":"element","tag":"code","props":{"code":"  <selector>._domainkey.<domain>\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"  <selector>._domainkey.<domain>"}]}]}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"dkim.private.key = filename"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Create a file "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"dkim.private.key"}]},{"type":"text","value":" in the config folder and paste\nyour private key in it."}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"getting-started","depth":2,"text":"Getting Started"},{"id":"key-size","depth":2,"text":"Key size"},{"id":"single-domain-configuration","depth":2,"text":"Single Domain Configuration"}]}},"_type":"markdown","_id":"content:8.plugins:dkim_sign.md","_source":"content","_file":"8.plugins/dkim_sign.md","_extension":"md"},{"_path":"/plugins/dkim_verify","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"dkim_verify - DKIM Verify plugin for Haraka","description":"Haraka dkim_verify plugin - DKIM Verify","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"dkim_verify-plugin"},"children":[{"type":"text","value":"dkim_verify plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin will verify DKIM signatures as defined by RFC 6376 and add\nan Authentication-Results header as appropriate."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"allowed_time_skew"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"How far can we stretch on time matching, in secs. Useful when clock is skewed."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"sigerror_log_level"}]}]},{"type":"element","tag":"h2","props":{"id":"testing"},"children":[{"type":"text","value":"Testing"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin also provides a command-line test tool that can be used to\ndebug DKIM issues or to check results."}]},{"type":"element","tag":"code","props":{"code":"# dkimverify < message\nidentity=\"@gmail.com\" domain=\"gmail.com\" result=pass\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"# dkimverify < message\nidentity=\"@gmail.com\" domain=\"gmail.com\" result=pass\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can add "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"--debug"}]},{"type":"text","value":" to the option arguments to see a full trace of the processing."}]},{"type":"element","tag":"h2","props":{"id":"notes"},"children":[{"type":"text","value":"Notes"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin and underlying library does not currently support DKIM body length limits (l=)."}]}]},"navigation":{"title":"dkim_verify"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"dkim_verify-plugin"},"children":[{"type":"text","value":"dkim_verify plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin will verify DKIM signatures as defined by RFC 6376 and add\nan Authentication-Results header as appropriate."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"allowed_time_skew"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"How far can we stretch on time matching, in secs. Useful when clock is skewed."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"sigerror_log_level"}]}]},{"type":"element","tag":"h2","props":{"id":"testing"},"children":[{"type":"text","value":"Testing"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin also provides a command-line test tool that can be used to\ndebug DKIM issues or to check results."}]},{"type":"element","tag":"code","props":{"code":"# dkimverify < message\nidentity=\"@gmail.com\" domain=\"gmail.com\" result=pass\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"# dkimverify < message\nidentity=\"@gmail.com\" domain=\"gmail.com\" result=pass"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can add "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"--debug"}]},{"type":"text","value":" to the option arguments to see a full trace of the processing."}]},{"type":"element","tag":"h2","props":{"id":"notes"},"children":[{"type":"text","value":"Notes"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin and underlying library does not currently support DKIM body length limits (l=)."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"configuration","depth":2,"text":"Configuration"},{"id":"testing","depth":2,"text":"Testing"},{"id":"notes","depth":2,"text":"Notes"}]}},"_type":"markdown","_id":"content:8.plugins:dkim_verify.md","_source":"content","_file":"8.plugins/dkim_verify.md","_extension":"md"},{"_path":"/plugins/dnsbl","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"dnsbl - DNS Blacklists plugin for Haraka","description":"Haraka dnsbl plugin - DNS Blacklists","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"dnsbl-plugin"},"children":[{"type":"text","value":"dnsbl plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin looks up the connecting IP address in an IP blocklist. Mails\nfound to be in the blocklist are rejected."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugins uses the following files:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"dnsbl.zones - Contains a list of zones to query, one per line."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"dnsbl.ini - INI format with options described below:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"zones"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"A comma or semi-colon list of zones to query.  It will be merged with\nany lists in dnsbl.zones."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"periodic_checks"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If enabled, this will check all the zones every n minutes.\nThe minimum value that will be accepted here is 5.  Any value less\nthan 5 will cause the checks to be run at start-up only."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The checks confirm that the list is responding and that it is not\nlisting the world.  If any errors are detected, then the zone is\ndisabled and will be re-checked on the next test.  If a zone\nsubsequently starts working correctly then it will be re-enabled."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"enable_stats"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"To use this feature you must have installed the 'redis' module and\nhave a redis server running."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"When enabled, this will record several list statistics to redis."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"It will track the total number of queries (TOTAL) and the average\nresponse time (AVG_RT) and the return type (e.g. LISTED or ERROR)\nto a redis hash where the key is 'dns-list-stat:zone' and the hash\nfield is the response type."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"It will also track the positive response overlap between the lists\nin another redis hash where the key is 'dns-list-overlap:zone' and\nthe hash field is the other list names."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Example:"},{"type":"text","value":"  "},{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"redis 127.0.0.1:6379> hgetall dns-list-stat:zen.spamhaus.org\n  1) \"TOTAL\"\n  2) \"23\"\n  3) \"ENOTFOUND\"\n  4) \"11\"\n  5) \"LISTED\"\n  6) \"12\"\n  7) \"AVG_RT\"\n  8) \"45.5\"\n  redis 127.0.0.1:6379> hgetall dns-list-overlap:zen.spamhaus.org\n  1) \"b.barracudacentral.org\"\n  2) \"1\"\n  3) \"bl.spamcop.net\"\n  4) \"1\"\n  5) \"TOTAL\"\n  6) \"1\"\n  "}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"stats_redis_host"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"In the form of "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"host:port"}]},{"type":"text","value":" this option allows you to specify a different\nhost on which redis runs."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"reject (default: true)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Reject connections from IPs that are blacklisted. Setting this to false\nmakes dnsbl informational. reject=false is best used in conjunction with\nplugins like "},{"type":"element","tag":"a","props":{"href":"/plugins/karma"},"children":[{"type":"text","value":"karma"}]},{"type":"text","value":" that employ a scoring\nengine to make choices about message delivery."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"search: (default: first)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"first: consider first DNSBL response conclusive. End processing.\nall:   process all DNSBL results"}]}]}]},"navigation":{"title":"dnsbl"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"dnsbl-plugin"},"children":[{"type":"text","value":"dnsbl plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin looks up the connecting IP address in an IP blocklist. Mails\nfound to be in the blocklist are rejected."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugins uses the following files:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"dnsbl.zones - Contains a list of zones to query, one per line."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"dnsbl.ini - INI format with options described below:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"zones"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"A comma or semi-colon list of zones to query.  It will be merged with\nany lists in dnsbl.zones."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"periodic_checks"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If enabled, this will check all the zones every n minutes.\nThe minimum value that will be accepted here is 5.  Any value less\nthan 5 will cause the checks to be run at start-up only."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The checks confirm that the list is responding and that it is not\nlisting the world.  If any errors are detected, then the zone is\ndisabled and will be re-checked on the next test.  If a zone\nsubsequently starts working correctly then it will be re-enabled."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"enable_stats"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"To use this feature you must have installed the 'redis' module and\nhave a redis server running."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"When enabled, this will record several list statistics to redis."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"It will track the total number of queries (TOTAL) and the average\nresponse time (AVG_RT) and the return type (e.g. LISTED or ERROR)\nto a redis hash where the key is 'dns-list-stat:zone' and the hash\nfield is the response type."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"It will also track the positive response overlap between the lists\nin another redis hash where the key is 'dns-list-overlap:zone' and\nthe hash field is the other list names."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Example:"},{"type":"text","value":"  "},{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"redis 127.0.0.1:6379> hgetall dns-list-stat:zen.spamhaus.org\n  1) \"TOTAL\"\n  2) \"23\"\n  3) \"ENOTFOUND\"\n  4) \"11\"\n  5) \"LISTED\"\n  6) \"12\"\n  7) \"AVG_RT\"\n  8) \"45.5\"\n  redis 127.0.0.1:6379> hgetall dns-list-overlap:zen.spamhaus.org\n  1) \"b.barracudacentral.org\"\n  2) \"1\"\n  3) \"bl.spamcop.net\"\n  4) \"1\"\n  5) \"TOTAL\"\n  6) \"1\"\n  "}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"stats_redis_host"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"In the form of "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"host:port"}]},{"type":"text","value":" this option allows you to specify a different\nhost on which redis runs."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"reject (default: true)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Reject connections from IPs that are blacklisted. Setting this to false\nmakes dnsbl informational. reject=false is best used in conjunction with\nplugins like "},{"type":"element","tag":"a","props":{"href":"/plugins/karma"},"children":[{"type":"text","value":"karma"}]},{"type":"text","value":" that employ a scoring\nengine to make choices about message delivery."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"search: (default: first)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"first: consider first DNSBL response conclusive. End processing.\nall:   process all DNSBL results"}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"configuration","depth":2,"text":"Configuration"}]}},"_type":"markdown","_id":"content:8.plugins:dnsbl.md","_source":"content","_file":"8.plugins/dnsbl.md","_extension":"md"},{"_path":"/plugins/dnswl","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"dnswl - DNSWL plugin for Haraka","description":"Haraka dnswl plugin - DNSWL","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"dnswl-plugin"},"children":[{"type":"text","value":"dnswl plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin looks up the connecting IP address in an IP whitelist.\nIf the host is listed, then the plugin will return OK for all hooks\nup to hook_data."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"IMPORTANT!  The order of plugins in config/plugins is important when\nthis plugin is used.  It should be listed "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"before"}]},{"type":"text","value":" any plugins that\nyou wish to skip, but after any plugins that accept recipients."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugins uses the following files:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"dnswl.zones - Contains a list of zones to query, one per line."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"dnswl.ini - INI format with options described below:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"zones"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"A comma or semi-colon list of zones to query.  It will be merged with\nany lists in dnswl.zones."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"periodic_checks"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If enabled, this will check all the zones every n minutes.\nThe minimum value that will be accepted here is 5.  Any value less\nthan 5 will cause the checks to be run at start-up only."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The checks confirm that the list is responding and that it is not\nlisting the world.  If any errors are detected, then the zone is\ndisabled and will be re-checked on the next test.  If a zone\nsubsequently starts working correctly then it will be re-enabled."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"enable_stats"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"To use this feature you must have installed the 'redis' module and\nhave a redis server running."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"When enabled, this will record several list statistics to redis."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"It will track the total number of queries (TOTAL) and the average\nresponse time (AVG_RT) and the return type (e.g. LISTED or ERROR)\nto a redis hash where the key is 'dns-list-stat:zone' and the hash\nfield is the response type."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"It will also track the positive response overlap between the lists\nin another redis hash where the key is 'dns-list-overlap:zone' and\nthe hash field is the other list names."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Example:"},{"type":"text","value":"  "},{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"redis 127.0.0.1:6379> hgetall dns-list-stat:zen.spamhaus.org\n  1) \"TOTAL\"\n  2) \"23\"\n  3) \"ENOTFOUND\"\n  4) \"11\"\n  5) \"LISTED\"\n  6) \"12\"\n  7) \"AVG_RT\"\n  8) \"45.5\"\n  redis 127.0.0.1:6379> hgetall dns-list-overlap:zen.spamhaus.org\n  1) \"b.barracudacentral.org\"\n  2) \"1\"\n  3) \"bl.spamcop.net\"\n  4) \"1\"\n  5) \"TOTAL\"\n  6) \"1\"\n  "}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"stats_redis_host"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"In the form of "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"host:port"}]},{"type":"text","value":" this option allows you to specify a different\nhost on which redis runs."}]}]}]},"navigation":{"title":"dnswl"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"dnswl-plugin"},"children":[{"type":"text","value":"dnswl plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin looks up the connecting IP address in an IP whitelist.\nIf the host is listed, then the plugin will return OK for all hooks\nup to hook_data."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"IMPORTANT!  The order of plugins in config/plugins is important when\nthis plugin is used.  It should be listed "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"before"}]},{"type":"text","value":" any plugins that\nyou wish to skip, but after any plugins that accept recipients."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugins uses the following files:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"dnswl.zones - Contains a list of zones to query, one per line."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"dnswl.ini - INI format with options described below:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"zones"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"A comma or semi-colon list of zones to query.  It will be merged with\nany lists in dnswl.zones."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"periodic_checks"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If enabled, this will check all the zones every n minutes.\nThe minimum value that will be accepted here is 5.  Any value less\nthan 5 will cause the checks to be run at start-up only."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The checks confirm that the list is responding and that it is not\nlisting the world.  If any errors are detected, then the zone is\ndisabled and will be re-checked on the next test.  If a zone\nsubsequently starts working correctly then it will be re-enabled."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"enable_stats"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"To use this feature you must have installed the 'redis' module and\nhave a redis server running."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"When enabled, this will record several list statistics to redis."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"It will track the total number of queries (TOTAL) and the average\nresponse time (AVG_RT) and the return type (e.g. LISTED or ERROR)\nto a redis hash where the key is 'dns-list-stat:zone' and the hash\nfield is the response type."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"It will also track the positive response overlap between the lists\nin another redis hash where the key is 'dns-list-overlap:zone' and\nthe hash field is the other list names."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Example:"},{"type":"text","value":"  "},{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"redis 127.0.0.1:6379> hgetall dns-list-stat:zen.spamhaus.org\n  1) \"TOTAL\"\n  2) \"23\"\n  3) \"ENOTFOUND\"\n  4) \"11\"\n  5) \"LISTED\"\n  6) \"12\"\n  7) \"AVG_RT\"\n  8) \"45.5\"\n  redis 127.0.0.1:6379> hgetall dns-list-overlap:zen.spamhaus.org\n  1) \"b.barracudacentral.org\"\n  2) \"1\"\n  3) \"bl.spamcop.net\"\n  4) \"1\"\n  5) \"TOTAL\"\n  6) \"1\"\n  "}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"stats_redis_host"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"In the form of "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"host:port"}]},{"type":"text","value":" this option allows you to specify a different\nhost on which redis runs."}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"configuration","depth":2,"text":"Configuration"}]}},"_type":"markdown","_id":"content:8.plugins:dnswl.md","_source":"content","_file":"8.plugins/dnswl.md","_extension":"md"},{"_path":"/plugins/early_talker","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"early_talker - Connection Delays plugin for Haraka","description":"Haraka early_talker plugin - Connection Delays","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"early_talker-plugin"},"children":[{"type":"text","value":"early_talker plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Early talkers are violators of the SMTP specification, which require that\nclients must wait for certain responses before sending the next command."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin introduces a configurable delay before the connection banner\nand after the DATA command for Haraka to detect if it talks early."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If an early talker is detected at connection or DATA, then a DENY is\nreturned with the message 'You talk too soon'."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The config file early_talker.ini has two options:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"pause: the delay in seconds before each SMTP command. Default is no pause."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"reject: whether or not to reject for early talkers. Default is true;"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"ip_whitelist"}]},{"type":"text","value":": list of IP addresses and/or subnets to whitelist"}]}]}]},"navigation":{"title":"early_talker"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"early_talker-plugin"},"children":[{"type":"text","value":"early_talker plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Early talkers are violators of the SMTP specification, which require that\nclients must wait for certain responses before sending the next command."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin introduces a configurable delay before the connection banner\nand after the DATA command for Haraka to detect if it talks early."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If an early talker is detected at connection or DATA, then a DENY is\nreturned with the message 'You talk too soon'."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The config file early_talker.ini has two options:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"pause: the delay in seconds before each SMTP command. Default is no pause."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"reject: whether or not to reject for early talkers. Default is true;"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"ip_whitelist"}]},{"type":"text","value":": list of IP addresses and/or subnets to whitelist"}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"configuration","depth":2,"text":"Configuration"}]}},"_type":"markdown","_id":"content:8.plugins:early_talker.md","_source":"content","_file":"8.plugins/early_talker.md","_extension":"md"},{"_path":"/plugins/esets","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"esets - ESET Antivirus plugin for Haraka","description":"Haraka esets plugin - ESET Antivirus Plugin","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"esets-plugin"},"children":[{"type":"text","value":"esets plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin allows virus scanning with ESET Mail Security for Linux/BSD."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Install the software as per the intructions from ESET and enable this plugin\nand it will scan each message using the \"esets_cli\" command which defaults to\n/opt/eset/esets/bin/esets_cli."}]}]},"navigation":{"title":"esets"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"esets-plugin"},"children":[{"type":"text","value":"esets plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin allows virus scanning with ESET Mail Security for Linux/BSD."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Install the software as per the intructions from ESET and enable this plugin\nand it will scan each message using the \"esets_cli\" command which defaults to\n/opt/eset/esets/bin/esets_cli."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:8.plugins:esets.md","_source":"content","_file":"8.plugins/esets.md","_extension":"md"},{"_path":"/plugins/graph","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"graph - Graphs plugin for Haraka","description":"Haraka graph plugin - Graphs","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"graph-plugin"},"children":[{"type":"text","value":"graph plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin logs accepted and rejected emails into a database and provides\na web server which you can browse to and view graphs over time of the\nplugins which rejected connections."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In order for this to work you need to install the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"sqlite3"}]},{"type":"text","value":" module via\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"npm install sqlite3"}]},{"type":"text","value":" in your Haraka directory."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"config settings are stored in config/graph.ini"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"db_file"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The file name (or :memory:), where data is stored"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"http_addr"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The IP address to listen on for http. Default: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"127.0.0.1"}]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"http_port"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The port to listen on for http. Default: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"8080"}]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"ignore_re"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Regular expression to match plugins to ignore for logging.\nDefault: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"queue|graph|relay"}]}]}]}]},"navigation":{"title":"graph"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"graph-plugin"},"children":[{"type":"text","value":"graph plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin logs accepted and rejected emails into a database and provides\na web server which you can browse to and view graphs over time of the\nplugins which rejected connections."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In order for this to work you need to install the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"sqlite3"}]},{"type":"text","value":" module via\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"npm install sqlite3"}]},{"type":"text","value":" in your Haraka directory."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"config settings are stored in config/graph.ini"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"db_file"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The file name (or :memory:), where data is stored"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"http_addr"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The IP address to listen on for http. Default: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"127.0.0.1"}]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"http_port"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The port to listen on for http. Default: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"8080"}]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"ignore_re"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Regular expression to match plugins to ignore for logging.\nDefault: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"queue|graph|relay"}]}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"configuration","depth":2,"text":"Configuration"}]}},"_type":"markdown","_id":"content:8.plugins:graph.md","_source":"content","_file":"8.plugins/graph.md","_extension":"md"},{"_path":"/plugins/greylist","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"Greylist - Greylisting plugin for Haraka","description":"Haraka greylist plugin - Delays delivery of mail from new senders","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"greylist-plugin"},"children":[{"type":"text","value":"greylist plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Basic greylisting plugin that follows common practices found on internets."}]},{"type":"element","tag":"h2","props":{"id":"principles-of-work"},"children":[{"type":"text","value":"Principles of work"}]},{"type":"element","tag":"h3","props":{"id":"notation"},"children":[{"type":"text","value":"Notation"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The so-called "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"tuple"}]},{"type":"text","value":" consists of the following:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"First subdomain of rDNS is stripped off (but no shorter than the domain boundary). This is considered a "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"hostid"}]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Envelope sender is the "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"sender"}]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"RCPT TO would supply the "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"recipient"}]},{"type":"text","value":"."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"hostid"}]},{"type":"text","value":" in above notation is chosen unless:"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The connecting host has no PTR record, a.k.a. reverse DNS (rDNS). "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"gl"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The rDNS record contains the first two or last two octets of the IP address. "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"fcrdns"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The rDNS record contains the ‘short’, decimal, or hex representation of the full IP address. "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"fcrdns"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"gl"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Multiple rDNS records are returned. "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"gl"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The rDNS record cannot be verified by forward confirmation (e.g. FCrDNS). "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"fcrdns"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The top-level-domain (TLD) used is not valid. "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"gl"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In other cases, it's set to be the remote party's IP address."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We define the following time periods:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"black"}]},{"type":"text","value":":  between first connect and start of "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"gray"}]},{"type":"text","value":". Defer."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"gray"}]},{"type":"text","value":":   between "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"black"}]},{"type":"text","value":" and start of "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"white"}]},{"type":"text","value":". Allow. Host must re-try within this window."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"white"}]},{"type":"text","value":":  comes after "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"gray"}]},{"type":"text","value":". Allow up until the end of period, then let the record expire in case no connections were made."}]}]},{"type":"element","tag":"h3","props":{"id":"algorithm"},"children":[{"type":"text","value":"Algorithm"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The greylist algo is as following:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Party connects. All FcrDNS & DNSWL checks are run by earlier plugins."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Party sends "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"recipient"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"If not already whitelisted"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Check "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"tuple"}]},{"type":"text","value":" color (compare current TS against record creation TS)"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"black"}]},{"type":"text","value":"?"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Create if no record exists. Defer."}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"gray"}]},{"type":"text","value":"?"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Allow. Promote record to "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"white"}]},{"type":"text","value":" status."}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"white"}]},{"type":"text","value":"?"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Allow. Update record TS."}]}]}]}]}]}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"In special case, "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"data"}]},{"type":"text","value":" hook runs above algo for all recipients. If any matched, all inherit the action."}]}]},{"type":"element","tag":"h3","props":{"id":"db-schema"},"children":[{"type":"text","value":"DB schema"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We store in Redis."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Key format for greylisting entries:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"grey:${hostid}:${sender}:${recipient} - grey record"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"white:${hostid} - white record"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"white"}]},{"type":"text","value":":"}]},{"type":"element","tag":"code","props":{"code":"{ first_connect: TS, whitelisted: TS, updated: TS, lifetime: TTL, tried: Integer, tried_when_greylisted: Integer }\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"{ first_connect: TS, whitelisted: TS, updated: TS, lifetime: TTL, tried: Integer, tried_when_greylisted: Integer }\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Where\n"},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"first_connect"}]},{"type":"text","value":": TS of first connection (sender)\n"},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"whitelisted"}]},{"type":"text","value":": basically the TS of this entry creation\n"},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"updated"}]},{"type":"text","value":": last update TS\n"},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"lifetime"}]},{"type":"text","value":": seconds for this entry to exist (== TTL)\n"},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"tried"}]},{"type":"text","value":": number of checks against this entry\n"},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"tried_when_greylisted"}]},{"type":"text","value":": number of checks while the host was +grey+ (sender)."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"grey"}]},{"type":"text","value":":"}]},{"type":"element","tag":"code","props":{"code":"{ created: TS, updated: TS, lifetime: TTL, tried: Integer }\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"{ created: TS, updated: TS, lifetime: TTL, tried: Integer }\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Where\n"},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"created"}]},{"type":"text","value":": TS of first connection (copied to "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"first_connect"}]},{"type":"text","value":" of "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"white"}]},{"type":"text","value":" after promotion)\n"},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"updated"}]},{"type":"text","value":": last update TS\n"},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"lifetime"}]},{"type":"text","value":": seconds for this entry to exist (== TTL)\n"},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"tried"}]},{"type":"text","value":": number of checks against this entry (copied to "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"tried_when_greylisted"}]},{"type":"text","value":" of "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"white"}]},{"type":"text","value":" after promotion)"}]},{"type":"element","tag":"h3","props":{"id":"whitelisting"},"children":[{"type":"text","value":"Whitelisting"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It's possible to whitelist hosts using the following section in greylist.ini config file:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"ip_whitelist               IP or subnet (prefix notation)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"envelope_whitelist         MAIL FROM (email or domain)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"recipient_whitelist        RCPT TO  (email or domain)"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"List of known dynamic hosts, to use the IP instead of the domain:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"special_dynamic_domains    Domain"}]}]}]},"navigation":{"title":"greylist"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"greylist-plugin"},"children":[{"type":"text","value":"greylist plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Basic greylisting plugin that follows common practices found on internets."}]},{"type":"element","tag":"h2","props":{"id":"principles-of-work"},"children":[{"type":"text","value":"Principles of work"}]},{"type":"element","tag":"h3","props":{"id":"notation"},"children":[{"type":"text","value":"Notation"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The so-called "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"tuple"}]},{"type":"text","value":" consists of the following:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"First subdomain of rDNS is stripped off (but no shorter than the domain boundary). This is considered a "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"hostid"}]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Envelope sender is the "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"sender"}]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"RCPT TO would supply the "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"recipient"}]},{"type":"text","value":"."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"hostid"}]},{"type":"text","value":" in above notation is chosen unless:"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The connecting host has no PTR record, a.k.a. reverse DNS (rDNS). "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"gl"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The rDNS record contains the first two or last two octets of the IP address. "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"fcrdns"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The rDNS record contains the ‘short’, decimal, or hex representation of the full IP address. "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"fcrdns"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"gl"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Multiple rDNS records are returned. "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"gl"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The rDNS record cannot be verified by forward confirmation (e.g. FCrDNS). "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"fcrdns"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The top-level-domain (TLD) used is not valid. "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"gl"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In other cases, it's set to be the remote party's IP address."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We define the following time periods:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"black"}]},{"type":"text","value":":  between first connect and start of "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"gray"}]},{"type":"text","value":". Defer."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"gray"}]},{"type":"text","value":":   between "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"black"}]},{"type":"text","value":" and start of "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"white"}]},{"type":"text","value":". Allow. Host must re-try within this window."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"white"}]},{"type":"text","value":":  comes after "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"gray"}]},{"type":"text","value":". Allow up until the end of period, then let the record expire in case no connections were made."}]}]},{"type":"element","tag":"h3","props":{"id":"algorithm"},"children":[{"type":"text","value":"Algorithm"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The greylist algo is as following:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Party connects. All FcrDNS & DNSWL checks are run by earlier plugins."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Party sends "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"recipient"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"If not already whitelisted"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Check "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"tuple"}]},{"type":"text","value":" color (compare current TS against record creation TS)"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"black"}]},{"type":"text","value":"?"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Create if no record exists. Defer."}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"gray"}]},{"type":"text","value":"?"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Allow. Promote record to "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"white"}]},{"type":"text","value":" status."}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"white"}]},{"type":"text","value":"?"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Allow. Update record TS."}]}]}]}]}]}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"In special case, "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"data"}]},{"type":"text","value":" hook runs above algo for all recipients. If any matched, all inherit the action."}]}]},{"type":"element","tag":"h3","props":{"id":"db-schema"},"children":[{"type":"text","value":"DB schema"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We store in Redis."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Key format for greylisting entries:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"grey:${hostid}:${sender}:${recipient} - grey record"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"white:${hostid} - white record"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"white"}]},{"type":"text","value":":"}]},{"type":"element","tag":"code","props":{"code":"{ first_connect: TS, whitelisted: TS, updated: TS, lifetime: TTL, tried: Integer, tried_when_greylisted: Integer }\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"{ first_connect: TS, whitelisted: TS, updated: TS, lifetime: TTL, tried: Integer, tried_when_greylisted: Integer }"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Where\n"},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"first_connect"}]},{"type":"text","value":": TS of first connection (sender)\n"},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"whitelisted"}]},{"type":"text","value":": basically the TS of this entry creation\n"},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"updated"}]},{"type":"text","value":": last update TS\n"},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"lifetime"}]},{"type":"text","value":": seconds for this entry to exist (== TTL)\n"},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"tried"}]},{"type":"text","value":": number of checks against this entry\n"},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"tried_when_greylisted"}]},{"type":"text","value":": number of checks while the host was +grey+ (sender)."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"grey"}]},{"type":"text","value":":"}]},{"type":"element","tag":"code","props":{"code":"{ created: TS, updated: TS, lifetime: TTL, tried: Integer }\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"{ created: TS, updated: TS, lifetime: TTL, tried: Integer }"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Where\n"},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"created"}]},{"type":"text","value":": TS of first connection (copied to "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"first_connect"}]},{"type":"text","value":" of "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"white"}]},{"type":"text","value":" after promotion)\n"},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"updated"}]},{"type":"text","value":": last update TS\n"},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"lifetime"}]},{"type":"text","value":": seconds for this entry to exist (== TTL)\n"},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"tried"}]},{"type":"text","value":": number of checks against this entry (copied to "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"tried_when_greylisted"}]},{"type":"text","value":" of "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"white"}]},{"type":"text","value":" after promotion)"}]},{"type":"element","tag":"h3","props":{"id":"whitelisting"},"children":[{"type":"text","value":"Whitelisting"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It's possible to whitelist hosts using the following section in greylist.ini config file:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"ip_whitelist               IP or subnet (prefix notation)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"envelope_whitelist         MAIL FROM (email or domain)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"recipient_whitelist        RCPT TO  (email or domain)"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"List of known dynamic hosts, to use the IP instead of the domain:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"special_dynamic_domains    Domain"}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"principles-of-work","depth":2,"text":"Principles of work","children":[{"id":"notation","depth":3,"text":"Notation"},{"id":"algorithm","depth":3,"text":"Algorithm"},{"id":"db-schema","depth":3,"text":"DB schema"},{"id":"whitelisting","depth":3,"text":"Whitelisting"}]}]}},"_type":"markdown","_id":"content:8.plugins:greylist.md","_source":"content","_file":"8.plugins/greylist.md","_extension":"md"},{"_path":"/plugins/helo.checks","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"helo.checks - HELO Checks plugin for Haraka","description":"Haraka helo.checks plugin - Rejects messages with invalid HELO/EHLO","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"helochecks-plugin"},"children":[{"type":"text","value":"helo.checks plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin performs a number of checks on the HELO string."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"HELO strings are very often forged or dubious in spam and so this can be a\nhighly effective and false-positive free anti-spam measure."}]},{"type":"element","tag":"h2","props":{"id":"usage"},"children":[{"type":"text","value":"Usage"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"helo.checks results can be accessed by subsequent plugins:"}]},{"type":"element","tag":"code","props":{"code":"var h = connection.results.get('helo.checks');\nif (h.pass && h.pass.length > 5) {\n    // nice job, you passed 6+ tests\n}\nif (h.fail && h.fail.length > 3) {\n    // yikes, you failed 4+ tests!\n}\nif (connection.results.has('helo.checks','pass', /^forward_dns/) {\n    // the HELO hostname is valid\n}\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"var h = connection.results.get('helo.checks');\nif (h.pass && h.pass.length > 5) {\n    // nice job, you passed 6+ tests\n}\nif (h.fail && h.fail.length > 3) {\n    // yikes, you failed 4+ tests!\n}\nif (connection.results.has('helo.checks','pass', /^forward_dns/) {\n    // the HELO hostname is valid\n}\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"helo.checks.regexps"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"List of regular expressions to match against the HELO string. The regular\nexpressions are automatically wrapped in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"^"}]},{"type":"text","value":" and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"$"}]},{"type":"text","value":" so they always match\nthe entire string."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"helo.checks.ini"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"INI file which controls enabling of certain checks:"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"dns_timeout=30"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"How many seconds to wait for DNS queries to timeout."}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"check"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"check"}]}]},{"type":"element","tag":"code","props":{"code":"* valid\\_hostname=true\n\n  Checks that the HELO has at least one '.' in it and the organizational\n  name is possible (ie, a host within a Public Suffix).\n\n* bare\\_ip=true\n\n  Checks for HELO <IP> where the IP is not surrounded by square brackets.\n  This is an RFC violation so should always be enabled.\n\n* dynamic=true\n\n  Checks to see if all or part the connecting IP address appears within\n  the HELO argument to indicate that the client has a dynamic IP address.\n\n* literal\\_mismatch=1|2|3\n\n  Checks to see if the IP literal used matches the connecting IP address.\n  If set to 1, the full IP must match.  If set to 2, the /24 must match.\n  If set to 3, the /24 may match, or the IP can be private (RFC 1918).\n\n* match\\_re=true\n\n  See above. This is merely an on/off toggle.\n\n* big\\_company=true\n\n  See below. This is merely an on/off toggle.\n\n* forward\\_dns=true\n\n  Perform a DNS lookup of the HELO hostname and validate that the IP of\n  the remote is included in the IP(s) of the HELO hostname.\n\n  This test requires that the valid\\_hostname check is also enabled.\n\n* rdns\\_match=true\n\n  Sees if the HELO hostname (or at least the domain) match the rDNS\n  hostname(s).\n\n* host\\_mismatch=true\n\n  If HELO is called multiple times, checks if the hostname differs between\n  EHLO invocations.\n\n* proto\\_mismatch=true\n\n  If EHLO was sent and the host later tries to then send HELO or vice-versa.\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"* valid\\_hostname=true\n\n  Checks that the HELO has at least one '.' in it and the organizational\n  name is possible (ie, a host within a Public Suffix).\n\n* bare\\_ip=true\n\n  Checks for HELO <IP> where the IP is not surrounded by square brackets.\n  This is an RFC violation so should always be enabled.\n\n* dynamic=true\n\n  Checks to see if all or part the connecting IP address appears within\n  the HELO argument to indicate that the client has a dynamic IP address.\n\n* literal\\_mismatch=1|2|3\n\n  Checks to see if the IP literal used matches the connecting IP address.\n  If set to 1, the full IP must match.  If set to 2, the /24 must match.\n  If set to 3, the /24 may match, or the IP can be private (RFC 1918).\n\n* match\\_re=true\n\n  See above. This is merely an on/off toggle.\n\n* big\\_company=true\n\n  See below. This is merely an on/off toggle.\n\n* forward\\_dns=true\n\n  Perform a DNS lookup of the HELO hostname and validate that the IP of\n  the remote is included in the IP(s) of the HELO hostname.\n\n  This test requires that the valid\\_hostname check is also enabled.\n\n* rdns\\_match=true\n\n  Sees if the HELO hostname (or at least the domain) match the rDNS\n  hostname(s).\n\n* host\\_mismatch=true\n\n  If HELO is called multiple times, checks if the hostname differs between\n  EHLO invocations.\n\n* proto\\_mismatch=true\n\n  If EHLO was sent and the host later tries to then send HELO or vice-versa.\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"reject"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"reject"}]}]},{"type":"element","tag":"code","props":{"code":"For all of the checks included above, a matching key in the reject section\ncontrols whether messages that fail the test are rejected.\n\nDefaults shown:\n\n[reject]\nhost_mismatch=false\nliteral_mismatch=false\nproto_mismatch=false\nrdns_match=false\ndynamic=false\nbare_ip=false\nvalid_hostname=false\nforward_dns=false\nbig_company=false\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"For all of the checks included above, a matching key in the reject section\ncontrols whether messages that fail the test are rejected.\n\nDefaults shown:\n\n[reject]\nhost_mismatch=false\nliteral_mismatch=false\nproto_mismatch=false\nrdns_match=false\ndynamic=false\nbare_ip=false\nvalid_hostname=false\nforward_dns=false\nbig_company=false\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"skip"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"skip"}]}]},{"type":"element","tag":"code","props":{"code":"* private\\_ip=true\n\n  Bypasses checks for clients within RFC1918, Loopback or APIPA IP address ranges.\n\n* relaying\n\n  Bypass checks for clients who have relaying privileges (whitelisted IP,\n  SMTP-AUTH, etc).\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"* private\\_ip=true\n\n  Bypasses checks for clients within RFC1918, Loopback or APIPA IP address ranges.\n\n* relaying\n\n  Bypass checks for clients who have relaying privileges (whitelisted IP,\n  SMTP-AUTH, etc).\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"bigco"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"bigco"}]}]},{"type":"element","tag":"code","props":{"code":"  A list of <helo>=<rdns>[,<rdns>...] to match against. If the HELO matches\n  what's on the left hand side, the reverse-DNS must match one of the\n  entries on the right hand side or the mail is blocked.\n\n  Example:\n\n        yahoo.com=yahoo.com,yahoo.co.jp\n        aol.com=aol.com\n        gmail.com=google.com\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"  A list of <helo>=<rdns>[,<rdns>...] to match against. If the HELO matches\n  what's on the left hand side, the reverse-DNS must match one of the\n  entries on the right hand side or the mail is blocked.\n\n  Example:\n\n        yahoo.com=yahoo.com,yahoo.co.jp\n        aol.com=aol.com\n        gmail.com=google.com\n"}]}]}]}]},"navigation":{"title":"helo.checks"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"helochecks-plugin"},"children":[{"type":"text","value":"helo.checks plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin performs a number of checks on the HELO string."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"HELO strings are very often forged or dubious in spam and so this can be a\nhighly effective and false-positive free anti-spam measure."}]},{"type":"element","tag":"h2","props":{"id":"usage"},"children":[{"type":"text","value":"Usage"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"helo.checks results can be accessed by subsequent plugins:"}]},{"type":"element","tag":"code","props":{"code":"var h = connection.results.get('helo.checks');\nif (h.pass && h.pass.length > 5) {\n    // nice job, you passed 6+ tests\n}\nif (h.fail && h.fail.length > 3) {\n    // yikes, you failed 4+ tests!\n}\nif (connection.results.has('helo.checks','pass', /^forward_dns/) {\n    // the HELO hostname is valid\n}\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d87712"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-e277b9"},"children":[{"type":"text","value":" h "}]},{"type":"element","tag":"span","props":{"class":"ct-d87712"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-e277b9"},"children":[{"type":"text","value":" connection.results."}]},{"type":"element","tag":"span","props":{"class":"ct-4477aa"},"children":[{"type":"text","value":"get"}]},{"type":"element","tag":"span","props":{"class":"ct-e277b9"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-d7f8a2"},"children":[{"type":"text","value":"'helo.checks'"}]},{"type":"element","tag":"span","props":{"class":"ct-e277b9"},"children":[{"type":"text","value":");"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d87712"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-e277b9"},"children":[{"type":"text","value":" (h.pass "}]},{"type":"element","tag":"span","props":{"class":"ct-d87712"},"children":[{"type":"text","value":"&&"}]},{"type":"element","tag":"span","props":{"class":"ct-e277b9"},"children":[{"type":"text","value":" h.pass."}]},{"type":"element","tag":"span","props":{"class":"ct-d7e890"},"children":[{"type":"text","value":"length"}]},{"type":"element","tag":"span","props":{"class":"ct-e277b9"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-d87712"},"children":[{"type":"text","value":">"}]},{"type":"element","tag":"span","props":{"class":"ct-e277b9"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-d7e890"},"children":[{"type":"text","value":"5"}]},{"type":"element","tag":"span","props":{"class":"ct-e277b9"},"children":[{"type":"text","value":") {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e277b9"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-4bd6c6"},"children":[{"type":"text","value":"// nice job, you passed 6+ tests"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e277b9"},"children":[{"type":"text","value":"}"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d87712"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-e277b9"},"children":[{"type":"text","value":" (h.fail "}]},{"type":"element","tag":"span","props":{"class":"ct-d87712"},"children":[{"type":"text","value":"&&"}]},{"type":"element","tag":"span","props":{"class":"ct-e277b9"},"children":[{"type":"text","value":" h.fail."}]},{"type":"element","tag":"span","props":{"class":"ct-d7e890"},"children":[{"type":"text","value":"length"}]},{"type":"element","tag":"span","props":{"class":"ct-e277b9"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-d87712"},"children":[{"type":"text","value":">"}]},{"type":"element","tag":"span","props":{"class":"ct-e277b9"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-d7e890"},"children":[{"type":"text","value":"3"}]},{"type":"element","tag":"span","props":{"class":"ct-e277b9"},"children":[{"type":"text","value":") {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e277b9"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-4bd6c6"},"children":[{"type":"text","value":"// yikes, you failed 4+ tests!"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e277b9"},"children":[{"type":"text","value":"}"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d87712"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-e277b9"},"children":[{"type":"text","value":" (connection.results."}]},{"type":"element","tag":"span","props":{"class":"ct-4477aa"},"children":[{"type":"text","value":"has"}]},{"type":"element","tag":"span","props":{"class":"ct-e277b9"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-d7f8a2"},"children":[{"type":"text","value":"'helo.checks'"}]},{"type":"element","tag":"span","props":{"class":"ct-e277b9"},"children":[{"type":"text","value":","}]},{"type":"element","tag":"span","props":{"class":"ct-d7f8a2"},"children":[{"type":"text","value":"'pass'"}]},{"type":"element","tag":"span","props":{"class":"ct-e277b9"},"children":[{"type":"text","value":","}]},{"type":"element","tag":"span","props":{"class":"ct-d7f8a2"},"children":[{"type":"text","value":" /"}]},{"type":"element","tag":"span","props":{"class":"ct-d87712"},"children":[{"type":"text","value":"^"}]},{"type":"element","tag":"span","props":{"class":"ct-d7f8a2"},"children":[{"type":"text","value":"forward_dns/"}]},{"type":"element","tag":"span","props":{"class":"ct-e277b9"},"children":[{"type":"text","value":") {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e277b9"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-4bd6c6"},"children":[{"type":"text","value":"// the HELO hostname is valid"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e277b9"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"helo.checks.regexps"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"List of regular expressions to match against the HELO string. The regular\nexpressions are automatically wrapped in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"^"}]},{"type":"text","value":" and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"$"}]},{"type":"text","value":" so they always match\nthe entire string."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"helo.checks.ini"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"INI file which controls enabling of certain checks:"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"dns_timeout=30"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"How many seconds to wait for DNS queries to timeout."}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"check"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"check"}]}]},{"type":"element","tag":"code","props":{"code":"* valid\\_hostname=true\n\n  Checks that the HELO has at least one '.' in it and the organizational\n  name is possible (ie, a host within a Public Suffix).\n\n* bare\\_ip=true\n\n  Checks for HELO <IP> where the IP is not surrounded by square brackets.\n  This is an RFC violation so should always be enabled.\n\n* dynamic=true\n\n  Checks to see if all or part the connecting IP address appears within\n  the HELO argument to indicate that the client has a dynamic IP address.\n\n* literal\\_mismatch=1|2|3\n\n  Checks to see if the IP literal used matches the connecting IP address.\n  If set to 1, the full IP must match.  If set to 2, the /24 must match.\n  If set to 3, the /24 may match, or the IP can be private (RFC 1918).\n\n* match\\_re=true\n\n  See above. This is merely an on/off toggle.\n\n* big\\_company=true\n\n  See below. This is merely an on/off toggle.\n\n* forward\\_dns=true\n\n  Perform a DNS lookup of the HELO hostname and validate that the IP of\n  the remote is included in the IP(s) of the HELO hostname.\n\n  This test requires that the valid\\_hostname check is also enabled.\n\n* rdns\\_match=true\n\n  Sees if the HELO hostname (or at least the domain) match the rDNS\n  hostname(s).\n\n* host\\_mismatch=true\n\n  If HELO is called multiple times, checks if the hostname differs between\n  EHLO invocations.\n\n* proto\\_mismatch=true\n\n  If EHLO was sent and the host later tries to then send HELO or vice-versa.\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"* valid\\_hostname=true\n\n  Checks that the HELO has at least one '.' in it and the organizational\n  name is possible (ie, a host within a Public Suffix).\n\n* bare\\_ip=true\n\n  Checks for HELO <IP> where the IP is not surrounded by square brackets.\n  This is an RFC violation so should always be enabled.\n\n* dynamic=true\n\n  Checks to see if all or part the connecting IP address appears within\n  the HELO argument to indicate that the client has a dynamic IP address.\n\n* literal\\_mismatch=1|2|3\n\n  Checks to see if the IP literal used matches the connecting IP address.\n  If set to 1, the full IP must match.  If set to 2, the /24 must match.\n  If set to 3, the /24 may match, or the IP can be private (RFC 1918).\n\n* match\\_re=true\n\n  See above. This is merely an on/off toggle.\n\n* big\\_company=true\n\n  See below. This is merely an on/off toggle.\n\n* forward\\_dns=true\n\n  Perform a DNS lookup of the HELO hostname and validate that the IP of\n  the remote is included in the IP(s) of the HELO hostname.\n\n  This test requires that the valid\\_hostname check is also enabled.\n\n* rdns\\_match=true\n\n  Sees if the HELO hostname (or at least the domain) match the rDNS\n  hostname(s).\n\n* host\\_mismatch=true\n\n  If HELO is called multiple times, checks if the hostname differs between\n  EHLO invocations.\n\n* proto\\_mismatch=true\n\n  If EHLO was sent and the host later tries to then send HELO or vice-versa."}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"reject"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"reject"}]}]},{"type":"element","tag":"code","props":{"code":"For all of the checks included above, a matching key in the reject section\ncontrols whether messages that fail the test are rejected.\n\nDefaults shown:\n\n[reject]\nhost_mismatch=false\nliteral_mismatch=false\nproto_mismatch=false\nrdns_match=false\ndynamic=false\nbare_ip=false\nvalid_hostname=false\nforward_dns=false\nbig_company=false\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"For all of the checks included above, a matching key in the reject section\ncontrols whether messages that fail the test are rejected.\n\nDefaults shown:\n\n[reject]\nhost_mismatch=false\nliteral_mismatch=false\nproto_mismatch=false\nrdns_match=false\ndynamic=false\nbare_ip=false\nvalid_hostname=false\nforward_dns=false\nbig_company=false"}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"skip"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"skip"}]}]},{"type":"element","tag":"code","props":{"code":"* private\\_ip=true\n\n  Bypasses checks for clients within RFC1918, Loopback or APIPA IP address ranges.\n\n* relaying\n\n  Bypass checks for clients who have relaying privileges (whitelisted IP,\n  SMTP-AUTH, etc).\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"* private\\_ip=true\n\n  Bypasses checks for clients within RFC1918, Loopback or APIPA IP address ranges.\n\n* relaying\n\n  Bypass checks for clients who have relaying privileges (whitelisted IP,\n  SMTP-AUTH, etc)."}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"bigco"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"bigco"}]}]},{"type":"element","tag":"code","props":{"code":"  A list of <helo>=<rdns>[,<rdns>...] to match against. If the HELO matches\n  what's on the left hand side, the reverse-DNS must match one of the\n  entries on the right hand side or the mail is blocked.\n\n  Example:\n\n        yahoo.com=yahoo.com,yahoo.co.jp\n        aol.com=aol.com\n        gmail.com=google.com\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"  A list of <helo>=<rdns>[,<rdns>...] to match against. If the HELO matches\n  what's on the left hand side, the reverse-DNS must match one of the\n  entries on the right hand side or the mail is blocked.\n\n  Example:\n\n        yahoo.com=yahoo.com,yahoo.co.jp\n        aol.com=aol.com\n        gmail.com=google.com"}]}]}]}]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-4bd6c6{color:#6E7781}\n.ct-d7e890{color:#0550AE}\n.ct-d7f8a2{color:#0A3069}\n.ct-4477aa{color:#8250DF}\n.ct-e277b9{color:#24292F}\n.ct-d87712{color:#CF222E}\n.dark .ct-d87712{color:#FF7B72}\n.dark .ct-e277b9{color:#C9D1D9}\n.dark .ct-4477aa{color:#D2A8FF}\n.dark .ct-d7f8a2{color:#A5D6FF}\n.dark .ct-d7e890{color:#79C0FF}\n.dark .ct-4bd6c6{color:#8B949E}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"usage","depth":2,"text":"Usage"},{"id":"configuration","depth":2,"text":"Configuration","children":[{"id":"check","depth":3,"text":"check"},{"id":"reject","depth":3,"text":"reject"},{"id":"skip","depth":3,"text":"skip"},{"id":"bigco","depth":3,"text":"bigco"}]}]}},"_type":"markdown","_id":"content:8.plugins:helo.checks.md","_source":"content","_file":"8.plugins/helo.checks.md","_extension":"md"},{"_path":"/plugins/karma","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"karma - a scoring engine plugin for Haraka","description":"Haraka karma plugin - a scoring engine for Haraka","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"karma-plugin"},"children":[{"type":"text","value":"karma plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Karma is a heuristic scoring engine that uses connection metadata and other Haraka plugins as inputs. Connections scoring in excess of specified thresholds are rewarded or "},{"type":"element","tag":"a","props":{"href":"#penalties"},"children":[{"type":"text","value":"penalized"}]},{"type":"text","value":" in proportionate ways."}]},{"type":"element","tag":"h2","props":{"id":"description"},"children":[{"type":"text","value":"Description"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Haraka includes some excellent plugins that detect message or sender patterns that are indicative of spam. "},{"type":"element","tag":"a","props":{"href":"http://haraka.github.io/plugins/spamassassin","rel":["nofollow"]},"children":[{"type":"text","value":"Some"}]},{"type":"text","value":" "},{"type":"element","tag":"a","props":{"href":"http://haraka.github.io/plugins/messagesniffer","rel":["nofollow"]},"children":[{"type":"text","value":"plugins"}]},{"type":"text","value":" "},{"type":"element","tag":"a","props":{"href":"http://haraka.github.io/plugins/connect.fcrdns","rel":["nofollow"]},"children":[{"type":"text","value":"have"}]},{"type":"text","value":" "},{"type":"element","tag":"a","props":{"href":"http://haraka.github.io/plugins/data.uribl","rel":["nofollow"]},"children":[{"type":"text","value":"accuracy"}]},{"type":"text","value":" rates above 95%. Detecting messages incorrectly 5% of the time means that some portion of ham will get blocked and some portion of spam will get delivered. The traditional solution is to permit users to specify their filtering aggressiveness, and then suffer the consequences (blocked ham -vs- too much spam)."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"By scoring and weighting several \"95+\" plugins, accuracy rates above 99% are attainable. With a half dozen such plugins, "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"99.99% accuracy"}]},{"type":"text","value":" is attainable. With karma, good senders with good history can occasionally fail tests (false positives) and still deliver their mail. Senders with poor history will have a much harder time."}]},{"type":"element","tag":"h3","props":{"id":"karma-prereqs"},"children":[{"type":"text","value":"Karma Prereqs"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"One challenge for mail filtering is that filters (or plugins, in Haraka's case) are usually called in sequence. A message passes from one filter to the next in a pipeline and each filter gets to choose \"yeah or nay.\" In order for karma to transcend this limit, karma requires that "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"every"}]},{"type":"text","value":" filter passes every message. Nearly all Haraka plugins have a "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"reject"}]},{"type":"text","value":" or "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"deny"}]},{"type":"text","value":" option for this reason."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In order to score a filters results, filters must save their results to the "},{"type":"element","tag":"a","props":{"href":"http://haraka.github.io/core/Results","rel":["nofollow"]},"children":[{"type":"text","value":"Result Store"}]},{"type":"text","value":". Karma will see that and apply the award specified in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"karma.ini"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h2","props":{"id":"how-karma-works"},"children":[{"type":"text","value":"How Karma Works"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Karma takes a holistic view of "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"connections"}]},{"type":"text","value":". During the connection, karma collects these results and applies the "},{"type":"element","tag":"a","props":{"href":"#awards"},"children":[{"type":"text","value":"result_awards"}]},{"type":"text","value":" defined in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"karma.ini"}]},{"type":"text","value":". Once a connection/message exceeds the threshold.negative score (default: -8), karma rejects it at the next "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"deny"}]},{"type":"text","value":"hook."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The scoring mechanism is not dissimilar to "},{"type":"element","tag":"a","props":{"href":"http://haraka.github.io/plugins/spamassassin","rel":["nofollow"]},"children":[{"type":"text","value":"SpamAssassin"}]},{"type":"text","value":", but Karma has some particular advantages:"}]},{"type":"element","tag":"code","props":{"code":"* Runs entirely in Node, so it's very fast\n* Async and very scalable.\n* Builds sender and network reputation databases\n* Has access to connection properties (relaying, port, auth attempts, etc..)\n* Access to raw SMTP commands (data + formatting inspection)\n* Can reject connections before DATA (save lots of bandwidth)\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"* Runs entirely in Node, so it's very fast\n* Async and very scalable.\n* Builds sender and network reputation databases\n* Has access to connection properties (relaying, port, auth attempts, etc..)\n* Access to raw SMTP commands (data + formatting inspection)\n* Can reject connections before DATA (save lots of bandwidth)\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Karma is not a replacement for content filters. Karma focuses on the quality of the "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"connection"}]},{"type":"text","value":". Content filters (bayes*) focus on the content of the "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"message"}]},{"type":"text","value":". Karma works best "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"with"}]},{"type":"text","value":" content filters."}]},{"type":"element","tag":"h1","props":{"id":"config"},"children":[{"type":"text","value":"CONFIG"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"See config/karma.ini for options and inline documentation."}]},{"type":"element","tag":"h2","props":{"id":"awards"},"children":[{"type":"text","value":"AWARDS"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Karma allows the site administrator to control how much weight to assign to\nplugin results, providing a great deal of control over what results are\nworth rejecting for."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Karma begins scoring the connection when the first packet arrives. The IP reputation, "},{"type":"element","tag":"a","props":{"href":"http://haraka.github.io/plugins/connect.p0f","rel":["nofollow"]},"children":[{"type":"text","value":"sender OS"}]},{"type":"text","value":", "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-geoip","rel":["nofollow"]},"children":[{"type":"text","value":"GeoIP location"}]},{"type":"text","value":", "},{"type":"element","tag":"a","props":{"href":"http://haraka.github.io/plugins/dnsbl","rel":["nofollow"]},"children":[{"type":"text","value":"DNSBL"}]},{"type":"text","value":" listing, and "},{"type":"element","tag":"a","props":{"href":"http://haraka.github.io/plugins/connect.fcrdns","rel":["nofollow"]},"children":[{"type":"text","value":"FCrDNS"}]},{"type":"text","value":" are often a sufficient basis for rejecting a connection without ever blocking a ham."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Karma performs checks early and often, maximizing the penality it can exact upon bad mailers."}]},{"type":"element","tag":"h2","props":{"id":"penalties"},"children":[{"type":"text","value":"Penalties"}]},{"type":"element","tag":"h3","props":{"id":"deny-reject"},"children":[{"type":"text","value":"Deny / Reject"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When connections become worse than "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"thresholds"}]},{"type":"text","value":"negative, they are denied during the next "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"deny"}]},{"type":"text","value":"hook."}]},{"type":"element","tag":"h3","props":{"id":"history"},"children":[{"type":"text","value":"History"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Karma history is computed as the number of good - bad connections."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When each connection ends, "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"karma"}]},{"type":"text","value":" records the result. When a sufficient history has been built for an IP or ASN, future connections from that address(es) will get a positive or negative karma award."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The reward is purposefully small, to permit good senders in bad neighborhoods to still send."}]},{"type":"element","tag":"h3","props":{"id":"connection-delays"},"children":[{"type":"text","value":"Connection Delays"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Connection delays (aka tarpitting, teergrubing, early talker) slow down a SMTP conversation by inserting artificial delays. Karma increases connection delays adaptively as connection quality changes."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Karma's delay goals:"}]},{"type":"element","tag":"code","props":{"code":"1. Don't delay valid senders\n2. Penalize senders in proportion to their karma score\n3. Dampen bruteforce AUTH attacks.\n4. Since the only *cost* we can exact from miscreants is time, and connections are cheap to maintain, keep miscreants online as long as possible.\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"1. Don't delay valid senders\n2. Penalize senders in proportion to their karma score\n3. Dampen bruteforce AUTH attacks.\n4. Since the only *cost* we can exact from miscreants is time, and connections are cheap to maintain, keep miscreants online as long as possible.\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"There are three tarpit options:"}]},{"type":"element","tag":"code","props":{"code":"[tarpit]\n* delay=0   (seconds to delay,      default: 0)\n* max=5     (max seconds to delay,  default: 5)\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"[tarpit]\n* delay=0   (seconds to delay,      default: 0)\n* max=5     (max seconds to delay,  default: 5)\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When set to zero, the value of the delay is adaptive, calculated proportional\nto the karma score of the connection. Connections with good karma will see no\ndelay and bad ones will see long delays."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When delay is non-zero, each SMTP response will be delayed by that many seconds."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In practice, most naughty senders abandon the connection when forced to\nwait more than a handful of seconds. "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"max"}]},{"type":"text","value":" sets the maximum delay between\nresponses."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When using "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"karma"}]},{"type":"text","value":", do not use Haraka's "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"tarpit"}]},{"type":"text","value":" plugin."}]},{"type":"element","tag":"h2","props":{"id":"included-tests"},"children":[{"type":"text","value":"Included Tests"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Connection data that karma considers:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#IP_Reputation"},"children":[{"type":"text","value":"IP Reputation"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#Neighbor_Reputation"},"children":[{"type":"text","value":"ASN reputation"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"DENY events by other plugins"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"envelope sender from a spammy TLD"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#malformed_env"},"children":[{"type":"text","value":"malformed envelope addresses"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#unrecognized"},"children":[{"type":"text","value":"unrecognized SMTP commands"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"matching "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"env from"}]},{"type":"text","value":" and "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"env to"}]},{"type":"text","value":" name (rare in ham, frequent in spam)"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The data from these tests are helpful but the real power of karma is "},{"type":"element","tag":"a","props":{"href":"#awards"},"children":[{"type":"text","value":"scoring\nthe results"}]},{"type":"text","value":" of other plugins. See karma.ini for a rich set of examples."}]},{"type":"element","tag":"h3","props":{"id":"ip-reputation"},"children":[{"type":"element","tag":"a","props":{"name":"IP_Reputation"},"children":[]},{"type":"text","value":"IP Reputation"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Karma records the number of good, bad, and total connections.  The results\nare accessible to other plugins as well."}]},{"type":"element","tag":"code","props":{"code":"var karma = connection.results.get('karma');\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"var karma = connection.results.get('karma');\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The karma result object contains at least the following:"}]},{"type":"element","tag":"code","props":{"code":"score: 0,         <- score for this connection\nhistory: 0,       <- score for all connections\n   good: 0,       <- qty of past 'good' connections\n   bad: 0,        <- qty of past 'bad' connections\nconnections: 0,   <- total past connections\npass: [],         <- tests that added positive karma\nfail: [],         <- tests that added negative karma\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"score: 0,         <- score for this connection\nhistory: 0,       <- score for all connections\n   good: 0,       <- qty of past 'good' connections\n   bad: 0,        <- qty of past 'bad' connections\nconnections: 0,   <- total past connections\npass: [],         <- tests that added positive karma\nfail: [],         <- tests that added negative karma\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If an IP has at least 5 connections and all are good or bad, and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"all_good"}]},{"type":"text","value":" or\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"all_bad"}]},{"type":"text","value":" result will be added to the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"pass"}]},{"type":"text","value":" or "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"fail"}]},{"type":"text","value":" test list. This are\nvery good indicators of future connection quality and are scored in karma.ini."}]},{"type":"element","tag":"h3","props":{"id":"asn-network-neighborhood-reputation"},"children":[{"type":"element","tag":"a","props":{"name":"Neighbor_Reputation"},"children":[]},{"type":"text","value":"ASN / Network Neighborhood Reputation"}]},{"type":"element","tag":"code","props":{"code":"[asn]\nenable=true    (default: true)\nreport_as\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"[asn]\nenable=true    (default: true)\nreport_as\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"asn"}]},{"type":"text","value":"enable is true, karma records the number of good and bad\nconnections from each ASN."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"ASNs with less than 5 karma points in either direction are ignored."}]},{"type":"element","tag":"h4","props":{"id":"report_as"},"children":[{"type":"text","value":"report_as"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Store the ASN results as another plugin. Example: I set "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"report_as=asn"}]},{"type":"text","value":", so that karma history for an ASN is reported with the ASN plugin data. A practical consequence of changing report_as is that the award location in karma.ini would need to change from:"}]},{"type":"element","tag":"code","props":{"code":"NNN karma | pass | equals | asn_all_good |  2\nNNN karma | fail | equals | asn_all_bad  | -3\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"NNN karma | pass | equals | asn_all_good |  2\nNNN karma | fail | equals | asn_all_bad  | -3\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"to:"}]},{"type":"element","tag":"code","props":{"code":"NNN asn | pass | equals | asn_all_good |  2\nNNN asn | fail | equals | asn_all_bad  | -3\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"NNN asn | pass | equals | asn_all_good |  2\nNNN asn | fail | equals | asn_all_bad  | -3\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"malformed-envelope-addresses"},"children":[{"type":"element","tag":"a","props":{"name":"malformed_env"},"children":[]},{"type":"text","value":"Malformed Envelope Addresses"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Very old versions of Outlook Express and some malware senders don't bother complying with the RFC (5321, 2821, 821) address format. Karma checks the envelope from and to addresses for a common RFC ignorant pattern that is highly correlated with malware."}]},{"type":"element","tag":"h3","props":{"id":"unrecognized-smtp-verbscommands"},"children":[{"type":"element","tag":"a","props":{"name":"unrecognized"},"children":[]},{"type":"text","value":"Unrecognized SMTP verbs/commands"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Certain bruteforce password hacking tools have a pre-programmed SMTP path\nthat ignores SMTP responses. After EHLO, they attempt AUTH,LOGIN with a valid\nusername. To bruteforce a password often requires millions of attempts so each\nbot sprays a couple dozen connections at the target server. Better quality\nMTAs like Haraka have built-in auth protection that inserts timeouts\nbetween successive auth attempts. The bots work around that by dropping the\nconnection after each failure and reconnecting. The attempts are distributed\nso IP blocking is of limited effectiveness."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To combat these bruteforce attacks several strategies are called for:"}]},{"type":"element","tag":"code","props":{"code":"1. Impose [connection delays](#delay)\n2. Disable SMTP-AUTH when not encrypted. The bots rarely use STARTTLS.\n   Besides preventing user passwords from transiting the internet in clear\n   text, requiring TLS encryption also means AUTH is not available to\n   poorly written bots.\n3. Having done #2, bot AUTH attempts show up as unrecognized commands.\n   Penalizing these with tarpitting and rate limiting will almost never\n   harm a legit sender but it will make it take much much longer for\n   attackers to bruteforce passwords.\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"1. Impose [connection delays](#delay)\n2. Disable SMTP-AUTH when not encrypted. The bots rarely use STARTTLS.\n   Besides preventing user passwords from transiting the internet in clear\n   text, requiring TLS encryption also means AUTH is not available to\n   poorly written bots.\n3. Having done #2, bot AUTH attempts show up as unrecognized commands.\n   Penalizing these with tarpitting and rate limiting will almost never\n   harm a legit sender but it will make it take much much longer for\n   attackers to bruteforce passwords.\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"limitations"},"children":[{"type":"text","value":"LIMITATIONS"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Karma is most effective at filtering mail delivered by bots and rogue servers.\nSpam delivered by servers with good reputations normally pass karma's checks.\nExpect to use karma "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"with"}]},{"type":"text","value":" content filters."}]}]},"navigation":{"title":"karma"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"karma-plugin"},"children":[{"type":"text","value":"karma plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Karma is a heuristic scoring engine that uses connection metadata and other Haraka plugins as inputs. Connections scoring in excess of specified thresholds are rewarded or "},{"type":"element","tag":"a","props":{"href":"#penalties"},"children":[{"type":"text","value":"penalized"}]},{"type":"text","value":" in proportionate ways."}]},{"type":"element","tag":"h2","props":{"id":"description"},"children":[{"type":"text","value":"Description"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Haraka includes some excellent plugins that detect message or sender patterns that are indicative of spam. "},{"type":"element","tag":"a","props":{"href":"http://haraka.github.io/plugins/spamassassin","rel":["nofollow"]},"children":[{"type":"text","value":"Some"}]},{"type":"text","value":" "},{"type":"element","tag":"a","props":{"href":"http://haraka.github.io/plugins/messagesniffer","rel":["nofollow"]},"children":[{"type":"text","value":"plugins"}]},{"type":"text","value":" "},{"type":"element","tag":"a","props":{"href":"http://haraka.github.io/plugins/connect.fcrdns","rel":["nofollow"]},"children":[{"type":"text","value":"have"}]},{"type":"text","value":" "},{"type":"element","tag":"a","props":{"href":"http://haraka.github.io/plugins/data.uribl","rel":["nofollow"]},"children":[{"type":"text","value":"accuracy"}]},{"type":"text","value":" rates above 95%. Detecting messages incorrectly 5% of the time means that some portion of ham will get blocked and some portion of spam will get delivered. The traditional solution is to permit users to specify their filtering aggressiveness, and then suffer the consequences (blocked ham -vs- too much spam)."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"By scoring and weighting several \"95+\" plugins, accuracy rates above 99% are attainable. With a half dozen such plugins, "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"99.99% accuracy"}]},{"type":"text","value":" is attainable. With karma, good senders with good history can occasionally fail tests (false positives) and still deliver their mail. Senders with poor history will have a much harder time."}]},{"type":"element","tag":"h3","props":{"id":"karma-prereqs"},"children":[{"type":"text","value":"Karma Prereqs"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"One challenge for mail filtering is that filters (or plugins, in Haraka's case) are usually called in sequence. A message passes from one filter to the next in a pipeline and each filter gets to choose \"yeah or nay.\" In order for karma to transcend this limit, karma requires that "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"every"}]},{"type":"text","value":" filter passes every message. Nearly all Haraka plugins have a "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"reject"}]},{"type":"text","value":" or "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"deny"}]},{"type":"text","value":" option for this reason."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In order to score a filters results, filters must save their results to the "},{"type":"element","tag":"a","props":{"href":"http://haraka.github.io/core/Results","rel":["nofollow"]},"children":[{"type":"text","value":"Result Store"}]},{"type":"text","value":". Karma will see that and apply the award specified in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"karma.ini"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h2","props":{"id":"how-karma-works"},"children":[{"type":"text","value":"How Karma Works"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Karma takes a holistic view of "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"connections"}]},{"type":"text","value":". During the connection, karma collects these results and applies the "},{"type":"element","tag":"a","props":{"href":"#awards"},"children":[{"type":"text","value":"result_awards"}]},{"type":"text","value":" defined in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"karma.ini"}]},{"type":"text","value":". Once a connection/message exceeds the threshold.negative score (default: -8), karma rejects it at the next "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"deny"}]},{"type":"text","value":"hook."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The scoring mechanism is not dissimilar to "},{"type":"element","tag":"a","props":{"href":"http://haraka.github.io/plugins/spamassassin","rel":["nofollow"]},"children":[{"type":"text","value":"SpamAssassin"}]},{"type":"text","value":", but Karma has some particular advantages:"}]},{"type":"element","tag":"code","props":{"code":"* Runs entirely in Node, so it's very fast\n* Async and very scalable.\n* Builds sender and network reputation databases\n* Has access to connection properties (relaying, port, auth attempts, etc..)\n* Access to raw SMTP commands (data + formatting inspection)\n* Can reject connections before DATA (save lots of bandwidth)\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"* Runs entirely in Node, so it's very fast\n* Async and very scalable.\n* Builds sender and network reputation databases\n* Has access to connection properties (relaying, port, auth attempts, etc..)\n* Access to raw SMTP commands (data + formatting inspection)\n* Can reject connections before DATA (save lots of bandwidth)"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Karma is not a replacement for content filters. Karma focuses on the quality of the "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"connection"}]},{"type":"text","value":". Content filters (bayes*) focus on the content of the "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"message"}]},{"type":"text","value":". Karma works best "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"with"}]},{"type":"text","value":" content filters."}]},{"type":"element","tag":"h1","props":{"id":"config"},"children":[{"type":"text","value":"CONFIG"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"See config/karma.ini for options and inline documentation."}]},{"type":"element","tag":"h2","props":{"id":"awards"},"children":[{"type":"text","value":"AWARDS"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Karma allows the site administrator to control how much weight to assign to\nplugin results, providing a great deal of control over what results are\nworth rejecting for."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Karma begins scoring the connection when the first packet arrives. The IP reputation, "},{"type":"element","tag":"a","props":{"href":"http://haraka.github.io/plugins/connect.p0f","rel":["nofollow"]},"children":[{"type":"text","value":"sender OS"}]},{"type":"text","value":", "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-geoip","rel":["nofollow"]},"children":[{"type":"text","value":"GeoIP location"}]},{"type":"text","value":", "},{"type":"element","tag":"a","props":{"href":"http://haraka.github.io/plugins/dnsbl","rel":["nofollow"]},"children":[{"type":"text","value":"DNSBL"}]},{"type":"text","value":" listing, and "},{"type":"element","tag":"a","props":{"href":"http://haraka.github.io/plugins/connect.fcrdns","rel":["nofollow"]},"children":[{"type":"text","value":"FCrDNS"}]},{"type":"text","value":" are often a sufficient basis for rejecting a connection without ever blocking a ham."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Karma performs checks early and often, maximizing the penality it can exact upon bad mailers."}]},{"type":"element","tag":"h2","props":{"id":"penalties"},"children":[{"type":"text","value":"Penalties"}]},{"type":"element","tag":"h3","props":{"id":"deny-reject"},"children":[{"type":"text","value":"Deny / Reject"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When connections become worse than "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"thresholds"}]},{"type":"text","value":"negative, they are denied during the next "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"deny"}]},{"type":"text","value":"hook."}]},{"type":"element","tag":"h3","props":{"id":"history"},"children":[{"type":"text","value":"History"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Karma history is computed as the number of good - bad connections."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When each connection ends, "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"karma"}]},{"type":"text","value":" records the result. When a sufficient history has been built for an IP or ASN, future connections from that address(es) will get a positive or negative karma award."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The reward is purposefully small, to permit good senders in bad neighborhoods to still send."}]},{"type":"element","tag":"h3","props":{"id":"connection-delays"},"children":[{"type":"text","value":"Connection Delays"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Connection delays (aka tarpitting, teergrubing, early talker) slow down a SMTP conversation by inserting artificial delays. Karma increases connection delays adaptively as connection quality changes."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Karma's delay goals:"}]},{"type":"element","tag":"code","props":{"code":"1. Don't delay valid senders\n2. Penalize senders in proportion to their karma score\n3. Dampen bruteforce AUTH attacks.\n4. Since the only *cost* we can exact from miscreants is time, and connections are cheap to maintain, keep miscreants online as long as possible.\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"1. Don't delay valid senders\n2. Penalize senders in proportion to their karma score\n3. Dampen bruteforce AUTH attacks.\n4. Since the only *cost* we can exact from miscreants is time, and connections are cheap to maintain, keep miscreants online as long as possible."}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"There are three tarpit options:"}]},{"type":"element","tag":"code","props":{"code":"[tarpit]\n* delay=0   (seconds to delay,      default: 0)\n* max=5     (max seconds to delay,  default: 5)\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"[tarpit]\n* delay=0   (seconds to delay,      default: 0)\n* max=5     (max seconds to delay,  default: 5)"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When set to zero, the value of the delay is adaptive, calculated proportional\nto the karma score of the connection. Connections with good karma will see no\ndelay and bad ones will see long delays."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When delay is non-zero, each SMTP response will be delayed by that many seconds."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In practice, most naughty senders abandon the connection when forced to\nwait more than a handful of seconds. "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"max"}]},{"type":"text","value":" sets the maximum delay between\nresponses."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When using "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"karma"}]},{"type":"text","value":", do not use Haraka's "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"tarpit"}]},{"type":"text","value":" plugin."}]},{"type":"element","tag":"h2","props":{"id":"included-tests"},"children":[{"type":"text","value":"Included Tests"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Connection data that karma considers:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#IP_Reputation"},"children":[{"type":"text","value":"IP Reputation"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#Neighbor_Reputation"},"children":[{"type":"text","value":"ASN reputation"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"DENY events by other plugins"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"envelope sender from a spammy TLD"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#malformed_env"},"children":[{"type":"text","value":"malformed envelope addresses"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#unrecognized"},"children":[{"type":"text","value":"unrecognized SMTP commands"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"matching "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"env from"}]},{"type":"text","value":" and "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"env to"}]},{"type":"text","value":" name (rare in ham, frequent in spam)"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The data from these tests are helpful but the real power of karma is "},{"type":"element","tag":"a","props":{"href":"#awards"},"children":[{"type":"text","value":"scoring\nthe results"}]},{"type":"text","value":" of other plugins. See karma.ini for a rich set of examples."}]},{"type":"element","tag":"h3","props":{"id":"ip-reputation"},"children":[{"type":"element","tag":"a","props":{"name":"IP_Reputation"},"children":[]},{"type":"text","value":"IP Reputation"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Karma records the number of good, bad, and total connections.  The results\nare accessible to other plugins as well."}]},{"type":"element","tag":"code","props":{"code":"var karma = connection.results.get('karma');\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"var karma = connection.results.get('karma');"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The karma result object contains at least the following:"}]},{"type":"element","tag":"code","props":{"code":"score: 0,         <- score for this connection\nhistory: 0,       <- score for all connections\n   good: 0,       <- qty of past 'good' connections\n   bad: 0,        <- qty of past 'bad' connections\nconnections: 0,   <- total past connections\npass: [],         <- tests that added positive karma\nfail: [],         <- tests that added negative karma\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"score: 0,         <- score for this connection\nhistory: 0,       <- score for all connections\n   good: 0,       <- qty of past 'good' connections\n   bad: 0,        <- qty of past 'bad' connections\nconnections: 0,   <- total past connections\npass: [],         <- tests that added positive karma\nfail: [],         <- tests that added negative karma"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If an IP has at least 5 connections and all are good or bad, and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"all_good"}]},{"type":"text","value":" or\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"all_bad"}]},{"type":"text","value":" result will be added to the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"pass"}]},{"type":"text","value":" or "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"fail"}]},{"type":"text","value":" test list. This are\nvery good indicators of future connection quality and are scored in karma.ini."}]},{"type":"element","tag":"h3","props":{"id":"asn-network-neighborhood-reputation"},"children":[{"type":"element","tag":"a","props":{"name":"Neighbor_Reputation"},"children":[]},{"type":"text","value":"ASN / Network Neighborhood Reputation"}]},{"type":"element","tag":"code","props":{"code":"[asn]\nenable=true    (default: true)\nreport_as\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"[asn]\nenable=true    (default: true)\nreport_as"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"asn"}]},{"type":"text","value":"enable is true, karma records the number of good and bad\nconnections from each ASN."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"ASNs with less than 5 karma points in either direction are ignored."}]},{"type":"element","tag":"h4","props":{"id":"report_as"},"children":[{"type":"text","value":"report_as"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Store the ASN results as another plugin. Example: I set "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"report_as=asn"}]},{"type":"text","value":", so that karma history for an ASN is reported with the ASN plugin data. A practical consequence of changing report_as is that the award location in karma.ini would need to change from:"}]},{"type":"element","tag":"code","props":{"code":"NNN karma | pass | equals | asn_all_good |  2\nNNN karma | fail | equals | asn_all_bad  | -3\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"NNN karma | pass | equals | asn_all_good |  2\nNNN karma | fail | equals | asn_all_bad  | -3"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"to:"}]},{"type":"element","tag":"code","props":{"code":"NNN asn | pass | equals | asn_all_good |  2\nNNN asn | fail | equals | asn_all_bad  | -3\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"NNN asn | pass | equals | asn_all_good |  2\nNNN asn | fail | equals | asn_all_bad  | -3"}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"malformed-envelope-addresses"},"children":[{"type":"element","tag":"a","props":{"name":"malformed_env"},"children":[]},{"type":"text","value":"Malformed Envelope Addresses"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Very old versions of Outlook Express and some malware senders don't bother complying with the RFC (5321, 2821, 821) address format. Karma checks the envelope from and to addresses for a common RFC ignorant pattern that is highly correlated with malware."}]},{"type":"element","tag":"h3","props":{"id":"unrecognized-smtp-verbscommands"},"children":[{"type":"element","tag":"a","props":{"name":"unrecognized"},"children":[]},{"type":"text","value":"Unrecognized SMTP verbs/commands"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Certain bruteforce password hacking tools have a pre-programmed SMTP path\nthat ignores SMTP responses. After EHLO, they attempt AUTH,LOGIN with a valid\nusername. To bruteforce a password often requires millions of attempts so each\nbot sprays a couple dozen connections at the target server. Better quality\nMTAs like Haraka have built-in auth protection that inserts timeouts\nbetween successive auth attempts. The bots work around that by dropping the\nconnection after each failure and reconnecting. The attempts are distributed\nso IP blocking is of limited effectiveness."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To combat these bruteforce attacks several strategies are called for:"}]},{"type":"element","tag":"code","props":{"code":"1. Impose [connection delays](#delay)\n2. Disable SMTP-AUTH when not encrypted. The bots rarely use STARTTLS.\n   Besides preventing user passwords from transiting the internet in clear\n   text, requiring TLS encryption also means AUTH is not available to\n   poorly written bots.\n3. Having done #2, bot AUTH attempts show up as unrecognized commands.\n   Penalizing these with tarpitting and rate limiting will almost never\n   harm a legit sender but it will make it take much much longer for\n   attackers to bruteforce passwords.\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"1. Impose [connection delays](#delay)\n2. Disable SMTP-AUTH when not encrypted. The bots rarely use STARTTLS.\n   Besides preventing user passwords from transiting the internet in clear\n   text, requiring TLS encryption also means AUTH is not available to\n   poorly written bots.\n3. Having done #2, bot AUTH attempts show up as unrecognized commands.\n   Penalizing these with tarpitting and rate limiting will almost never\n   harm a legit sender but it will make it take much much longer for\n   attackers to bruteforce passwords."}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"limitations"},"children":[{"type":"text","value":"LIMITATIONS"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Karma is most effective at filtering mail delivered by bots and rogue servers.\nSpam delivered by servers with good reputations normally pass karma's checks.\nExpect to use karma "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"with"}]},{"type":"text","value":" content filters."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"description","depth":2,"text":"Description","children":[{"id":"karma-prereqs","depth":3,"text":"Karma Prereqs"}]},{"id":"how-karma-works","depth":2,"text":"How Karma Works"},{"id":"awards","depth":2,"text":"AWARDS"},{"id":"penalties","depth":2,"text":"Penalties","children":[{"id":"deny-reject","depth":3,"text":"Deny / Reject"},{"id":"history","depth":3,"text":"History"},{"id":"connection-delays","depth":3,"text":"Connection Delays"}]},{"id":"included-tests","depth":2,"text":"Included Tests","children":[{"id":"ip-reputation","depth":3,"text":"IP Reputation"},{"id":"asn-network-neighborhood-reputation","depth":3,"text":"ASN / Network Neighborhood Reputation"},{"id":"malformed-envelope-addresses","depth":3,"text":"Malformed Envelope Addresses"},{"id":"unrecognized-smtp-verbscommands","depth":3,"text":"Unrecognized SMTP verbs/commands"}]},{"id":"limitations","depth":2,"text":"LIMITATIONS"}]}},"_type":"markdown","_id":"content:8.plugins:karma.md","_source":"content","_file":"8.plugins/karma.md","_extension":"md"},{"_path":"/plugins/limit","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"limit - Limits plugin for Haraka","description":"Haraka limit plugin - Limits the number of messages per connection","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"limit-plugin"},"children":[{"type":"text","value":"limit plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Apply several types of limits to SMTP connections."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Each limit type has a max value that can be defined in limit.ini. The default is empty / disabled until a value has been set."}]},{"type":"element","tag":"h2","props":{"id":"concurrency"},"children":[{"type":"text","value":"concurrency"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[concurrency]max"}]},{"type":"text","value":" is defined, it limits the maximum number of simultaneous connections per IP address. Connection attempts in excess of the limit are delayed for "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"disconnect_delay"}]},{"type":"text","value":" seconds (default: 3) before being disconnected."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This works best in conjunction with a history / reputation database, so that\none can assign very low concurrency (1) to bad or unknown senders and higher\nlimits for reputable mail servers."}]},{"type":"element","tag":"h3","props":{"id":"history"},"children":[{"type":"text","value":"History"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"History: when enabled, the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"history"}]},{"type":"text","value":" setting is the name of a plugin that stores IP history / reputation results. The result store must have a positive value for good connections and negative integers for poor / undesirable connections. Karma is one such plugin."}]},{"type":"element","tag":"h2","props":{"id":"recipients"},"children":[{"type":"text","value":"recipients"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[recipients]max"}]},{"type":"text","value":" is defined, each connection is limited to that number of recipients. The limit is imposed against "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"all"}]},{"type":"text","value":" recipient attempts. Attempts in excess of the limit are issued a temporary failure."}]},{"type":"element","tag":"h2","props":{"id":"unrecognized_commands"},"children":[{"type":"text","value":"unrecognized_commands"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[unrecognized_commands]max"}]},{"type":"text","value":" is set, a connection that exceeeds the limit is disconnected."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Unrecognized commands are normally SMTP verbs invalidly issued by the client.\nExamples:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"issuing AUTH when we didn't advertise AUTH extension"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"issuing STARTTLS when we didn't advertise STARTTLS"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"invalid SMTP verbs"}]}]},{"type":"element","tag":"h3","props":{"id":"limitations"},"children":[{"type":"text","value":"Limitations"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The unrecognized_command hook is used by the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"tls"}]},{"type":"text","value":" and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"auth"}]},{"type":"text","value":" plugins, so\nrunning this plugin before those would result in valid operations getting\ncounted against that connections limits. The solution is simple: list\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"limit"}]},{"type":"text","value":" in config/plugins after those."}]},{"type":"element","tag":"h2","props":{"id":"errors"},"children":[{"type":"text","value":"errors"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[errors]max"}]},{"type":"text","value":" is set, a connection that exceeeds the limit is disconnected. Errors that count against this limit include:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"issuing commands out of turn (MAIL before EHLO, RCPT before MAIL, etc)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"attempting MAIL on port 465/587 without AUTH"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"MAIL or RCPT addresses that fail to parse"}]}]},{"type":"element","tag":"h1","props":{"id":"error-handling"},"children":[{"type":"text","value":"Error Handling"}]},{"type":"element","tag":"h2","props":{"id":"too-high-counters"},"children":[{"type":"text","value":"Too high counters"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If the NoSQL store is Redis and Haraka is restarted or crashes while active\nconnections are open, the concurrency counters might be inflated. This is\nhandled by the "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"concurrency"}]},{"type":"text","value":"reset setting (default: 10m), which:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"ssc: sets collection expiration time"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"redis: empties the concurrency hash"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"RAM: empties the in-memory hash of all keys"}]}]},{"type":"element","tag":"h2","props":{"id":"too-low-counters"},"children":[{"type":"text","value":"Too low counters"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Because the redis and RAM objects are emptied periodically, connections that\nare open while the collections are emptied will be too low. When\nthat happens, log messages like these might be emitted:"}]},{"type":"element","tag":"code","props":{"code":"resetting 0 to 1\nresetting -1 to 1\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"resetting 0 to 1\nresetting -1 to 1\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This is a harmless error condition that is repaired automatically."}]}]},"navigation":{"title":"limit"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"limit-plugin"},"children":[{"type":"text","value":"limit plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Apply several types of limits to SMTP connections."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Each limit type has a max value that can be defined in limit.ini. The default is empty / disabled until a value has been set."}]},{"type":"element","tag":"h2","props":{"id":"concurrency"},"children":[{"type":"text","value":"concurrency"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[concurrency]max"}]},{"type":"text","value":" is defined, it limits the maximum number of simultaneous connections per IP address. Connection attempts in excess of the limit are delayed for "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"disconnect_delay"}]},{"type":"text","value":" seconds (default: 3) before being disconnected."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This works best in conjunction with a history / reputation database, so that\none can assign very low concurrency (1) to bad or unknown senders and higher\nlimits for reputable mail servers."}]},{"type":"element","tag":"h3","props":{"id":"history"},"children":[{"type":"text","value":"History"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"History: when enabled, the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"history"}]},{"type":"text","value":" setting is the name of a plugin that stores IP history / reputation results. The result store must have a positive value for good connections and negative integers for poor / undesirable connections. Karma is one such plugin."}]},{"type":"element","tag":"h2","props":{"id":"recipients"},"children":[{"type":"text","value":"recipients"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[recipients]max"}]},{"type":"text","value":" is defined, each connection is limited to that number of recipients. The limit is imposed against "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"all"}]},{"type":"text","value":" recipient attempts. Attempts in excess of the limit are issued a temporary failure."}]},{"type":"element","tag":"h2","props":{"id":"unrecognized_commands"},"children":[{"type":"text","value":"unrecognized_commands"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[unrecognized_commands]max"}]},{"type":"text","value":" is set, a connection that exceeeds the limit is disconnected."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Unrecognized commands are normally SMTP verbs invalidly issued by the client.\nExamples:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"issuing AUTH when we didn't advertise AUTH extension"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"issuing STARTTLS when we didn't advertise STARTTLS"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"invalid SMTP verbs"}]}]},{"type":"element","tag":"h3","props":{"id":"limitations"},"children":[{"type":"text","value":"Limitations"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The unrecognized_command hook is used by the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"tls"}]},{"type":"text","value":" and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"auth"}]},{"type":"text","value":" plugins, so\nrunning this plugin before those would result in valid operations getting\ncounted against that connections limits. The solution is simple: list\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"limit"}]},{"type":"text","value":" in config/plugins after those."}]},{"type":"element","tag":"h2","props":{"id":"errors"},"children":[{"type":"text","value":"errors"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[errors]max"}]},{"type":"text","value":" is set, a connection that exceeeds the limit is disconnected. Errors that count against this limit include:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"issuing commands out of turn (MAIL before EHLO, RCPT before MAIL, etc)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"attempting MAIL on port 465/587 without AUTH"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"MAIL or RCPT addresses that fail to parse"}]}]},{"type":"element","tag":"h1","props":{"id":"error-handling"},"children":[{"type":"text","value":"Error Handling"}]},{"type":"element","tag":"h2","props":{"id":"too-high-counters"},"children":[{"type":"text","value":"Too high counters"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If the NoSQL store is Redis and Haraka is restarted or crashes while active\nconnections are open, the concurrency counters might be inflated. This is\nhandled by the "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"concurrency"}]},{"type":"text","value":"reset setting (default: 10m), which:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"ssc: sets collection expiration time"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"redis: empties the concurrency hash"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"RAM: empties the in-memory hash of all keys"}]}]},{"type":"element","tag":"h2","props":{"id":"too-low-counters"},"children":[{"type":"text","value":"Too low counters"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Because the redis and RAM objects are emptied periodically, connections that\nare open while the collections are emptied will be too low. When\nthat happens, log messages like these might be emitted:"}]},{"type":"element","tag":"code","props":{"code":"resetting 0 to 1\nresetting -1 to 1\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"resetting 0 to 1\nresetting -1 to 1"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This is a harmless error condition that is repaired automatically."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"concurrency","depth":2,"text":"concurrency","children":[{"id":"history","depth":3,"text":"History"}]},{"id":"recipients","depth":2,"text":"recipients"},{"id":"unrecognized_commands","depth":2,"text":"unrecognized_commands","children":[{"id":"limitations","depth":3,"text":"Limitations"}]},{"id":"errors","depth":2,"text":"errors"},{"id":"too-high-counters","depth":2,"text":"Too high counters"},{"id":"too-low-counters","depth":2,"text":"Too low counters"}]}},"_type":"markdown","_id":"content:8.plugins:limit.md","_source":"content","_file":"8.plugins/limit.md","_extension":"md"},{"_path":"/plugins/log.elasticsearch","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"log.elasticsearch - Logs to Elasticsearch plugin for Haraka","description":"Haraka log.elasticsearch plugin - Logs to Elasticsearch","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"logelasticsearch-plugin"},"children":[{"type":"text","value":"log.elasticsearch plugin"}]},{"type":"element","tag":"h2","props":{"id":"logging"},"children":[{"type":"text","value":"Logging"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Unless errors are encountered, no logs are emitted."}]},{"type":"element","tag":"h2","props":{"id":"errors"},"children":[{"type":"text","value":"Errors"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The elasticsearch module has very robust error handling built in. If there's a\nconnection issue, errors such as these will be emitted when Haraka starts\nup:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Elasticsearch cluster is down!"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"No Living connections"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"However, ES will continue attempting to connect and when the ES server becomes\navailable, logging will begin. If errors are encountered trying to save data\nto ES, they look like this:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"No Living connections"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Request Timeout after 30000ms"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"They normally fix themselves when ES resumes working properly."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"host - an IP or hostname of the ES server to connect to"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"host=127.0.0.2"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"pluginObject"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"By default, all plugin results are presented as "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"$plugin_name: { ... }"}]},{"type":"text","value":", at\nthe top level. If you prefer that all plugin results be nested inside an\nobject "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"$obj: { $plugin_name: { ...}"}]},{"type":"text","value":", set pluginObject to that object's key name"}]},{"type":"element","tag":"code","props":{"code":"pluginObject=plugin\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"pluginObject=plugin\n"}]}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"ignore_hosts"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A config file section for hosts whose results should not be stored in\nES. HAproxy servers, Nagios, and other hosts who monitor Haraka can be listed\nhere. The format for entries is host.name=true"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"index"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"transaction=smtp-transaction\nconnection=smtp-connection"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Transactions include all the connection information and are \"the good stuff.\"\nWhen a connection has transactions, the connection is not saved separately.\nThe distinction is that a connection is stored only when it has zero\ntransactions. The connections index tends to be mostly noise (monitoring,\nblocked connections, bruteforce auth attempts, etc.). To collapse them into\nthe same index, set the value for both identically."}]},{"type":"element","tag":"h2","props":{"id":"index-map-template"},"children":[{"type":"text","value":"Index map template"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Creating a map template will apply the template(s) to any future indexes that\nmatch the pattern/name in the template setting. This is how to manually apply\nan index map template:"}]},{"type":"element","tag":"code","props":{"code":"curl -XPUT localhost:9200/_template/haraka_results -d '\n{\n    \"template\" : \"smtp-*\",\n    \"mappings\" : {\n        \"haraka\" : {\n            \"dynamic_templates\" : [\n                { \"fail_results\" : {\n                        \"match\" : \"fail\",\n                        \"mapping\" : {\n                            \"type\" : \"string\", \"index\" : \"not_analyzed\"\n                        }\n                    }\n                },\n                { \"pass_results\" : {\n                        \"match\" : \"pass\",\n                        \"mapping\" : {\n                            \"type\" : \"string\", \"index\" : \"not_analyzed\"\n                        }\n                    }\n                },\n                { \"skip_results\" : {\n                        \"match\" : \"skip\",\n                        \"mapping\" : {\n                            \"type\" : \"string\", \"index\" : \"not_analyzed\"\n                        }\n                    }\n                },\n                { \"msg_results\" : {\n                        \"match\" : \"msg\",\n                        \"mapping\" : {\n                            \"type\" : \"string\", \"index\" : \"not_analyzed\"\n                        }\n                    }\n                },\n                { \"err_results\" : {\n                        \"match\" : \"err\",\n                        \"mapping\" : {\n                            \"type\" : \"string\", \"index\" : \"not_analyzed\"\n                        }\n                    }\n                },\n                { \"ip_addrs\" : {\n                        \"match\" : \"ip\",\n                        \"mapping\" : { \"type\" : \"ip\" }\n                    }\n                },\n                { \"hostnames\" : {\n                        \"match\" : \"host\",\n                        \"mapping\" : {\n                            \"type\" : \"string\", \"index\" : \"not_analyzed\"\n                        }\n                    }\n                }\n            ],\n            \"properties\" : {\n                \"plugin\" : {\n                    \"properties\" : {\n                        \"asn\" : {\n                            \"properties\" : {\n                                \"org\" : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                \"asn_good\"        : { \"type\" : \"double\" },\n                                \"asn_bad\"         : { \"type\" : \"double\" },\n                                \"asn_score\"       : { \"type\" : \"double\" },\n                                \"asn_connections\" : { \"type\" : \"double\" }\n                            }\n                        },\n                        \"geoip\" : {\n                            \"properties\" : {\n                                \"org\"      : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                \"geo\"      : { \"type\" : \"geo_point\" },\n                                \"distance\" : { \"type\" : \"float\" }\n                            }\n                        },\n                        \"helo\" : {\n                            \"properties\"   : {\n                                \"ips\"      : { \"type\" : \"string\", \"index\" : \"not_analyzed\" }\n                            }\n                        },\n                        \"fcrdns\" : {\n                            \"properties\"    : {\n                                \"fcrdns\"    : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                \"other_ips\" : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                \"ptr_names\" : { \"type\" : \"string\", \"index\" : \"not_analyzed\" }\n                            }\n                        },\n                        \"p0f\" : {\n                            \"properties\" : {\n                                \"os_flavor\" : { \"type\" : \"string\", \"index\" : \"not_analyzed\" }\n                            }\n                        },\n                        \"rspamd\" : {\n                            \"properties\"   : {\n                                \"emails\"   : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                \"urls\"     : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                \"messages\" : { \"type\" : \"string\", \"index\" : \"not_analyzed\" }\n                            }\n                        },\n                        \"karma\" : {\n                            \"properties\" : {\n                                \"connect\"   : { \"type\" : \"double\" },\n                                \"score\"     : { \"type\" : \"double\" },\n                                \"good\"      : { \"type\" : \"double\" },\n                                \"bad\"       : { \"type\" : \"double\" },\n                                \"history\"   : { \"type\" : \"double\" },\n                                \"connections\" : { \"type\" : \"double\" },\n                                \"total_connects\" : { \"type\" : \"double\" },\n                                \"neighbors\" : { \"type\" : \"double\" }\n                            }\n                        },\n                        \"spamassassin\" : {\n                            \"properties\" : {\n                                \"headers\": {\n                                    \"properties\" : {\n                                        \"report\" : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                        \"Status\" : { \"type\" : \"string\", \"index\" : \"not_analyzed\" }\n                                    }\n                                },\n                                \"line0\" : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                \"reqd\"  : { \"type\" : \"double\" },\n                                \"score\" : { \"type\" : \"double\" },\n                                \"tests\" : { \"type\" : \"string\", \"index\" : \"not_analyzed\" }\n                            }\n                        },\n                        \"spf\" : {\n                            \"properties\" : {\n                                \"domain\" : { \"type\" : \"string\", \"index\" : \"not_analyzed\" }\n                            }\n                        }\n                    }\n                },\n                \"message\" : {\n                    \"properties\" : {\n                        \"bytes\" : { \"type\": \"double\" },\n                        \"envelope\": {\n                            \"properties\": {\n                                \"sender\" : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                \"recipient\" : {\n                                    \"properties\"  : {\n                                        \"action\"  : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                        \"address\" : { \"type\" : \"string\", \"index\" : \"not_analyzed\" }\n                                    }\n                                }\n                            }\n                        },\n                        \"header\": {\n                            \"properties\": {\n                                \"from\"         : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                \"to\"           : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                \"subject\"      : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                \"message-id\"   : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                \"date\"         : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                \"reply-to\"     : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                \"resent-from\"  : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                \"resent-header\": { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                \"sender\"       : { \"type\" : \"string\", \"index\" : \"not_analyzed\" }\n                            }\n                        },\n                        \"body\" : {\n                            \"properties\" : {\n                                \"attachment\" : {\n                                    \"properties\": {\n                                        \"bytes\" : { \"type\" : \"float\" },\n                                        \"ctype\" : { \"type\" : \"string\" },\n                                        \"file\"  : { \"type\" : \"string\" },\n                                        \"md5\"   : { \"type\" : \"string\", \"index\": \"not_analyzed\" }\n                                    }\n                                }\n                            }\n                        },\n                        \"queue\" : {\n                            \"properties\" : {\n\n                            }\n                        }\n                    }\n                },\n                \"connection\" : {\n                    \"properties\" : {\n                        \"count\" : {\n                            \"properties\" : {\n                                \"msg\" : {\n                                    \"properties\" : {\n                                        \"accept\" : { \"type\": \"integer\" },\n                                        \"reject\" : { \"type\": \"integer\" },\n                                        \"tempfail\" : { \"type\": \"integer\" }\n                                    }\n                                },\n                                \"rcpt\" : {\n                                    \"properties\" : {\n                                        \"accept\" : { \"type\": \"integer\" },\n                                        \"reject\" : { \"type\": \"integer\" },\n                                        \"tempfail\" : { \"type\": \"integer\" }\n                                    }\n                                },\n                                \"errors\" : { \"type\": \"integer\" },\n                                \"trans\" : { \"type\": \"integer\" }\n                            }\n                        },\n                        \"early\" : { \"type\" : \"boolean\" }\n                    }\n                }\n            }\n        }\n    }\n}'\n","language":"json"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"curl -XPUT localhost:9200/_template/haraka_results -d '\n{\n    \"template\" : \"smtp-*\",\n    \"mappings\" : {\n        \"haraka\" : {\n            \"dynamic_templates\" : [\n                { \"fail_results\" : {\n                        \"match\" : \"fail\",\n                        \"mapping\" : {\n                            \"type\" : \"string\", \"index\" : \"not_analyzed\"\n                        }\n                    }\n                },\n                { \"pass_results\" : {\n                        \"match\" : \"pass\",\n                        \"mapping\" : {\n                            \"type\" : \"string\", \"index\" : \"not_analyzed\"\n                        }\n                    }\n                },\n                { \"skip_results\" : {\n                        \"match\" : \"skip\",\n                        \"mapping\" : {\n                            \"type\" : \"string\", \"index\" : \"not_analyzed\"\n                        }\n                    }\n                },\n                { \"msg_results\" : {\n                        \"match\" : \"msg\",\n                        \"mapping\" : {\n                            \"type\" : \"string\", \"index\" : \"not_analyzed\"\n                        }\n                    }\n                },\n                { \"err_results\" : {\n                        \"match\" : \"err\",\n                        \"mapping\" : {\n                            \"type\" : \"string\", \"index\" : \"not_analyzed\"\n                        }\n                    }\n                },\n                { \"ip_addrs\" : {\n                        \"match\" : \"ip\",\n                        \"mapping\" : { \"type\" : \"ip\" }\n                    }\n                },\n                { \"hostnames\" : {\n                        \"match\" : \"host\",\n                        \"mapping\" : {\n                            \"type\" : \"string\", \"index\" : \"not_analyzed\"\n                        }\n                    }\n                }\n            ],\n            \"properties\" : {\n                \"plugin\" : {\n                    \"properties\" : {\n                        \"asn\" : {\n                            \"properties\" : {\n                                \"org\" : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                \"asn_good\"        : { \"type\" : \"double\" },\n                                \"asn_bad\"         : { \"type\" : \"double\" },\n                                \"asn_score\"       : { \"type\" : \"double\" },\n                                \"asn_connections\" : { \"type\" : \"double\" }\n                            }\n                        },\n                        \"geoip\" : {\n                            \"properties\" : {\n                                \"org\"      : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                \"geo\"      : { \"type\" : \"geo_point\" },\n                                \"distance\" : { \"type\" : \"float\" }\n                            }\n                        },\n                        \"helo\" : {\n                            \"properties\"   : {\n                                \"ips\"      : { \"type\" : \"string\", \"index\" : \"not_analyzed\" }\n                            }\n                        },\n                        \"fcrdns\" : {\n                            \"properties\"    : {\n                                \"fcrdns\"    : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                \"other_ips\" : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                \"ptr_names\" : { \"type\" : \"string\", \"index\" : \"not_analyzed\" }\n                            }\n                        },\n                        \"p0f\" : {\n                            \"properties\" : {\n                                \"os_flavor\" : { \"type\" : \"string\", \"index\" : \"not_analyzed\" }\n                            }\n                        },\n                        \"rspamd\" : {\n                            \"properties\"   : {\n                                \"emails\"   : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                \"urls\"     : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                \"messages\" : { \"type\" : \"string\", \"index\" : \"not_analyzed\" }\n                            }\n                        },\n                        \"karma\" : {\n                            \"properties\" : {\n                                \"connect\"   : { \"type\" : \"double\" },\n                                \"score\"     : { \"type\" : \"double\" },\n                                \"good\"      : { \"type\" : \"double\" },\n                                \"bad\"       : { \"type\" : \"double\" },\n                                \"history\"   : { \"type\" : \"double\" },\n                                \"connections\" : { \"type\" : \"double\" },\n                                \"total_connects\" : { \"type\" : \"double\" },\n                                \"neighbors\" : { \"type\" : \"double\" }\n                            }\n                        },\n                        \"spamassassin\" : {\n                            \"properties\" : {\n                                \"headers\": {\n                                    \"properties\" : {\n                                        \"report\" : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                        \"Status\" : { \"type\" : \"string\", \"index\" : \"not_analyzed\" }\n                                    }\n                                },\n                                \"line0\" : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                \"reqd\"  : { \"type\" : \"double\" },\n                                \"score\" : { \"type\" : \"double\" },\n                                \"tests\" : { \"type\" : \"string\", \"index\" : \"not_analyzed\" }\n                            }\n                        },\n                        \"spf\" : {\n                            \"properties\" : {\n                                \"domain\" : { \"type\" : \"string\", \"index\" : \"not_analyzed\" }\n                            }\n                        }\n                    }\n                },\n                \"message\" : {\n                    \"properties\" : {\n                        \"bytes\" : { \"type\": \"double\" },\n                        \"envelope\": {\n                            \"properties\": {\n                                \"sender\" : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                \"recipient\" : {\n                                    \"properties\"  : {\n                                        \"action\"  : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                        \"address\" : { \"type\" : \"string\", \"index\" : \"not_analyzed\" }\n                                    }\n                                }\n                            }\n                        },\n                        \"header\": {\n                            \"properties\": {\n                                \"from\"         : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                \"to\"           : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                \"subject\"      : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                \"message-id\"   : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                \"date\"         : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                \"reply-to\"     : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                \"resent-from\"  : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                \"resent-header\": { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                \"sender\"       : { \"type\" : \"string\", \"index\" : \"not_analyzed\" }\n                            }\n                        },\n                        \"body\" : {\n                            \"properties\" : {\n                                \"attachment\" : {\n                                    \"properties\": {\n                                        \"bytes\" : { \"type\" : \"float\" },\n                                        \"ctype\" : { \"type\" : \"string\" },\n                                        \"file\"  : { \"type\" : \"string\" },\n                                        \"md5\"   : { \"type\" : \"string\", \"index\": \"not_analyzed\" }\n                                    }\n                                }\n                            }\n                        },\n                        \"queue\" : {\n                            \"properties\" : {\n\n                            }\n                        }\n                    }\n                },\n                \"connection\" : {\n                    \"properties\" : {\n                        \"count\" : {\n                            \"properties\" : {\n                                \"msg\" : {\n                                    \"properties\" : {\n                                        \"accept\" : { \"type\": \"integer\" },\n                                        \"reject\" : { \"type\": \"integer\" },\n                                        \"tempfail\" : { \"type\": \"integer\" }\n                                    }\n                                },\n                                \"rcpt\" : {\n                                    \"properties\" : {\n                                        \"accept\" : { \"type\": \"integer\" },\n                                        \"reject\" : { \"type\": \"integer\" },\n                                        \"tempfail\" : { \"type\": \"integer\" }\n                                    }\n                                },\n                                \"errors\" : { \"type\": \"integer\" },\n                                \"trans\" : { \"type\": \"integer\" }\n                            }\n                        },\n                        \"early\" : { \"type\" : \"boolean\" }\n                    }\n                }\n            }\n        }\n    }\n}'\n"}]}]}]}]},"navigation":{"title":"log.elasticsearch"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"logelasticsearch-plugin"},"children":[{"type":"text","value":"log.elasticsearch plugin"}]},{"type":"element","tag":"h2","props":{"id":"logging"},"children":[{"type":"text","value":"Logging"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Unless errors are encountered, no logs are emitted."}]},{"type":"element","tag":"h2","props":{"id":"errors"},"children":[{"type":"text","value":"Errors"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The elasticsearch module has very robust error handling built in. If there's a\nconnection issue, errors such as these will be emitted when Haraka starts\nup:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Elasticsearch cluster is down!"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"No Living connections"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"However, ES will continue attempting to connect and when the ES server becomes\navailable, logging will begin. If errors are encountered trying to save data\nto ES, they look like this:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"No Living connections"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Request Timeout after 30000ms"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"They normally fix themselves when ES resumes working properly."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"host - an IP or hostname of the ES server to connect to"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"host=127.0.0.2"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"pluginObject"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"By default, all plugin results are presented as "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"$plugin_name: { ... }"}]},{"type":"text","value":", at\nthe top level. If you prefer that all plugin results be nested inside an\nobject "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"$obj: { $plugin_name: { ...}"}]},{"type":"text","value":", set pluginObject to that object's key name"}]},{"type":"element","tag":"code","props":{"code":"pluginObject=plugin\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"pluginObject=plugin"}]}]}]}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"ignore_hosts"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A config file section for hosts whose results should not be stored in\nES. HAproxy servers, Nagios, and other hosts who monitor Haraka can be listed\nhere. The format for entries is host.name=true"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"index"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"transaction=smtp-transaction\nconnection=smtp-connection"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Transactions include all the connection information and are \"the good stuff.\"\nWhen a connection has transactions, the connection is not saved separately.\nThe distinction is that a connection is stored only when it has zero\ntransactions. The connections index tends to be mostly noise (monitoring,\nblocked connections, bruteforce auth attempts, etc.). To collapse them into\nthe same index, set the value for both identically."}]},{"type":"element","tag":"h2","props":{"id":"index-map-template"},"children":[{"type":"text","value":"Index map template"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Creating a map template will apply the template(s) to any future indexes that\nmatch the pattern/name in the template setting. This is how to manually apply\nan index map template:"}]},{"type":"element","tag":"code","props":{"code":"curl -XPUT localhost:9200/_template/haraka_results -d '\n{\n    \"template\" : \"smtp-*\",\n    \"mappings\" : {\n        \"haraka\" : {\n            \"dynamic_templates\" : [\n                { \"fail_results\" : {\n                        \"match\" : \"fail\",\n                        \"mapping\" : {\n                            \"type\" : \"string\", \"index\" : \"not_analyzed\"\n                        }\n                    }\n                },\n                { \"pass_results\" : {\n                        \"match\" : \"pass\",\n                        \"mapping\" : {\n                            \"type\" : \"string\", \"index\" : \"not_analyzed\"\n                        }\n                    }\n                },\n                { \"skip_results\" : {\n                        \"match\" : \"skip\",\n                        \"mapping\" : {\n                            \"type\" : \"string\", \"index\" : \"not_analyzed\"\n                        }\n                    }\n                },\n                { \"msg_results\" : {\n                        \"match\" : \"msg\",\n                        \"mapping\" : {\n                            \"type\" : \"string\", \"index\" : \"not_analyzed\"\n                        }\n                    }\n                },\n                { \"err_results\" : {\n                        \"match\" : \"err\",\n                        \"mapping\" : {\n                            \"type\" : \"string\", \"index\" : \"not_analyzed\"\n                        }\n                    }\n                },\n                { \"ip_addrs\" : {\n                        \"match\" : \"ip\",\n                        \"mapping\" : { \"type\" : \"ip\" }\n                    }\n                },\n                { \"hostnames\" : {\n                        \"match\" : \"host\",\n                        \"mapping\" : {\n                            \"type\" : \"string\", \"index\" : \"not_analyzed\"\n                        }\n                    }\n                }\n            ],\n            \"properties\" : {\n                \"plugin\" : {\n                    \"properties\" : {\n                        \"asn\" : {\n                            \"properties\" : {\n                                \"org\" : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                \"asn_good\"        : { \"type\" : \"double\" },\n                                \"asn_bad\"         : { \"type\" : \"double\" },\n                                \"asn_score\"       : { \"type\" : \"double\" },\n                                \"asn_connections\" : { \"type\" : \"double\" }\n                            }\n                        },\n                        \"geoip\" : {\n                            \"properties\" : {\n                                \"org\"      : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                \"geo\"      : { \"type\" : \"geo_point\" },\n                                \"distance\" : { \"type\" : \"float\" }\n                            }\n                        },\n                        \"helo\" : {\n                            \"properties\"   : {\n                                \"ips\"      : { \"type\" : \"string\", \"index\" : \"not_analyzed\" }\n                            }\n                        },\n                        \"fcrdns\" : {\n                            \"properties\"    : {\n                                \"fcrdns\"    : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                \"other_ips\" : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                \"ptr_names\" : { \"type\" : \"string\", \"index\" : \"not_analyzed\" }\n                            }\n                        },\n                        \"p0f\" : {\n                            \"properties\" : {\n                                \"os_flavor\" : { \"type\" : \"string\", \"index\" : \"not_analyzed\" }\n                            }\n                        },\n                        \"rspamd\" : {\n                            \"properties\"   : {\n                                \"emails\"   : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                \"urls\"     : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                \"messages\" : { \"type\" : \"string\", \"index\" : \"not_analyzed\" }\n                            }\n                        },\n                        \"karma\" : {\n                            \"properties\" : {\n                                \"connect\"   : { \"type\" : \"double\" },\n                                \"score\"     : { \"type\" : \"double\" },\n                                \"good\"      : { \"type\" : \"double\" },\n                                \"bad\"       : { \"type\" : \"double\" },\n                                \"history\"   : { \"type\" : \"double\" },\n                                \"connections\" : { \"type\" : \"double\" },\n                                \"total_connects\" : { \"type\" : \"double\" },\n                                \"neighbors\" : { \"type\" : \"double\" }\n                            }\n                        },\n                        \"spamassassin\" : {\n                            \"properties\" : {\n                                \"headers\": {\n                                    \"properties\" : {\n                                        \"report\" : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                        \"Status\" : { \"type\" : \"string\", \"index\" : \"not_analyzed\" }\n                                    }\n                                },\n                                \"line0\" : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                \"reqd\"  : { \"type\" : \"double\" },\n                                \"score\" : { \"type\" : \"double\" },\n                                \"tests\" : { \"type\" : \"string\", \"index\" : \"not_analyzed\" }\n                            }\n                        },\n                        \"spf\" : {\n                            \"properties\" : {\n                                \"domain\" : { \"type\" : \"string\", \"index\" : \"not_analyzed\" }\n                            }\n                        }\n                    }\n                },\n                \"message\" : {\n                    \"properties\" : {\n                        \"bytes\" : { \"type\": \"double\" },\n                        \"envelope\": {\n                            \"properties\": {\n                                \"sender\" : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                \"recipient\" : {\n                                    \"properties\"  : {\n                                        \"action\"  : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                        \"address\" : { \"type\" : \"string\", \"index\" : \"not_analyzed\" }\n                                    }\n                                }\n                            }\n                        },\n                        \"header\": {\n                            \"properties\": {\n                                \"from\"         : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                \"to\"           : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                \"subject\"      : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                \"message-id\"   : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                \"date\"         : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                \"reply-to\"     : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                \"resent-from\"  : { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                \"resent-header\": { \"type\" : \"string\", \"index\" : \"not_analyzed\" },\n                                \"sender\"       : { \"type\" : \"string\", \"index\" : \"not_analyzed\" }\n                            }\n                        },\n                        \"body\" : {\n                            \"properties\" : {\n                                \"attachment\" : {\n                                    \"properties\": {\n                                        \"bytes\" : { \"type\" : \"float\" },\n                                        \"ctype\" : { \"type\" : \"string\" },\n                                        \"file\"  : { \"type\" : \"string\" },\n                                        \"md5\"   : { \"type\" : \"string\", \"index\": \"not_analyzed\" }\n                                    }\n                                }\n                            }\n                        },\n                        \"queue\" : {\n                            \"properties\" : {\n\n                            }\n                        }\n                    }\n                },\n                \"connection\" : {\n                    \"properties\" : {\n                        \"count\" : {\n                            \"properties\" : {\n                                \"msg\" : {\n                                    \"properties\" : {\n                                        \"accept\" : { \"type\": \"integer\" },\n                                        \"reject\" : { \"type\": \"integer\" },\n                                        \"tempfail\" : { \"type\": \"integer\" }\n                                    }\n                                },\n                                \"rcpt\" : {\n                                    \"properties\" : {\n                                        \"accept\" : { \"type\": \"integer\" },\n                                        \"reject\" : { \"type\": \"integer\" },\n                                        \"tempfail\" : { \"type\": \"integer\" }\n                                    }\n                                },\n                                \"errors\" : { \"type\": \"integer\" },\n                                \"trans\" : { \"type\": \"integer\" }\n                            }\n                        },\n                        \"early\" : { \"type\" : \"boolean\" }\n                    }\n                }\n            }\n        }\n    }\n}'\n","language":"json"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"curl -XPUT localhost:"}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"9200"}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"/_template/haraka_results -d '"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"{"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"template\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"smtp-*\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":","}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"mappings\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"haraka\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"            "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"dynamic_templates\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : ["}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"fail_results\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"match\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"fail\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":","}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"mapping\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                            "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"string\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"index\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"not_analyzed\""}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                    }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"pass_results\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"match\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"pass\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":","}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"mapping\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                            "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"string\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"index\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"not_analyzed\""}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                    }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"skip_results\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"match\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"skip\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":","}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"mapping\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                            "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"string\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"index\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"not_analyzed\""}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                    }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"msg_results\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"match\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"msg\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":","}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"mapping\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                            "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"string\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"index\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"not_analyzed\""}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                    }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"err_results\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"match\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"err\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":","}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"mapping\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                            "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"string\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"index\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"not_analyzed\""}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                    }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"ip_addrs\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"match\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"ip\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":","}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"mapping\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"ip\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                    }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"hostnames\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"match\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"host\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":","}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"mapping\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                            "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"string\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"index\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"not_analyzed\""}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                    }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"            ],"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"            "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"properties\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"plugin\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                    "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"properties\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"asn\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                            "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"properties\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"org\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"string\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"index\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"not_analyzed\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"asn_good\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"        : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"double\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"asn_bad\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"         : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"double\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"asn_score\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"       : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"double\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"asn_connections\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"double\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                            }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"geoip\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                            "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"properties\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"org\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"      : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"string\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"index\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"not_analyzed\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"geo\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"      : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"geo_point\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"distance\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"float\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                            }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"helo\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                            "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"properties\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"   : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"ips\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"      : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"string\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"index\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"not_analyzed\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                            }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"fcrdns\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                            "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"properties\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"    : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"fcrdns\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"    : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"string\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"index\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"not_analyzed\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"other_ips\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"string\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"index\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"not_analyzed\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"ptr_names\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"string\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"index\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"not_analyzed\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                            }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"p0f\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                            "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"properties\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"os_flavor\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"string\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"index\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"not_analyzed\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                            }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"rspamd\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                            "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"properties\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"   : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"emails\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"   : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"string\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"index\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"not_analyzed\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"urls\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"     : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"string\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"index\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"not_analyzed\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"messages\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"string\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"index\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"not_analyzed\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                            }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"karma\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                            "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"properties\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"connect\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"   : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"double\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"score\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"     : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"double\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"good\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"      : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"double\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"bad\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"       : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"double\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"history\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"   : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"double\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"connections\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"double\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"total_connects\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"double\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"neighbors\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"double\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                            }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"spamassassin\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                            "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"properties\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"headers\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":": {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                    "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"properties\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                        "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"report\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"string\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"index\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"not_analyzed\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                        "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"Status\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"string\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"index\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"not_analyzed\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                    }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"line0\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"string\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"index\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"not_analyzed\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"reqd\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"  : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"double\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"score\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"double\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"tests\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"string\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"index\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"not_analyzed\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                            }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"spf\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                            "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"properties\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"domain\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"string\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"index\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"not_analyzed\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                            }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                    }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"message\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                    "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"properties\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"bytes\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"double\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"envelope\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":": {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                            "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"properties\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":": {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"sender\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"string\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"index\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"not_analyzed\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"recipient\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                    "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"properties\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"  : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                        "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"action\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"  : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"string\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"index\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"not_analyzed\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                        "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"address\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"string\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"index\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"not_analyzed\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                    }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                            }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"header\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":": {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                            "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"properties\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":": {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"from\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"         : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"string\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"index\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"not_analyzed\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"to\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"           : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"string\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"index\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"not_analyzed\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"subject\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"      : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"string\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"index\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"not_analyzed\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"message-id\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"   : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"string\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"index\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"not_analyzed\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"date\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"         : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"string\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"index\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"not_analyzed\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"reply-to\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"     : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"string\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"index\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"not_analyzed\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"resent-from\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"  : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"string\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"index\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"not_analyzed\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"resent-header\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":": { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"string\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"index\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"not_analyzed\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"sender\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"       : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"string\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"index\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"not_analyzed\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                            }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"body\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                            "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"properties\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"attachment\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                    "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"properties\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":": {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                        "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"bytes\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"float\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                        "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"ctype\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"string\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                        "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"file\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"  : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"string\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                        "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"md5\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"   : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"string\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"index\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"not_analyzed\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                    }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                            }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"queue\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                            "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"properties\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                            }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                    }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"connection\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                    "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"properties\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"count\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                            "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"properties\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"msg\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                    "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"properties\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                        "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"accept\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"integer\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                        "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"reject\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"integer\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                        "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"tempfail\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"integer\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                    }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"rcpt\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                    "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"properties\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                        "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"accept\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"integer\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                        "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"reject\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"integer\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                        "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"tempfail\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"integer\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                    }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"errors\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"integer\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                                "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"trans\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"integer\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                            }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                        "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"early\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : { "}]},{"type":"element","tag":"span","props":{"class":"ct-0b5534"},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" : "}]},{"type":"element","tag":"span","props":{"class":"ct-3f625c"},"children":[{"type":"text","value":"\"boolean\""}]},{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":" }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                    }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"                }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"            }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"        }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"    }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-790a61"},"children":[{"type":"text","value":"}'"}]}]}]}]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-3f625c{color:#0A3069}\n.ct-0b5534{color:#0550AE}\n.ct-790a61{color:#24292F}\n.dark .ct-790a61{color:#C9D1D9}\n.dark .ct-0b5534{color:#79C0FF}\n.dark .ct-3f625c{color:#A5D6FF}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"logging","depth":2,"text":"Logging"},{"id":"errors","depth":2,"text":"Errors"},{"id":"configuration","depth":2,"text":"Configuration"},{"id":"index-map-template","depth":2,"text":"Index map template"}]}},"_type":"markdown","_id":"content:8.plugins:log.elasticsearch.md","_source":"content","_file":"8.plugins/log.elasticsearch.md","_extension":"md"},{"_path":"/plugins/log.syslog","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"log.syslog - Logs to syslog plugin for Haraka","description":"Haraka log.syslog plugin - Logs to syslog","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"logsyslog-plugin"},"children":[{"type":"text","value":"log.syslog plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin adds syslog support to haraka.  Most log levels in haraka\nalready map to valid levels in syslog.  Additional log levels in haraka\nfall under the DEBUG syslog level.  Note: this plugin requires modern-syslog and you need enable/add log.syslog inside config/plugins at the top of the file."}]},{"type":"element","tag":"h2","props":{"id":"configuration-logsyslogini"},"children":[{"type":"text","value":"Configuration log.syslog.ini"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This is the general configuration file for the log.syslog plugin.\nIn it you can find ways to customize the syslog service name, set the\nlogging facility, and set any syslog options you wish. For example:"}]},{"type":"element","tag":"code","props":{"code":"[general]\nname=SomeOtherName\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"[general]\nname=SomeOtherName\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Sane defaults are\nchosen for you."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"log.syslog.general.name (default: haraka)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The service name to show up in the logs."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"log.syslog.general.facility (default: MAIL)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The syslog logging facility to use.  MAIL makes the most sense, but some\ndefault syslog configs may try to do something special with this log level.\nFreeBSD and OSX, for example, does not log all messages sent to this log\nlevel to the same file.\nValid options are:\nMAIL\nKERN\nUSER\nDAEMON\nAUTH\nSYSLOG\nLPR\nNEWS\nUUCP\nLOCAL0 ... LOCAL7"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"log.syslog.general.pid (default: 1)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Option to put the PID in the log message."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"log.syslog.general.odelay (default: 1)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Option to open the connection on the first log message."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"log.syslog.general.ndelay (default: 0)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Option to open the connection immediately."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"log.syslog.general.cons (default: 0)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Option to write directly to system console if there is an error\nwhile sending to system logger."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"log.syslog.general.nowait (default: 0)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Don't wait for child processes that may have been created while\nlogging the message."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"log.syslog.general.always_ok (default: false)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If false, then this plugin will return with just next() allowing other\nplugins that have registered for the log hook to run.  To speed things up,\nif no other log hooks need to run (daemon), then one can make this true.\nThis will case the plugin to always call next(OK)."}]}]}]},"navigation":{"title":"log.syslog"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"logsyslog-plugin"},"children":[{"type":"text","value":"log.syslog plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin adds syslog support to haraka.  Most log levels in haraka\nalready map to valid levels in syslog.  Additional log levels in haraka\nfall under the DEBUG syslog level.  Note: this plugin requires modern-syslog and you need enable/add log.syslog inside config/plugins at the top of the file."}]},{"type":"element","tag":"h2","props":{"id":"configuration-logsyslogini"},"children":[{"type":"text","value":"Configuration log.syslog.ini"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This is the general configuration file for the log.syslog plugin.\nIn it you can find ways to customize the syslog service name, set the\nlogging facility, and set any syslog options you wish. For example:"}]},{"type":"element","tag":"code","props":{"code":"[general]\nname=SomeOtherName\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"[general]\nname=SomeOtherName"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Sane defaults are\nchosen for you."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"log.syslog.general.name (default: haraka)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The service name to show up in the logs."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"log.syslog.general.facility (default: MAIL)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The syslog logging facility to use.  MAIL makes the most sense, but some\ndefault syslog configs may try to do something special with this log level.\nFreeBSD and OSX, for example, does not log all messages sent to this log\nlevel to the same file.\nValid options are:\nMAIL\nKERN\nUSER\nDAEMON\nAUTH\nSYSLOG\nLPR\nNEWS\nUUCP\nLOCAL0 ... LOCAL7"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"log.syslog.general.pid (default: 1)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Option to put the PID in the log message."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"log.syslog.general.odelay (default: 1)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Option to open the connection on the first log message."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"log.syslog.general.ndelay (default: 0)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Option to open the connection immediately."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"log.syslog.general.cons (default: 0)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Option to write directly to system console if there is an error\nwhile sending to system logger."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"log.syslog.general.nowait (default: 0)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Don't wait for child processes that may have been created while\nlogging the message."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"log.syslog.general.always_ok (default: false)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If false, then this plugin will return with just next() allowing other\nplugins that have registered for the log hook to run.  To speed things up,\nif no other log hooks need to run (daemon), then one can make this true.\nThis will case the plugin to always call next(OK)."}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"configuration-logsyslogini","depth":2,"text":"Configuration log.syslog.ini"}]}},"_type":"markdown","_id":"content:8.plugins:log.syslog.md","_source":"content","_file":"8.plugins/log.syslog.md","_extension":"md"},{"_path":"/plugins/mail_from.access","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"mail_from.access - ACL plugin for Haraka","description":"Haraka mail_from.access plugin - Access control for mail_from","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"mail_fromaccess-plugin"},"children":[{"type":"text","value":"mail_from.access plugin"}]},{"type":"element","tag":"h2","props":{"id":"deprecation-notice"},"children":[{"type":"text","value":"DEPRECATION NOTICE"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"See the "},{"type":"element","tag":"a","props":{"href":"/plugins/access"},"children":[{"type":"text","value":"access"}]},{"type":"text","value":" plugin\nfor upgrade instructions."}]},{"type":"element","tag":"h1","props":{"id":"mail_fromaccess"},"children":[{"type":"text","value":"mail_from.access"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin will evaluate the address against a set of white and black lists.\nThe lists are applied in the following way:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"mail_from.access.whitelist          (pass)\nmail_from.access.whitelist_regex   (pass)\nmail_from.access.blacklist          (block)\nmail_from.access.blacklist_regex   (block)"}]},{"type":"element","tag":"h2","props":{"id":"configuration-mail_fromaccessini"},"children":[{"type":"text","value":"Configuration mail_from.access.ini"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"General configuration file for this plugin."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"mail_from.access.general.deny_msg"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Text to send the user on reject (text)."}]}]},{"type":"element","tag":"h2","props":{"id":"configuration-mail_fromaccesswhitelist"},"children":[{"type":"text","value":"Configuration mail_from.access.whitelist"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The whitelist is mostly to counter blacklist entries that match more than\nwhat one would want.  This file should be used for a specific address,\none per line, that should bypass blacklist checks.\nNOTE: We heavily suggest tailoring blacklist entries to be as accurate as\npossible and never using whitelists.  Nevertheless, if you need whitelists,\nhere they are."}]},{"type":"element","tag":"h2","props":{"id":"configuration-mail_fromaccesswhitelist_regex"},"children":[{"type":"text","value":"Configuration mail_from.access.whitelist_regex"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Does the same thing as the whitelist file, but each line is a regex.\nEach line is also anchored for you, meaning '^' + regex + '$' is added for\nyou.  If you need to get around this restriction, you may use a '.*' at\neither the start or the end of your regex.  This should help prevent people\nfrom writing overly permissive rules on accident."}]},{"type":"element","tag":"h2","props":{"id":"configuration-mail_fromaccessblacklist"},"children":[{"type":"text","value":"Configuration mail_from.access.blacklist"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This file should be used for a specific address, one per line, that should\nfail on connect."}]},{"type":"element","tag":"h2","props":{"id":"configuration-mail_fromaccessblacklist_regex"},"children":[{"type":"text","value":"Configuration mail_from.access.blacklist_regex"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Does the same thing as the blacklist file, but each line is a regex.\nEach line is also anchored for you, meaning '^' + regex + '$' is added for\nyou.  If you need to get around this restriction, you may use a '.*' at\neither the start or the end of your regex.  This should help prevent people\nfrom writing overly permissive rules on accident."}]}]},"navigation":{"title":"mail_from.access"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"mail_fromaccess-plugin"},"children":[{"type":"text","value":"mail_from.access plugin"}]},{"type":"element","tag":"h2","props":{"id":"deprecation-notice"},"children":[{"type":"text","value":"DEPRECATION NOTICE"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"See the "},{"type":"element","tag":"a","props":{"href":"/plugins/access"},"children":[{"type":"text","value":"access"}]},{"type":"text","value":" plugin\nfor upgrade instructions."}]},{"type":"element","tag":"h1","props":{"id":"mail_fromaccess"},"children":[{"type":"text","value":"mail_from.access"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin will evaluate the address against a set of white and black lists.\nThe lists are applied in the following way:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"mail_from.access.whitelist          (pass)\nmail_from.access.whitelist_regex   (pass)\nmail_from.access.blacklist          (block)\nmail_from.access.blacklist_regex   (block)"}]},{"type":"element","tag":"h2","props":{"id":"configuration-mail_fromaccessini"},"children":[{"type":"text","value":"Configuration mail_from.access.ini"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"General configuration file for this plugin."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"mail_from.access.general.deny_msg"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Text to send the user on reject (text)."}]}]},{"type":"element","tag":"h2","props":{"id":"configuration-mail_fromaccesswhitelist"},"children":[{"type":"text","value":"Configuration mail_from.access.whitelist"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The whitelist is mostly to counter blacklist entries that match more than\nwhat one would want.  This file should be used for a specific address,\none per line, that should bypass blacklist checks.\nNOTE: We heavily suggest tailoring blacklist entries to be as accurate as\npossible and never using whitelists.  Nevertheless, if you need whitelists,\nhere they are."}]},{"type":"element","tag":"h2","props":{"id":"configuration-mail_fromaccesswhitelist_regex"},"children":[{"type":"text","value":"Configuration mail_from.access.whitelist_regex"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Does the same thing as the whitelist file, but each line is a regex.\nEach line is also anchored for you, meaning '^' + regex + '$' is added for\nyou.  If you need to get around this restriction, you may use a '.*' at\neither the start or the end of your regex.  This should help prevent people\nfrom writing overly permissive rules on accident."}]},{"type":"element","tag":"h2","props":{"id":"configuration-mail_fromaccessblacklist"},"children":[{"type":"text","value":"Configuration mail_from.access.blacklist"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This file should be used for a specific address, one per line, that should\nfail on connect."}]},{"type":"element","tag":"h2","props":{"id":"configuration-mail_fromaccessblacklist_regex"},"children":[{"type":"text","value":"Configuration mail_from.access.blacklist_regex"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Does the same thing as the blacklist file, but each line is a regex.\nEach line is also anchored for you, meaning '^' + regex + '$' is added for\nyou.  If you need to get around this restriction, you may use a '.*' at\neither the start or the end of your regex.  This should help prevent people\nfrom writing overly permissive rules on accident."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"deprecation-notice","depth":2,"text":"DEPRECATION NOTICE"},{"id":"configuration-mail_fromaccessini","depth":2,"text":"Configuration mail_from.access.ini"},{"id":"configuration-mail_fromaccesswhitelist","depth":2,"text":"Configuration mail_from.access.whitelist"},{"id":"configuration-mail_fromaccesswhitelist_regex","depth":2,"text":"Configuration mail_from.access.whitelist_regex"},{"id":"configuration-mail_fromaccessblacklist","depth":2,"text":"Configuration mail_from.access.blacklist"},{"id":"configuration-mail_fromaccessblacklist_regex","depth":2,"text":"Configuration mail_from.access.blacklist_regex"}]}},"_type":"markdown","_id":"content:8.plugins:mail_from.access.md","_source":"content","_file":"8.plugins/mail_from.access.md","_extension":"md"},{"_path":"/plugins/mail_from.is_resolvable","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"mail_from.is_resolvable - Rejects messages with unresolvable mail_from domains","description":"Haraka mail_from.is_resolvable plugin - Rejects messages with unresolvable mail_from domains","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"mail_fromis_resolvable-plugin"},"children":[{"type":"text","value":"mail_from.is_resolvable plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin checks that the domain used in MAIL FROM is resolvable to an MX\nrecord."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin uses the INI-style file format and accepts the following options:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"timeout"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: 30"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Maximum limit in seconds for queries to complete.  If the timeout is\nreached a TEMPFAIL is returned to the client."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"allow_mx_ip="},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"0|1"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Allow MX records that return IP addresses instead of hostnames.\nThis is not allowed as per the RFC, but some MTAs allow it."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"reject_no_mx="},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"0|1"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Return DENY and reject the command if no MX record is found.  Otherwise a\nDENYSOFT (TEMPFAIL) is returned and the client will retry later."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"DNS errors always return DENYSOFT, so this should be safe to enable."}]}]}]},"navigation":{"title":"mail_from.is_resolvable"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"mail_fromis_resolvable-plugin"},"children":[{"type":"text","value":"mail_from.is_resolvable plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin checks that the domain used in MAIL FROM is resolvable to an MX\nrecord."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin uses the INI-style file format and accepts the following options:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"timeout"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: 30"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Maximum limit in seconds for queries to complete.  If the timeout is\nreached a TEMPFAIL is returned to the client."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"allow_mx_ip="},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"0|1"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Allow MX records that return IP addresses instead of hostnames.\nThis is not allowed as per the RFC, but some MTAs allow it."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"reject_no_mx="},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"0|1"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Return DENY and reject the command if no MX record is found.  Otherwise a\nDENYSOFT (TEMPFAIL) is returned and the client will retry later."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"DNS errors always return DENYSOFT, so this should be safe to enable."}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"configuration","depth":2,"text":"Configuration"}]}},"_type":"markdown","_id":"content:8.plugins:mail_from.is_resolvable.md","_source":"content","_file":"8.plugins/mail_from.is_resolvable.md","_extension":"md"},{"_path":"/plugins/max_unrecognized_commands","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"max_unrecognized_commands - Max Unrecognized Commands plugin for Haraka","description":"Haraka max_unrecognized_commands plugin - Rejects messages with too many unrecognized commands","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"max_unrecognized_commands-plugin"},"children":[{"type":"text","value":"max_unrecognized_commands plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin places a maximum limit on the number of unrecognized commands\nallowed before recognising that the connection is bad."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If the limit is reached the connecting client is sent an error message and\nimmediately (and rudely - technically an RFC violation) disconnected."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"IMPORTANT"}]},{"type":"text","value":":\nThis plugin should be listed near the bottom of "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/plugins"}]},{"type":"text","value":" so that it\nruns after any plugins that use the unrecognized_command hook to implement\nother SMTP verbs and extensions (such as the auth/* plugins), otherwise\ncommands valid for these plugins will be counted as unknown by this plugin."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"max_unrecognized_commands"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Specifies the number of unrecognized commands to allow before disconnecting.\nDefault: 10."}]}]}]},"navigation":{"title":"max_unrecognized_commands"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"max_unrecognized_commands-plugin"},"children":[{"type":"text","value":"max_unrecognized_commands plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin places a maximum limit on the number of unrecognized commands\nallowed before recognising that the connection is bad."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If the limit is reached the connecting client is sent an error message and\nimmediately (and rudely - technically an RFC violation) disconnected."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"IMPORTANT"}]},{"type":"text","value":":\nThis plugin should be listed near the bottom of "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/plugins"}]},{"type":"text","value":" so that it\nruns after any plugins that use the unrecognized_command hook to implement\nother SMTP verbs and extensions (such as the auth/* plugins), otherwise\ncommands valid for these plugins will be counted as unknown by this plugin."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"max_unrecognized_commands"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Specifies the number of unrecognized commands to allow before disconnecting.\nDefault: 10."}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"configuration","depth":2,"text":"Configuration"}]}},"_type":"markdown","_id":"content:8.plugins:max_unrecognized_commands.md","_source":"content","_file":"8.plugins/max_unrecognized_commands.md","_extension":"md"},{"_path":"/plugins/messagesniffer","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"messagesniffer - Message Sniffer plugin for Haraka","description":"Haraka messagesniffer plugin - Message Sniffer","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"messagesniffer-plugin"},"children":[{"type":"text","value":"messagesniffer plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin provides integration with the commerical Anti-Spam product "},{"type":"element","tag":"a","props":{"href":"http://armresearch.com/products/sniffer.jsp","rel":["nofollow"]},"children":[{"type":"text","value":"MessageSniffer"}]},{"type":"text","value":" by Arm Research Labs using its XML Client interface "},{"type":"element","tag":"a","props":{"href":"http://armresearch.com/support/articles/software/snfServer/xci/","rel":["nofollow"]},"children":[{"type":"text","value":"XCI"}]},{"type":"text","value":" over TCP."}]},{"type":"element","tag":"h2","props":{"id":"installation"},"children":[{"type":"text","value":"Installation"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Install the SNF Client/Server package for your platform as per the instructions on the MessageSniffer website."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Modify your SNFServer.xml file and under the 'xheaders' section set:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"output mode='api'"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This prevents MessageSniffer from adding additional headers to the temporary file used to send it the message data which is\nunnecessary as Haraka reads the headers from the XCI response."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"rulebase on-off='on'"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"result on-off='on'"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"black on-off='on'"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"while on-off='on'"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"clean on-off='on'"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"all symbol on-off='on'"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"These cause SNFServer to send Haraka additional headers that are inserted into all messages scanned by MessageSniffer and\nwill aid debugging and troubleshooting."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Once this is done start/restart the SNF server."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin uses "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"messagesniffer.ini"}]},{"type":"text","value":" for configuration.  The "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[main]"}]},{"type":"text","value":" section is for global configuration, the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[gbudb]"}]},{"type":"text","value":"\nsection is used to specify the action that should be taken based on the GBUdb result which is checked at the start of the\nconnection and the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[message]"}]},{"type":"text","value":" section is used to specify the action to be taken based on the main scan result."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[main]"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"port"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: 9001\nTCP port to use when communicating to the SNFServer daemon.\nThis needs to match the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"<xci on-off='on' port='9001'/>"}]},{"type":"text","value":" value in the SNFServer.xml file."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"tmpdir"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: /tmp\nTemporary directory used to write temporary message files to that are read by the SNFServer daemon.\nThis directory and the files within need to be readable by the user that SNFServer is running as."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"gbudb_report_deny = "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":" true | false | 0 | 1"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: false\nThis is an experimental option that will record a GBUdb 'bad' encounter for a connected IP address when a client\ndisconnects with no message having been sent or seen by MessageSniffer but Haraka has recorded a hard rejection at\nsome point during the session.  The idea behind this option is that it allows other Haraka plugins rejections influence\nGBUdb IP reputation where MessageSniffer isn't seeing the actual message because it is being rejected pre-DATA."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"tag_string"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"SPAM"}]},{"type":"text","value":"\nString to prepend to the Subject line if the 'tag' action is applied."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[gbudb]"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"white = "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":" accept | allow | continue | retry | tempfail | reject | quarantine | tag"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: accept\nAction to take when GBUdb reports a 'white' result."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"caution = "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":" accept | allow | continue | retry | tempfail | reject | quarantine | tag"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: continue\nAction to take when GBUdb reports a 'caution' result."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"black = "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":" accept | allow | continue | retry | tempfail | reject | quarantine | tag"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: continue\nAction to take when GBUdb reports a 'black' result."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"truncate = "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":" accept | allow | continue | retry | tempfail | reject | quarantine | tag"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: reject\nAction to take when GBUdb reports a 'truncate' result."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[message]"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"white = "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":" accept | allow | continue | retry | tempfail | reject | quarantine | tag"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: continue\nAction to take when MessageSniffer reports a 'white' result (result code: 0)."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"local_white = "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":" accept | allow | continue | retry | tempfail | reject | quarantine | tag"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: accept\nAction to take when MessageSniffer reports a local whitelist result (result code: 1).\nNOTE: You will not see this result unless you Arm support have customized your rulebase and added white rules for you."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"truncate = "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":" accept | allow | continue | retry | tempfail | reject | quarantine | tag"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: reject\nAction to take when MessageSniffer reports a GBUdb result of 'truncate' (result code: 20).\nNOTE: GBUdb IP lookups during the data phase can be different than the connecting IP address if you have configured\nSource and DrillDown options in the Training section of SNFServer.xml."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"caution = "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":" accept | allow | continue | retry | tempfail | reject | quarantine | tag"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: continue\nAction to take when MessageSniffer reports a GBUdb result of 'caution' (result code: 40).\nNOTE: GBUdb IP lookups during the data phase can be different than the connecting IP address if you have configured\nSource and DrillDown options in the Training section of SNFServer.xml."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"black = "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":" accept | allow | continue | retry | tempfail | reject | quarantine | tag"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: continue\nAction to take when MessageSniffer reports a GBUdb result of 'black' (result code: 63).\nNOTE: GBUdb IP lookups during the data phase can be different than the connecting IP address if you have configured\nSource and DrillDown options in the Training section of SNFServer.xml."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"code_NN = "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":" accept | allow | continue | retry | tempfail | reject | quarantine | tag"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"NOTE: replace NN with the numeric MessageSniffer "},{"type":"element","tag":"a","props":{"href":"http://armresearch.com/support/articles/software/snfServer/core.jsp","rel":["nofollow"]},"children":[{"type":"text","value":"result code"}]},{"type":"text","value":"\nAction to take when MessageSniffer reports a result code other than those explicitly defined above."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"nonzero = "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":" accept | allow | continue | retry | tempfail | reject | quarantine | tag"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Defalt: reject\nAction to take for any non-zero result code other than those explicity defined above.  This is a catch-all result that\nis checked last after all other settings have been checked so you can define a code_NN value to prevent this action from\nbeing taken."}]}]},{"type":"element","tag":"h2","props":{"id":"actions"},"children":[{"type":"text","value":"Actions"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"accept"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Accept the message and skip further plugins (whitelist)."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"allow | continute"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Continue to the next plugin."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"retry | tempfail"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Reject the message with a temporary failure message (DENYSOFT)."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"reject"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Reject the message with a permanent failure message (DENY)."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"quarantine"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Continue to the next plugin.  If the message isn't rejected by another plugin - it will cause the message to be quarantined\nand the message will not be delivered to the recipient(s)."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"NOTE: this option requires the queue/quarantine plugin in your config/plugins files and it must be listed before any\nother queue plugins."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"tag"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Tag the subject with the default 'tag_string' defined in the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"main"}]},{"type":"text","value":" section above, this will also set X-Spam-Flag: YES in\nthe message headers.   Once tagged, processing will continue to the next plugin."}]}]}]},"navigation":{"title":"messagesniffer"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"messagesniffer-plugin"},"children":[{"type":"text","value":"messagesniffer plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin provides integration with the commerical Anti-Spam product "},{"type":"element","tag":"a","props":{"href":"http://armresearch.com/products/sniffer.jsp","rel":["nofollow"]},"children":[{"type":"text","value":"MessageSniffer"}]},{"type":"text","value":" by Arm Research Labs using its XML Client interface "},{"type":"element","tag":"a","props":{"href":"http://armresearch.com/support/articles/software/snfServer/xci/","rel":["nofollow"]},"children":[{"type":"text","value":"XCI"}]},{"type":"text","value":" over TCP."}]},{"type":"element","tag":"h2","props":{"id":"installation"},"children":[{"type":"text","value":"Installation"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Install the SNF Client/Server package for your platform as per the instructions on the MessageSniffer website."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Modify your SNFServer.xml file and under the 'xheaders' section set:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"output mode='api'"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This prevents MessageSniffer from adding additional headers to the temporary file used to send it the message data which is\nunnecessary as Haraka reads the headers from the XCI response."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"rulebase on-off='on'"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"result on-off='on'"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"black on-off='on'"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"while on-off='on'"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"clean on-off='on'"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"all symbol on-off='on'"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"These cause SNFServer to send Haraka additional headers that are inserted into all messages scanned by MessageSniffer and\nwill aid debugging and troubleshooting."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Once this is done start/restart the SNF server."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin uses "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"messagesniffer.ini"}]},{"type":"text","value":" for configuration.  The "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[main]"}]},{"type":"text","value":" section is for global configuration, the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[gbudb]"}]},{"type":"text","value":"\nsection is used to specify the action that should be taken based on the GBUdb result which is checked at the start of the\nconnection and the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[message]"}]},{"type":"text","value":" section is used to specify the action to be taken based on the main scan result."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[main]"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"port"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: 9001\nTCP port to use when communicating to the SNFServer daemon.\nThis needs to match the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"<xci on-off='on' port='9001'/>"}]},{"type":"text","value":" value in the SNFServer.xml file."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"tmpdir"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: /tmp\nTemporary directory used to write temporary message files to that are read by the SNFServer daemon.\nThis directory and the files within need to be readable by the user that SNFServer is running as."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"gbudb_report_deny = "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":" true | false | 0 | 1"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: false\nThis is an experimental option that will record a GBUdb 'bad' encounter for a connected IP address when a client\ndisconnects with no message having been sent or seen by MessageSniffer but Haraka has recorded a hard rejection at\nsome point during the session.  The idea behind this option is that it allows other Haraka plugins rejections influence\nGBUdb IP reputation where MessageSniffer isn't seeing the actual message because it is being rejected pre-DATA."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"tag_string"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"SPAM"}]},{"type":"text","value":"\nString to prepend to the Subject line if the 'tag' action is applied."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[gbudb]"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"white = "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":" accept | allow | continue | retry | tempfail | reject | quarantine | tag"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: accept\nAction to take when GBUdb reports a 'white' result."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"caution = "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":" accept | allow | continue | retry | tempfail | reject | quarantine | tag"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: continue\nAction to take when GBUdb reports a 'caution' result."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"black = "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":" accept | allow | continue | retry | tempfail | reject | quarantine | tag"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: continue\nAction to take when GBUdb reports a 'black' result."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"truncate = "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":" accept | allow | continue | retry | tempfail | reject | quarantine | tag"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: reject\nAction to take when GBUdb reports a 'truncate' result."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[message]"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"white = "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":" accept | allow | continue | retry | tempfail | reject | quarantine | tag"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: continue\nAction to take when MessageSniffer reports a 'white' result (result code: 0)."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"local_white = "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":" accept | allow | continue | retry | tempfail | reject | quarantine | tag"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: accept\nAction to take when MessageSniffer reports a local whitelist result (result code: 1).\nNOTE: You will not see this result unless you Arm support have customized your rulebase and added white rules for you."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"truncate = "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":" accept | allow | continue | retry | tempfail | reject | quarantine | tag"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: reject\nAction to take when MessageSniffer reports a GBUdb result of 'truncate' (result code: 20).\nNOTE: GBUdb IP lookups during the data phase can be different than the connecting IP address if you have configured\nSource and DrillDown options in the Training section of SNFServer.xml."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"caution = "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":" accept | allow | continue | retry | tempfail | reject | quarantine | tag"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: continue\nAction to take when MessageSniffer reports a GBUdb result of 'caution' (result code: 40).\nNOTE: GBUdb IP lookups during the data phase can be different than the connecting IP address if you have configured\nSource and DrillDown options in the Training section of SNFServer.xml."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"black = "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":" accept | allow | continue | retry | tempfail | reject | quarantine | tag"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: continue\nAction to take when MessageSniffer reports a GBUdb result of 'black' (result code: 63).\nNOTE: GBUdb IP lookups during the data phase can be different than the connecting IP address if you have configured\nSource and DrillDown options in the Training section of SNFServer.xml."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"code_NN = "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":" accept | allow | continue | retry | tempfail | reject | quarantine | tag"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"NOTE: replace NN with the numeric MessageSniffer "},{"type":"element","tag":"a","props":{"href":"http://armresearch.com/support/articles/software/snfServer/core.jsp","rel":["nofollow"]},"children":[{"type":"text","value":"result code"}]},{"type":"text","value":"\nAction to take when MessageSniffer reports a result code other than those explicitly defined above."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"nonzero = "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":" accept | allow | continue | retry | tempfail | reject | quarantine | tag"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Defalt: reject\nAction to take for any non-zero result code other than those explicity defined above.  This is a catch-all result that\nis checked last after all other settings have been checked so you can define a code_NN value to prevent this action from\nbeing taken."}]}]},{"type":"element","tag":"h2","props":{"id":"actions"},"children":[{"type":"text","value":"Actions"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"accept"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Accept the message and skip further plugins (whitelist)."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"allow | continute"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Continue to the next plugin."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"retry | tempfail"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Reject the message with a temporary failure message (DENYSOFT)."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"reject"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Reject the message with a permanent failure message (DENY)."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"quarantine"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Continue to the next plugin.  If the message isn't rejected by another plugin - it will cause the message to be quarantined\nand the message will not be delivered to the recipient(s)."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"NOTE: this option requires the queue/quarantine plugin in your config/plugins files and it must be listed before any\nother queue plugins."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"tag"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Tag the subject with the default 'tag_string' defined in the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"main"}]},{"type":"text","value":" section above, this will also set X-Spam-Flag: YES in\nthe message headers.   Once tagged, processing will continue to the next plugin."}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"installation","depth":2,"text":"Installation"},{"id":"configuration","depth":2,"text":"Configuration"},{"id":"actions","depth":2,"text":"Actions"}]}},"_type":"markdown","_id":"content:8.plugins:messagesniffer.md","_source":"content","_file":"8.plugins/messagesniffer.md","_extension":"md"},{"_path":"/plugins/prevent_credential_leaks","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"prevent_credential_leaks - Prevent credential leaks plugin for Haraka","description":"Haraka prevent_credential_leaks plugin - Prevent credential leaks","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"prevent_credential_leaks-plugin"},"children":[{"type":"text","value":"prevent_credential_leaks plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin prevents an authenticated user (via SMTP AUTH) from sending\ntheir username and password out in a message (e.g. like replying to a\nphish)."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If their username and password are detected inside the message body, then\nthe message is rejected with the message:"}]},{"type":"element","tag":"code","props":{"code":"Credential leak detected: never give out your username/password to anyone!\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"Credential leak detected: never give out your username/password to anyone!\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Note that if the username is qualified e.g. "},{"type":"element","tag":"a","props":{"href":"mailto:user@domain.com"},"children":[{"type":"text","value":"user@domain.com"}]},{"type":"text","value":" - then the\nplugin will search for both "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"user"}]},{"type":"text","value":" and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"user@domain.com"}]},{"type":"text","value":" for maximum\neffectiveness."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"No configuration is required.  Simply add the plugin to your "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/plugins"}]},{"type":"text","value":"\nfile.  It should be added before any other plugins that run on hook_data_post\nfor maximum efficiency."}]}]},"navigation":{"title":"prevent_credential_leaks"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"prevent_credential_leaks-plugin"},"children":[{"type":"text","value":"prevent_credential_leaks plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin prevents an authenticated user (via SMTP AUTH) from sending\ntheir username and password out in a message (e.g. like replying to a\nphish)."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If their username and password are detected inside the message body, then\nthe message is rejected with the message:"}]},{"type":"element","tag":"code","props":{"code":"Credential leak detected: never give out your username/password to anyone!\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"Credential leak detected: never give out your username/password to anyone!"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Note that if the username is qualified e.g. "},{"type":"element","tag":"a","props":{"href":"mailto:user@domain.com"},"children":[{"type":"text","value":"user@domain.com"}]},{"type":"text","value":" - then the\nplugin will search for both "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"user"}]},{"type":"text","value":" and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"user@domain.com"}]},{"type":"text","value":" for maximum\neffectiveness."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"No configuration is required.  Simply add the plugin to your "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/plugins"}]},{"type":"text","value":"\nfile.  It should be added before any other plugins that run on hook_data_post\nfor maximum efficiency."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"configuration","depth":2,"text":"Configuration"}]}},"_type":"markdown","_id":"content:8.plugins:prevent_credential_leaks.md","_source":"content","_file":"8.plugins/prevent_credential_leaks.md","_extension":"md"},{"_path":"/plugins/process_title","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"process_title - Process title plugin for Haraka","description":"Haraka process_title plugin - Set the process title","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"process_title-plugin"},"children":[{"type":"text","value":"process_title plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin causes the process title seen by the UNIX 'ps' command to\nbe modified from this:"}]},{"type":"element","tag":"code","props":{"code":"node haraka.js -c /etc/haraka\n","language":"sh"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"node haraka.js -c /etc/haraka\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"to this:"}]},{"type":"element","tag":"code","props":{"code":"Haraka (master) cn=11148 cc=1082 cps=21/25.24/79 rcpts=144950/1.84 rps=518/328.18/586 msgs=78815/7.07 mps=302/178.44/329 out=0/0/0 respawn=0 \n \\_ Haraka (worker) cn=1646 cc=140 cps=5/3.73/17 rcpts=20310/1.86 rps=75/46.04/102 msgs=10938/6.65 mps=42/24.8/56 out=0/0/0 \n \\_ Haraka (worker) cn=1563 cc=168 cps=3/3.54/18 rcpts=19844/1.87 rps=78/45/96 msgs=10627/6.8 mps=49/24.1/53 out=0/0/0 \n \\_ Haraka (worker) cn=1852 cc=172 cps=3/4.2/16 rcpts=26278/2.03 rps=93/59.56/114 msgs=12938/6.99 mps=40/29.33/65 out=0/0/0 \n \\_ Haraka (worker) cn=1704 cc=187 cps=5/3.86/14 rcpts=23688/1.84 rps=93/53.7/125 msgs=12886/7.56 mps=64/29.21/66 out=0/0/0 \n \\_ Haraka (worker) cn=2296 cc=218 cps=2/5.2/20 rcpts=29300/1.78 rps=117/66.4/125 msgs=16489/7.18 mps=40/37.37/66 out=0/0/0 \n \\_ Haraka (worker) cn=2091 cc=195 cps=4/4.74/16 rcpts=25646/1.71 rps=84/58.12/117 msgs=14982/7.16 mps=52/33.95/66 out=0/0/0 \n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"Haraka (master) cn=11148 cc=1082 cps=21/25.24/79 rcpts=144950/1.84 rps=518/328.18/586 msgs=78815/7.07 mps=302/178.44/329 out=0/0/0 respawn=0 \n \\_ Haraka (worker) cn=1646 cc=140 cps=5/3.73/17 rcpts=20310/1.86 rps=75/46.04/102 msgs=10938/6.65 mps=42/24.8/56 out=0/0/0 \n \\_ Haraka (worker) cn=1563 cc=168 cps=3/3.54/18 rcpts=19844/1.87 rps=78/45/96 msgs=10627/6.8 mps=49/24.1/53 out=0/0/0 \n \\_ Haraka (worker) cn=1852 cc=172 cps=3/4.2/16 rcpts=26278/2.03 rps=93/59.56/114 msgs=12938/6.99 mps=40/29.33/65 out=0/0/0 \n \\_ Haraka (worker) cn=1704 cc=187 cps=5/3.86/14 rcpts=23688/1.84 rps=93/53.7/125 msgs=12886/7.56 mps=64/29.21/66 out=0/0/0 \n \\_ Haraka (worker) cn=2296 cc=218 cps=2/5.2/20 rcpts=29300/1.78 rps=117/66.4/125 msgs=16489/7.18 mps=40/37.37/66 out=0/0/0 \n \\_ Haraka (worker) cn=2091 cc=195 cps=4/4.74/16 rcpts=25646/1.71 rps=84/58.12/117 msgs=14982/7.16 mps=52/33.95/66 out=0/0/0 \n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"where:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"cn = Total number of connections"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"cc = Total number of concurrent connections"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"cps = Number of connections in the last second / average / maximum"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"rcpts = Total number of recipients / Average number of recipients per message"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"rps = Number of recipients in the last second / average / maximum"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"msgs = Total number of messages / Average number messages per connection"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"mps = Number of messages in the last second / average / maximum"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"out = Mails being processed / Mails waiting to be processed / Mails in temp fail state"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"respawn = Number of worker processes respawned (only under cluster)"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If 'cluster' is used then the master process will show the total\nacross all workers, with the exception of outbound stats."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"All of the counts shown are since the process started, so if a\nworker has been re-started then the counts may not add up."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Note: this plugin will only work on node >= 0.8 and should be\nadded at the top of config/plugins to ensure that it functions\ncorrectly."}]}]},"navigation":{"title":"process_title"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"process_title-plugin"},"children":[{"type":"text","value":"process_title plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin causes the process title seen by the UNIX 'ps' command to\nbe modified from this:"}]},{"type":"element","tag":"code","props":{"code":"node haraka.js -c /etc/haraka\n","language":"sh"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0a43bc"},"children":[{"type":"text","value":"node haraka.js -c /etc/haraka"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"to this:"}]},{"type":"element","tag":"code","props":{"code":"Haraka (master) cn=11148 cc=1082 cps=21/25.24/79 rcpts=144950/1.84 rps=518/328.18/586 msgs=78815/7.07 mps=302/178.44/329 out=0/0/0 respawn=0 \n \\_ Haraka (worker) cn=1646 cc=140 cps=5/3.73/17 rcpts=20310/1.86 rps=75/46.04/102 msgs=10938/6.65 mps=42/24.8/56 out=0/0/0 \n \\_ Haraka (worker) cn=1563 cc=168 cps=3/3.54/18 rcpts=19844/1.87 rps=78/45/96 msgs=10627/6.8 mps=49/24.1/53 out=0/0/0 \n \\_ Haraka (worker) cn=1852 cc=172 cps=3/4.2/16 rcpts=26278/2.03 rps=93/59.56/114 msgs=12938/6.99 mps=40/29.33/65 out=0/0/0 \n \\_ Haraka (worker) cn=1704 cc=187 cps=5/3.86/14 rcpts=23688/1.84 rps=93/53.7/125 msgs=12886/7.56 mps=64/29.21/66 out=0/0/0 \n \\_ Haraka (worker) cn=2296 cc=218 cps=2/5.2/20 rcpts=29300/1.78 rps=117/66.4/125 msgs=16489/7.18 mps=40/37.37/66 out=0/0/0 \n \\_ Haraka (worker) cn=2091 cc=195 cps=4/4.74/16 rcpts=25646/1.71 rps=84/58.12/117 msgs=14982/7.16 mps=52/33.95/66 out=0/0/0 \n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"Haraka (master) cn=11148 cc=1082 cps=21/25.24/79 rcpts=144950/1.84 rps=518/328.18/586 msgs=78815/7.07 mps=302/178.44/329 out=0/0/0 respawn=0 \n \\_ Haraka (worker) cn=1646 cc=140 cps=5/3.73/17 rcpts=20310/1.86 rps=75/46.04/102 msgs=10938/6.65 mps=42/24.8/56 out=0/0/0 \n \\_ Haraka (worker) cn=1563 cc=168 cps=3/3.54/18 rcpts=19844/1.87 rps=78/45/96 msgs=10627/6.8 mps=49/24.1/53 out=0/0/0 \n \\_ Haraka (worker) cn=1852 cc=172 cps=3/4.2/16 rcpts=26278/2.03 rps=93/59.56/114 msgs=12938/6.99 mps=40/29.33/65 out=0/0/0 \n \\_ Haraka (worker) cn=1704 cc=187 cps=5/3.86/14 rcpts=23688/1.84 rps=93/53.7/125 msgs=12886/7.56 mps=64/29.21/66 out=0/0/0 \n \\_ Haraka (worker) cn=2296 cc=218 cps=2/5.2/20 rcpts=29300/1.78 rps=117/66.4/125 msgs=16489/7.18 mps=40/37.37/66 out=0/0/0 \n \\_ Haraka (worker) cn=2091 cc=195 cps=4/4.74/16 rcpts=25646/1.71 rps=84/58.12/117 msgs=14982/7.16 mps=52/33.95/66 out=0/0/0 "}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"where:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"cn = Total number of connections"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"cc = Total number of concurrent connections"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"cps = Number of connections in the last second / average / maximum"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"rcpts = Total number of recipients / Average number of recipients per message"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"rps = Number of recipients in the last second / average / maximum"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"msgs = Total number of messages / Average number messages per connection"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"mps = Number of messages in the last second / average / maximum"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"out = Mails being processed / Mails waiting to be processed / Mails in temp fail state"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"respawn = Number of worker processes respawned (only under cluster)"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If 'cluster' is used then the master process will show the total\nacross all workers, with the exception of outbound stats."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"All of the counts shown are since the process started, so if a\nworker has been re-started then the counts may not add up."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Note: this plugin will only work on node >= 0.8 and should be\nadded at the top of config/plugins to ensure that it functions\ncorrectly."}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-0a43bc{color:#24292F}\n.dark .ct-0a43bc{color:#C9D1D9}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:8.plugins:process_title.md","_source":"content","_file":"8.plugins/process_title.md","_extension":"md"},{"_path":"/plugins/queue/deliver","_dir":"queue","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"queue/deliver - Deliver mail to the local MTA","description":"Haraka queue/deliver plugin - Deliver mail to the local MTA","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"queuedeliver-plugin"},"children":[{"type":"text","value":"queue/deliver plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin is now redundant. Outbound delivery is now built into Haraka."}]}]},"navigation":{"title":"queue/deliver"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"queuedeliver-plugin"},"children":[{"type":"text","value":"queue/deliver plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin is now redundant. Outbound delivery is now built into Haraka."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:8.plugins:queue:deliver.md","_source":"content","_file":"8.plugins/queue/deliver.md","_extension":"md"},{"_path":"/plugins/queue/discard","_dir":"queue","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"discard - Discard mail","description":"Haraka discard plugin - Discard mail","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"discard-plugin"},"children":[{"type":"text","value":"discard plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin will discard a message by pretending that the message was queued."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It is designed to be used by other plugins which request the message be\ndiscard by setting a connection or transaction note that this plugin\nchecks."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It uses the 'queue' hook, so it runs after all the plugins that hook on "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"data_post"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you use the 'quarantine' plug-in then this plugin should run "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"after"}]},{"type":"text","value":" it."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"USE THIS PLUGIN WITH CARE!"}]},{"type":"element","tag":"h1","props":{"id":"enable"},"children":[{"type":"text","value":"Enable"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Enable by adding a "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"queue/discard"}]},{"type":"text","value":" entry in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/plugins"}]},{"type":"text","value":" "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"before"}]},{"type":"text","value":" your\nother queue plugins that perform actual deliveries."}]},{"type":"element","tag":"h1","props":{"id":"usage"},"children":[{"type":"text","value":"Usage"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Set"}]},{"type":"element","tag":"code","props":{"code":"connection.notes.discard = [ 1 | true ];\n","language":"javascript"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"connection.notes.discard = [ 1 | true ];\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"or"}]},{"type":"element","tag":"code","props":{"code":"connection.transaction.notes.discard = [ 1 | true ];\n","language":"javascript"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"connection.transaction.notes.discard = [ 1 | true ];\n"}]}]}]}]},"navigation":{"title":"discard"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"discard-plugin"},"children":[{"type":"text","value":"discard plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin will discard a message by pretending that the message was queued."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It is designed to be used by other plugins which request the message be\ndiscard by setting a connection or transaction note that this plugin\nchecks."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It uses the 'queue' hook, so it runs after all the plugins that hook on "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"data_post"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you use the 'quarantine' plug-in then this plugin should run "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"after"}]},{"type":"text","value":" it."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"USE THIS PLUGIN WITH CARE!"}]},{"type":"element","tag":"h1","props":{"id":"enable"},"children":[{"type":"text","value":"Enable"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Enable by adding a "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"queue/discard"}]},{"type":"text","value":" entry in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/plugins"}]},{"type":"text","value":" "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"before"}]},{"type":"text","value":" your\nother queue plugins that perform actual deliveries."}]},{"type":"element","tag":"h1","props":{"id":"usage"},"children":[{"type":"text","value":"Usage"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Set"}]},{"type":"element","tag":"code","props":{"code":"connection.notes.discard = [ 1 | true ];\n","language":"javascript"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-66992d"},"children":[{"type":"text","value":"connection.notes.discard "}]},{"type":"element","tag":"span","props":{"class":"ct-9eea7f"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-66992d"},"children":[{"type":"text","value":" [ "}]},{"type":"element","tag":"span","props":{"class":"ct-934292"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-66992d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9eea7f"},"children":[{"type":"text","value":"|"}]},{"type":"element","tag":"span","props":{"class":"ct-66992d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-934292"},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"span","props":{"class":"ct-66992d"},"children":[{"type":"text","value":" ];"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"or"}]},{"type":"element","tag":"code","props":{"code":"connection.transaction.notes.discard = [ 1 | true ];\n","language":"javascript"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-66992d"},"children":[{"type":"text","value":"connection.transaction.notes.discard "}]},{"type":"element","tag":"span","props":{"class":"ct-9eea7f"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-66992d"},"children":[{"type":"text","value":" [ "}]},{"type":"element","tag":"span","props":{"class":"ct-934292"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-66992d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9eea7f"},"children":[{"type":"text","value":"|"}]},{"type":"element","tag":"span","props":{"class":"ct-66992d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-934292"},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"span","props":{"class":"ct-66992d"},"children":[{"type":"text","value":" ];"}]}]}]}]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-934292{color:#0550AE}\n.ct-9eea7f{color:#CF222E}\n.ct-66992d{color:#24292F}\n.dark .ct-66992d{color:#C9D1D9}\n.dark .ct-9eea7f{color:#FF7B72}\n.dark .ct-934292{color:#79C0FF}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:8.plugins:queue:discard.md","_source":"content","_file":"8.plugins/queue/discard.md","_extension":"md"},{"_path":"/plugins/queue/lmtp","_dir":"queue","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"queue/lmtp - Deliver mail to the local MTA","description":"Haraka queue/lmtp plugin - Deliver mail to the local MTA","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"queuelmtp-plugin"},"children":[{"type":"text","value":"queue/lmtp plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin delivers inbound mail via LMTP."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"LMTP is enabled by adding "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"queue/lmtp"}]},{"type":"text","value":" to config/plugins. LMTP delivery is configured in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/lmtp.ini"}]},{"type":"text","value":" . By default, all inbound messages are forwarded to the host specified in the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[main]"}]},{"type":"text","value":" section. Domain specific routes can be specified by creating additional sections with the same host/port or path options."}]},{"type":"element","tag":"h3","props":{"id":"lmtpini"},"children":[{"type":"text","value":"lmtp.ini"}]},{"type":"element","tag":"code","props":{"code":"; defaults\nhost=localhost\nport=24\n\n[example1.com]\n; Goes elsewhere\nhost=10.1.1.1\nport=2400\n\n[example2.com]\n; Using unix domain sockets\npath = /tmp/blah_com_socket\n","language":"ini"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"; defaults\nhost=localhost\nport=24\n\n[example1.com]\n; Goes elsewhere\nhost=10.1.1.1\nport=2400\n\n[example2.com]\n; Using unix domain sockets\npath = /tmp/blah_com_socket\n"}]}]}]}]},"navigation":{"title":"queue/lmtp"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"queuelmtp-plugin"},"children":[{"type":"text","value":"queue/lmtp plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin delivers inbound mail via LMTP."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"LMTP is enabled by adding "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"queue/lmtp"}]},{"type":"text","value":" to config/plugins. LMTP delivery is configured in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/lmtp.ini"}]},{"type":"text","value":" . By default, all inbound messages are forwarded to the host specified in the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[main]"}]},{"type":"text","value":" section. Domain specific routes can be specified by creating additional sections with the same host/port or path options."}]},{"type":"element","tag":"h3","props":{"id":"lmtpini"},"children":[{"type":"text","value":"lmtp.ini"}]},{"type":"element","tag":"code","props":{"code":"; defaults\nhost=localhost\nport=24\n\n[example1.com]\n; Goes elsewhere\nhost=10.1.1.1\nport=2400\n\n[example2.com]\n; Using unix domain sockets\npath = /tmp/blah_com_socket\n","language":"ini"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a19d93"},"children":[{"type":"text","value":"; defaults"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ecbea5"},"children":[{"type":"text","value":"host"}]},{"type":"element","tag":"span","props":{"class":"ct-2ba212"},"children":[{"type":"text","value":"=localhost"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ecbea5"},"children":[{"type":"text","value":"port"}]},{"type":"element","tag":"span","props":{"class":"ct-2ba212"},"children":[{"type":"text","value":"=24"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ddc814"},"children":[{"type":"text","value":"[example1.com]"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a19d93"},"children":[{"type":"text","value":"; Goes elsewhere"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ecbea5"},"children":[{"type":"text","value":"host"}]},{"type":"element","tag":"span","props":{"class":"ct-2ba212"},"children":[{"type":"text","value":"=10.1.1.1"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ecbea5"},"children":[{"type":"text","value":"port"}]},{"type":"element","tag":"span","props":{"class":"ct-2ba212"},"children":[{"type":"text","value":"=2400"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ddc814"},"children":[{"type":"text","value":"[example2.com]"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-a19d93"},"children":[{"type":"text","value":"; Using unix domain sockets"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ecbea5"},"children":[{"type":"text","value":"path"}]},{"type":"element","tag":"span","props":{"class":"ct-2ba212"},"children":[{"type":"text","value":" = /tmp/blah_com_socket"}]}]}]}]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-ddc814{color:#953800}\n.ct-2ba212{color:#24292F}\n.ct-ecbea5{color:#CF222E}\n.ct-a19d93{color:#6E7781}\n.dark .ct-a19d93{color:#8B949E}\n.dark .ct-ecbea5{color:#FF7B72}\n.dark .ct-2ba212{color:#C9D1D9}\n.dark .ct-ddc814{color:#FFA657}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"configuration","depth":2,"text":"Configuration","children":[{"id":"lmtpini","depth":3,"text":"lmtp.ini"}]}]}},"_type":"markdown","_id":"content:8.plugins:queue:lmtp.md","_source":"content","_file":"8.plugins/queue/lmtp.md","_extension":"md"},{"_path":"/plugins/queue/qmail-queue","_dir":"queue","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"queue/qmail-queue - Deliver mail to the local MTA","description":"Haraka queue/qmail-queue plugin - Deliver mail to the local MTA","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"queueqmail-queue-plugin"},"children":[{"type":"text","value":"queue/qmail-queue plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin delivers the mail to the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"qmail-queue"}]},{"type":"text","value":" program, which can be used\nfor both inbound and outbound delivery."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"qmail-queue.path"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The path to the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"qmail-queue"}]},{"type":"text","value":" binary. Default: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/var/qmail/bin/qmail-queue"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"qmail-queue.ini"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"enable_outbound=true"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Deliver outbound email to qmail. Set to false to use Haraka's\nseparate Outbound mail routing (MX based delivery))."}]}]}]}]}]},"navigation":{"title":"queue/qmail-queue"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"queueqmail-queue-plugin"},"children":[{"type":"text","value":"queue/qmail-queue plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin delivers the mail to the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"qmail-queue"}]},{"type":"text","value":" program, which can be used\nfor both inbound and outbound delivery."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"qmail-queue.path"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The path to the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"qmail-queue"}]},{"type":"text","value":" binary. Default: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/var/qmail/bin/qmail-queue"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"qmail-queue.ini"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"enable_outbound=true"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Deliver outbound email to qmail. Set to false to use Haraka's\nseparate Outbound mail routing (MX based delivery))."}]}]}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"configuration","depth":2,"text":"Configuration"}]}},"_type":"markdown","_id":"content:8.plugins:queue:qmail-queue.md","_source":"content","_file":"8.plugins/queue/qmail-queue.md","_extension":"md"},{"_path":"/plugins/queue/quarantine","_dir":"queue","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"quarantine - Quarantine mail","description":"Haraka quarantine plugin - Quarantine mail","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"quarantine-plugin"},"children":[{"type":"text","value":"quarantine plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin will save a message (in message/rfc822 format) to a specified\ndirectory, which will be created automatically if it does not already exist,\na dated sub-folder is also added to the end of the path specified in YYYYMMDD\nformat."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It is designed to be used by other plugins which request the message be\nquarantined by setting a connection or transaction note that this plugin\nchecks."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"NOTE: this plugin simply saves a copy of the message.  It does not reject or\ndiscard the message and relies on another plugin to perform this function."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It uses the 'queue' hook, so that it runs after all the 'data_post' plugins\nand should be listed in 'config/plugins' to run before your queue hooks that\nperform actual deliveries."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To ensure that only completely written files are present in the quarantine,\nthe files are written to a temporary directory first and then hardlinked to\nthe final destination before the temporary file is deleted."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The temporary directory is 'quarantine_path/tmp' which defaults to:\n/var/spool/haraka/quarantine/tmp."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Upon start-up, any files present in the temporary directory are deleted\nsyncronously prior to any messages being accepted."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin looks for 'quarantine.ini' in the config directory."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"quarantine_path                   (default: /var/spool/haraka/quarantine)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The default base path to save the quarantine files to.  It will be created\nif it does not already exist."}]}]},{"type":"element","tag":"h2","props":{"id":"usage"},"children":[{"type":"text","value":"Usage"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you wish to keep a copy of the message in your plugin, simply either:"}]},{"type":"element","tag":"code","props":{"code":"connection.notes.quarantine = [ 1 | true | 'sub/directory/path' ];\n","language":"javascript"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"connection.notes.quarantine = [ 1 | true | 'sub/directory/path' ];\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"or"}]},{"type":"element","tag":"code","props":{"code":"connection.transaction.notes.quarantine = [ 1 | true | 'sub/directory/path' ];\n","language":"javascript"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"connection.transaction.notes.quarantine = [ 1 | true | 'sub/directory/path' ];\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"e.g."}]},{"type":"element","tag":"code","props":{"code":"connection.notes.quarantine = 1;\n","language":"javascript"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"connection.notes.quarantine = 1;\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"would save the message to '/var/spool/quarantine/haraka/YYYYMMDD/UUID' where\nYYYMMDD and UUID are expanded to current date and transaction UUID."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"and"}]},{"type":"element","tag":"code","props":{"code":"connection.notes.quarantine = 'corpus';\n","language":"javascript"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"connection.notes.quarantine = 'corpus';\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"would save the message to '/var/spool/quarantine/haraka/corpus/YYYYMMDD/UUID'."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Note: you can specify 'corpus/foo' or 'corpus/foo/bar' and the directories will\nbe automatically created.  Do not add any leading or trailing slashes."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"By default - after the message is quarantined, the plugin will tell Haraka to\ncontinue to the next plugin.  You can specify a different action like DENY or\nOK and supply an optional message using the following notes:"}]},{"type":"element","tag":"code","props":{"code":"connection.notes.quarantine_action = [ OK, 'Message quarantined' ];\nconnection.transaction.notes.quarantine_action = [ DENY, 'Message rejected' ];\n","language":"javascript"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"connection.notes.quarantine_action = [ OK, 'Message quarantined' ];\nconnection.transaction.notes.quarantine_action = [ DENY, 'Message rejected' ];\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you don't want to supply a specific message back to the client you can\nalso just specify a return code:"}]},{"type":"element","tag":"code","props":{"code":"connection.notes.quarantine_action = OK;\nconnection.transaction.notes.quarantine_action = DENY;\n","language":"javascript"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"connection.notes.quarantine_action = OK;\nconnection.transaction.notes.quarantine_action = DENY;\n"}]}]}]}]},"navigation":{"title":"quarantine"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"quarantine-plugin"},"children":[{"type":"text","value":"quarantine plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin will save a message (in message/rfc822 format) to a specified\ndirectory, which will be created automatically if it does not already exist,\na dated sub-folder is also added to the end of the path specified in YYYYMMDD\nformat."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It is designed to be used by other plugins which request the message be\nquarantined by setting a connection or transaction note that this plugin\nchecks."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"NOTE: this plugin simply saves a copy of the message.  It does not reject or\ndiscard the message and relies on another plugin to perform this function."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It uses the 'queue' hook, so that it runs after all the 'data_post' plugins\nand should be listed in 'config/plugins' to run before your queue hooks that\nperform actual deliveries."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To ensure that only completely written files are present in the quarantine,\nthe files are written to a temporary directory first and then hardlinked to\nthe final destination before the temporary file is deleted."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The temporary directory is 'quarantine_path/tmp' which defaults to:\n/var/spool/haraka/quarantine/tmp."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Upon start-up, any files present in the temporary directory are deleted\nsyncronously prior to any messages being accepted."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin looks for 'quarantine.ini' in the config directory."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"quarantine_path                   (default: /var/spool/haraka/quarantine)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The default base path to save the quarantine files to.  It will be created\nif it does not already exist."}]}]},{"type":"element","tag":"h2","props":{"id":"usage"},"children":[{"type":"text","value":"Usage"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you wish to keep a copy of the message in your plugin, simply either:"}]},{"type":"element","tag":"code","props":{"code":"connection.notes.quarantine = [ 1 | true | 'sub/directory/path' ];\n","language":"javascript"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-355fc3"},"children":[{"type":"text","value":"connection.notes.quarantine "}]},{"type":"element","tag":"span","props":{"class":"ct-dcfe98"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-355fc3"},"children":[{"type":"text","value":" [ "}]},{"type":"element","tag":"span","props":{"class":"ct-390cfb"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-355fc3"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dcfe98"},"children":[{"type":"text","value":"|"}]},{"type":"element","tag":"span","props":{"class":"ct-355fc3"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-390cfb"},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"span","props":{"class":"ct-355fc3"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dcfe98"},"children":[{"type":"text","value":"|"}]},{"type":"element","tag":"span","props":{"class":"ct-355fc3"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-82276e"},"children":[{"type":"text","value":"'sub/directory/path'"}]},{"type":"element","tag":"span","props":{"class":"ct-355fc3"},"children":[{"type":"text","value":" ];"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"or"}]},{"type":"element","tag":"code","props":{"code":"connection.transaction.notes.quarantine = [ 1 | true | 'sub/directory/path' ];\n","language":"javascript"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-355fc3"},"children":[{"type":"text","value":"connection.transaction.notes.quarantine "}]},{"type":"element","tag":"span","props":{"class":"ct-dcfe98"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-355fc3"},"children":[{"type":"text","value":" [ "}]},{"type":"element","tag":"span","props":{"class":"ct-390cfb"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-355fc3"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dcfe98"},"children":[{"type":"text","value":"|"}]},{"type":"element","tag":"span","props":{"class":"ct-355fc3"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-390cfb"},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"span","props":{"class":"ct-355fc3"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dcfe98"},"children":[{"type":"text","value":"|"}]},{"type":"element","tag":"span","props":{"class":"ct-355fc3"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-82276e"},"children":[{"type":"text","value":"'sub/directory/path'"}]},{"type":"element","tag":"span","props":{"class":"ct-355fc3"},"children":[{"type":"text","value":" ];"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"e.g."}]},{"type":"element","tag":"code","props":{"code":"connection.notes.quarantine = 1;\n","language":"javascript"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-355fc3"},"children":[{"type":"text","value":"connection.notes.quarantine "}]},{"type":"element","tag":"span","props":{"class":"ct-dcfe98"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-355fc3"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-390cfb"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-355fc3"},"children":[{"type":"text","value":";"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"would save the message to '/var/spool/quarantine/haraka/YYYYMMDD/UUID' where\nYYYMMDD and UUID are expanded to current date and transaction UUID."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"and"}]},{"type":"element","tag":"code","props":{"code":"connection.notes.quarantine = 'corpus';\n","language":"javascript"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-355fc3"},"children":[{"type":"text","value":"connection.notes.quarantine "}]},{"type":"element","tag":"span","props":{"class":"ct-dcfe98"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-355fc3"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-82276e"},"children":[{"type":"text","value":"'corpus'"}]},{"type":"element","tag":"span","props":{"class":"ct-355fc3"},"children":[{"type":"text","value":";"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"would save the message to '/var/spool/quarantine/haraka/corpus/YYYYMMDD/UUID'."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Note: you can specify 'corpus/foo' or 'corpus/foo/bar' and the directories will\nbe automatically created.  Do not add any leading or trailing slashes."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"By default - after the message is quarantined, the plugin will tell Haraka to\ncontinue to the next plugin.  You can specify a different action like DENY or\nOK and supply an optional message using the following notes:"}]},{"type":"element","tag":"code","props":{"code":"connection.notes.quarantine_action = [ OK, 'Message quarantined' ];\nconnection.transaction.notes.quarantine_action = [ DENY, 'Message rejected' ];\n","language":"javascript"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-355fc3"},"children":[{"type":"text","value":"connection.notes.quarantine_action "}]},{"type":"element","tag":"span","props":{"class":"ct-dcfe98"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-355fc3"},"children":[{"type":"text","value":" [ "}]},{"type":"element","tag":"span","props":{"class":"ct-390cfb"},"children":[{"type":"text","value":"OK"}]},{"type":"element","tag":"span","props":{"class":"ct-355fc3"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-82276e"},"children":[{"type":"text","value":"'Message quarantined'"}]},{"type":"element","tag":"span","props":{"class":"ct-355fc3"},"children":[{"type":"text","value":" ];"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-355fc3"},"children":[{"type":"text","value":"connection.transaction.notes.quarantine_action "}]},{"type":"element","tag":"span","props":{"class":"ct-dcfe98"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-355fc3"},"children":[{"type":"text","value":" [ "}]},{"type":"element","tag":"span","props":{"class":"ct-390cfb"},"children":[{"type":"text","value":"DENY"}]},{"type":"element","tag":"span","props":{"class":"ct-355fc3"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-82276e"},"children":[{"type":"text","value":"'Message rejected'"}]},{"type":"element","tag":"span","props":{"class":"ct-355fc3"},"children":[{"type":"text","value":" ];"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you don't want to supply a specific message back to the client you can\nalso just specify a return code:"}]},{"type":"element","tag":"code","props":{"code":"connection.notes.quarantine_action = OK;\nconnection.transaction.notes.quarantine_action = DENY;\n","language":"javascript"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-355fc3"},"children":[{"type":"text","value":"connection.notes.quarantine_action "}]},{"type":"element","tag":"span","props":{"class":"ct-dcfe98"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-355fc3"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-390cfb"},"children":[{"type":"text","value":"OK"}]},{"type":"element","tag":"span","props":{"class":"ct-355fc3"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-355fc3"},"children":[{"type":"text","value":"connection.transaction.notes.quarantine_action "}]},{"type":"element","tag":"span","props":{"class":"ct-dcfe98"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-355fc3"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-390cfb"},"children":[{"type":"text","value":"DENY"}]},{"type":"element","tag":"span","props":{"class":"ct-355fc3"},"children":[{"type":"text","value":";"}]}]}]}]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-82276e{color:#0A3069}\n.ct-390cfb{color:#0550AE}\n.ct-dcfe98{color:#CF222E}\n.ct-355fc3{color:#24292F}\n.dark .ct-355fc3{color:#C9D1D9}\n.dark .ct-dcfe98{color:#FF7B72}\n.dark .ct-390cfb{color:#79C0FF}\n.dark .ct-82276e{color:#A5D6FF}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"configuration","depth":2,"text":"Configuration"},{"id":"usage","depth":2,"text":"Usage"}]}},"_type":"markdown","_id":"content:8.plugins:queue:quarantine.md","_source":"content","_file":"8.plugins/queue/quarantine.md","_extension":"md"},{"_path":"/plugins/queue/rabbitmq_amqplib","_dir":"queue","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"queue/rabbitmq_amqplib","description":"This plugin delivers emails to RabbitMQ queue for further processing. Based on queue/rabbitmq but using amqplib.","excerpt":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin delivers emails to RabbitMQ queue for further processing. Based on "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"queue/rabbitmq"}]},{"type":"text","value":" but using "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"amqplib"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h2","props":{"id":"dependency"},"children":[{"type":"text","value":"Dependency"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"amqplib"}]},{"type":"text","value":" - "},{"type":"element","tag":"a","props":{"href":"https://github.com/squaremo/amqp.node","rel":["nofollow"]},"children":[{"type":"text","value":"https://github.com/squaremo/amqp.node"}]}]}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/rabbitmq.ini"}]},{"type":"text","value":" - Connection, exchange and queue settings"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Example:"}]}]},{"type":"element","tag":"code","props":{"code":"[rabbitmq]\n; Connection\n; Protocol. Either \"amqp\" or \"amqps\"\nprotocol = amqp\nhost = localhost\nport = 5672\n;Virtual Host. Start with \"/\". Leave blank or not use if you don't want to use virtual hosts.\nvhost = /haraka\n;Credentials\nuser = guest\npassword = guest\n; Exchange\nexchangeName  = email_messages\nexchangeType = direct\n; Queue\nqueueName = emails\ndeliveryMode = 2\nconfirm = true\ndurable = true\nautoDelete = false\n","language":"ini"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"[rabbitmq]\n; Connection\n; Protocol. Either \"amqp\" or \"amqps\"\nprotocol = amqp\nhost = localhost\nport = 5672\n;Virtual Host. Start with \"/\". Leave blank or not use if you don't want to use virtual hosts.\nvhost = /haraka\n;Credentials\nuser = guest\npassword = guest\n; Exchange\nexchangeName  = email_messages\nexchangeType = direct\n; Queue\nqueueName = emails\ndeliveryMode = 2\nconfirm = true\ndurable = true\nautoDelete = false\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"More information about RabbitMQ can be found at "},{"type":"element","tag":"a","props":{"href":"https://www.rabbitmq.com/","rel":["nofollow"]},"children":[{"type":"text","value":"https://www.rabbitmq.com/"}]}]}]},"position":31,"category":"Plugins","body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin delivers emails to RabbitMQ queue for further processing. Based on "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"queue/rabbitmq"}]},{"type":"text","value":" but using "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"amqplib"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h2","props":{"id":"dependency"},"children":[{"type":"text","value":"Dependency"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"amqplib"}]},{"type":"text","value":" - "},{"type":"element","tag":"a","props":{"href":"https://github.com/squaremo/amqp.node","rel":["nofollow"]},"children":[{"type":"text","value":"https://github.com/squaremo/amqp.node"}]}]}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/rabbitmq.ini"}]},{"type":"text","value":" - Connection, exchange and queue settings"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Example:"}]}]},{"type":"element","tag":"code","props":{"code":"[rabbitmq]\n; Connection\n; Protocol. Either \"amqp\" or \"amqps\"\nprotocol = amqp\nhost = localhost\nport = 5672\n;Virtual Host. Start with \"/\". Leave blank or not use if you don't want to use virtual hosts.\nvhost = /haraka\n;Credentials\nuser = guest\npassword = guest\n; Exchange\nexchangeName  = email_messages\nexchangeType = direct\n; Queue\nqueueName = emails\ndeliveryMode = 2\nconfirm = true\ndurable = true\nautoDelete = false\n","language":"ini"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-bbb42c"},"children":[{"type":"text","value":"[rabbitmq]"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-285aad"},"children":[{"type":"text","value":"; Connection"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-285aad"},"children":[{"type":"text","value":"; Protocol. Either \"amqp\" or \"amqps\""}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-07d281"},"children":[{"type":"text","value":"protocol"}]},{"type":"element","tag":"span","props":{"class":"ct-0bead2"},"children":[{"type":"text","value":" = amqp"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-07d281"},"children":[{"type":"text","value":"host"}]},{"type":"element","tag":"span","props":{"class":"ct-0bead2"},"children":[{"type":"text","value":" = localhost"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-07d281"},"children":[{"type":"text","value":"port"}]},{"type":"element","tag":"span","props":{"class":"ct-0bead2"},"children":[{"type":"text","value":" = 5672"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-285aad"},"children":[{"type":"text","value":";Virtual Host. Start with \"/\". Leave blank or not use if you don't want to use virtual hosts."}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-07d281"},"children":[{"type":"text","value":"vhost"}]},{"type":"element","tag":"span","props":{"class":"ct-0bead2"},"children":[{"type":"text","value":" = /haraka"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-285aad"},"children":[{"type":"text","value":";Credentials"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-07d281"},"children":[{"type":"text","value":"user"}]},{"type":"element","tag":"span","props":{"class":"ct-0bead2"},"children":[{"type":"text","value":" = guest"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-07d281"},"children":[{"type":"text","value":"password"}]},{"type":"element","tag":"span","props":{"class":"ct-0bead2"},"children":[{"type":"text","value":" = guest"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-285aad"},"children":[{"type":"text","value":"; Exchange"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-07d281"},"children":[{"type":"text","value":"exchangeName"}]},{"type":"element","tag":"span","props":{"class":"ct-0bead2"},"children":[{"type":"text","value":"  = email_messages"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-07d281"},"children":[{"type":"text","value":"exchangeType"}]},{"type":"element","tag":"span","props":{"class":"ct-0bead2"},"children":[{"type":"text","value":" = direct"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-285aad"},"children":[{"type":"text","value":"; Queue"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-07d281"},"children":[{"type":"text","value":"queueName"}]},{"type":"element","tag":"span","props":{"class":"ct-0bead2"},"children":[{"type":"text","value":" = emails"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-07d281"},"children":[{"type":"text","value":"deliveryMode"}]},{"type":"element","tag":"span","props":{"class":"ct-0bead2"},"children":[{"type":"text","value":" = 2"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-07d281"},"children":[{"type":"text","value":"confirm"}]},{"type":"element","tag":"span","props":{"class":"ct-0bead2"},"children":[{"type":"text","value":" = true"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-07d281"},"children":[{"type":"text","value":"durable"}]},{"type":"element","tag":"span","props":{"class":"ct-0bead2"},"children":[{"type":"text","value":" = true"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-07d281"},"children":[{"type":"text","value":"autoDelete"}]},{"type":"element","tag":"span","props":{"class":"ct-0bead2"},"children":[{"type":"text","value":" = false"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"More information about RabbitMQ can be found at "},{"type":"element","tag":"a","props":{"href":"https://www.rabbitmq.com/","rel":["nofollow"]},"children":[{"type":"text","value":"https://www.rabbitmq.com/"}]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-0bead2{color:#24292F}\n.ct-07d281{color:#CF222E}\n.ct-285aad{color:#6E7781}\n.ct-bbb42c{color:#953800}\n.dark .ct-bbb42c{color:#FFA657}\n.dark .ct-285aad{color:#8B949E}\n.dark .ct-07d281{color:#FF7B72}\n.dark .ct-0bead2{color:#C9D1D9}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"dependency","depth":2,"text":"Dependency"},{"id":"configuration","depth":2,"text":"Configuration"}]}},"_type":"markdown","_id":"content:8.plugins:queue:rabbitmq_amqplib.md","_source":"content","_file":"8.plugins/queue/rabbitmq_amqplib.md","_extension":"md"},{"_path":"/plugins/queue/rabbitmq","_dir":"queue","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"queue/rabbitmq - Deliver mail to the local MTA","description":"Haraka queue/rabbitmq plugin - Deliver mail to the local MTA","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"queuerabbitmq-plugin"},"children":[{"type":"text","value":"queue/rabbitmq plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin delivers mails to rabbitmq queue for further processing."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/rabbitmq.ini"}]},{"type":"text","value":"\nThis config file provides server address and port of rabbitmq server to deliver with other configs of queues and exchange."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Example:"},{"type":"element","tag":"code","props":{"code":"[rabbitmq]\n; This is name of exchange.\nexchangeName  = emailMessages\n; ip and port of the server.\nserver_ip = localhost\nserver_port = 5672\n; user and password\nuser = guest\npassword = guest\n; name of the queue which reader will read\nqueueName = email\n; This is for making it persistant while publishing message\ndeliveryMode = 2\n; If true it will require ack for marking it complete from worker\nconfirm = true\n; Again for persistance passed while creating queue\ndurable = true\n; if true will delete queue if publisher quits\nautoDelete = false\n; type of the exchange\nexchangeType = direct\n","language":"ini"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"[rabbitmq]\n; This is name of exchange.\nexchangeName  = emailMessages\n; ip and port of the server.\nserver_ip = localhost\nserver_port = 5672\n; user and password\nuser = guest\npassword = guest\n; name of the queue which reader will read\nqueueName = email\n; This is for making it persistant while publishing message\ndeliveryMode = 2\n; If true it will require ack for marking it complete from worker\nconfirm = true\n; Again for persistance passed while creating queue\ndurable = true\n; if true will delete queue if publisher quits\nautoDelete = false\n; type of the exchange\nexchangeType = direct\n"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"More information about rabbitmq can be found at "},{"type":"element","tag":"a","props":{"href":"https://www.rabbitmq.com/","rel":["nofollow"]},"children":[{"type":"text","value":"https://www.rabbitmq.com/"}]}]}]},"navigation":{"title":"queue/rabbitmq"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"queuerabbitmq-plugin"},"children":[{"type":"text","value":"queue/rabbitmq plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin delivers mails to rabbitmq queue for further processing."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/rabbitmq.ini"}]},{"type":"text","value":"\nThis config file provides server address and port of rabbitmq server to deliver with other configs of queues and exchange."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Example:"},{"type":"element","tag":"code","props":{"code":"[rabbitmq]\n; This is name of exchange.\nexchangeName  = emailMessages\n; ip and port of the server.\nserver_ip = localhost\nserver_port = 5672\n; user and password\nuser = guest\npassword = guest\n; name of the queue which reader will read\nqueueName = email\n; This is for making it persistant while publishing message\ndeliveryMode = 2\n; If true it will require ack for marking it complete from worker\nconfirm = true\n; Again for persistance passed while creating queue\ndurable = true\n; if true will delete queue if publisher quits\nautoDelete = false\n; type of the exchange\nexchangeType = direct\n","language":"ini"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e51238"},"children":[{"type":"text","value":"[rabbitmq]"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ca4919"},"children":[{"type":"text","value":"; This is name of exchange."}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-c0e587"},"children":[{"type":"text","value":"exchangeName"}]},{"type":"element","tag":"span","props":{"class":"ct-6e96de"},"children":[{"type":"text","value":"  = emailMessages"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ca4919"},"children":[{"type":"text","value":"; ip and port of the server."}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-c0e587"},"children":[{"type":"text","value":"server_ip"}]},{"type":"element","tag":"span","props":{"class":"ct-6e96de"},"children":[{"type":"text","value":" = localhost"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-c0e587"},"children":[{"type":"text","value":"server_port"}]},{"type":"element","tag":"span","props":{"class":"ct-6e96de"},"children":[{"type":"text","value":" = 5672"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ca4919"},"children":[{"type":"text","value":"; user and password"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-c0e587"},"children":[{"type":"text","value":"user"}]},{"type":"element","tag":"span","props":{"class":"ct-6e96de"},"children":[{"type":"text","value":" = guest"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-c0e587"},"children":[{"type":"text","value":"password"}]},{"type":"element","tag":"span","props":{"class":"ct-6e96de"},"children":[{"type":"text","value":" = guest"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ca4919"},"children":[{"type":"text","value":"; name of the queue which reader will read"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-c0e587"},"children":[{"type":"text","value":"queueName"}]},{"type":"element","tag":"span","props":{"class":"ct-6e96de"},"children":[{"type":"text","value":" = email"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ca4919"},"children":[{"type":"text","value":"; This is for making it persistant while publishing message"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-c0e587"},"children":[{"type":"text","value":"deliveryMode"}]},{"type":"element","tag":"span","props":{"class":"ct-6e96de"},"children":[{"type":"text","value":" = 2"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ca4919"},"children":[{"type":"text","value":"; If true it will require ack for marking it complete from worker"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-c0e587"},"children":[{"type":"text","value":"confirm"}]},{"type":"element","tag":"span","props":{"class":"ct-6e96de"},"children":[{"type":"text","value":" = true"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ca4919"},"children":[{"type":"text","value":"; Again for persistance passed while creating queue"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-c0e587"},"children":[{"type":"text","value":"durable"}]},{"type":"element","tag":"span","props":{"class":"ct-6e96de"},"children":[{"type":"text","value":" = true"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ca4919"},"children":[{"type":"text","value":"; if true will delete queue if publisher quits"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-c0e587"},"children":[{"type":"text","value":"autoDelete"}]},{"type":"element","tag":"span","props":{"class":"ct-6e96de"},"children":[{"type":"text","value":" = false"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ca4919"},"children":[{"type":"text","value":"; type of the exchange"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-c0e587"},"children":[{"type":"text","value":"exchangeType"}]},{"type":"element","tag":"span","props":{"class":"ct-6e96de"},"children":[{"type":"text","value":" = direct"}]}]}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"More information about rabbitmq can be found at "},{"type":"element","tag":"a","props":{"href":"https://www.rabbitmq.com/","rel":["nofollow"]},"children":[{"type":"text","value":"https://www.rabbitmq.com/"}]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-6e96de{color:#24292F}\n.ct-c0e587{color:#CF222E}\n.ct-ca4919{color:#6E7781}\n.ct-e51238{color:#953800}\n.dark .ct-e51238{color:#FFA657}\n.dark .ct-ca4919{color:#8B949E}\n.dark .ct-c0e587{color:#FF7B72}\n.dark .ct-6e96de{color:#C9D1D9}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"configuration","depth":2,"text":"Configuration"}]}},"_type":"markdown","_id":"content:8.plugins:queue:rabbitmq.md","_source":"content","_file":"8.plugins/queue/rabbitmq.md","_extension":"md"},{"_path":"/plugins/queue/smtp_bridge","_dir":"queue","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"queue/smtp_bridge - Deliver mail to the local MTA","description":"Haraka queue/smtp_bridge plugin - Deliver mail to the local MTA","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"queuesmtp_bridge-plugin"},"children":[{"type":"text","value":"queue/smtp_bridge plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin delivers to another SMTP server, bridging the authentication\ndetails and post data from the initial connection."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin is meant to be used with the plugin "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"auth/auth_bridge"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It is different than "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"queue/smtp_proxy"}]},{"type":"text","value":" or "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"queue/smpt_forward"}]},{"type":"text","value":" because\nit doesn't use the AUTH details from a configuration file. This plugins\nsimply post the data from the original connection to the remote SMTP server\nusing the original AUTH details."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Configuration is stored in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/smtp_bridge.ini"}]},{"type":"text","value":" and uses the INI\nstyle formatting."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The configuration of this plugin is simple:"}]},{"type":"element","tag":"code","props":{"code":"host=localhost\n#port=\n#auth_type=\n#priority=10\n","language":"ini"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"host=localhost\n#port=\n#auth_type=\n#priority=10\n"}]}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"host: the host where you will be authenticating and posting,\nfor example "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"smtp.host.tld"}]},{"type":"text","value":". This is the only setting required."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If needed you can also set"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"port: default to empty and Haraka will use 25."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"auth_type: default to empty and Haraka will try to pick an appropriate method."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"priority: default to 10."}]}]}]},"navigation":{"title":"queue/smtp_bridge"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"queuesmtp_bridge-plugin"},"children":[{"type":"text","value":"queue/smtp_bridge plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin delivers to another SMTP server, bridging the authentication\ndetails and post data from the initial connection."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin is meant to be used with the plugin "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"auth/auth_bridge"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It is different than "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"queue/smtp_proxy"}]},{"type":"text","value":" or "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"queue/smpt_forward"}]},{"type":"text","value":" because\nit doesn't use the AUTH details from a configuration file. This plugins\nsimply post the data from the original connection to the remote SMTP server\nusing the original AUTH details."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Configuration is stored in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/smtp_bridge.ini"}]},{"type":"text","value":" and uses the INI\nstyle formatting."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The configuration of this plugin is simple:"}]},{"type":"element","tag":"code","props":{"code":"host=localhost\n#port=\n#auth_type=\n#priority=10\n","language":"ini"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-77c3f0"},"children":[{"type":"text","value":"host"}]},{"type":"element","tag":"span","props":{"class":"ct-8ae883"},"children":[{"type":"text","value":"=localhost"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d56d8c"},"children":[{"type":"text","value":"#port="}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d56d8c"},"children":[{"type":"text","value":"#auth_type="}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d56d8c"},"children":[{"type":"text","value":"#priority=10"}]}]}]}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"host: the host where you will be authenticating and posting,\nfor example "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"smtp.host.tld"}]},{"type":"text","value":". This is the only setting required."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If needed you can also set"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"port: default to empty and Haraka will use 25."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"auth_type: default to empty and Haraka will try to pick an appropriate method."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"priority: default to 10."}]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-d56d8c{color:#6E7781}\n.ct-8ae883{color:#24292F}\n.ct-77c3f0{color:#CF222E}\n.dark .ct-77c3f0{color:#FF7B72}\n.dark .ct-8ae883{color:#C9D1D9}\n.dark .ct-d56d8c{color:#8B949E}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"configuration","depth":2,"text":"Configuration"}]}},"_type":"markdown","_id":"content:8.plugins:queue:smtp_bridge.md","_source":"content","_file":"8.plugins/queue/smtp_bridge.md","_extension":"md"},{"_path":"/plugins/queue/smtp_forward","_dir":"queue","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"queue/smtp_forward - Forward mail to another SMTP server","description":"Haraka queue/smtp_forward plugin - Forward mail to another SMTP server","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"queuesmtp_forward-plugin"},"children":[{"type":"text","value":"queue/smtp_forward plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin delivers to another mail server. This is a common setup when you\nwant to have a mail server with a solid pedigree of outbound delivery to\nother hosts, and inbound delivery to users."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In comparison to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"queue/smtp_proxy"}]},{"type":"text","value":", this plugin waits until queue time to\nattempt the ongoing connection. This can be a benefit in reducing connections\nto your inbound mail server when you have content filtering (such as\nspamassassin) enabled. A possible downside is that it also delays recipient\nvalidation that the ongoing mail server may provide until queue time."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"smtp_forward.ini"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Configuration is stored in this file in the following keys:"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"enable_outbound="},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"SMTP forward outbound messages (set to false to enable Haraka's separate\nOutbound mail routing (MX based delivery))."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"host=HOST"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The host to connect to."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"port=PORT"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The port to connect to. Default: 25"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connect_timeout=SECONDS"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The maximum amount of time to wait when creating a new connection\nto the host.  Default: 30 seconds."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"timeout=SECONDS"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The amount of seconds to let a backend connection live idle in the\nconnection pool.  This should always be less than the global plugin\ntimeout, which should in turn be less than the connection timeout."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"max_connections=NUMBER"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Maximum number of connections at any given time. Default: 1000"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"enable_tls="},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Enable TLS with the forward host (if supported). TLS uses options\nfrom the tls plugin. If key and cert are provided in the the outbound section of the tls plugin,\nthat certificate will be used as a TLS Client Certificate."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"This option controls the use of TLS via "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"STARTTLS"}]},{"type":"text","value":". This plugin does not work with\nSMTP over TLS."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"auth_type="},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"plain|login"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Enable PLAIN or LOGIN SMTP AUTH.  This is required to enable AUTH."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"auth_user=USERNAME"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"SMTP AUTH username to use."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"auth_pass=PASSWORD"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"SMTP AUTH password to use."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"queue"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Which queue plugin to use. Default: undefined. The default bahavior is to\nuse smtp_forward for inbound connections and outbound for relaying\nconnections. This option is used for complex mail routes."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"check_sender=false"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Requires that sender domains defined in smtp_forward.ini (see Per-Domain below) have relaying privileges. This is a form of spoof prevention and assumes that any mail clients have relaying or AUTH privileges. This is usually the case."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"check_recipient=false"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"By default, Haraka accepts no emails until a recipient plugin has been configured to accept mails for a domain. The simplest common case is the in_host_list plugin with a list of domains in config/host_list. An alternative is to set "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"check_recipient=true"}]},{"type":"text","value":" and list each domain in a definition block in smtp_forward.ini (see Per-Domain Configuration). An example for two domains:"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"example.com"}]},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"example.net"}]}]}]}]}]},{"type":"element","tag":"h1","props":{"id":"per-domain-configuration"},"children":[{"type":"text","value":"Per-Domain Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"More specific forward routes for domains can be defined. The domain is\nchosen based on the value of the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"domain_selector"}]},{"type":"text","value":" config variable."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"domain_selector"}]},{"type":"text","value":" is set to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"rcpt_to"}]},{"type":"text","value":" (the default), more specific\nroutes are only honored for SMTP connections with a single recipient or SMTP\nconnections where every recipient host is identical."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"domain_selector"}]},{"type":"text","value":" is set to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"mail_from"}]},{"type":"text","value":", the domain of the MAIL FROM\naddress is used."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"enable_outbound can be set or unset on a per-domain level to enable or disable\nforwarding for specific domains."}]},{"type":"element","tag":"code","props":{"code":"# default SMTP host\nhost=1.2.3.4\n# auth_type=plain\n# auth_user=user\n# auth_user=pass\n\n[example1.com]\nhost=1.2.3.5\n# auth_type=plain\n# auth_user=user\n# auth_pass=pass\n\n[example2.com]\nhost=1.2.3.5\n\n[example3.com]\nhost=1.2.3.6\n\n[example4.com]\nenable\\_outbound=false\n","language":"ini"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"# default SMTP host\nhost=1.2.3.4\n# auth_type=plain\n# auth_user=user\n# auth_user=pass\n\n[example1.com]\nhost=1.2.3.5\n# auth_type=plain\n# auth_user=user\n# auth_pass=pass\n\n[example2.com]\nhost=1.2.3.5\n\n[example3.com]\nhost=1.2.3.6\n\n[example4.com]\nenable\\_outbound=false\n"}]}]}]},{"type":"element","tag":"h1","props":{"id":"split-host-forward-routing"},"children":[{"type":"text","value":"Split host forward routing"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When an incoming email transaction has multiple recipients with different forward routes,  recipients to subsequent forward routes are deferred. Example: an incoming email transaction has recipients "},{"type":"element","tag":"a","props":{"href":"mailto:user@example1.com"},"children":[{"type":"text","value":"user@example1.com"}]},{"type":"text","value":", "},{"type":"element","tag":"a","props":{"href":"mailto:user@example2.com"},"children":[{"type":"text","value":"user@example2.com"}]},{"type":"text","value":", and "},{"type":"element","tag":"a","props":{"href":"mailto:user@example3.com"},"children":[{"type":"text","value":"user@example3.com"}]},{"type":"text","value":". The first two recipients will be accepted (they share the same forward destination) and the latter will be deferred. It will arrive in a future delivery attempt by the remote."}]}]},"navigation":{"title":"queue/smtp_forward"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"queuesmtp_forward-plugin"},"children":[{"type":"text","value":"queue/smtp_forward plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin delivers to another mail server. This is a common setup when you\nwant to have a mail server with a solid pedigree of outbound delivery to\nother hosts, and inbound delivery to users."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In comparison to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"queue/smtp_proxy"}]},{"type":"text","value":", this plugin waits until queue time to\nattempt the ongoing connection. This can be a benefit in reducing connections\nto your inbound mail server when you have content filtering (such as\nspamassassin) enabled. A possible downside is that it also delays recipient\nvalidation that the ongoing mail server may provide until queue time."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"smtp_forward.ini"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Configuration is stored in this file in the following keys:"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"enable_outbound="},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"SMTP forward outbound messages (set to false to enable Haraka's separate\nOutbound mail routing (MX based delivery))."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"host=HOST"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The host to connect to."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"port=PORT"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The port to connect to. Default: 25"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connect_timeout=SECONDS"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The maximum amount of time to wait when creating a new connection\nto the host.  Default: 30 seconds."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"timeout=SECONDS"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The amount of seconds to let a backend connection live idle in the\nconnection pool.  This should always be less than the global plugin\ntimeout, which should in turn be less than the connection timeout."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"max_connections=NUMBER"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Maximum number of connections at any given time. Default: 1000"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"enable_tls="},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Enable TLS with the forward host (if supported). TLS uses options\nfrom the tls plugin. If key and cert are provided in the the outbound section of the tls plugin,\nthat certificate will be used as a TLS Client Certificate."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"This option controls the use of TLS via "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"STARTTLS"}]},{"type":"text","value":". This plugin does not work with\nSMTP over TLS."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"auth_type="},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"plain|login"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Enable PLAIN or LOGIN SMTP AUTH.  This is required to enable AUTH."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"auth_user=USERNAME"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"SMTP AUTH username to use."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"auth_pass=PASSWORD"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"SMTP AUTH password to use."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"queue"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Which queue plugin to use. Default: undefined. The default bahavior is to\nuse smtp_forward for inbound connections and outbound for relaying\nconnections. This option is used for complex mail routes."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"check_sender=false"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Requires that sender domains defined in smtp_forward.ini (see Per-Domain below) have relaying privileges. This is a form of spoof prevention and assumes that any mail clients have relaying or AUTH privileges. This is usually the case."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"check_recipient=false"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"By default, Haraka accepts no emails until a recipient plugin has been configured to accept mails for a domain. The simplest common case is the in_host_list plugin with a list of domains in config/host_list. An alternative is to set "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"check_recipient=true"}]},{"type":"text","value":" and list each domain in a definition block in smtp_forward.ini (see Per-Domain Configuration). An example for two domains:"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"example.com"}]},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"example.net"}]}]}]}]}]},{"type":"element","tag":"h1","props":{"id":"per-domain-configuration"},"children":[{"type":"text","value":"Per-Domain Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"More specific forward routes for domains can be defined. The domain is\nchosen based on the value of the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"domain_selector"}]},{"type":"text","value":" config variable."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"domain_selector"}]},{"type":"text","value":" is set to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"rcpt_to"}]},{"type":"text","value":" (the default), more specific\nroutes are only honored for SMTP connections with a single recipient or SMTP\nconnections where every recipient host is identical."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"domain_selector"}]},{"type":"text","value":" is set to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"mail_from"}]},{"type":"text","value":", the domain of the MAIL FROM\naddress is used."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"enable_outbound can be set or unset on a per-domain level to enable or disable\nforwarding for specific domains."}]},{"type":"element","tag":"code","props":{"code":"# default SMTP host\nhost=1.2.3.4\n# auth_type=plain\n# auth_user=user\n# auth_user=pass\n\n[example1.com]\nhost=1.2.3.5\n# auth_type=plain\n# auth_user=user\n# auth_pass=pass\n\n[example2.com]\nhost=1.2.3.5\n\n[example3.com]\nhost=1.2.3.6\n\n[example4.com]\nenable\\_outbound=false\n","language":"ini"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-b4455d"},"children":[{"type":"text","value":"# default SMTP host"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dea0f9"},"children":[{"type":"text","value":"host"}]},{"type":"element","tag":"span","props":{"class":"ct-5bf010"},"children":[{"type":"text","value":"=1.2.3.4"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-b4455d"},"children":[{"type":"text","value":"# auth_type=plain"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-b4455d"},"children":[{"type":"text","value":"# auth_user=user"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-b4455d"},"children":[{"type":"text","value":"# auth_user=pass"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-c7b418"},"children":[{"type":"text","value":"[example1.com]"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dea0f9"},"children":[{"type":"text","value":"host"}]},{"type":"element","tag":"span","props":{"class":"ct-5bf010"},"children":[{"type":"text","value":"=1.2.3.5"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-b4455d"},"children":[{"type":"text","value":"# auth_type=plain"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-b4455d"},"children":[{"type":"text","value":"# auth_user=user"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-b4455d"},"children":[{"type":"text","value":"# auth_pass=pass"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-c7b418"},"children":[{"type":"text","value":"[example2.com]"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dea0f9"},"children":[{"type":"text","value":"host"}]},{"type":"element","tag":"span","props":{"class":"ct-5bf010"},"children":[{"type":"text","value":"=1.2.3.5"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-c7b418"},"children":[{"type":"text","value":"[example3.com]"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dea0f9"},"children":[{"type":"text","value":"host"}]},{"type":"element","tag":"span","props":{"class":"ct-5bf010"},"children":[{"type":"text","value":"=1.2.3.6"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-c7b418"},"children":[{"type":"text","value":"[example4.com]"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5bf010"},"children":[{"type":"text","value":"enable\\"}]},{"type":"element","tag":"span","props":{"class":"ct-dea0f9"},"children":[{"type":"text","value":"_outbound"}]},{"type":"element","tag":"span","props":{"class":"ct-5bf010"},"children":[{"type":"text","value":"=false"}]}]}]}]}]},{"type":"element","tag":"h1","props":{"id":"split-host-forward-routing"},"children":[{"type":"text","value":"Split host forward routing"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When an incoming email transaction has multiple recipients with different forward routes,  recipients to subsequent forward routes are deferred. Example: an incoming email transaction has recipients "},{"type":"element","tag":"a","props":{"href":"mailto:user@example1.com"},"children":[{"type":"text","value":"user@example1.com"}]},{"type":"text","value":", "},{"type":"element","tag":"a","props":{"href":"mailto:user@example2.com"},"children":[{"type":"text","value":"user@example2.com"}]},{"type":"text","value":", and "},{"type":"element","tag":"a","props":{"href":"mailto:user@example3.com"},"children":[{"type":"text","value":"user@example3.com"}]},{"type":"text","value":". The first two recipients will be accepted (they share the same forward destination) and the latter will be deferred. It will arrive in a future delivery attempt by the remote."}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-c7b418{color:#953800}\n.ct-5bf010{color:#24292F}\n.ct-dea0f9{color:#CF222E}\n.ct-b4455d{color:#6E7781}\n.dark .ct-b4455d{color:#8B949E}\n.dark .ct-dea0f9{color:#FF7B72}\n.dark .ct-5bf010{color:#C9D1D9}\n.dark .ct-c7b418{color:#FFA657}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"configuration","depth":2,"text":"Configuration"}]}},"_type":"markdown","_id":"content:8.plugins:queue:smtp_forward.md","_source":"content","_file":"8.plugins/queue/smtp_forward.md","_extension":"md"},{"_path":"/plugins/queue/smtp_proxy","_dir":"queue","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"queue/smtp_proxy - Deliver mail to the proxy MTA","description":"Haraka queue/smtp_proxy plugin - Deliver mail to the proxy MTA","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"queuesmtp_proxy-plugin"},"children":[{"type":"text","value":"queue/smtp_proxy plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin delivers to another mail server. This is a common setup when you\nwant to have a mail server with a solid pedigree of outbound delivery to\nother hosts, and inbound delivery to users."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In comparison to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"queue/smtp_forward"}]},{"type":"text","value":", this plugin makes a connection at\nMAIL FROM time to the ongoing SMTP server. This can be a benefit in that\nyou get any SMTP-time filtering that the ongoing server provides, in\nparticular one important facility to some setups is recipient filtering.\nHowever be aware that other than connect and HELO-time filtering, you will\nhave as many connections to your ongoing SMTP server as you have to Haraka."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"smtp_proxy.ini"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Configuration is stored in this file in the following keys:"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"enable_outbound="},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"true"}]}]}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"SMTP proxy outbound messages (set to false to enable Haraka's\nseparate Outbound mail routing (MX based delivery))."},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"host=HOST"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The host to connect to."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"port=PORT"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The port to connect to."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connect_timeout=SECONDS"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The maximum amount of time to wait when creating a new connection\nto the host.  Default if unspecified is 30 seconds."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"timeout=SECONDS"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The amount of seconds to let a backend connection live idle in the\nproxy pool.  This should always be less than the global plugin timeout,\nwhich should in turn be less than the connection timeout."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"max_connections=NUMBER"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Maximum number of connections to create at any given time."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"enable_tls="},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"true|yes|1"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Enable TLS with the forward host (if supported). TLS uses options from\nthe tls plugin."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"auth_type="},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"plain|login"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Enable PLAIN or LOGIN SMTP AUTH.  This is required to enable AUTH."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"auth_user=USERNAME"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"SMTP AUTH username to use."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"auth_pass=PASSWORD"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"SMTP AUTH password to use."}]}]}]}]}]},"navigation":{"title":"queue/smtp_proxy"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"queuesmtp_proxy-plugin"},"children":[{"type":"text","value":"queue/smtp_proxy plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin delivers to another mail server. This is a common setup when you\nwant to have a mail server with a solid pedigree of outbound delivery to\nother hosts, and inbound delivery to users."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In comparison to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"queue/smtp_forward"}]},{"type":"text","value":", this plugin makes a connection at\nMAIL FROM time to the ongoing SMTP server. This can be a benefit in that\nyou get any SMTP-time filtering that the ongoing server provides, in\nparticular one important facility to some setups is recipient filtering.\nHowever be aware that other than connect and HELO-time filtering, you will\nhave as many connections to your ongoing SMTP server as you have to Haraka."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"smtp_proxy.ini"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Configuration is stored in this file in the following keys:"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"enable_outbound="},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"true"}]}]}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"SMTP proxy outbound messages (set to false to enable Haraka's\nseparate Outbound mail routing (MX based delivery))."},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"host=HOST"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The host to connect to."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"port=PORT"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The port to connect to."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connect_timeout=SECONDS"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The maximum amount of time to wait when creating a new connection\nto the host.  Default if unspecified is 30 seconds."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"timeout=SECONDS"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The amount of seconds to let a backend connection live idle in the\nproxy pool.  This should always be less than the global plugin timeout,\nwhich should in turn be less than the connection timeout."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"max_connections=NUMBER"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Maximum number of connections to create at any given time."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"enable_tls="},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"true|yes|1"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Enable TLS with the forward host (if supported). TLS uses options from\nthe tls plugin."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"auth_type="},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"plain|login"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Enable PLAIN or LOGIN SMTP AUTH.  This is required to enable AUTH."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"auth_user=USERNAME"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"SMTP AUTH username to use."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"auth_pass=PASSWORD"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"SMTP AUTH password to use."}]}]}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"configuration","depth":2,"text":"Configuration"}]}},"_type":"markdown","_id":"content:8.plugins:queue:smtp_proxy.md","_source":"content","_file":"8.plugins/queue/smtp_proxy.md","_extension":"md"},{"_path":"/plugins/rate_limit","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"rate_limit - Rate limit connections plugin for Haraka","description":"Haraka rate_limit plugin - Rate limit connections","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"rate_limit-plugin"},"children":[{"type":"text","value":"rate_limit plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Enforce limits on connection concurrency, connection rate, and recipient rate."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"By default DENYSOFT will be returned when the limits are exceeded, but for\nconcurrency, connection rate and recipient rate by host you can optionally\ntarpit the connection by adding a delay before every response sent back to the\nclient instead of sending a DENYSOFT.  To do this requires the 'tarpit' plugin\nto run immediately after this plugin."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To use this plugin you will need a Redis server and will need the redis,\nhiredis and ipaddr.js packages installed via:"}]},{"type":"element","tag":"code","props":{"code":"cd /path/to/haraka/home\nnpm install redis hiredis ipaddr.js\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"cd /path/to/haraka/home\nnpm install redis hiredis ipaddr.js\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin uses the configuration file rate_limit.ini which is checked for\nupdates before each hook, so changes to this file will never require a restart\nand will take effect seconds after the changes are saved."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The configuration options for each heading are detailed below:"}]},{"type":"element","tag":"h3","props":{"id":"main"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"main"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"redis_server = <ip | host>"},{"type":"element","tag":"span","props":{},"children":[{"type":"element","tag":"port","props":{},"children":[]}]},{"type":"text","value":" "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"(optional)"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If port is missing then it defaults to 6379."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nIf this setting is missing entirely then it defaults to 127.0.0.1:6379."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Note that Redis does not currently support IPv6."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"tarpit_delay = seconds "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"(optional)"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Set this to the length in seconds that you want to delay every SMTP\nresponse to a remote client that has exceeded the rate limits.  For this\nto work the 'tarpit' plugin must be loaded "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"after"}]},{"type":"text","value":" this plugin in\nconfig/plugins."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If 'tarpit' is not loaded or is loaded before this plugin, then no\nrate throttling will occur."}]}]},{"type":"element","tag":"hr","props":{},"children":[]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"All of the following sections are optional.  Any missing section disables\nthat particular test."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"They all use a common configuration format:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"<lookup> = <limit>"},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"/time"},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"unit"}]}]},{"type":"text","value":"  "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"(optional)"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"'lookup' is based upon the limit being enforced and is either an IP\naddress, rDNS name, sender address or recipient address either in full\nor part."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nThe lookup order is as follows and the first match in this order is\nreturned and is used as the record key in Redis (except for 'default'\nwhich always uses the full lookup for that test as the record key):"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"IPv4/IPv6 address or rDNS hostname:"}]},{"type":"text","value":" "},{"type":"element","tag":"pre","props":{},"children":[{"type":"text","value":" fe80:0:0:0:202:b3ff:fe1e:8329\n fe80:0:0:0:202:b3ff:fe1e\n fe80:0:0:0:202:b3ff\n fe80:0:0:0:202\n fe80:0:0:0\n fe80:0:0\n fe80:0\n fe80\n 1.2.3.4\n 1.2.3\n 1.2\n 1\n host.part.domain.com\n part.domain.com\n domain.com\n com\n default\n "}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Sender or Recipient address:"}]},{"type":"text","value":" "},{"type":"element","tag":"pre","props":{},"children":[{"type":"text","value":" user@host.sub.part.domain.com\n host.sub.part.domain.com\n sub.part.domain.com\n part.domain.com\n domain.com\n com\n default\n "}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"In all tests 'default' is used to specify a default limit if nothing else has\nmatched."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"'limit' specifies the limit for this lookup.  Specify 0 (zero) to disable\nlimits on a matching lookup."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"'time' is optional and if missing defaults to 60 seconds.  You can optionally\nspecify the following time units (case-insensitive):"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"s (seconds)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"m (minutes)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"h (hours)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"d (days)"}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"concurrency"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"concurrency"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"IMPORTANT NOTE:"}]},{"type":"text","value":" connection concurrency is recorded in-memory (in\nconnection.server.notes) and not in Redis, so the limits are per-server and\nper-child if you use the cluster module."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"IP and rDNS names are looked up by this test.  This section does "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"not"}]},{"type":"text","value":" accept an\ninterval.  It's a hard limit on the number of connections and not based on time."}]},{"type":"element","tag":"h3","props":{"id":"rate_conn"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"rate_conn"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This section limits the number of connections per interval from a given host\nor set of hosts."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"IP and rDNS names are looked up by this test."}]},{"type":"element","tag":"h3","props":{"id":"rate_rcpt_host"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"rate_rcpt_host"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This section limits the number of recipients per interval from a given host or\nset of hosts."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"IP and rDNS names are looked up by this test."}]},{"type":"element","tag":"h3","props":{"id":"rate_rcpt_sender"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"rate_rcpt_sender"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This section limits the number of recipients per interval from a sender or\nsender domain."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The sender is looked up by this test."}]},{"type":"element","tag":"h3","props":{"id":"rate_rcpt"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"rate_rcpt"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This section limits the rate which a recipient or recipient domain can\nreceive messages over an interval."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Each recipient is looked up by this test."}]},{"type":"element","tag":"h3","props":{"id":"rate_rcpt_null"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"rate_rcpt_null"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This section limits the rate at which a recipient can receive messages from\na null sender (e.g. DSN, MDN etc.) over an interval."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Each recipient is looked up by this test."}]}]},"navigation":{"title":"rate_limit"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"rate_limit-plugin"},"children":[{"type":"text","value":"rate_limit plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Enforce limits on connection concurrency, connection rate, and recipient rate."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"By default DENYSOFT will be returned when the limits are exceeded, but for\nconcurrency, connection rate and recipient rate by host you can optionally\ntarpit the connection by adding a delay before every response sent back to the\nclient instead of sending a DENYSOFT.  To do this requires the 'tarpit' plugin\nto run immediately after this plugin."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To use this plugin you will need a Redis server and will need the redis,\nhiredis and ipaddr.js packages installed via:"}]},{"type":"element","tag":"code","props":{"code":"cd /path/to/haraka/home\nnpm install redis hiredis ipaddr.js\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"cd /path/to/haraka/home\nnpm install redis hiredis ipaddr.js"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin uses the configuration file rate_limit.ini which is checked for\nupdates before each hook, so changes to this file will never require a restart\nand will take effect seconds after the changes are saved."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The configuration options for each heading are detailed below:"}]},{"type":"element","tag":"h3","props":{"id":"main"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"main"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"redis_server = <ip | host>"},{"type":"element","tag":"span","props":{},"children":[{"type":"element","tag":"port","props":{},"children":[]}]},{"type":"text","value":" "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"(optional)"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If port is missing then it defaults to 6379."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nIf this setting is missing entirely then it defaults to 127.0.0.1:6379."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Note that Redis does not currently support IPv6."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"tarpit_delay = seconds "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"(optional)"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Set this to the length in seconds that you want to delay every SMTP\nresponse to a remote client that has exceeded the rate limits.  For this\nto work the 'tarpit' plugin must be loaded "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"after"}]},{"type":"text","value":" this plugin in\nconfig/plugins."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If 'tarpit' is not loaded or is loaded before this plugin, then no\nrate throttling will occur."}]}]},{"type":"element","tag":"hr","props":{},"children":[]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"All of the following sections are optional.  Any missing section disables\nthat particular test."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"They all use a common configuration format:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"<lookup> = <limit>"},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"/time"},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"unit"}]}]},{"type":"text","value":"  "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"(optional)"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"'lookup' is based upon the limit being enforced and is either an IP\naddress, rDNS name, sender address or recipient address either in full\nor part."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nThe lookup order is as follows and the first match in this order is\nreturned and is used as the record key in Redis (except for 'default'\nwhich always uses the full lookup for that test as the record key):"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"IPv4/IPv6 address or rDNS hostname:"}]},{"type":"text","value":" "},{"type":"element","tag":"pre","props":{},"children":[{"type":"text","value":" fe80:0:0:0:202:b3ff:fe1e:8329\n fe80:0:0:0:202:b3ff:fe1e\n fe80:0:0:0:202:b3ff\n fe80:0:0:0:202\n fe80:0:0:0\n fe80:0:0\n fe80:0\n fe80\n 1.2.3.4\n 1.2.3\n 1.2\n 1\n host.part.domain.com\n part.domain.com\n domain.com\n com\n default\n "}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Sender or Recipient address:"}]},{"type":"text","value":" "},{"type":"element","tag":"pre","props":{},"children":[{"type":"text","value":" user@host.sub.part.domain.com\n host.sub.part.domain.com\n sub.part.domain.com\n part.domain.com\n domain.com\n com\n default\n "}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"In all tests 'default' is used to specify a default limit if nothing else has\nmatched."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"'limit' specifies the limit for this lookup.  Specify 0 (zero) to disable\nlimits on a matching lookup."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"'time' is optional and if missing defaults to 60 seconds.  You can optionally\nspecify the following time units (case-insensitive):"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"s (seconds)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"m (minutes)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"h (hours)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"d (days)"}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"concurrency"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"concurrency"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"IMPORTANT NOTE:"}]},{"type":"text","value":" connection concurrency is recorded in-memory (in\nconnection.server.notes) and not in Redis, so the limits are per-server and\nper-child if you use the cluster module."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"IP and rDNS names are looked up by this test.  This section does "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"not"}]},{"type":"text","value":" accept an\ninterval.  It's a hard limit on the number of connections and not based on time."}]},{"type":"element","tag":"h3","props":{"id":"rate_conn"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"rate_conn"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This section limits the number of connections per interval from a given host\nor set of hosts."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"IP and rDNS names are looked up by this test."}]},{"type":"element","tag":"h3","props":{"id":"rate_rcpt_host"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"rate_rcpt_host"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This section limits the number of recipients per interval from a given host or\nset of hosts."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"IP and rDNS names are looked up by this test."}]},{"type":"element","tag":"h3","props":{"id":"rate_rcpt_sender"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"rate_rcpt_sender"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This section limits the number of recipients per interval from a sender or\nsender domain."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The sender is looked up by this test."}]},{"type":"element","tag":"h3","props":{"id":"rate_rcpt"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"rate_rcpt"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This section limits the rate which a recipient or recipient domain can\nreceive messages over an interval."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Each recipient is looked up by this test."}]},{"type":"element","tag":"h3","props":{"id":"rate_rcpt_null"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"rate_rcpt_null"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This section limits the rate at which a recipient can receive messages from\na null sender (e.g. DSN, MDN etc.) over an interval."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Each recipient is looked up by this test."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"configuration","depth":2,"text":"Configuration","children":[{"id":"main","depth":3,"text":"main"},{"id":"concurrency","depth":3,"text":"concurrency"},{"id":"rate_conn","depth":3,"text":"rate_conn"},{"id":"rate_rcpt_host","depth":3,"text":"rate_rcpt_host"},{"id":"rate_rcpt_sender","depth":3,"text":"rate_rcpt_sender"},{"id":"rate_rcpt","depth":3,"text":"rate_rcpt"},{"id":"rate_rcpt_null","depth":3,"text":"rate_rcpt_null"}]}]}},"_type":"markdown","_id":"content:8.plugins:rate_limit.md","_source":"content","_file":"8.plugins/rate_limit.md","_extension":"md"},{"_path":"/plugins/rcpt_to.access","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"rcpt_to.access - Access control for RCPT TO plugin for Haraka","description":"Haraka rcpt_to.access plugin - Access control for RCPT TO","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"rcpt_toaccess-plugin"},"children":[{"type":"text","value":"rcpt_to.access plugin"}]},{"type":"element","tag":"h2","props":{"id":"deprecation-notice"},"children":[{"type":"text","value":"DEPRECATION NOTICE"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"See the "},{"type":"element","tag":"a","props":{"href":"http://haraka.github.io/plugins/access","rel":["nofollow"]},"children":[{"type":"text","value":"access"}]},{"type":"text","value":" plugin for upgrade instructions."}]},{"type":"element","tag":"h1","props":{"id":"rcpt_toaccess"},"children":[{"type":"text","value":"rcpt_to.access"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin blocks RCPT_TO addresses in a list or regex.\nThis plugin will evaluate the RCPT_TO address against a set of white and black\nlists.  The lists are applied in the following way:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"rcpt_to.access.whitelist          (pass)\nrcpt_to.access.whitelist_regex   (pass)\nrcpt_to.access.blacklist          (block)\nrcpt_to.access.blacklist_regex   (block)"}]},{"type":"element","tag":"h2","props":{"id":"configuration-rcpt_toaccessini"},"children":[{"type":"text","value":"Configuration rcpt_to.access.ini"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"General configuration file for this plugin."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"rcpt_to.access.general.deny_msg"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Text to send the user on reject (text)."}]}]},{"type":"element","tag":"h2","props":{"id":"configuration-rcpt_toaccesswhitelist"},"children":[{"type":"text","value":"Configuration rcpt_to.access.whitelist"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The whitelist is mostly to counter blacklist entries that match more than\nwhat one would want.  This file should be used for a specific address\none per line, that should bypass blacklist checks.\nNOTE: We heavily suggest tailoring blacklist entries to be as accurate as\npossible and never using whitelists.  Nevertheless, if you need whitelists,\nhere they are."}]},{"type":"element","tag":"h2","props":{"id":"configuration-rcpt_toaccesswhitelist_regex"},"children":[{"type":"text","value":"Configuration rcpt_to.access.whitelist_regex"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Does the same thing as the whitelist file, but each line is a regex.\nEach line is also anchored for you, meaning '^' + regex + '$' is added for\nyou.  If you need to get around this restriction, you may use a '.*' at\neither the start or the end of your regex.  This should help prevent people\nfrom writing overly permissive rules on accident."}]},{"type":"element","tag":"h2","props":{"id":"configuration-rcpt_toaccessblacklist"},"children":[{"type":"text","value":"Configuration rcpt_to.access.blacklist"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This file should be used for a specific address, one per line, that should\nfail on connect."}]},{"type":"element","tag":"h2","props":{"id":"configuration-rcpt_toaccessblacklist_regex"},"children":[{"type":"text","value":"Configuration rcpt_to.access.blacklist_regex"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Does the same thing as the blacklist file, but each line is a regex.\nEach line is also anchored for you, meaning '^' + regex + '$' is added for\nyou.  If you need to get around this restriction, you may use a '.*' at\neither the start or the end of your regex.  This should help prevent people\nfrom writing overly permissive rules on accident."}]}]},"navigation":{"title":"rcpt_to.access"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"rcpt_toaccess-plugin"},"children":[{"type":"text","value":"rcpt_to.access plugin"}]},{"type":"element","tag":"h2","props":{"id":"deprecation-notice"},"children":[{"type":"text","value":"DEPRECATION NOTICE"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"See the "},{"type":"element","tag":"a","props":{"href":"http://haraka.github.io/plugins/access","rel":["nofollow"]},"children":[{"type":"text","value":"access"}]},{"type":"text","value":" plugin for upgrade instructions."}]},{"type":"element","tag":"h1","props":{"id":"rcpt_toaccess"},"children":[{"type":"text","value":"rcpt_to.access"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin blocks RCPT_TO addresses in a list or regex.\nThis plugin will evaluate the RCPT_TO address against a set of white and black\nlists.  The lists are applied in the following way:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"rcpt_to.access.whitelist          (pass)\nrcpt_to.access.whitelist_regex   (pass)\nrcpt_to.access.blacklist          (block)\nrcpt_to.access.blacklist_regex   (block)"}]},{"type":"element","tag":"h2","props":{"id":"configuration-rcpt_toaccessini"},"children":[{"type":"text","value":"Configuration rcpt_to.access.ini"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"General configuration file for this plugin."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"rcpt_to.access.general.deny_msg"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Text to send the user on reject (text)."}]}]},{"type":"element","tag":"h2","props":{"id":"configuration-rcpt_toaccesswhitelist"},"children":[{"type":"text","value":"Configuration rcpt_to.access.whitelist"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The whitelist is mostly to counter blacklist entries that match more than\nwhat one would want.  This file should be used for a specific address\none per line, that should bypass blacklist checks.\nNOTE: We heavily suggest tailoring blacklist entries to be as accurate as\npossible and never using whitelists.  Nevertheless, if you need whitelists,\nhere they are."}]},{"type":"element","tag":"h2","props":{"id":"configuration-rcpt_toaccesswhitelist_regex"},"children":[{"type":"text","value":"Configuration rcpt_to.access.whitelist_regex"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Does the same thing as the whitelist file, but each line is a regex.\nEach line is also anchored for you, meaning '^' + regex + '$' is added for\nyou.  If you need to get around this restriction, you may use a '.*' at\neither the start or the end of your regex.  This should help prevent people\nfrom writing overly permissive rules on accident."}]},{"type":"element","tag":"h2","props":{"id":"configuration-rcpt_toaccessblacklist"},"children":[{"type":"text","value":"Configuration rcpt_to.access.blacklist"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This file should be used for a specific address, one per line, that should\nfail on connect."}]},{"type":"element","tag":"h2","props":{"id":"configuration-rcpt_toaccessblacklist_regex"},"children":[{"type":"text","value":"Configuration rcpt_to.access.blacklist_regex"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Does the same thing as the blacklist file, but each line is a regex.\nEach line is also anchored for you, meaning '^' + regex + '$' is added for\nyou.  If you need to get around this restriction, you may use a '.*' at\neither the start or the end of your regex.  This should help prevent people\nfrom writing overly permissive rules on accident."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"deprecation-notice","depth":2,"text":"DEPRECATION NOTICE"},{"id":"configuration-rcpt_toaccessini","depth":2,"text":"Configuration rcpt_to.access.ini"},{"id":"configuration-rcpt_toaccesswhitelist","depth":2,"text":"Configuration rcpt_to.access.whitelist"},{"id":"configuration-rcpt_toaccesswhitelist_regex","depth":2,"text":"Configuration rcpt_to.access.whitelist_regex"},{"id":"configuration-rcpt_toaccessblacklist","depth":2,"text":"Configuration rcpt_to.access.blacklist"},{"id":"configuration-rcpt_toaccessblacklist_regex","depth":2,"text":"Configuration rcpt_to.access.blacklist_regex"}]}},"_type":"markdown","_id":"content:8.plugins:rcpt_to.access.md","_source":"content","_file":"8.plugins/rcpt_to.access.md","_extension":"md"},{"_path":"/plugins/rcpt_to.in_host_list","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"rcpt_to.in_host_list - Check if recipient is in host_list","description":"Haraka rcpt_to.in_host_list plugin - Check if recipient is in host_list","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"rcpt_toin_host_list-plugin"},"children":[{"type":"text","value":"rcpt_to.in_host_list plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin is the mainstay of an inbound Haraka server. It should list the\ndomains that are local to the host. Mails that have RCPT TO not matching\na host in the given list will be passed onto other rcpt hooks. If no rcpt\nhook accepts the connection, it will be rejected."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"host_list"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Specifies the list of hosts that are local to this server."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"host_list_regex"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Specifies the list of regexes that are local to this server.  Note\nall these regexes are anchored with ^regex$. One can choose not to\nanchor with .*. There is the potential for bad regexes to be\ntoo permissive if we don't anchor."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"host_list.anti_spoof"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"When enabled, this will cause Haraka to reject any MAIL FROM where\nthe host appears within the host list but the connected host is not\na relay, e.g. connection.relaying is not set either by SMTP AUTH or\nanother plugin like 'relay'."}]}]},{"type":"element","tag":"h2","props":{"id":"relaying"},"children":[{"type":"text","value":"Relaying"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin checks to see if the MAIL FROM domain is local. When\nconnection.relaying is detected (haraka -h relay) and the MAIL FROM domain is\nlocal, this plugin will vouch for any RCPT. This limits relaying users to\nsending from local domains, which is much safer than letting relay clients\nsend from any domain."}]}]},"navigation":{"title":"rcpt_to.in_host_list"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"rcpt_toin_host_list-plugin"},"children":[{"type":"text","value":"rcpt_to.in_host_list plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin is the mainstay of an inbound Haraka server. It should list the\ndomains that are local to the host. Mails that have RCPT TO not matching\na host in the given list will be passed onto other rcpt hooks. If no rcpt\nhook accepts the connection, it will be rejected."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"host_list"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Specifies the list of hosts that are local to this server."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"host_list_regex"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Specifies the list of regexes that are local to this server.  Note\nall these regexes are anchored with ^regex$. One can choose not to\nanchor with .*. There is the potential for bad regexes to be\ntoo permissive if we don't anchor."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"host_list.anti_spoof"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"When enabled, this will cause Haraka to reject any MAIL FROM where\nthe host appears within the host list but the connected host is not\na relay, e.g. connection.relaying is not set either by SMTP AUTH or\nanother plugin like 'relay'."}]}]},{"type":"element","tag":"h2","props":{"id":"relaying"},"children":[{"type":"text","value":"Relaying"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin checks to see if the MAIL FROM domain is local. When\nconnection.relaying is detected (haraka -h relay) and the MAIL FROM domain is\nlocal, this plugin will vouch for any RCPT. This limits relaying users to\nsending from local domains, which is much safer than letting relay clients\nsend from any domain."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"configuration","depth":2,"text":"Configuration"},{"id":"relaying","depth":2,"text":"Relaying"}]}},"_type":"markdown","_id":"content:8.plugins:rcpt_to.in_host_list.md","_source":"content","_file":"8.plugins/rcpt_to.in_host_list.md","_extension":"md"},{"_path":"/plugins/rcpt_to.ldap","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"rcpt_to.ldap - LDAP plugin for Haraka","description":"Haraka rcpt_to.ldap plugin - LDAP plugin","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"rcp_toldap-plugin"},"children":[{"type":"text","value":"rcp_to.ldap plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin tries to validate recipients against an LDAP server. This will help\nin replacing an existing qmail-ldap installation with Haraka."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The plugin assumes simple qmail-ldap style LDAP records. It is completely\nconfigurable using the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/rcpt_to.ldap.ini"}]},{"type":"text","value":" file."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The logic that is followed is:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Check if the recipient is for a local domain (ie. check if the domaiin is\npresent in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"host_list"}]},{"type":"text","value":")"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Check if the recipient is already whitelisted"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Run an LDAP search to see if the recipient can be found in LDAP."}]}]}]},"navigation":{"title":"rcpt_to.ldap.js"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"rcp_toldap-plugin"},"children":[{"type":"text","value":"rcp_to.ldap plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin tries to validate recipients against an LDAP server. This will help\nin replacing an existing qmail-ldap installation with Haraka."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The plugin assumes simple qmail-ldap style LDAP records. It is completely\nconfigurable using the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/rcpt_to.ldap.ini"}]},{"type":"text","value":" file."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The logic that is followed is:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Check if the recipient is for a local domain (ie. check if the domaiin is\npresent in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"host_list"}]},{"type":"text","value":")"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Check if the recipient is already whitelisted"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Run an LDAP search to see if the recipient can be found in LDAP."}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:8.plugins:rcpt_to.ldap.md","_source":"content","_file":"8.plugins/rcpt_to.ldap.md","_extension":"md"},{"_path":"/plugins/rcpt_to.max_count","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"rcpt_to.max_count - Limit the number of recipients per connection","description":"Haraka rcpt_to.max_count plugin - Limit the number of recipients per connection","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"rcpt_tomax_count-plugin"},"children":[{"type":"text","value":"rcpt_to.max_count plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin sets a maximum limit on RCPT TOs. Violators will be disconnected."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"rcpt_to.max_count"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The maximum number of recipients. Default: 40."}]}]}]},"navigation":{"title":"rcpt_to.max_count"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"rcpt_tomax_count-plugin"},"children":[{"type":"text","value":"rcpt_to.max_count plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin sets a maximum limit on RCPT TOs. Violators will be disconnected."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"rcpt_to.max_count"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The maximum number of recipients. Default: 40."}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"configuration","depth":2,"text":"Configuration"}]}},"_type":"markdown","_id":"content:8.plugins:rcpt_to.max_count.md","_source":"content","_file":"8.plugins/rcpt_to.max_count.md","_extension":"md"},{"_path":"/plugins/rcpt_to.qmail_deliverable","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"rcpt_to.qmail_deliverable - Check if recipient is deliverable","description":"Haraka rcpt_to.qmail_deliverable plugin - Check if recipient is deliverable","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"rcpt_toqmail_deliverable-plugin"},"children":[{"type":"text","value":"rcpt_to.qmail_deliverable plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A client for checking the deliverability of an email\naddress against the "},{"type":"element","tag":"a","props":{"href":"http://search.cpan.org/dist/Qmail-Deliverable/","rel":["nofollow"]},"children":[{"type":"text","value":"qmail-deliverabled"}]},{"type":"text","value":" daemon."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"On incoming messages (relaying=false), the RCPT TO address is validated."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"On outgoing messages (relaying=true) the MAIL FROM address is validated when\nthe "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"check\\_outbound"}]},{"type":"text","value":" option is enabled."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The host and port that qmail-deliverabled is listening on can be set by\naltering the contents of "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/rcpt_to.qmail_deliverable.ini"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"host"}]},{"type":"text","value":" (Default: localhost)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"port"}]},{"type":"text","value":" (Default: 8998)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"check_outbound"}]},{"type":"text","value":"=true"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"check_outbound"}]},{"type":"text","value":" is enabled, and a connection has relay privileges, the\nMAIL FROM address is validated as deliverable."}]},{"type":"element","tag":"h2","props":{"id":"per-domain-configuration"},"children":[{"type":"text","value":"Per-domain Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Additionally, domains can each have their own configuration for connecting\nto qmail-deliverabled. The defaults are the same, so only the differences\nneeds to be declared. Example:"}]},{"type":"element","tag":"code","props":{"code":"[example.com]\nhost=192.168.0.1\n\n[example2.com]\nhost=192.168.0.2\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"[example.com]\nhost=192.168.0.1\n\n[example2.com]\nhost=192.168.0.2\n"}]}]}]}]},"navigation":{"title":"rcpt_to.qmail_deliverable"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"rcpt_toqmail_deliverable-plugin"},"children":[{"type":"text","value":"rcpt_to.qmail_deliverable plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A client for checking the deliverability of an email\naddress against the "},{"type":"element","tag":"a","props":{"href":"http://search.cpan.org/dist/Qmail-Deliverable/","rel":["nofollow"]},"children":[{"type":"text","value":"qmail-deliverabled"}]},{"type":"text","value":" daemon."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"On incoming messages (relaying=false), the RCPT TO address is validated."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"On outgoing messages (relaying=true) the MAIL FROM address is validated when\nthe "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"check\\_outbound"}]},{"type":"text","value":" option is enabled."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The host and port that qmail-deliverabled is listening on can be set by\naltering the contents of "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/rcpt_to.qmail_deliverable.ini"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"host"}]},{"type":"text","value":" (Default: localhost)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"port"}]},{"type":"text","value":" (Default: 8998)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"check_outbound"}]},{"type":"text","value":"=true"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"check_outbound"}]},{"type":"text","value":" is enabled, and a connection has relay privileges, the\nMAIL FROM address is validated as deliverable."}]},{"type":"element","tag":"h2","props":{"id":"per-domain-configuration"},"children":[{"type":"text","value":"Per-domain Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Additionally, domains can each have their own configuration for connecting\nto qmail-deliverabled. The defaults are the same, so only the differences\nneeds to be declared. Example:"}]},{"type":"element","tag":"code","props":{"code":"[example.com]\nhost=192.168.0.1\n\n[example2.com]\nhost=192.168.0.2\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"[example.com]\nhost=192.168.0.1\n\n[example2.com]\nhost=192.168.0.2"}]}]}]}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"configuration","depth":2,"text":"Configuration"},{"id":"per-domain-configuration","depth":2,"text":"Per-domain Configuration"}]}},"_type":"markdown","_id":"content:8.plugins:rcpt_to.qmail_deliverable.md","_source":"content","_file":"8.plugins/rcpt_to.qmail_deliverable.md","_extension":"md"},{"_path":"/plugins/rcpt_to.routes","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"rcpt_to.routes - Route mail to different hosts based on recipient","description":"Haraka rcpt_to.routes plugin - Route mail to different hosts based on recipient","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"rcpt_toroutes-plugin"},"children":[{"type":"text","value":"rcpt_to.routes plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Moved to "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-recipient-routes","rel":["nofollow"]},"children":[{"type":"text","value":"https://github.com/haraka/haraka-plugin-recipient-routes"}]}]}]},"navigation":{"title":"rcpt_to.routes"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"rcpt_toroutes-plugin"},"children":[{"type":"text","value":"rcpt_to.routes plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Moved to "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/haraka-plugin-recipient-routes","rel":["nofollow"]},"children":[{"type":"text","value":"https://github.com/haraka/haraka-plugin-recipient-routes"}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:8.plugins:rcpt_to.routes.md","_source":"content","_file":"8.plugins/rcpt_to.routes.md","_extension":"md"},{"_path":"/plugins/record_envelope_addresses","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"record_envelope_addresses - Record envelope addresses","description":"Haraka record_envelope_addresses plugin - Record envelope addresses","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"record_envelope_addresses-plugin"},"children":[{"type":"text","value":"record_envelope_addresses plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin adds two new header lines."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"X-Envelope-To: the envelope RCPT TO address"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"X-Envelope-From: the envelope MAIL FROM address"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It is useful if you need to know the exact addresses used to send an email, e.g. when\nthe email was sent to you as BCC or if it is a newsletter. In both cases the recipient\naddress is normally not recorded in the headers."}]},{"type":"element","tag":"h2","props":{"id":"caveats"},"children":[{"type":"text","value":"Caveats"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you enable this plugin you may introduce a possible information leak, i.e. disclosure\nof BCC recipients. So you never want to use this on an outgoing mail server and maybe also\nnot if this server is used as a relay."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin has no configuration."}]}]},"navigation":{"title":"record_envelope_addresses"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"record_envelope_addresses-plugin"},"children":[{"type":"text","value":"record_envelope_addresses plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin adds two new header lines."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"X-Envelope-To: the envelope RCPT TO address"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"X-Envelope-From: the envelope MAIL FROM address"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It is useful if you need to know the exact addresses used to send an email, e.g. when\nthe email was sent to you as BCC or if it is a newsletter. In both cases the recipient\naddress is normally not recorded in the headers."}]},{"type":"element","tag":"h2","props":{"id":"caveats"},"children":[{"type":"text","value":"Caveats"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you enable this plugin you may introduce a possible information leak, i.e. disclosure\nof BCC recipients. So you never want to use this on an outgoing mail server and maybe also\nnot if this server is used as a relay."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin has no configuration."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"caveats","depth":2,"text":"Caveats"},{"id":"configuration","depth":2,"text":"Configuration"}]}},"_type":"markdown","_id":"content:8.plugins:record_envelope_addresses.md","_source":"content","_file":"8.plugins/record_envelope_addresses.md","_extension":"md"},{"_path":"/plugins/redis","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"redis - Redis plugin","description":"Haraka redis plugin - Redis plugin","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"redis-plugin"},"children":[{"type":"text","value":"Redis plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Connects to a local (by default) redis instance and stores a "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"redis"}]},{"type":"text","value":"\nconnection handle at "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"server.notes.redis"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h2","props":{"id":"config"},"children":[{"type":"text","value":"Config"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"redis.ini"}]},{"type":"text","value":" file has the following sections (defaults shown):"}]},{"type":"element","tag":"h3","props":{"id":"server"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"server"}]}]},{"type":"element","tag":"code","props":{"code":"; host=127.0.0.1\n; port=6379\n; db=0\n","language":"ini"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"; host=127.0.0.1\n; port=6379\n; db=0\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"pubsub"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"pubsub"}]}]},{"type":"element","tag":"code","props":{"code":"; host=127.0.0.1\n; port=6379\n","language":"ini"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"; host=127.0.0.1\n; port=6379\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Publish & Subscribe are DB agnostic and thus have no db setting. If host and port and not defined, they default to the same as "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"server"}]},{"type":"text","value":" settings."}]},{"type":"element","tag":"h3","props":{"id":"opts"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"opts"}]}]},{"type":"element","tag":"code","props":{"code":"; see https://www.npmjs.com/package/redis#overloading\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"; see https://www.npmjs.com/package/redis#overloading\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"usage"},"children":[{"type":"text","value":"Usage"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Use redis in your plugin like so:"}]},{"type":"element","tag":"code","props":{"code":"if (server.notes.redis) {\n    server.notes.redis.hgetall(...);\n        // or any other redis command\n}\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"if (server.notes.redis) {\n    server.notes.redis.hgetall(...);\n        // or any other redis command\n}\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"publishsubscribe-usage"},"children":[{"type":"text","value":"Publish/Subscribe Usage"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In your plugin:"}]},{"type":"element","tag":"code","props":{"code":"exports.results_init = function (next, connection) {\n    var plugin = this;\n    plugin.redis_subscribe(connection, function () {\n        connection.notes.redis.on('pmessage', function (pattern, channel, message) {\n            plugin.do_something_with_message(message, ...);\n        });\n        next();\n    });\n}\n// be nice to redis and disconnect\nexports.hook_disconnect = function (next, connection) {\n    this.redis_unsubscribe(connection);\n}\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"exports.results_init = function (next, connection) {\n    var plugin = this;\n    plugin.redis_subscribe(connection, function () {\n        connection.notes.redis.on('pmessage', function (pattern, channel, message) {\n            plugin.do_something_with_message(message, ...);\n        });\n        next();\n    });\n}\n// be nice to redis and disconnect\nexports.hook_disconnect = function (next, connection) {\n    this.redis_unsubscribe(connection);\n}\n"}]}]}]}]},"navigation":{"title":"redis"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"redis-plugin"},"children":[{"type":"text","value":"Redis plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Connects to a local (by default) redis instance and stores a "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"redis"}]},{"type":"text","value":"\nconnection handle at "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"server.notes.redis"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h2","props":{"id":"config"},"children":[{"type":"text","value":"Config"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"redis.ini"}]},{"type":"text","value":" file has the following sections (defaults shown):"}]},{"type":"element","tag":"h3","props":{"id":"server"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"server"}]}]},{"type":"element","tag":"code","props":{"code":"; host=127.0.0.1\n; port=6379\n; db=0\n","language":"ini"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-1094ae"},"children":[{"type":"text","value":"; host=127.0.0.1"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-1094ae"},"children":[{"type":"text","value":"; port=6379"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-1094ae"},"children":[{"type":"text","value":"; db=0"}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"pubsub"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"pubsub"}]}]},{"type":"element","tag":"code","props":{"code":"; host=127.0.0.1\n; port=6379\n","language":"ini"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-1094ae"},"children":[{"type":"text","value":"; host=127.0.0.1"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-1094ae"},"children":[{"type":"text","value":"; port=6379"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Publish & Subscribe are DB agnostic and thus have no db setting. If host and port and not defined, they default to the same as "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"server"}]},{"type":"text","value":" settings."}]},{"type":"element","tag":"h3","props":{"id":"opts"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"opts"}]}]},{"type":"element","tag":"code","props":{"code":"; see https://www.npmjs.com/package/redis#overloading\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"; see https://www.npmjs.com/package/redis#overloading"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"usage"},"children":[{"type":"text","value":"Usage"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Use redis in your plugin like so:"}]},{"type":"element","tag":"code","props":{"code":"if (server.notes.redis) {\n    server.notes.redis.hgetall(...);\n        // or any other redis command\n}\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0879c6"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-85e997"},"children":[{"type":"text","value":" (server.notes.redis) {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-85e997"},"children":[{"type":"text","value":"    server.notes.redis."}]},{"type":"element","tag":"span","props":{"class":"ct-ef6872"},"children":[{"type":"text","value":"hgetall"}]},{"type":"element","tag":"span","props":{"class":"ct-85e997"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-0879c6"},"children":[{"type":"text","value":"..."}]},{"type":"element","tag":"span","props":{"class":"ct-85e997"},"children":[{"type":"text","value":");"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-85e997"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-1094ae"},"children":[{"type":"text","value":"// or any other redis command"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-85e997"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"publishsubscribe-usage"},"children":[{"type":"text","value":"Publish/Subscribe Usage"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In your plugin:"}]},{"type":"element","tag":"code","props":{"code":"exports.results_init = function (next, connection) {\n    var plugin = this;\n    plugin.redis_subscribe(connection, function () {\n        connection.notes.redis.on('pmessage', function (pattern, channel, message) {\n            plugin.do_something_with_message(message, ...);\n        });\n        next();\n    });\n}\n// be nice to redis and disconnect\nexports.hook_disconnect = function (next, connection) {\n    this.redis_unsubscribe(connection);\n}\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-9476e9"},"children":[{"type":"text","value":"exports"}]},{"type":"element","tag":"span","props":{"class":"ct-85e997"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-ef6872"},"children":[{"type":"text","value":"results_init"}]},{"type":"element","tag":"span","props":{"class":"ct-85e997"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0879c6"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-85e997"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0879c6"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-85e997"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-c29903"},"children":[{"type":"text","value":"next"}]},{"type":"element","tag":"span","props":{"class":"ct-85e997"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-c29903"},"children":[{"type":"text","value":"connection"}]},{"type":"element","tag":"span","props":{"class":"ct-85e997"},"children":[{"type":"text","value":") {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-85e997"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-0879c6"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-85e997"},"children":[{"type":"text","value":" plugin "}]},{"type":"element","tag":"span","props":{"class":"ct-0879c6"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-85e997"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9476e9"},"children":[{"type":"text","value":"this"}]},{"type":"element","tag":"span","props":{"class":"ct-85e997"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-85e997"},"children":[{"type":"text","value":"    plugin."}]},{"type":"element","tag":"span","props":{"class":"ct-ef6872"},"children":[{"type":"text","value":"redis_subscribe"}]},{"type":"element","tag":"span","props":{"class":"ct-85e997"},"children":[{"type":"text","value":"(connection, "}]},{"type":"element","tag":"span","props":{"class":"ct-0879c6"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-85e997"},"children":[{"type":"text","value":" () {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-85e997"},"children":[{"type":"text","value":"        connection.notes.redis."}]},{"type":"element","tag":"span","props":{"class":"ct-ef6872"},"children":[{"type":"text","value":"on"}]},{"type":"element","tag":"span","props":{"class":"ct-85e997"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-fdc24f"},"children":[{"type":"text","value":"'pmessage'"}]},{"type":"element","tag":"span","props":{"class":"ct-85e997"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-0879c6"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-85e997"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-c29903"},"children":[{"type":"text","value":"pattern"}]},{"type":"element","tag":"span","props":{"class":"ct-85e997"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-c29903"},"children":[{"type":"text","value":"channel"}]},{"type":"element","tag":"span","props":{"class":"ct-85e997"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-c29903"},"children":[{"type":"text","value":"message"}]},{"type":"element","tag":"span","props":{"class":"ct-85e997"},"children":[{"type":"text","value":") {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-85e997"},"children":[{"type":"text","value":"            plugin."}]},{"type":"element","tag":"span","props":{"class":"ct-ef6872"},"children":[{"type":"text","value":"do_something_with_message"}]},{"type":"element","tag":"span","props":{"class":"ct-85e997"},"children":[{"type":"text","value":"(message, "}]},{"type":"element","tag":"span","props":{"class":"ct-0879c6"},"children":[{"type":"text","value":"..."}]},{"type":"element","tag":"span","props":{"class":"ct-85e997"},"children":[{"type":"text","value":");"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-85e997"},"children":[{"type":"text","value":"        });"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-85e997"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-ef6872"},"children":[{"type":"text","value":"next"}]},{"type":"element","tag":"span","props":{"class":"ct-85e997"},"children":[{"type":"text","value":"();"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-85e997"},"children":[{"type":"text","value":"    });"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-85e997"},"children":[{"type":"text","value":"}"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-1094ae"},"children":[{"type":"text","value":"// be nice to redis and disconnect"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-9476e9"},"children":[{"type":"text","value":"exports"}]},{"type":"element","tag":"span","props":{"class":"ct-85e997"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-ef6872"},"children":[{"type":"text","value":"hook_disconnect"}]},{"type":"element","tag":"span","props":{"class":"ct-85e997"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0879c6"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-85e997"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0879c6"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-85e997"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-c29903"},"children":[{"type":"text","value":"next"}]},{"type":"element","tag":"span","props":{"class":"ct-85e997"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-c29903"},"children":[{"type":"text","value":"connection"}]},{"type":"element","tag":"span","props":{"class":"ct-85e997"},"children":[{"type":"text","value":") {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-85e997"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-9476e9"},"children":[{"type":"text","value":"this"}]},{"type":"element","tag":"span","props":{"class":"ct-85e997"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-ef6872"},"children":[{"type":"text","value":"redis_unsubscribe"}]},{"type":"element","tag":"span","props":{"class":"ct-85e997"},"children":[{"type":"text","value":"(connection);"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-85e997"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-fdc24f{color:#0A3069}\n.ct-c29903{color:#953800}\n.ct-9476e9{color:#0550AE}\n.ct-ef6872{color:#8250DF}\n.ct-85e997{color:#24292F}\n.ct-0879c6{color:#CF222E}\n.ct-1094ae{color:#6E7781}\n.dark .ct-1094ae{color:#8B949E}\n.dark .ct-0879c6{color:#FF7B72}\n.dark .ct-85e997{color:#C9D1D9}\n.dark .ct-ef6872{color:#D2A8FF}\n.dark .ct-9476e9{color:#79C0FF}\n.dark .ct-c29903{color:#FFA657}\n.dark .ct-fdc24f{color:#A5D6FF}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"config","depth":2,"text":"Config","children":[{"id":"server","depth":3,"text":"server"},{"id":"pubsub","depth":3,"text":"pubsub"},{"id":"opts","depth":3,"text":"opts"}]},{"id":"usage","depth":2,"text":"Usage"},{"id":"publishsubscribe-usage","depth":2,"text":"Publish/Subscribe Usage"}]}},"_type":"markdown","_id":"content:8.plugins:redis.md","_source":"content","_file":"8.plugins/redis.md","_extension":"md"},{"_path":"/plugins/relay_acl","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"relay_acl","description":"This plugin makes it possible to relay outbound mails using IP based ACLs\nand relay inbound mails using destination domains.","excerpt":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin makes it possible to relay outbound mails using IP based ACLs\nand relay inbound mails using destination domains."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/relay_acl_allow"}]},{"type":"text","value":"\nAllowed IP ranges in CIDR notation, one per line.\nIPs listed in here will be allowed to send mails without any furthur\nchecks."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/relay_dest_domains.ini"}]},{"type":"text","value":"\nAllowed destination domains. The format is in ini file, the domain\nis the key and the value is in JSON, all under the "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"domains"}]},{"type":"text","value":" section.\nCurrently supported field is \"action\": where the value can be\n\"accept\" (accept the mail without further checks), \"continue\" (mails\nare still subjected to further checks) or \"deny\" (reject the mails)."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"An example:"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"domains"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\ntest.com = { \"action\": \"continue\" }"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Please note that this config/relay_dest_domains.ini is shared with\nplugins/relay_force_routing.js, which uses additional fields."}]}]}]},"position":68,"category":"Plugins","body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin makes it possible to relay outbound mails using IP based ACLs\nand relay inbound mails using destination domains."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/relay_acl_allow"}]},{"type":"text","value":"\nAllowed IP ranges in CIDR notation, one per line.\nIPs listed in here will be allowed to send mails without any furthur\nchecks."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/relay_dest_domains.ini"}]},{"type":"text","value":"\nAllowed destination domains. The format is in ini file, the domain\nis the key and the value is in JSON, all under the "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"domains"}]},{"type":"text","value":" section.\nCurrently supported field is \"action\": where the value can be\n\"accept\" (accept the mail without further checks), \"continue\" (mails\nare still subjected to further checks) or \"deny\" (reject the mails)."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"An example:"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"domains"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\ntest.com = { \"action\": \"continue\" }"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Please note that this config/relay_dest_domains.ini is shared with\nplugins/relay_force_routing.js, which uses additional fields."}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"configuration","depth":2,"text":"Configuration"}]}},"_type":"markdown","_id":"content:8.plugins:relay_acl.md","_source":"content","_file":"8.plugins/relay_acl.md","_extension":"md"},{"_path":"/plugins/relay_all","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"relay_all - Relay all mail to a specific host","description":"Haraka relay_all plugin - Relay all mail to a specific host","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"relay_all-plugin"},"children":[{"type":"text","value":"relay_all plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin is useful in spamtraps to accept mail to any host, and to allow\nany user from anywhere to send email."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Do NOT use this plugin on a real mail server, unless you really know what\nyou are doing. If you use this plugin with anything that relays mail (such\nas forwarding to a real mail server, or the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"deliver"}]},{"type":"text","value":" plugin), your mail\nserver is now an open relay."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This is BAD. Hence the big letters. In short: DO NOT USE THIS PLUGIN."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It is useful for testing, hence why it is here. Also I work with spamtraps\na lot, so it is useful there."}]}]},"navigation":{"title":"relay_all"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"relay_all-plugin"},"children":[{"type":"text","value":"relay_all plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin is useful in spamtraps to accept mail to any host, and to allow\nany user from anywhere to send email."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Do NOT use this plugin on a real mail server, unless you really know what\nyou are doing. If you use this plugin with anything that relays mail (such\nas forwarding to a real mail server, or the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"deliver"}]},{"type":"text","value":" plugin), your mail\nserver is now an open relay."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This is BAD. Hence the big letters. In short: DO NOT USE THIS PLUGIN."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It is useful for testing, hence why it is here. Also I work with spamtraps\na lot, so it is useful there."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:8.plugins:relay_all.md","_source":"content","_file":"8.plugins/relay_all.md","_extension":"md"},{"_path":"/plugins/relay_force_routing","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"relay_force_routing.js - Force routing of mail to a specific host","description":"Haraka relay_force_routing plugin - Force routing of mail to a specific host","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"relay_force_routing-plugin"},"children":[{"type":"text","value":"relay_force_routing plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin allows you to force the next hop for the configured domains.\nIt works a lot like the transport map of Postfix."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/relay_dest_domains.ini"}]},{"type":"text","value":"\nThis config file is shared with relay_acl.js, for the basics see the\ndocumentation provided by plugins/relay_acl.js."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"relay_force_routing.js adds the field \"nexthop\": in the JSON value\nof the domain. The value of \"nexthop\": can be hostname or IP optionally\nfollow by "},{"type":"element","tag":"port","props":{},"children":[]},{"type":"text","value":"."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Example:"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"domains"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\ntest.com = { \"action\": \"continue\", \"nexthop\": \"127.0.0.1:2525\" }"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"You can also define a default relay using the \"any\" domain, which will be\nused if the message's destination domain doesn't match any of the domains\nalready defined."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Example:"}]}]},{"type":"element","tag":"code","props":{"code":"        [domains]  \n        test.com = { \"action\": \"continue\", \"nexthop\": \"127.0.0.1:2525\" }\n        my.test.com = { \"action\": \"continue\", \"nexthop\": \"127.0.0.1:2527\" }\n        any = { \"action\": \"continue\", \"nexthop\": \"10.10.10.1:2525\"}\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"        [domains]  \n        test.com = { \"action\": \"continue\", \"nexthop\": \"127.0.0.1:2525\" }\n        my.test.com = { \"action\": \"continue\", \"nexthop\": \"127.0.0.1:2527\" }\n        any = { \"action\": \"continue\", \"nexthop\": \"10.10.10.1:2525\"}\n"}]}]}]}]},"navigation":{"title":"relay_force_routing"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"relay_force_routing-plugin"},"children":[{"type":"text","value":"relay_force_routing plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin allows you to force the next hop for the configured domains.\nIt works a lot like the transport map of Postfix."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/relay_dest_domains.ini"}]},{"type":"text","value":"\nThis config file is shared with relay_acl.js, for the basics see the\ndocumentation provided by plugins/relay_acl.js."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"relay_force_routing.js adds the field \"nexthop\": in the JSON value\nof the domain. The value of \"nexthop\": can be hostname or IP optionally\nfollow by "},{"type":"element","tag":"port","props":{},"children":[]},{"type":"text","value":"."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Example:"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"domains"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\ntest.com = { \"action\": \"continue\", \"nexthop\": \"127.0.0.1:2525\" }"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"You can also define a default relay using the \"any\" domain, which will be\nused if the message's destination domain doesn't match any of the domains\nalready defined."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Example:"}]}]},{"type":"element","tag":"code","props":{"code":"        [domains]  \n        test.com = { \"action\": \"continue\", \"nexthop\": \"127.0.0.1:2525\" }\n        my.test.com = { \"action\": \"continue\", \"nexthop\": \"127.0.0.1:2527\" }\n        any = { \"action\": \"continue\", \"nexthop\": \"10.10.10.1:2525\"}\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"        [domains]  \n        test.com = { \"action\": \"continue\", \"nexthop\": \"127.0.0.1:2525\" }\n        my.test.com = { \"action\": \"continue\", \"nexthop\": \"127.0.0.1:2527\" }\n        any = { \"action\": \"continue\", \"nexthop\": \"10.10.10.1:2525\"}"}]}]}]}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"configuration","depth":2,"text":"Configuration"}]}},"_type":"markdown","_id":"content:8.plugins:relay_force_routing.md","_source":"content","_file":"8.plugins/relay_force_routing.md","_extension":"md"},{"_path":"/plugins/relay","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"relay - Relay outbound mail","description":"Haraka relay plugin - Relay outbound mail","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"relay-plugin"},"children":[{"type":"text","value":"relay plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://en.wikipedia.org/wiki/Mail_transfer_agent","rel":["nofollow"]},"children":[{"type":"text","value":"MTAs"}]},{"type":"text","value":" generally only accept mail for "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"local"}]},{"type":"text","value":" domains they can deliver to. In Haraka, the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"rcpt_to.*"}]},{"type":"text","value":" plugins usually decide which domains and/or email addresses are deliverable. By default, everything else is rejected."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Relaying"}]},{"type":"text","value":" is when a MTA accepts mail that is destined elsewhere. Back in the day (1980s), most MTAs permitted open relaying. Soon spammers abused our open relays (1990s) and left us with soiled mail queues. Now nearly all MTAs have relaying disabled and "},{"type":"element","tag":"a","props":{"href":"http://en.wikipedia.org/wiki/Mail_user_agent","rel":["nofollow"]},"children":[{"type":"text","value":"MUAs"}]},{"type":"text","value":" are required to use a "},{"type":"element","tag":"a","props":{"href":"http://en.wikipedia.org/wiki/Message_submission_agent","rel":["nofollow"]},"children":[{"type":"text","value":"MSA"}]},{"type":"text","value":" to relay. Most MTAs (including Haraka) have MSA features and can serve both purposes."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"relay"}]},{"type":"text","value":" plugin provides Haraka with options for managing relay permissions."}]},{"type":"element","tag":"h2","props":{"id":"authentication"},"children":[{"type":"text","value":"Authentication"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"One way to enable relaying is "},{"type":"element","tag":"a","props":{"href":"http://haraka.github.io/manual.html","rel":["nofollow"]},"children":[{"type":"text","value":"authentication"}]},{"type":"text","value":" via the auth plugins. Successful authentication enables relaying during "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"that"}]},{"type":"text","value":" SMTP connection. To securely offer SMTP AUTH, the "},{"type":"element","tag":"a","props":{"href":"http://haraka.github.io/manual/plugins/tls.html","rel":["nofollow"]},"children":[{"type":"text","value":"tls"}]},{"type":"text","value":" plugin and at least one auth plugin must be enabled and properly configured. When that requirement is met, the AUTH SMTP extension will be advertised to SMTP clients."}]},{"type":"element","tag":"code","props":{"code":"% nc mail.example.com 587\n220 mail.example.com ESMTP Haraka 2.4.0 ready\nehlo client.example.com\n250-mail.example.com Hello client.example.com [192.168.0.1], Haraka is at your service.\n250-PIPELINING\n250-8BITMIME\n250-SIZE 10000000\n250 STARTTLS\nquit\n221 mail.example.com closing connection. Have a jolly good day.\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"% nc mail.example.com 587\n220 mail.example.com ESMTP Haraka 2.4.0 ready\nehlo client.example.com\n250-mail.example.com Hello client.example.com [192.168.0.1], Haraka is at your service.\n250-PIPELINING\n250-8BITMIME\n250-SIZE 10000000\n250 STARTTLS\nquit\n221 mail.example.com closing connection. Have a jolly good day.\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Notice that there's no AUTH advertised. We only permit authentication when the\nconnection is secured with TLS:"}]},{"type":"element","tag":"code","props":{"code":"% openssl s_client -connect mail.example.com:587 -starttls smtp\nCONNECTED(00000003)\n<snip long SSL certificate details>\n---\n250 STARTTLS\nehlo client.example.com\n250-mail.example.com Hello client.example.com [192.168.1.1], Haraka is at your service.\n250-PIPELINING\n250-8BITMIME\n250-SIZE 10000000\n250 AUTH PLAIN LOGIN\nquit\n221 mail.example.com closing connection. Have a jolly good day.\nclosed\n","language":"text"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"% openssl s_client -connect mail.example.com:587 -starttls smtp\nCONNECTED(00000003)\n<snip long SSL certificate details>\n---\n250 STARTTLS\nehlo client.example.com\n250-mail.example.com Hello client.example.com [192.168.1.1], Haraka is at your service.\n250-PIPELINING\n250-8BITMIME\n250-SIZE 10000000\n250 AUTH PLAIN LOGIN\nquit\n221 mail.example.com closing connection. Have a jolly good day.\nclosed\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To avoid port 25 restrictions, in 1998 we developed "},{"type":"element","tag":"a","props":{"href":"http://tools.ietf.org/html/rfc2476","rel":["nofollow"]},"children":[{"type":"text","value":"SMTP submission"}]},{"type":"text","value":" on port 587. As of January 2018, "},{"type":"element","tag":"a","props":{"href":"https://tools.ietf.org/html/rfc8314","rel":["nofollow"]},"children":[{"type":"text","value":"RFC 8314"}]},{"type":"text","value":" resurrects "},{"type":"element","tag":"a","props":{"href":"https://en.wikipedia.org/wiki/SMTPS","rel":["nofollow"]},"children":[{"type":"text","value":"SMTPS"}]},{"type":"text","value":" on port 465 in favor of port 587 with STARTTLS. For optimal security and reliability, "},{"type":"element","tag":"a","props":{"href":"http://en.wikipedia.org/wiki/Mail_user_agent","rel":["nofollow"]},"children":[{"type":"text","value":"MUAs"}]},{"type":"text","value":" should be configured to send mail to port 465 with TLS."}]},{"type":"element","tag":"h2","props":{"id":"acl-access-control-list"},"children":[{"type":"text","value":"ACL (Access Control List)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"ACL processing is enabled by setting acl=true in the "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"relay"}]},{"type":"text","value":" section of\nrelay.ini:"}]},{"type":"element","tag":"code","props":{"code":"[relay]\nacl=true\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"[relay]\nacl=true\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"With the Access Control List feature, relaying can be enabled for IPv4 and\nIPv6 networks. IP ranges listed in the ACL file are allowed to send mails\nwithout furthur checks."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/relay_acl_allow"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Allowed IP ranges in CIDR notation, one per line."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Back in the day, ISPs enabled all of their IP space to relay. That proved\nproblematic for users who took their laptops and mobile phones elsewhere and\nthen couldn't send mail. For end users therefore, use SMTP AUTH described\nabove. If you reside somewhere technology evolves more slowly, you can still\nadd IP allocations to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"relay_acl_allow"}]},{"type":"text","value":" like so:"}]},{"type":"element","tag":"code","props":{"code":"echo 'N.N.N.N/24' >> /path/to/haraka/config/relay_acl_allow\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"echo 'N.N.N.N/24' >> /path/to/haraka/config/relay_acl_allow\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A common use case for IP based relaying is to relay messages on behalf of\nanother mail server. If your organization has an Exchange server, using Haraka\nto filter inbound messages is a great choice. You might also want to relay\noutbound messages via Haraka as well, so they can be DKIM signed on their way\nto the internet. For such a use case, you would set 'acl=true' (the default)\nin the "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"relay"}]},{"type":"text","value":" section of "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"relay.ini"}]},{"type":"text","value":" and then add the external IP address\nof the corporate firewall to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/relay_acl_allow"}]},{"type":"text","value":":"}]},{"type":"element","tag":"code","props":{"code":"echo 'N.N.N.N/32' >> /path/to/haraka/config/relay_acl_allow\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"echo 'N.N.N.N/32' >> /path/to/haraka/config/relay_acl_allow\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"force-route-destination-domains"},"children":[{"type":"text","value":"Force Route / Dest"},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"ination"}]},{"type":"text","value":" Domains"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Force routes and Destination Domains are enabled by setting in the "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"relay"}]},{"type":"text","value":"\nsection of relay.ini:"}]},{"type":"element","tag":"code","props":{"code":"[relay]\nforce_routing=false  (default: false)\ndest_domains=false   (default: false)\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"[relay]\nforce_routing=false  (default: false)\ndest_domains=false   (default: false)\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"These two features share another common config file:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/relay_dest_domains.ini"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The format is ini and entries are within the "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"domains"}]},{"type":"text","value":" section. The key for each entry is the domain and the value is a JSON string. Within the JSON string, the currently supported keys are:"}]},{"type":"element","tag":"code","props":{"code":"* action  (Dest Domains)\n* nexthop (Force Route)\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"* action  (Dest Domains)\n* nexthop (Force Route)\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"force-route"},"children":[{"type":"text","value":"Force Route"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Think of force route as the equivalent of the transport map in Postfix or the smtproutes file in Qmail. Rather than looking up the MX for a host, the "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"nexthop"}]},{"type":"text","value":" value from the entry in the config file is used."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The value of \"nexthop\": can be a hostname or an IP, optionally follow by "},{"type":"element","tag":"port","props":{},"children":[]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Example:"}]},{"type":"element","tag":"code","props":{"code":"[domains]\ntest.com = { \"action\": \"continue\", \"nexthop\": \"127.0.0.1:2525\" }\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"[domains]\ntest.com = { \"action\": \"continue\", \"nexthop\": \"127.0.0.1:2525\" }\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"destination-domains"},"children":[{"type":"text","value":"Destination Domains"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Allowed destination/recipient domains. The field within the JSON value used\nby Dest Domains is \"action\": and the possible values are accept, continue, or\ndeny."}]},{"type":"element","tag":"code","props":{"code":"* accept   (accept the mail without further checks)\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"* accept   (accept the mail without further checks)\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Example:"}]},{"type":"element","tag":"code","props":{"code":"[domains]\ntest.com = { \"action\": \"accept\" }\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"[domains]\ntest.com = { \"action\": \"accept\" }\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I think of "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"accept"}]},{"type":"text","value":" as the equivalent of qmail's "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"rcpthosts"}]},{"type":"text","value":", or a misplaced Haraka "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"rcpt_to.*"}]},{"type":"text","value":" plugin. The "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"accept"}]},{"type":"text","value":" mechanism is another way to tell Haraka that a particular domain is one we accept mail for. The difference between this and the "},{"type":"element","tag":"a","props":{"href":"http://haraka.github.io/manual/plugins/rcpt_to.in_host_list.html","rel":["nofollow"]},"children":[{"type":"text","value":"rcpt_to.in_host_list"}]},{"type":"text","value":" plugin is that this one also enables relaying."}]},{"type":"element","tag":"code","props":{"code":"* continue (mails are subject to further checks)\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"* continue (mails are subject to further checks)\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Example:"}]},{"type":"element","tag":"code","props":{"code":"[domains]\ntest.com = { \"action\": \"continue\" }\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"[domains]\ntest.com = { \"action\": \"continue\" }\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Because the default behavior of Dest Routes is to deny, the "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"continue"}]},{"type":"text","value":" option provides an escape, permitting another Haraka plugin to validate the recipient. Like the "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"accept"}]},{"type":"text","value":" option, it too enables relaying."}]},{"type":"element","tag":"code","props":{"code":"* deny    (mails are rejected)\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"* deny    (mails are rejected)\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This deny option baffles me. The default behavior of Haraka is to reject emails for\nwhich a recipient validation plugin hasn't vouched. Adding it here prevents\nany subsequent recipient validation plugin from getting a chance. It also\nnecessitates the continue option."}]},{"type":"element","tag":"h2","props":{"id":"all"},"children":[{"type":"text","value":"all"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Relay all is enabled by setting all=true in the "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"relay"}]},{"type":"text","value":" section of\nrelay.ini:"}]},{"type":"element","tag":"code","props":{"code":"[relay]\nall=true     (default: false)\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"[relay]\nall=true     (default: false)\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Relay all is useful for spamtraps to accept all mail."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Do NOT use this on a real mail server, unless you really know what you are\ndoing. If you use the all feature with anything that relays mail (such\nas forwarding to a real mail server, or the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"deliver"}]},{"type":"text","value":" plugin), your mail\nserver is now an open relay."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This is BAD. Hence the big letters. In short: DO NOT USE THIS FEATURE."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It is useful for testing and spamtraps, hence its presence."}]}]},"navigation":{"title":"relay"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"relay-plugin"},"children":[{"type":"text","value":"relay plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://en.wikipedia.org/wiki/Mail_transfer_agent","rel":["nofollow"]},"children":[{"type":"text","value":"MTAs"}]},{"type":"text","value":" generally only accept mail for "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"local"}]},{"type":"text","value":" domains they can deliver to. In Haraka, the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"rcpt_to.*"}]},{"type":"text","value":" plugins usually decide which domains and/or email addresses are deliverable. By default, everything else is rejected."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Relaying"}]},{"type":"text","value":" is when a MTA accepts mail that is destined elsewhere. Back in the day (1980s), most MTAs permitted open relaying. Soon spammers abused our open relays (1990s) and left us with soiled mail queues. Now nearly all MTAs have relaying disabled and "},{"type":"element","tag":"a","props":{"href":"http://en.wikipedia.org/wiki/Mail_user_agent","rel":["nofollow"]},"children":[{"type":"text","value":"MUAs"}]},{"type":"text","value":" are required to use a "},{"type":"element","tag":"a","props":{"href":"http://en.wikipedia.org/wiki/Message_submission_agent","rel":["nofollow"]},"children":[{"type":"text","value":"MSA"}]},{"type":"text","value":" to relay. Most MTAs (including Haraka) have MSA features and can serve both purposes."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"relay"}]},{"type":"text","value":" plugin provides Haraka with options for managing relay permissions."}]},{"type":"element","tag":"h2","props":{"id":"authentication"},"children":[{"type":"text","value":"Authentication"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"One way to enable relaying is "},{"type":"element","tag":"a","props":{"href":"http://haraka.github.io/manual.html","rel":["nofollow"]},"children":[{"type":"text","value":"authentication"}]},{"type":"text","value":" via the auth plugins. Successful authentication enables relaying during "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"that"}]},{"type":"text","value":" SMTP connection. To securely offer SMTP AUTH, the "},{"type":"element","tag":"a","props":{"href":"http://haraka.github.io/manual/plugins/tls.html","rel":["nofollow"]},"children":[{"type":"text","value":"tls"}]},{"type":"text","value":" plugin and at least one auth plugin must be enabled and properly configured. When that requirement is met, the AUTH SMTP extension will be advertised to SMTP clients."}]},{"type":"element","tag":"code","props":{"code":"% nc mail.example.com 587\n220 mail.example.com ESMTP Haraka 2.4.0 ready\nehlo client.example.com\n250-mail.example.com Hello client.example.com [192.168.0.1], Haraka is at your service.\n250-PIPELINING\n250-8BITMIME\n250-SIZE 10000000\n250 STARTTLS\nquit\n221 mail.example.com closing connection. Have a jolly good day.\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"% nc mail.example.com 587\n220 mail.example.com ESMTP Haraka 2.4.0 ready\nehlo client.example.com\n250-mail.example.com Hello client.example.com [192.168.0.1], Haraka is at your service.\n250-PIPELINING\n250-8BITMIME\n250-SIZE 10000000\n250 STARTTLS\nquit\n221 mail.example.com closing connection. Have a jolly good day."}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Notice that there's no AUTH advertised. We only permit authentication when the\nconnection is secured with TLS:"}]},{"type":"element","tag":"code","props":{"code":"% openssl s_client -connect mail.example.com:587 -starttls smtp\nCONNECTED(00000003)\n<snip long SSL certificate details>\n---\n250 STARTTLS\nehlo client.example.com\n250-mail.example.com Hello client.example.com [192.168.1.1], Haraka is at your service.\n250-PIPELINING\n250-8BITMIME\n250-SIZE 10000000\n250 AUTH PLAIN LOGIN\nquit\n221 mail.example.com closing connection. Have a jolly good day.\nclosed\n","language":"text"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"% openssl s_client -connect mail.example.com:587 -starttls smtp\nCONNECTED(00000003)\n<snip long SSL certificate details>\n---\n250 STARTTLS\nehlo client.example.com\n250-mail.example.com Hello client.example.com [192.168.1.1], Haraka is at your service.\n250-PIPELINING\n250-8BITMIME\n250-SIZE 10000000\n250 AUTH PLAIN LOGIN\nquit\n221 mail.example.com closing connection. Have a jolly good day.\nclosed"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To avoid port 25 restrictions, in 1998 we developed "},{"type":"element","tag":"a","props":{"href":"http://tools.ietf.org/html/rfc2476","rel":["nofollow"]},"children":[{"type":"text","value":"SMTP submission"}]},{"type":"text","value":" on port 587. As of January 2018, "},{"type":"element","tag":"a","props":{"href":"https://tools.ietf.org/html/rfc8314","rel":["nofollow"]},"children":[{"type":"text","value":"RFC 8314"}]},{"type":"text","value":" resurrects "},{"type":"element","tag":"a","props":{"href":"https://en.wikipedia.org/wiki/SMTPS","rel":["nofollow"]},"children":[{"type":"text","value":"SMTPS"}]},{"type":"text","value":" on port 465 in favor of port 587 with STARTTLS. For optimal security and reliability, "},{"type":"element","tag":"a","props":{"href":"http://en.wikipedia.org/wiki/Mail_user_agent","rel":["nofollow"]},"children":[{"type":"text","value":"MUAs"}]},{"type":"text","value":" should be configured to send mail to port 465 with TLS."}]},{"type":"element","tag":"h2","props":{"id":"acl-access-control-list"},"children":[{"type":"text","value":"ACL (Access Control List)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"ACL processing is enabled by setting acl=true in the "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"relay"}]},{"type":"text","value":" section of\nrelay.ini:"}]},{"type":"element","tag":"code","props":{"code":"[relay]\nacl=true\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"[relay]\nacl=true"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"With the Access Control List feature, relaying can be enabled for IPv4 and\nIPv6 networks. IP ranges listed in the ACL file are allowed to send mails\nwithout furthur checks."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/relay_acl_allow"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Allowed IP ranges in CIDR notation, one per line."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Back in the day, ISPs enabled all of their IP space to relay. That proved\nproblematic for users who took their laptops and mobile phones elsewhere and\nthen couldn't send mail. For end users therefore, use SMTP AUTH described\nabove. If you reside somewhere technology evolves more slowly, you can still\nadd IP allocations to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"relay_acl_allow"}]},{"type":"text","value":" like so:"}]},{"type":"element","tag":"code","props":{"code":"echo 'N.N.N.N/24' >> /path/to/haraka/config/relay_acl_allow\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"echo 'N.N.N.N/24' >> /path/to/haraka/config/relay_acl_allow"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A common use case for IP based relaying is to relay messages on behalf of\nanother mail server. If your organization has an Exchange server, using Haraka\nto filter inbound messages is a great choice. You might also want to relay\noutbound messages via Haraka as well, so they can be DKIM signed on their way\nto the internet. For such a use case, you would set 'acl=true' (the default)\nin the "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"relay"}]},{"type":"text","value":" section of "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"relay.ini"}]},{"type":"text","value":" and then add the external IP address\nof the corporate firewall to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/relay_acl_allow"}]},{"type":"text","value":":"}]},{"type":"element","tag":"code","props":{"code":"echo 'N.N.N.N/32' >> /path/to/haraka/config/relay_acl_allow\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"echo 'N.N.N.N/32' >> /path/to/haraka/config/relay_acl_allow"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"force-route-destination-domains"},"children":[{"type":"text","value":"Force Route / Dest"},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"ination"}]},{"type":"text","value":" Domains"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Force routes and Destination Domains are enabled by setting in the "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"relay"}]},{"type":"text","value":"\nsection of relay.ini:"}]},{"type":"element","tag":"code","props":{"code":"[relay]\nforce_routing=false  (default: false)\ndest_domains=false   (default: false)\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"[relay]\nforce_routing=false  (default: false)\ndest_domains=false   (default: false)"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"These two features share another common config file:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/relay_dest_domains.ini"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The format is ini and entries are within the "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"domains"}]},{"type":"text","value":" section. The key for each entry is the domain and the value is a JSON string. Within the JSON string, the currently supported keys are:"}]},{"type":"element","tag":"code","props":{"code":"* action  (Dest Domains)\n* nexthop (Force Route)\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"* action  (Dest Domains)\n* nexthop (Force Route)"}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"force-route"},"children":[{"type":"text","value":"Force Route"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Think of force route as the equivalent of the transport map in Postfix or the smtproutes file in Qmail. Rather than looking up the MX for a host, the "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"nexthop"}]},{"type":"text","value":" value from the entry in the config file is used."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The value of \"nexthop\": can be a hostname or an IP, optionally follow by "},{"type":"element","tag":"port","props":{},"children":[]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Example:"}]},{"type":"element","tag":"code","props":{"code":"[domains]\ntest.com = { \"action\": \"continue\", \"nexthop\": \"127.0.0.1:2525\" }\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"[domains]\ntest.com = { \"action\": \"continue\", \"nexthop\": \"127.0.0.1:2525\" }"}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"destination-domains"},"children":[{"type":"text","value":"Destination Domains"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Allowed destination/recipient domains. The field within the JSON value used\nby Dest Domains is \"action\": and the possible values are accept, continue, or\ndeny."}]},{"type":"element","tag":"code","props":{"code":"* accept   (accept the mail without further checks)\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"* accept   (accept the mail without further checks)"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Example:"}]},{"type":"element","tag":"code","props":{"code":"[domains]\ntest.com = { \"action\": \"accept\" }\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"[domains]\ntest.com = { \"action\": \"accept\" }"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I think of "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"accept"}]},{"type":"text","value":" as the equivalent of qmail's "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"rcpthosts"}]},{"type":"text","value":", or a misplaced Haraka "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"rcpt_to.*"}]},{"type":"text","value":" plugin. The "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"accept"}]},{"type":"text","value":" mechanism is another way to tell Haraka that a particular domain is one we accept mail for. The difference between this and the "},{"type":"element","tag":"a","props":{"href":"http://haraka.github.io/manual/plugins/rcpt_to.in_host_list.html","rel":["nofollow"]},"children":[{"type":"text","value":"rcpt_to.in_host_list"}]},{"type":"text","value":" plugin is that this one also enables relaying."}]},{"type":"element","tag":"code","props":{"code":"* continue (mails are subject to further checks)\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"* continue (mails are subject to further checks)"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Example:"}]},{"type":"element","tag":"code","props":{"code":"[domains]\ntest.com = { \"action\": \"continue\" }\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"[domains]\ntest.com = { \"action\": \"continue\" }"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Because the default behavior of Dest Routes is to deny, the "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"continue"}]},{"type":"text","value":" option provides an escape, permitting another Haraka plugin to validate the recipient. Like the "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"accept"}]},{"type":"text","value":" option, it too enables relaying."}]},{"type":"element","tag":"code","props":{"code":"* deny    (mails are rejected)\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"* deny    (mails are rejected)"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This deny option baffles me. The default behavior of Haraka is to reject emails for\nwhich a recipient validation plugin hasn't vouched. Adding it here prevents\nany subsequent recipient validation plugin from getting a chance. It also\nnecessitates the continue option."}]},{"type":"element","tag":"h2","props":{"id":"all"},"children":[{"type":"text","value":"all"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Relay all is enabled by setting all=true in the "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"relay"}]},{"type":"text","value":" section of\nrelay.ini:"}]},{"type":"element","tag":"code","props":{"code":"[relay]\nall=true     (default: false)\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"[relay]\nall=true     (default: false)"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Relay all is useful for spamtraps to accept all mail."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Do NOT use this on a real mail server, unless you really know what you are\ndoing. If you use the all feature with anything that relays mail (such\nas forwarding to a real mail server, or the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"deliver"}]},{"type":"text","value":" plugin), your mail\nserver is now an open relay."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This is BAD. Hence the big letters. In short: DO NOT USE THIS FEATURE."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It is useful for testing and spamtraps, hence its presence."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"authentication","depth":2,"text":"Authentication"},{"id":"acl-access-control-list","depth":2,"text":"ACL (Access Control List)"},{"id":"force-route-destination-domains","depth":2,"text":"Force Route / Destination Domains","children":[{"id":"force-route","depth":3,"text":"Force Route"},{"id":"destination-domains","depth":3,"text":"Destination Domains"}]},{"id":"all","depth":2,"text":"all"}]}},"_type":"markdown","_id":"content:8.plugins:relay.md","_source":"content","_file":"8.plugins/relay.md","_extension":"md"},{"_path":"/plugins/reseed_rng","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"reseed_rng - Reseed the random number generator","description":"Haraka reseed_rng plugin - Reseed the random number generator","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"reseed-rng-plugin"},"children":[{"type":"text","value":"Reseed RNG plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The V8 that ships with node 0.4.x uses an unsophisticated method of\nseeding its random number generator- it simply uses the current time\nin ms.  Worse, that version of V8 (at least) doesn't provide a way\nto explicitly reseed the RNG."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In situations where multiple processes can spawn in the same\nms, processes can be seeded with the same value, leading to bad\nproblems like UUID collisions. When using the 'cluster' module, it's\nquite easy to observe this behavior."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin uses David Bao's reseed.js (see "},{"type":"element","tag":"a","props":{"href":"http://davidbau.com/archives/2010/01/30/random_seeds_coded_hints_and_quintillions.html","rel":["nofollow"]},"children":[{"type":"text","value":"http://davidbau.com/archives/2010/01/30/random_seeds_coded_hints_and_quintillions.html"}]},{"type":"text","value":")\nto provide a reseedable Math.random(), and hooks the init_child event\nto reseed the RNG with a sligtly better seed at spawned-process startup\ntime."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"All users of the 'cluster' module should consider using this plugin."}]}]},"navigation":{"title":"reseed_rng"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"reseed-rng-plugin"},"children":[{"type":"text","value":"Reseed RNG plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The V8 that ships with node 0.4.x uses an unsophisticated method of\nseeding its random number generator- it simply uses the current time\nin ms.  Worse, that version of V8 (at least) doesn't provide a way\nto explicitly reseed the RNG."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In situations where multiple processes can spawn in the same\nms, processes can be seeded with the same value, leading to bad\nproblems like UUID collisions. When using the 'cluster' module, it's\nquite easy to observe this behavior."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin uses David Bao's reseed.js (see "},{"type":"element","tag":"a","props":{"href":"http://davidbau.com/archives/2010/01/30/random_seeds_coded_hints_and_quintillions.html","rel":["nofollow"]},"children":[{"type":"text","value":"http://davidbau.com/archives/2010/01/30/random_seeds_coded_hints_and_quintillions.html"}]},{"type":"text","value":")\nto provide a reseedable Math.random(), and hooks the init_child event\nto reseed the RNG with a sligtly better seed at spawned-process startup\ntime."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"All users of the 'cluster' module should consider using this plugin."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:8.plugins:reseed_rng.md","_source":"content","_file":"8.plugins/reseed_rng.md","_extension":"md"},{"_path":"/plugins/rspamd","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"rspamd - Rspamd plugin","description":"Haraka rspamd plugin - Rspamd plugin","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"rspamd-plugin"},"children":[{"type":"text","value":"Rspamd plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin facilitates scanning messages with Rspamd."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"rspamd.ini"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"host"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: localhost"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Host to connect to to query Rspamd."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"port"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: 11333"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Port Rspamd is listening on."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"add_headers"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: sometimes"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Possible values are:"},{"type":"element","tag":"code","props":{"code":"  \"always\" - always add headers\n  \"never\" - never add headers (unless provided by rspamd - see rmilter\\_headers)\n  \"sometimes\" - add headers when rspamd recommends `add header` action\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"  \"always\" - always add headers\n  \"never\" - never add headers (unless provided by rspamd - see rmilter\\_headers)\n  \"sometimes\" - add headers when rspamd recommends `add header` action\n"}]}]}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Format of these headers is governed by header.* settings"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"reject.message"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: Detected as spam"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Message to send when rejecting mail due to Rspamd policy recommendation."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"reject.spam"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: true"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If set to false, ignore recommended "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"reject"}]},{"type":"text","value":" action from Rspamd (except\nfor authenticated users)."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"reject.authenticated"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: false"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Reject messages from authenticated users if Rspamd recommends "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"reject"}]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"check.authenticated"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: false"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If true, messages from authenticated users will not be scanned by Rspamd."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"check.private_ip"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: false"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If false, messages from private IPs will not be scanned by Rspamd.\nIf true, messages from private IPs will be scanned by Rspamd."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"dkim.enabled"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: true"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If set to true, allow rspamd to add DKIM signatures to messages."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"header.bar"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: undefined"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If set, add a visual spam level in a header with this name."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"header.report"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: undefined"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If set, add information about symbols matched & their scores in a header\nwith this name."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"header.score"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: undefined"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If set, add the numeric spam score in a header with this name."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"rmilter_headers.enabled"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: true"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If set to true, allow rspamd to add/remove headers to messages via "},{"type":"element","tag":"a","props":{"href":"https://rspamd.com/doc/lua/task.html#me7351","rel":["nofollow"]},"children":[{"type":"text","value":"task:rmilter_set_reply()"}]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"soft_reject.enabled"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: true"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If set to true, allow rspamd to defer messages."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"soft_reject.message"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: Deferred by policy"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Message to send to remote server on rspamd soft rejection."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"spambar.positive"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: +"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Used as character for visual spam-level where score is positive."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"spambar.negative"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: -"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Used as character for visual spam-level where score is negative."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"spambar.neutral"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: /"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Used as character for visual spam-level where score is zero."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"timeout (in seconds)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: 29 seconds"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"How long to wait for a response from rspamd."}]}]}]},"navigation":{"title":"rspamd"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"rspamd-plugin"},"children":[{"type":"text","value":"Rspamd plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin facilitates scanning messages with Rspamd."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"rspamd.ini"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"host"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: localhost"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Host to connect to to query Rspamd."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"port"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: 11333"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Port Rspamd is listening on."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"add_headers"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: sometimes"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Possible values are:"},{"type":"element","tag":"code","props":{"code":"  \"always\" - always add headers\n  \"never\" - never add headers (unless provided by rspamd - see rmilter\\_headers)\n  \"sometimes\" - add headers when rspamd recommends `add header` action\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"  \"always\" - always add headers\n  \"never\" - never add headers (unless provided by rspamd - see rmilter\\_headers)\n  \"sometimes\" - add headers when rspamd recommends `add header` action"}]}]}]}]}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Format of these headers is governed by header.* settings"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"reject.message"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: Detected as spam"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Message to send when rejecting mail due to Rspamd policy recommendation."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"reject.spam"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: true"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If set to false, ignore recommended "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"reject"}]},{"type":"text","value":" action from Rspamd (except\nfor authenticated users)."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"reject.authenticated"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: false"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Reject messages from authenticated users if Rspamd recommends "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"reject"}]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"check.authenticated"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: false"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If true, messages from authenticated users will not be scanned by Rspamd."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"check.private_ip"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: false"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If false, messages from private IPs will not be scanned by Rspamd.\nIf true, messages from private IPs will be scanned by Rspamd."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"dkim.enabled"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: true"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If set to true, allow rspamd to add DKIM signatures to messages."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"header.bar"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: undefined"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If set, add a visual spam level in a header with this name."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"header.report"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: undefined"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If set, add information about symbols matched & their scores in a header\nwith this name."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"header.score"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: undefined"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If set, add the numeric spam score in a header with this name."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"rmilter_headers.enabled"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: true"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If set to true, allow rspamd to add/remove headers to messages via "},{"type":"element","tag":"a","props":{"href":"https://rspamd.com/doc/lua/task.html#me7351","rel":["nofollow"]},"children":[{"type":"text","value":"task:rmilter_set_reply()"}]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"soft_reject.enabled"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: true"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If set to true, allow rspamd to defer messages."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"soft_reject.message"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: Deferred by policy"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Message to send to remote server on rspamd soft rejection."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"spambar.positive"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: +"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Used as character for visual spam-level where score is positive."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"spambar.negative"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: -"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Used as character for visual spam-level where score is negative."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"spambar.neutral"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: /"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Used as character for visual spam-level where score is zero."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"timeout (in seconds)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: 29 seconds"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"How long to wait for a response from rspamd."}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"configuration","depth":2,"text":"Configuration"}]}},"_type":"markdown","_id":"content:8.plugins:rspamd.md","_source":"content","_file":"8.plugins/rspamd.md","_extension":"md"},{"_path":"/plugins/spamassassin","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"spamassassin - SpamAssassin integration for Haraka","description":"Haraka spamassassin plugin - SpamAssassin integration for Haraka","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"spamassassin-plugin"},"children":[{"type":"text","value":"SpamAssassin plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin implements the spamd protocol and will send messages to\nspamd for scoring."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"spamassassin.ini"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"spamd_socket = [host:port | /path/to/socket]  "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"optional"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: localhost:783"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Host or path to socket where spamd is running."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"spamd_user = [user]   "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"optional"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: default"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Username to pass to spamd.  This is useful when you are running\nspamd with virtual users."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"You can also pass this value in dynamically by setting:"},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"connection.transaction.notes.spamd_user"}]},{"type":"text","value":" in another plugin."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The special username: "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"first-recipient"}]},{"type":"text","value":". The first envelope recipient\nwill be used as the username."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"the special username "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"all-recipients"}]},{"type":"text","value":" may eventually be supported. See\nthe get_spamd_username function in the plugin."}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"max_size = N  "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"optional"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: 500000"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Maximum size of messages (in bytes) to send to spamd.\nMessages over this size will be skipped."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"reject_threshold = N   "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"optional"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: none (do not reject any mail)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"SpamAssassin score at which the mail should be rejected."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"relay_reject_threshold = N  "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"optional"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: none"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"As above, except this threshold only applies to connections\nthat are relays (e.g. AUTH) where connection.relaying = true.\nThis is used to set a "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"lower"}]},{"type":"text","value":" thresold at which to reject mail\nfrom these hosts to prevent sending outbound spam."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If this is not set, then the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"reject_thresold"}]},{"type":"text","value":" value is used."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"munge_subject_threshold = N  "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"optional"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: none (do not munge the subject)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Score at which the subject should be munged (prefixed)."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"subject_prefix = [prefix]   "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"optional"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: *** SPAM ***"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Prefix to use when munging the subject."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"old_headers_action = [rename | drop | keep]   "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"optional"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: rename"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If old X-Spam-* headers are in the email, what do we do with them?"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"rename"}]},{"type":"text","value":" them to X-Old-Spam-*."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"drop"}]},{"type":"text","value":" will delete them."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"keep"}]},{"type":"text","value":" will keep them (new X-Spam-* headers appear lower down in\nthe headers then)."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connect_timeout = N  "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"optional"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: 30"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Time in seconds to wait for a connection to spamd"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"results_timeout = N  "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"optional"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: 300"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Time in seconds to wait for results from spamd"}]}]},{"type":"element","tag":"h1","props":{"id":"check"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"check"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The optional check section can allow skipping SpamAssassin check for remote connection\nmeeting following criteria."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"authenticated"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: true"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If true, messages from authenticated users will be scored."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"private_ip"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: true"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If true, messages from private IPs will be scored."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"local_ip"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: true"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If true, messages from localhost will be scored."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"relay"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: true"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If true, messages that are to be relayed will be scored."}]}]},{"type":"element","tag":"h1","props":{"id":"defer"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"defer"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The optional defer section can allow returning a DENYSOFT status back to the\nclient.  Setting these to true will force the client to retry later in cases where\nspamassassin is not responding properly.  If set to false, then the errors\nwill be ignored and message processing will continue."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"error"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: false"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If true, return DENYSOFT on socket errors"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connect_timeout"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: false"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If true, return DENYSOFT on socket connection timeouts"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"scan_timeout"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: false"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If true, return DENYSOFT on scan timeouts"}]}]},{"type":"element","tag":"h1","props":{"id":"extras"},"children":[{"type":"text","value":"Extras"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A SpamAssassin plugin can be found in the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"contrib"}]},{"type":"text","value":" directory.\nThe "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Haraka.\\[pm|cf\\]"}]},{"type":"text","value":" files should be placed in the SpamAssassin local\nsite rules directory (/etc/mail/spamassassin on Linux), spamd should be\nrestarted and the plugin will make spamd output the Haraka UUID as part\nof its log output to aid debugging when searching the mail logs."}]},{"type":"element","tag":"h2","props":{"id":"changes"},"children":[{"type":"text","value":"Changes"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin now passes the X-Spam-* headers generated by SA through\nunaltered. You can control the presence and appearance of X-Spam-*\nheaders by editing your SpamAssassin config."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The default headers added by SpamAssassin are:"}]},{"type":"element","tag":"code","props":{"code":"add_header all Checker-Version SpamAssassin _VERSION_ (_SUBVERSION_) on _HOSTNAME_\nadd_header spam Flag _YESNOCAPS_\nadd_header all Level _STARS(\\*)_\nadd_header all Status \"_YESNO_, score=_SCORE_ required=_REQD_ tests=_TESTS_ autolearn=_AUTOLEARN_ version=_VERSION_\"\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"add_header all Checker-Version SpamAssassin _VERSION_ (_SUBVERSION_) on _HOSTNAME_\nadd_header spam Flag _YESNOCAPS_\nadd_header all Level _STARS(\\*)_\nadd_header all Status \"_YESNO_, score=_SCORE_ required=_REQD_ tests=_TESTS_ autolearn=_AUTOLEARN_ version=_VERSION_\"\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Other headers options you might find interesting or useful are:"}]},{"type":"element","tag":"code","props":{"code":"add_header all DCC _DCCB_: _DCCR_\nadd_header all Tests _TESTS_\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"add_header all DCC _DCCB_: _DCCR_\nadd_header all Tests _TESTS_\n"}]}]}]}]},"navigation":{"title":"spamassassin"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"spamassassin-plugin"},"children":[{"type":"text","value":"SpamAssassin plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin implements the spamd protocol and will send messages to\nspamd for scoring."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"spamassassin.ini"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"spamd_socket = [host:port | /path/to/socket]  "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"optional"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: localhost:783"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Host or path to socket where spamd is running."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"spamd_user = [user]   "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"optional"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: default"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Username to pass to spamd.  This is useful when you are running\nspamd with virtual users."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"You can also pass this value in dynamically by setting:"},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"connection.transaction.notes.spamd_user"}]},{"type":"text","value":" in another plugin."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The special username: "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"first-recipient"}]},{"type":"text","value":". The first envelope recipient\nwill be used as the username."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"the special username "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"all-recipients"}]},{"type":"text","value":" may eventually be supported. See\nthe get_spamd_username function in the plugin."}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"max_size = N  "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"optional"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: 500000"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Maximum size of messages (in bytes) to send to spamd.\nMessages over this size will be skipped."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"reject_threshold = N   "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"optional"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: none (do not reject any mail)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"SpamAssassin score at which the mail should be rejected."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"relay_reject_threshold = N  "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"optional"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: none"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"As above, except this threshold only applies to connections\nthat are relays (e.g. AUTH) where connection.relaying = true.\nThis is used to set a "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"lower"}]},{"type":"text","value":" thresold at which to reject mail\nfrom these hosts to prevent sending outbound spam."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If this is not set, then the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"reject_thresold"}]},{"type":"text","value":" value is used."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"munge_subject_threshold = N  "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"optional"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: none (do not munge the subject)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Score at which the subject should be munged (prefixed)."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"subject_prefix = [prefix]   "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"optional"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: *** SPAM ***"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Prefix to use when munging the subject."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"old_headers_action = [rename | drop | keep]   "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"optional"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: rename"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If old X-Spam-* headers are in the email, what do we do with them?"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"rename"}]},{"type":"text","value":" them to X-Old-Spam-*."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"drop"}]},{"type":"text","value":" will delete them."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"keep"}]},{"type":"text","value":" will keep them (new X-Spam-* headers appear lower down in\nthe headers then)."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connect_timeout = N  "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"optional"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: 30"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Time in seconds to wait for a connection to spamd"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"results_timeout = N  "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"optional"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: 300"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Time in seconds to wait for results from spamd"}]}]},{"type":"element","tag":"h1","props":{"id":"check"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"check"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The optional check section can allow skipping SpamAssassin check for remote connection\nmeeting following criteria."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"authenticated"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: true"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If true, messages from authenticated users will be scored."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"private_ip"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: true"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If true, messages from private IPs will be scored."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"local_ip"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: true"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If true, messages from localhost will be scored."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"relay"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: true"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If true, messages that are to be relayed will be scored."}]}]},{"type":"element","tag":"h1","props":{"id":"defer"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"defer"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The optional defer section can allow returning a DENYSOFT status back to the\nclient.  Setting these to true will force the client to retry later in cases where\nspamassassin is not responding properly.  If set to false, then the errors\nwill be ignored and message processing will continue."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"error"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: false"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If true, return DENYSOFT on socket errors"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connect_timeout"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: false"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If true, return DENYSOFT on socket connection timeouts"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"scan_timeout"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: false"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If true, return DENYSOFT on scan timeouts"}]}]},{"type":"element","tag":"h1","props":{"id":"extras"},"children":[{"type":"text","value":"Extras"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A SpamAssassin plugin can be found in the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"contrib"}]},{"type":"text","value":" directory.\nThe "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Haraka.\\[pm|cf\\]"}]},{"type":"text","value":" files should be placed in the SpamAssassin local\nsite rules directory (/etc/mail/spamassassin on Linux), spamd should be\nrestarted and the plugin will make spamd output the Haraka UUID as part\nof its log output to aid debugging when searching the mail logs."}]},{"type":"element","tag":"h2","props":{"id":"changes"},"children":[{"type":"text","value":"Changes"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin now passes the X-Spam-* headers generated by SA through\nunaltered. You can control the presence and appearance of X-Spam-*\nheaders by editing your SpamAssassin config."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The default headers added by SpamAssassin are:"}]},{"type":"element","tag":"code","props":{"code":"add_header all Checker-Version SpamAssassin _VERSION_ (_SUBVERSION_) on _HOSTNAME_\nadd_header spam Flag _YESNOCAPS_\nadd_header all Level _STARS(\\*)_\nadd_header all Status \"_YESNO_, score=_SCORE_ required=_REQD_ tests=_TESTS_ autolearn=_AUTOLEARN_ version=_VERSION_\"\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"add_header all Checker-Version SpamAssassin _VERSION_ (_SUBVERSION_) on _HOSTNAME_\nadd_header spam Flag _YESNOCAPS_\nadd_header all Level _STARS(\\*)_\nadd_header all Status \"_YESNO_, score=_SCORE_ required=_REQD_ tests=_TESTS_ autolearn=_AUTOLEARN_ version=_VERSION_\""}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Other headers options you might find interesting or useful are:"}]},{"type":"element","tag":"code","props":{"code":"add_header all DCC _DCCB_: _DCCR_\nadd_header all Tests _TESTS_\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"add_header all DCC _DCCB_: _DCCR_\nadd_header all Tests _TESTS_"}]}]}]}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"configuration","depth":2,"text":"Configuration"},{"id":"changes","depth":2,"text":"Changes"}]}},"_type":"markdown","_id":"content:8.plugins:spamassassin.md","_source":"content","_file":"8.plugins/spamassassin.md","_extension":"md"},{"_path":"/plugins/spf","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"spf - SPF plugin for Haraka","description":"Haraka spf plugin that implements SPF checks","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"spf-plugin"},"children":[{"type":"text","value":"SPF plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin implements RFC 4408 Sender Policy Framework (SPF)\nSee the "},{"type":"element","tag":"a","props":{"href":"http://en.wikipedia.org/wiki/Sender_Policy_Framework","rel":["nofollow"]},"children":[{"type":"text","value":"Wikipedia article on SPF"}]},{"type":"text","value":" for details."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"By default this plugin with only add trace Received-SPF headers to a message.\nTo make it reject mail then you will need to enable the relevant options below.\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[deny]helo_fail"}]},{"type":"text","value":" and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[deny]mfrom_fail"}]},{"type":"text","value":" are the closest match for the intent\nof SPF but you will need to whitelist any hosts forwarding mail from another\ndomain whilst preserving the original return-path."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin uses spf.ini for configuration and the following options are\navailable:"}]},{"type":"element","tag":"code","props":{"code":"[relay]\ncontext=sender   (default: sender)\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"[relay]\ncontext=sender   (default: sender)\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"On connections with relaying privileges (MSA or mail relay), it is often\ndesirable to evaluate SPF from the context of Haraka's public IP(s), in the\nsame fashion the next mail server will evaluate it when we send to them.\nIn that use case, Haraka should use context=myself."}]},{"type":"element","tag":"code","props":{"code":"* context=sender    evaluate SPF based on the sender (connection.remote.ip)\n* context=myself    evaluate SPF based on Haraka's public IP\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"* context=sender    evaluate SPF based on the sender (connection.remote.ip)\n* context=myself    evaluate SPF based on Haraka's public IP\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The rest of the optional settings (disabled by default) permit deferring or\ndenying mail from senders whose SPF fails the checks."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Additional settings allow you to control the small things (defaults are shown):"}]},{"type":"element","tag":"code","props":{"code":"; The lookup timeout, in seconds. Better set it to something much lower than this.\nlookup_timeout = 29\n\n; bypass hosts that match these conditions\n[skip]\n; hosts that relay through us\nrelaying = false\n; hosts that are SMTP AUTH'ed\nauth = false\n","language":"ini"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"; The lookup timeout, in seconds. Better set it to something much lower than this.\nlookup_timeout = 29\n\n; bypass hosts that match these conditions\n[skip]\n; hosts that relay through us\nrelaying = false\n; hosts that are SMTP AUTH'ed\nauth = false\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"There's a special setting that would allow the plugin to emit a funny explanation text on SPF DENY, essentially meant to be visible to end-users that will receive the bounce. The text is "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"http://www.openspf.org/Why?s=${scope}&id=${sender_id}&ip=${connection.remote.ip}"}]},{"type":"text","value":" and is enabled by:"}]},{"type":"element","tag":"code","props":{"code":"[deny]\nopenspf_text = true\n\n; in case you DENY on failing SPF on hosts that are relaying (but why?)\n[deny_relay]\nopenspf_text = true\n","language":"ini"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"[deny]\nopenspf_text = true\n\n; in case you DENY on failing SPF on hosts that are relaying (but why?)\n[deny_relay]\nopenspf_text = true\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"things-to-know"},"children":[{"type":"text","value":"Things to Know"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Most senders do not publish SPF records for their mail server "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"hostname"}]},{"type":"text","value":",\nwhich means that the SPF HELO test rarely passes. During observation in 2014,\nmore spam senders have valid SPF HELO than ham senders. If you expect very\nlittle from SPF HELO validation, you might still be disappointed."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Enabling error deferrals will cause excessive delays and perhaps bounced\nmail for senders with broken DNS. Enable this only if you are willing to\ndelay and sometimes lose valid mail."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Broken SPF records by valid senders are common. Keep that in mind when\nconsidering denial of SPF error results. If you deny on error, budget\ntime for instructing senders on how to correct their SPF records so they\ncan email you."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The only deny option most sites should consider is "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"mfrom_fail"}]},{"type":"text","value":". That will\nreject messages that explicitely fail SPF tests. SPF failures have a high\ncorrelation with spam. However, up to 10% of ham transits forwarders and/or\nemail lists which frequently break SPF. SPF results are best used as inputs\nto other plugins such as DMARC, "},{"type":"element","tag":"a","props":{"href":"http://haraka.github.io/manual/plugins/spamassassin.html","rel":["nofollow"]},"children":[{"type":"text","value":"spamassassin"}]},{"type":"text","value":", and "},{"type":"element","tag":"a","props":{"href":"http://haraka.github.io/manual/plugins/karma.html","rel":["nofollow"]},"children":[{"type":"text","value":"karma"}]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Heed well the implications of SPF, as described in "},{"type":"element","tag":"a","props":{"href":"http://tools.ietf.org/html/rfc4408#section-9.3","rel":["nofollow"]},"children":[{"type":"text","value":"RFC 4408"}]}]}]},{"type":"element","tag":"code","props":{"code":"[defer]\nhelo_temperror\nmfrom_temperror\n\n[deny]\nhelo_none\nhelo_softfail\nhelo_fail\nhelo_permerror\n\nmfrom_none\nmfrom_softfail\nmfrom_fail\nmfrom_permerror\n\nopenspf_text\n\n; SPF settings used when connection.relaying=true\n[defer_relay]\nhelo_temperror\nmfrom_temperror\n\n[deny_relay]\nhelo_none\nhelo_softfail\nhelo_fail\nhelo_permerror\n\nmfrom_none\nmfrom_softfail\nmfrom_fail\nmfrom_permerror\n\nopenspf_text\n","language":"ini"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"[defer]\nhelo_temperror\nmfrom_temperror\n\n[deny]\nhelo_none\nhelo_softfail\nhelo_fail\nhelo_permerror\n\nmfrom_none\nmfrom_softfail\nmfrom_fail\nmfrom_permerror\n\nopenspf_text\n\n; SPF settings used when connection.relaying=true\n[defer_relay]\nhelo_temperror\nmfrom_temperror\n\n[deny_relay]\nhelo_none\nhelo_softfail\nhelo_fail\nhelo_permerror\n\nmfrom_none\nmfrom_softfail\nmfrom_fail\nmfrom_permerror\n\nopenspf_text\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"testing"},"children":[{"type":"text","value":"Testing"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin also provides a command-line test tool that can be used to debug SPF issues or to check results."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To check the SPF record for a domain:"}]},{"type":"element","tag":"code","props":{"code":"# spf --ip 1.2.3.4 --domain fsl.com\nip=1.2.3.4 helo=\"\" domain=\"fsl.com\" result=Fail\n","language":"sh"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"# spf --ip 1.2.3.4 --domain fsl.com\nip=1.2.3.4 helo=\"\" domain=\"fsl.com\" result=Fail\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To check the SPF record for a HELO/EHLO name:"}]},{"type":"element","tag":"code","props":{"code":"# spf --ip 1.2.3.4 --helo foo.bar.com\nip=1.2.3.4 helo=\"foo.bar.com\" domain=\"\" result=None\n","language":"sh"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"# spf --ip 1.2.3.4 --helo foo.bar.com\nip=1.2.3.4 helo=\"foo.bar.com\" domain=\"\" result=None\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can add "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"--debug"}]},{"type":"text","value":" to the option arguments to see a full trace of the SPF processing."}]},{"type":"element","tag":"h3","props":{"id":"spf-resource-record-type"},"children":[{"type":"text","value":"SPF Resource Record Type"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Node does not support the SPF DNS Resource Record type. Only TXT records are\nchecked."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This is a non-issue as < 1% (as of 2014) of SPF records use the SPF RR type.\nDue to lack of adoption, the next SPF revision will like likely deprecate the\nSPF RR type."}]}]},"navigation":{"title":"spf"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"spf-plugin"},"children":[{"type":"text","value":"SPF plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin implements RFC 4408 Sender Policy Framework (SPF)\nSee the "},{"type":"element","tag":"a","props":{"href":"http://en.wikipedia.org/wiki/Sender_Policy_Framework","rel":["nofollow"]},"children":[{"type":"text","value":"Wikipedia article on SPF"}]},{"type":"text","value":" for details."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"By default this plugin with only add trace Received-SPF headers to a message.\nTo make it reject mail then you will need to enable the relevant options below.\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[deny]helo_fail"}]},{"type":"text","value":" and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[deny]mfrom_fail"}]},{"type":"text","value":" are the closest match for the intent\nof SPF but you will need to whitelist any hosts forwarding mail from another\ndomain whilst preserving the original return-path."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin uses spf.ini for configuration and the following options are\navailable:"}]},{"type":"element","tag":"code","props":{"code":"[relay]\ncontext=sender   (default: sender)\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"[relay]\ncontext=sender   (default: sender)"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"On connections with relaying privileges (MSA or mail relay), it is often\ndesirable to evaluate SPF from the context of Haraka's public IP(s), in the\nsame fashion the next mail server will evaluate it when we send to them.\nIn that use case, Haraka should use context=myself."}]},{"type":"element","tag":"code","props":{"code":"* context=sender    evaluate SPF based on the sender (connection.remote.ip)\n* context=myself    evaluate SPF based on Haraka's public IP\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"* context=sender    evaluate SPF based on the sender (connection.remote.ip)\n* context=myself    evaluate SPF based on Haraka's public IP"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The rest of the optional settings (disabled by default) permit deferring or\ndenying mail from senders whose SPF fails the checks."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Additional settings allow you to control the small things (defaults are shown):"}]},{"type":"element","tag":"code","props":{"code":"; The lookup timeout, in seconds. Better set it to something much lower than this.\nlookup_timeout = 29\n\n; bypass hosts that match these conditions\n[skip]\n; hosts that relay through us\nrelaying = false\n; hosts that are SMTP AUTH'ed\nauth = false\n","language":"ini"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5f0a5c"},"children":[{"type":"text","value":"; The lookup timeout, in seconds. Better set it to something much lower than this."}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-4b7a31"},"children":[{"type":"text","value":"lookup_timeout"}]},{"type":"element","tag":"span","props":{"class":"ct-900653"},"children":[{"type":"text","value":" = 29"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5f0a5c"},"children":[{"type":"text","value":"; bypass hosts that match these conditions"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f93e12"},"children":[{"type":"text","value":"[skip]"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5f0a5c"},"children":[{"type":"text","value":"; hosts that relay through us"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-4b7a31"},"children":[{"type":"text","value":"relaying"}]},{"type":"element","tag":"span","props":{"class":"ct-900653"},"children":[{"type":"text","value":" = false"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5f0a5c"},"children":[{"type":"text","value":"; hosts that are SMTP AUTH'ed"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-4b7a31"},"children":[{"type":"text","value":"auth"}]},{"type":"element","tag":"span","props":{"class":"ct-900653"},"children":[{"type":"text","value":" = false"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"There's a special setting that would allow the plugin to emit a funny explanation text on SPF DENY, essentially meant to be visible to end-users that will receive the bounce. The text is "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"http://www.openspf.org/Why?s=${scope}&id=${sender_id}&ip=${connection.remote.ip}"}]},{"type":"text","value":" and is enabled by:"}]},{"type":"element","tag":"code","props":{"code":"[deny]\nopenspf_text = true\n\n; in case you DENY on failing SPF on hosts that are relaying (but why?)\n[deny_relay]\nopenspf_text = true\n","language":"ini"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f93e12"},"children":[{"type":"text","value":"[deny]"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-4b7a31"},"children":[{"type":"text","value":"openspf_text"}]},{"type":"element","tag":"span","props":{"class":"ct-900653"},"children":[{"type":"text","value":" = true"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5f0a5c"},"children":[{"type":"text","value":"; in case you DENY on failing SPF on hosts that are relaying (but why?)"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f93e12"},"children":[{"type":"text","value":"[deny_relay]"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-4b7a31"},"children":[{"type":"text","value":"openspf_text"}]},{"type":"element","tag":"span","props":{"class":"ct-900653"},"children":[{"type":"text","value":" = true"}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"things-to-know"},"children":[{"type":"text","value":"Things to Know"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Most senders do not publish SPF records for their mail server "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"hostname"}]},{"type":"text","value":",\nwhich means that the SPF HELO test rarely passes. During observation in 2014,\nmore spam senders have valid SPF HELO than ham senders. If you expect very\nlittle from SPF HELO validation, you might still be disappointed."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Enabling error deferrals will cause excessive delays and perhaps bounced\nmail for senders with broken DNS. Enable this only if you are willing to\ndelay and sometimes lose valid mail."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Broken SPF records by valid senders are common. Keep that in mind when\nconsidering denial of SPF error results. If you deny on error, budget\ntime for instructing senders on how to correct their SPF records so they\ncan email you."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The only deny option most sites should consider is "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"mfrom_fail"}]},{"type":"text","value":". That will\nreject messages that explicitely fail SPF tests. SPF failures have a high\ncorrelation with spam. However, up to 10% of ham transits forwarders and/or\nemail lists which frequently break SPF. SPF results are best used as inputs\nto other plugins such as DMARC, "},{"type":"element","tag":"a","props":{"href":"http://haraka.github.io/manual/plugins/spamassassin.html","rel":["nofollow"]},"children":[{"type":"text","value":"spamassassin"}]},{"type":"text","value":", and "},{"type":"element","tag":"a","props":{"href":"http://haraka.github.io/manual/plugins/karma.html","rel":["nofollow"]},"children":[{"type":"text","value":"karma"}]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Heed well the implications of SPF, as described in "},{"type":"element","tag":"a","props":{"href":"http://tools.ietf.org/html/rfc4408#section-9.3","rel":["nofollow"]},"children":[{"type":"text","value":"RFC 4408"}]}]}]},{"type":"element","tag":"code","props":{"code":"[defer]\nhelo_temperror\nmfrom_temperror\n\n[deny]\nhelo_none\nhelo_softfail\nhelo_fail\nhelo_permerror\n\nmfrom_none\nmfrom_softfail\nmfrom_fail\nmfrom_permerror\n\nopenspf_text\n\n; SPF settings used when connection.relaying=true\n[defer_relay]\nhelo_temperror\nmfrom_temperror\n\n[deny_relay]\nhelo_none\nhelo_softfail\nhelo_fail\nhelo_permerror\n\nmfrom_none\nmfrom_softfail\nmfrom_fail\nmfrom_permerror\n\nopenspf_text\n","language":"ini"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f93e12"},"children":[{"type":"text","value":"[defer]"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-900653"},"children":[{"type":"text","value":"helo_temperror"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-900653"},"children":[{"type":"text","value":"mfrom_temperror"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f93e12"},"children":[{"type":"text","value":"[deny]"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-900653"},"children":[{"type":"text","value":"helo_none"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-900653"},"children":[{"type":"text","value":"helo_softfail"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-900653"},"children":[{"type":"text","value":"helo_fail"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-900653"},"children":[{"type":"text","value":"helo_permerror"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-900653"},"children":[{"type":"text","value":"mfrom_none"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-900653"},"children":[{"type":"text","value":"mfrom_softfail"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-900653"},"children":[{"type":"text","value":"mfrom_fail"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-900653"},"children":[{"type":"text","value":"mfrom_permerror"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-900653"},"children":[{"type":"text","value":"openspf_text"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5f0a5c"},"children":[{"type":"text","value":"; SPF settings used when connection.relaying=true"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f93e12"},"children":[{"type":"text","value":"[defer_relay]"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-900653"},"children":[{"type":"text","value":"helo_temperror"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-900653"},"children":[{"type":"text","value":"mfrom_temperror"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-f93e12"},"children":[{"type":"text","value":"[deny_relay]"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-900653"},"children":[{"type":"text","value":"helo_none"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-900653"},"children":[{"type":"text","value":"helo_softfail"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-900653"},"children":[{"type":"text","value":"helo_fail"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-900653"},"children":[{"type":"text","value":"helo_permerror"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-900653"},"children":[{"type":"text","value":"mfrom_none"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-900653"},"children":[{"type":"text","value":"mfrom_softfail"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-900653"},"children":[{"type":"text","value":"mfrom_fail"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-900653"},"children":[{"type":"text","value":"mfrom_permerror"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-900653"},"children":[{"type":"text","value":"openspf_text"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"testing"},"children":[{"type":"text","value":"Testing"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin also provides a command-line test tool that can be used to debug SPF issues or to check results."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To check the SPF record for a domain:"}]},{"type":"element","tag":"code","props":{"code":"# spf --ip 1.2.3.4 --domain fsl.com\nip=1.2.3.4 helo=\"\" domain=\"fsl.com\" result=Fail\n","language":"sh"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5f0a5c"},"children":[{"type":"text","value":"# spf --ip 1.2.3.4 --domain fsl.com"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-900653"},"children":[{"type":"text","value":"ip=1.2.3.4 helo="}]},{"type":"element","tag":"span","props":{"class":"ct-e3bc25"},"children":[{"type":"text","value":"\"\""}]},{"type":"element","tag":"span","props":{"class":"ct-900653"},"children":[{"type":"text","value":" domain="}]},{"type":"element","tag":"span","props":{"class":"ct-e3bc25"},"children":[{"type":"text","value":"\"fsl.com\""}]},{"type":"element","tag":"span","props":{"class":"ct-900653"},"children":[{"type":"text","value":" result=Fail"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To check the SPF record for a HELO/EHLO name:"}]},{"type":"element","tag":"code","props":{"code":"# spf --ip 1.2.3.4 --helo foo.bar.com\nip=1.2.3.4 helo=\"foo.bar.com\" domain=\"\" result=None\n","language":"sh"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5f0a5c"},"children":[{"type":"text","value":"# spf --ip 1.2.3.4 --helo foo.bar.com"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-900653"},"children":[{"type":"text","value":"ip=1.2.3.4 helo="}]},{"type":"element","tag":"span","props":{"class":"ct-e3bc25"},"children":[{"type":"text","value":"\"foo.bar.com\""}]},{"type":"element","tag":"span","props":{"class":"ct-900653"},"children":[{"type":"text","value":" domain="}]},{"type":"element","tag":"span","props":{"class":"ct-e3bc25"},"children":[{"type":"text","value":"\"\""}]},{"type":"element","tag":"span","props":{"class":"ct-900653"},"children":[{"type":"text","value":" result=None"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can add "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"--debug"}]},{"type":"text","value":" to the option arguments to see a full trace of the SPF processing."}]},{"type":"element","tag":"h3","props":{"id":"spf-resource-record-type"},"children":[{"type":"text","value":"SPF Resource Record Type"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Node does not support the SPF DNS Resource Record type. Only TXT records are\nchecked."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This is a non-issue as < 1% (as of 2014) of SPF records use the SPF RR type.\nDue to lack of adoption, the next SPF revision will like likely deprecate the\nSPF RR type."}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-e3bc25{color:#0A3069}\n.ct-f93e12{color:#953800}\n.ct-900653{color:#24292F}\n.ct-4b7a31{color:#CF222E}\n.ct-5f0a5c{color:#6E7781}\n.dark .ct-5f0a5c{color:#8B949E}\n.dark .ct-4b7a31{color:#FF7B72}\n.dark .ct-900653{color:#C9D1D9}\n.dark .ct-f93e12{color:#FFA657}\n.dark .ct-e3bc25{color:#A5D6FF}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"configuration","depth":2,"text":"Configuration","children":[{"id":"things-to-know","depth":3,"text":"Things to Know"}]},{"id":"testing","depth":2,"text":"Testing","children":[{"id":"spf-resource-record-type","depth":3,"text":"SPF Resource Record Type"}]}]}},"_type":"markdown","_id":"content:8.plugins:spf.md","_source":"content","_file":"8.plugins/spf.md","_extension":"md"},{"_path":"/plugins/status","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"status - Status plugin","description":"Haraka status plugin that allows you to view the status of your Haraka server","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"status-plugin"},"children":[{"type":"text","value":"Status plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin allows to get internal status of queues and pools with SMTP commands sent from localhost."}]},{"type":"element","tag":"h2","props":{"id":"communication"},"children":[{"type":"text","value":"Communication"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Request"}]},{"type":"text","value":" → "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"STATUS <CMD> [param1] [param2]...."}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Response"}]},{"type":"text","value":" ← "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"<SMTP code 211 or 500><space><json encoded response>\\r\\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"example"},"children":[{"type":"text","value":"Example"}]},{"type":"element","tag":"code","props":{"code":"< 220 example.com ESMTP Haraka ready\n> STATUS QUEUE LIST\n< 211 {\"delivery_queue\":[],\"temp_fail_queue\":[]}\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"< 220 example.com ESMTP Haraka ready\n> STATUS QUEUE LIST\n< 211 {\"delivery_queue\":[],\"temp_fail_queue\":[]}\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"available-commands-list"},"children":[{"type":"text","value":"Available commands list"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"STATUS POOL LIST"}]},{"type":"text","value":" - list of active pools"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"STATUS QUEUE STATS"}]},{"type":"text","value":" - queue statistics in format \"<in_progress>/<delivery_queue length>/<temp_fail_queue length>\""}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"STATUS QUEUE LIST"}]},{"type":"text","value":" - list of parsed queue files with "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"uuid, domain, mail_from, rcpt_to"}]},{"type":"text","value":" attributes"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"STATUS QUEUE INSPECT"}]},{"type":"text","value":" - returns content of "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"outbound.delivery_queue"}]},{"type":"text","value":" and "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"outbound.temp_fail_queue"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"STATUS QUEUE DISCARD file"}]},{"type":"text","value":" - stop delivering email file"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"STATUS QUEUE PUSH file"}]},{"type":"text","value":" - try to re-deliver email immediately"}]}]}]},"navigation":{"title":"status"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"status-plugin"},"children":[{"type":"text","value":"Status plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin allows to get internal status of queues and pools with SMTP commands sent from localhost."}]},{"type":"element","tag":"h2","props":{"id":"communication"},"children":[{"type":"text","value":"Communication"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Request"}]},{"type":"text","value":" → "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"STATUS <CMD> [param1] [param2]...."}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Response"}]},{"type":"text","value":" ← "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"<SMTP code 211 or 500><space><json encoded response>\\r\\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"example"},"children":[{"type":"text","value":"Example"}]},{"type":"element","tag":"code","props":{"code":"< 220 example.com ESMTP Haraka ready\n> STATUS QUEUE LIST\n< 211 {\"delivery_queue\":[],\"temp_fail_queue\":[]}\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"< 220 example.com ESMTP Haraka ready\n> STATUS QUEUE LIST\n< 211 {\"delivery_queue\":[],\"temp_fail_queue\":[]}"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"available-commands-list"},"children":[{"type":"text","value":"Available commands list"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"STATUS POOL LIST"}]},{"type":"text","value":" - list of active pools"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"STATUS QUEUE STATS"}]},{"type":"text","value":" - queue statistics in format \"<in_progress>/<delivery_queue length>/<temp_fail_queue length>\""}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"STATUS QUEUE LIST"}]},{"type":"text","value":" - list of parsed queue files with "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"uuid, domain, mail_from, rcpt_to"}]},{"type":"text","value":" attributes"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"STATUS QUEUE INSPECT"}]},{"type":"text","value":" - returns content of "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"outbound.delivery_queue"}]},{"type":"text","value":" and "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"outbound.temp_fail_queue"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"STATUS QUEUE DISCARD file"}]},{"type":"text","value":" - stop delivering email file"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"STATUS QUEUE PUSH file"}]},{"type":"text","value":" - try to re-deliver email immediately"}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"communication","depth":2,"text":"Communication","children":[{"id":"example","depth":3,"text":"Example"}]},{"id":"available-commands-list","depth":2,"text":"Available commands list"}]}},"_type":"markdown","_id":"content:8.plugins:status.md","_source":"content","_file":"8.plugins/status.md","_extension":"md"},{"_path":"/plugins/tarpit","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"tarpit - Tarpit plugin","description":"Haraka tarpit plugin - Tarpit plugin","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"tarpit-plugin"},"children":[{"type":"text","value":"Tarpit plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin is designed to introduce deliberate delays on the response\nof every hook in order to slow down a connection.  It has no\nconfiguration and is designed to be used only by other plugins."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It must be loaded early in config/plugins (e.g. before any plugins\nthat accept recipients or that return OK) but must be loaded "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"after"}]},{"type":"text","value":"\nany plugins that wish to use it."}]},{"type":"element","tag":"h2","props":{"id":"usage"},"children":[{"type":"text","value":"Usage"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To use this plugin in another plugin set:"}]},{"type":"element","tag":"code","props":{"code":"connection.notes.tarpit = <seconds to delay>;\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"connection.notes.tarpit = <seconds to delay>;\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"or"}]},{"type":"element","tag":"code","props":{"code":"connection.transaction.notes.tarpit = <seconds to delay>;\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"connection.transaction.notes.tarpit = <seconds to delay>;\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The configuration file for tarpit is config/tarpit.ini."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hooks_to_delay - a list of hooks to delay at. This setting can be used to\noverride the default list in the plugin. For example, if you notice that\nmalware is disconnecting after delaying rcpt_ok, you can remove just that\nhook from the list:"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"hooks_to_delay=connect,helo,ehlo,mail,rcpt,data,data_post,queue,unrecognized_command,vrfy,noop,rset,quit"}]},{"type":"element","tag":"h2","props":{"id":"plugin-timeout"},"children":[{"type":"text","value":"Plugin Timeout"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"config/tarpit.timeout (Default: 0)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"All Haraka plugins can configure a "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"name"}]},{"type":"text","value":".timeout file. The timeout specifies\nhow long Haraka lets the plugin do nothing before it times out. When zero,\nthere is no timeout. When non-zero and "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"seconds to delay"}]},{"type":"text","value":" is longer than\ntarpit.timeout (default: 1s), you'll get errors like this in your log files:"}]},{"type":"element","tag":"code","props":{"code":"[core] Plugin tarpit timed out on hook rcpt - make sure it calls the callback\n[core] Plugin tarpit timed out on hook quit - make sure it calls the callback\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"[core] Plugin tarpit timed out on hook rcpt - make sure it calls the callback\n[core] Plugin tarpit timed out on hook quit - make sure it calls the callback\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The solution is to set the contents of config/tarpit.timeout to zero or\n"},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"seconds to delay"}]},{"type":"text","value":" + 1."}]},{"type":"element","tag":"h2","props":{"id":"logging"},"children":[{"type":"text","value":"Logging"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When tarpitting a command it will log 'tarpitting response for Ns' to\nthe INFO facility where N is the number of seconds."}]}]},"navigation":{"title":"tarpit"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"tarpit-plugin"},"children":[{"type":"text","value":"Tarpit plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin is designed to introduce deliberate delays on the response\nof every hook in order to slow down a connection.  It has no\nconfiguration and is designed to be used only by other plugins."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It must be loaded early in config/plugins (e.g. before any plugins\nthat accept recipients or that return OK) but must be loaded "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"after"}]},{"type":"text","value":"\nany plugins that wish to use it."}]},{"type":"element","tag":"h2","props":{"id":"usage"},"children":[{"type":"text","value":"Usage"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To use this plugin in another plugin set:"}]},{"type":"element","tag":"code","props":{"code":"connection.notes.tarpit = <seconds to delay>;\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"connection.notes.tarpit = <seconds to delay>;"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"or"}]},{"type":"element","tag":"code","props":{"code":"connection.transaction.notes.tarpit = <seconds to delay>;\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"connection.transaction.notes.tarpit = <seconds to delay>;"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The configuration file for tarpit is config/tarpit.ini."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hooks_to_delay - a list of hooks to delay at. This setting can be used to\noverride the default list in the plugin. For example, if you notice that\nmalware is disconnecting after delaying rcpt_ok, you can remove just that\nhook from the list:"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"hooks_to_delay=connect,helo,ehlo,mail,rcpt,data,data_post,queue,unrecognized_command,vrfy,noop,rset,quit"}]},{"type":"element","tag":"h2","props":{"id":"plugin-timeout"},"children":[{"type":"text","value":"Plugin Timeout"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"config/tarpit.timeout (Default: 0)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"All Haraka plugins can configure a "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"name"}]},{"type":"text","value":".timeout file. The timeout specifies\nhow long Haraka lets the plugin do nothing before it times out. When zero,\nthere is no timeout. When non-zero and "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"seconds to delay"}]},{"type":"text","value":" is longer than\ntarpit.timeout (default: 1s), you'll get errors like this in your log files:"}]},{"type":"element","tag":"code","props":{"code":"[core] Plugin tarpit timed out on hook rcpt - make sure it calls the callback\n[core] Plugin tarpit timed out on hook quit - make sure it calls the callback\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"[core] Plugin tarpit timed out on hook rcpt - make sure it calls the callback\n[core] Plugin tarpit timed out on hook quit - make sure it calls the callback"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The solution is to set the contents of config/tarpit.timeout to zero or\n"},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"seconds to delay"}]},{"type":"text","value":" + 1."}]},{"type":"element","tag":"h2","props":{"id":"logging"},"children":[{"type":"text","value":"Logging"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When tarpitting a command it will log 'tarpitting response for Ns' to\nthe INFO facility where N is the number of seconds."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"usage","depth":2,"text":"Usage"},{"id":"configuration","depth":2,"text":"Configuration"},{"id":"plugin-timeout","depth":2,"text":"Plugin Timeout"},{"id":"logging","depth":2,"text":"Logging"}]}},"_type":"markdown","_id":"content:8.plugins:tarpit.md","_source":"content","_file":"8.plugins/tarpit.md","_extension":"md"},{"_path":"/plugins/tls","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"tls - TLS support for Haraka","description":"Haraka tls plugin - TLS support for Haraka","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"tls-plugin"},"children":[{"type":"text","value":"TLS plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin enables the use of TLS (via "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"STARTTLS"}]},{"type":"text","value":") in Haraka."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For this plugin to work you must have SSL certificates installed correctly."}]},{"type":"element","tag":"h2","props":{"id":"certificate-files"},"children":[{"type":"text","value":"Certificate Files"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Defaults are shown and can be overridden in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/tls.ini"}]},{"type":"text","value":"."}]},{"type":"element","tag":"code","props":{"code":"key=tls_key.pem\ncert=tls_cert.pem\ndhparam=dhparams.pem\n","language":"ini"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"key=tls_key.pem\ncert=tls_cert.pem\ndhparam=dhparams.pem\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"certificate-directory"},"children":[{"type":"text","value":"Certificate Directory"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If the directory "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/tls"}]},{"type":"text","value":" exists, each file within the directory is expected to be a PEM encoded TLS bundle. Generate the PEM bundles in The Usual Way"},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"TM"}]},{"type":"text","value":" by concatenating the key, certificate, and CA/chain certs in that order. Example:"}]},{"type":"element","tag":"code","props":{"code":"cat example.com.key example.com.crt ca.crt > config/tls/example.com.pem\n","language":"sh"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"cat example.com.key example.com.crt ca.crt > config/tls/example.com.pem\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"An example "},{"type":"element","tag":"a","props":{"href":"https://acme.sh","rel":["nofollow"]},"children":[{"type":"text","value":"acme.sh"}]},{"type":"text","value":" deployment "},{"type":"element","tag":"a","props":{"href":"https://github.com/msimerson/Mail-Toaster-6/blob/master/provision/letsencrypt.sh","rel":["nofollow"]},"children":[{"type":"text","value":"script"}]},{"type":"text","value":" demonstrates how to install "},{"type":"element","tag":"a","props":{"href":"https://letsencrypt.org","rel":["nofollow"]},"children":[{"type":"text","value":"Let's Encrypt"}]},{"type":"text","value":" certificates to the Haraka "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/tls"}]},{"type":"text","value":"directory."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Haraka has "},{"type":"element","tag":"a","props":{"href":"https://en.wikipedia.org/wiki/Server_Name_Indication","rel":["nofollow"]},"children":[{"type":"text","value":"SNI"}]},{"type":"text","value":" support. When the remote MUA/MTA presents a servername during the TLS handshake and a TLS certificate with that Common Name matches, that certificate will be presented. If no match is found, the default certificate (see Certificate Files above) is presented."}]},{"type":"element","tag":"h2","props":{"id":"purchased-certificate"},"children":[{"type":"text","value":"Purchased Certificate"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you have a purchased certificate, append any intermediate/chained/ca-cert\nfiles to the certificate in this order:"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The CA signed SSL cert"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Any intermediate certificates"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The CA root certificate"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"See also "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/wiki/Setting-up-TLS-with-CA-certificates","rel":["nofollow"]},"children":[{"type":"text","value":"Setting Up TLS"}]}]},{"type":"element","tag":"h2","props":{"id":"self-issued-unsigned-certificate"},"children":[{"type":"text","value":"Self Issued (unsigned) Certificate"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Create a certificate and key file in the config directory with the following\ncommand:"}]},{"type":"element","tag":"code","props":{"code":"openssl req -x509 -nodes -days 2190 -newkey rsa:2048 -keyout config/tls_key.pem -out config/tls_cert.pem\n","language":"sh"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"openssl req -x509 -nodes -days 2190 -newkey rsa:2048 -keyout config/tls_key.pem -out config/tls_cert.pem\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You will be prompted to provide details of your organization. Make sure the\nCommon Name is set to your servers Fully Qualified Domain Name, which should\nbe the same as the contents of your "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/me"}]},{"type":"text","value":" file."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The following settings can be specified in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/tls.ini"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h3","props":{"id":"key"},"children":[{"type":"text","value":"key"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Specifies an alternative location for the key file. For multiple keys, use "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"key[]="}]},{"type":"text","value":" assignment for each. Non-absolute paths are relative to the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/"}]},{"type":"text","value":" directory."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To configure a single key and a cert chain, located in the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/"}]},{"type":"text","value":"\ndirectory, use the following in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"tls.ini"}]},{"type":"text","value":":"}]},{"type":"element","tag":"code","props":{"code":"key=example.com.key.pem\ncert=example.com.crt-chain.pem\n","language":"ini"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"key=example.com.key.pem\ncert=example.com.crt-chain.pem\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To use multiple pairs of key and cert chain files outside of the haraka\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/"}]},{"type":"text","value":" directory, configure instead:"}]},{"type":"element","tag":"code","props":{"code":"key[]=/etc/ssl/private/example.com.rsa.key.pem\ncert[]=/etc/ssl/private/example.com.rsa.crt-chain.pem\nkey[]=/etc/ssl/private/example.com.ecdsa.key.pem\ncert[]=/etc/ssl/private/example.com.ecdsa.crt-chain.pem\n","language":"ini"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"key[]=/etc/ssl/private/example.com.rsa.key.pem\ncert[]=/etc/ssl/private/example.com.rsa.crt-chain.pem\nkey[]=/etc/ssl/private/example.com.ecdsa.key.pem\ncert[]=/etc/ssl/private/example.com.ecdsa.crt-chain.pem\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"cert"},"children":[{"type":"text","value":"cert"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Specifies the location(s) for the certificate chain file. For multiple certificate chains, use "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"cert[]="}]},{"type":"text","value":" assignment for each. Non-absolute paths are relative to the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/"}]},{"type":"text","value":" directory. See the description of the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"key"}]},{"type":"text","value":" parameter for specific use."}]},{"type":"element","tag":"h3","props":{"id":"no_tls_hosts"},"children":[{"type":"text","value":"no_tls_hosts"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If needed, add this section to the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/tls.ini"}]},{"type":"text","value":" file and list any IP ranges that have broken TLS hosts. Ex:"}]},{"type":"element","tag":"code","props":{"code":"[no_tls_hosts]\n192.168.1.3\n172.16.0.0/16\n","language":"ini"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"[no_tls_hosts]\n192.168.1.3\n172.16.0.0/16\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"a","props":{"href":"http://nodejs.org/api/tls.html","rel":["nofollow"]},"children":[{"type":"text","value":"Node.js TLS"}]},{"type":"text","value":" page has additional information about the following options."}]},{"type":"element","tag":"h3","props":{"id":"no_starttls_ports"},"children":[{"type":"text","value":"no_starttls_ports"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"An array of incoming ports on which Haraka will not advertise STARTTLS capability."}]},{"type":"element","tag":"code","props":{"code":"no_starttls_ports[]=2525\n","language":"ini"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"no_starttls_ports[]=2525\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"force_tls_hosts"},"children":[{"type":"text","value":"force_tls_hosts"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For known good TLS hosts, it's possible to force that the outbound mailer will only connect via secure sockets. This makes Haraka use "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"forced TLS"}]},{"type":"text","value":" instead of "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"opportunistic TLS"}]},{"type":"text","value":". For forced TLS, the STARTTLS upgrade must succeed with a valid certificate (overriding "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"rejectUnauthorized"}]},{"type":"text","value":"). The list is matched both against the host (MX record or "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"nexthop"}]},{"type":"text","value":" in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"relay_dest_domains.ini"}]},{"type":"text","value":"), and the domain name of the email address."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Note: unlike "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"no_tls_hosts"}]},{"type":"text","value":", this feature is implemented as an array:"}]},{"type":"element","tag":"code","props":{"code":"[outbound]\nforce_tls_hosts[]=172.17.123.1\nforce_tls_hosts[]=172.17.124.0/24\nforce_tls_hosts[]=mx.example.org\nforce_tls_hosts[]=example.com\n","language":"ini"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"[outbound]\nforce_tls_hosts[]=172.17.123.1\nforce_tls_hosts[]=172.17.124.0/24\nforce_tls_hosts[]=mx.example.org\nforce_tls_hosts[]=example.com\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"ciphers"},"children":[{"type":"text","value":"ciphers"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A list of allowable ciphers to use. Example:"}]},{"type":"element","tag":"code","props":{"code":"ciphers=EECDH+AESGCM:EDH+aRSA+AESGCM:EECDH+AES256:EDH+aRSA+AES256:EECDH+AES128:EDH+aRSA+AES128:RSA+AES:RSA+3DES\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"ciphers=EECDH+AESGCM:EDH+aRSA+AESGCM:EECDH+AES256:EDH+aRSA+AES256:EECDH+AES128:EDH+aRSA+AES128:RSA+AES:RSA+3DES\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"See also: "},{"type":"element","tag":"a","props":{"href":"https://ssl-config.mozilla.org/","rel":["nofollow"]},"children":[{"type":"text","value":"Mozilla SSL configuration generator"}]},{"type":"text","value":" and the "},{"type":"element","tag":"a","props":{"href":"https://www.ssllabs.com/ssltest/index.html","rel":["nofollow"]},"children":[{"type":"text","value":"SSLlabs Test Page"}]}]},{"type":"element","tag":"h3","props":{"id":"minversion"},"children":[{"type":"text","value":"minVersion"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Specifies minimum allowable TLS protocol version to use. Example:"}]},{"type":"element","tag":"code","props":{"code":" minVersion=TLSv1.1 \n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":" minVersion=TLSv1.1 \n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If unset, the default is node's tls.DEFAULT_MIN_VERSION constant."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"("},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Node.js 11.4+ required"}]},{"type":"text","value":", for older instances you can use "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"secureProtocol"}]},{"type":"text","value":" settings)"}]},{"type":"element","tag":"h3","props":{"id":"honorcipherorder"},"children":[{"type":"text","value":"honorCipherOrder"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If specified, the list of configured ciphers is treated as the cipher priority from highest to lowest. The first matching cipher will be used, instead of letting the client choose. The default is "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"true"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h3","props":{"id":"ecdhcurve"},"children":[{"type":"text","value":"ecdhCurve"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Specifies the elliptic curve used for ECDH or ECDHE ciphers.\nOnly one curve can be specified. The default is "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"prime256v1"}]},{"type":"text","value":" (NIST P-256)."}]},{"type":"element","tag":"h3","props":{"id":"dhparam"},"children":[{"type":"text","value":"dhparam"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Specifies the file containing the diffie-hellman parameters to use for DH or DHE key exchange. If this param or file is missing, it will be generated automatically. Default: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"dhparams.pem"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h3","props":{"id":"requestcert"},"children":[{"type":"text","value":"requestCert"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Whether Haraka should request a certificate from a connecting client."}]},{"type":"element","tag":"code","props":{"code":"requestCert=[true|false]  (default: true)\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"requestCert=[true|false]  (default: true)\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"rejectunauthorized"},"children":[{"type":"text","value":"rejectUnauthorized"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Reject connections from clients without a CA validated TLS certificate."}]},{"type":"element","tag":"code","props":{"code":"rejectUnauthorized=[true|false]  (default: false)\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"rejectUnauthorized=[true|false]  (default: false)\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"requireauthorized"},"children":[{"type":"text","value":"requireAuthorized"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"rejectUnauthorized=false"}]},{"type":"text","value":", require validated TLS certificates on just the specified ports."}]},{"type":"element","tag":"code","props":{"code":"requireAuthorized[]=465;\nrequireAuthorized[]=587;\n","language":"ini"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"requireAuthorized[]=465;\nrequireAuthorized[]=587;\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"secureprotocol"},"children":[{"type":"text","value":"secureProtocol"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Specifies the OpenSSL API function used for handling the TLS session. Choose\none of the methods described at the\n"},{"type":"element","tag":"a","props":{"href":"https://www.openssl.org/docs/manmaster/ssl/ssl.html","rel":["nofollow"]},"children":[{"type":"text","value":"OpenSSL API page"}]},{"type":"text","value":".\nThe default is "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"SSLv23_method"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h3","props":{"id":"requestocsp"},"children":[{"type":"text","value":"requestOCSP"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Specifies that OCSP Stapling should be enabled, according to RFC 6066.\nStapling of OCSP messages allows the client to receive these along the\nTLS session setup instead of delaying the session setup by requiring a\nseparate http connection to the OCSP server."}]},{"type":"element","tag":"code","props":{"code":"requestOCSP=[true|false]  (default: false)\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"requestOCSP=[true|false]  (default: false)\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"OCSP responses from the OCSP server are cached in memory for as long as\nthey are valid, and get refreshed after that time. A server restart\nrequires the OCSP responses to be fetched again upon the first client\nconnection."}]},{"type":"element","tag":"h2","props":{"id":"inbound-specific-configuration"},"children":[{"type":"text","value":"Inbound Specific Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"By default the above options are shared with outbound mail (either\nusing "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"smtp_forward"}]},{"type":"text","value":", "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"smtp_proxy"}]},{"type":"text","value":" or plain outbound mail heading to\nan external destination). To make these options specific to inbound\nmail, put them under an "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[inbound]"}]},{"type":"text","value":" parameter group. Outbound options\ncan go under an "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[outbound]"}]},{"type":"text","value":" parameter group, and plugins that use\nSMTP tls for queueing such as "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"smtp_proxy"}]},{"type":"text","value":" and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"smtp_forward"}]},{"type":"text","value":" can\nuse that plugin name for plugin specific options."}]},{"type":"element","tag":"h2","props":{"id":"redis-section"},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[redis]"}]},{"type":"text","value":" section"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This section is mainly used to enable so called "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"TLS NO-GO"}]},{"type":"text","value":" feature that essentially stops advertising/using TLS if there was a problem setting it up previously. We use "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"no_tls|ip.add.re.ss"}]},{"type":"text","value":" key to store the flag in redis. There are a couple of settings that control the behavior:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"disable_for_failed_hosts = true"}]},{"type":"text","value":" to enable the feature"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"disable_expiry = 604800"}]},{"type":"text","value":" to set for how long we disable TLS for failing host, in seconds"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"disable_inbound_expiry = 3600"}]},{"type":"text","value":" same as above, but applies to inbound (aka STARTTLS capability) only"}]}]},"navigation":{"title":"tls"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"tls-plugin"},"children":[{"type":"text","value":"TLS plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin enables the use of TLS (via "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"STARTTLS"}]},{"type":"text","value":") in Haraka."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For this plugin to work you must have SSL certificates installed correctly."}]},{"type":"element","tag":"h2","props":{"id":"certificate-files"},"children":[{"type":"text","value":"Certificate Files"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Defaults are shown and can be overridden in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/tls.ini"}]},{"type":"text","value":"."}]},{"type":"element","tag":"code","props":{"code":"key=tls_key.pem\ncert=tls_cert.pem\ndhparam=dhparams.pem\n","language":"ini"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-af32b9"},"children":[{"type":"text","value":"key"}]},{"type":"element","tag":"span","props":{"class":"ct-5041ba"},"children":[{"type":"text","value":"=tls_key.pem"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-af32b9"},"children":[{"type":"text","value":"cert"}]},{"type":"element","tag":"span","props":{"class":"ct-5041ba"},"children":[{"type":"text","value":"=tls_cert.pem"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-af32b9"},"children":[{"type":"text","value":"dhparam"}]},{"type":"element","tag":"span","props":{"class":"ct-5041ba"},"children":[{"type":"text","value":"=dhparams.pem"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"certificate-directory"},"children":[{"type":"text","value":"Certificate Directory"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If the directory "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/tls"}]},{"type":"text","value":" exists, each file within the directory is expected to be a PEM encoded TLS bundle. Generate the PEM bundles in The Usual Way"},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"TM"}]},{"type":"text","value":" by concatenating the key, certificate, and CA/chain certs in that order. Example:"}]},{"type":"element","tag":"code","props":{"code":"cat example.com.key example.com.crt ca.crt > config/tls/example.com.pem\n","language":"sh"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5041ba"},"children":[{"type":"text","value":"cat example.com.key example.com.crt ca.crt "}]},{"type":"element","tag":"span","props":{"class":"ct-af32b9"},"children":[{"type":"text","value":">"}]},{"type":"element","tag":"span","props":{"class":"ct-5041ba"},"children":[{"type":"text","value":" config/tls/example.com.pem"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"An example "},{"type":"element","tag":"a","props":{"href":"https://acme.sh","rel":["nofollow"]},"children":[{"type":"text","value":"acme.sh"}]},{"type":"text","value":" deployment "},{"type":"element","tag":"a","props":{"href":"https://github.com/msimerson/Mail-Toaster-6/blob/master/provision/letsencrypt.sh","rel":["nofollow"]},"children":[{"type":"text","value":"script"}]},{"type":"text","value":" demonstrates how to install "},{"type":"element","tag":"a","props":{"href":"https://letsencrypt.org","rel":["nofollow"]},"children":[{"type":"text","value":"Let's Encrypt"}]},{"type":"text","value":" certificates to the Haraka "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/tls"}]},{"type":"text","value":"directory."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Haraka has "},{"type":"element","tag":"a","props":{"href":"https://en.wikipedia.org/wiki/Server_Name_Indication","rel":["nofollow"]},"children":[{"type":"text","value":"SNI"}]},{"type":"text","value":" support. When the remote MUA/MTA presents a servername during the TLS handshake and a TLS certificate with that Common Name matches, that certificate will be presented. If no match is found, the default certificate (see Certificate Files above) is presented."}]},{"type":"element","tag":"h2","props":{"id":"purchased-certificate"},"children":[{"type":"text","value":"Purchased Certificate"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you have a purchased certificate, append any intermediate/chained/ca-cert\nfiles to the certificate in this order:"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The CA signed SSL cert"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Any intermediate certificates"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The CA root certificate"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"See also "},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/wiki/Setting-up-TLS-with-CA-certificates","rel":["nofollow"]},"children":[{"type":"text","value":"Setting Up TLS"}]}]},{"type":"element","tag":"h2","props":{"id":"self-issued-unsigned-certificate"},"children":[{"type":"text","value":"Self Issued (unsigned) Certificate"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Create a certificate and key file in the config directory with the following\ncommand:"}]},{"type":"element","tag":"code","props":{"code":"openssl req -x509 -nodes -days 2190 -newkey rsa:2048 -keyout config/tls_key.pem -out config/tls_cert.pem\n","language":"sh"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5041ba"},"children":[{"type":"text","value":"openssl req -x509 -nodes -days 2190 -newkey rsa:2048 -keyout config/tls_key.pem -out config/tls_cert.pem"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You will be prompted to provide details of your organization. Make sure the\nCommon Name is set to your servers Fully Qualified Domain Name, which should\nbe the same as the contents of your "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/me"}]},{"type":"text","value":" file."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The following settings can be specified in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/tls.ini"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h3","props":{"id":"key"},"children":[{"type":"text","value":"key"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Specifies an alternative location for the key file. For multiple keys, use "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"key[]="}]},{"type":"text","value":" assignment for each. Non-absolute paths are relative to the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/"}]},{"type":"text","value":" directory."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To configure a single key and a cert chain, located in the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/"}]},{"type":"text","value":"\ndirectory, use the following in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"tls.ini"}]},{"type":"text","value":":"}]},{"type":"element","tag":"code","props":{"code":"key=example.com.key.pem\ncert=example.com.crt-chain.pem\n","language":"ini"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-af32b9"},"children":[{"type":"text","value":"key"}]},{"type":"element","tag":"span","props":{"class":"ct-5041ba"},"children":[{"type":"text","value":"=example.com.key.pem"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-af32b9"},"children":[{"type":"text","value":"cert"}]},{"type":"element","tag":"span","props":{"class":"ct-5041ba"},"children":[{"type":"text","value":"=example.com.crt-chain.pem"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To use multiple pairs of key and cert chain files outside of the haraka\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/"}]},{"type":"text","value":" directory, configure instead:"}]},{"type":"element","tag":"code","props":{"code":"key[]=/etc/ssl/private/example.com.rsa.key.pem\ncert[]=/etc/ssl/private/example.com.rsa.crt-chain.pem\nkey[]=/etc/ssl/private/example.com.ecdsa.key.pem\ncert[]=/etc/ssl/private/example.com.ecdsa.crt-chain.pem\n","language":"ini"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5041ba"},"children":[{"type":"text","value":"key[]=/etc/ssl/private/example.com.rsa.key.pem"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5041ba"},"children":[{"type":"text","value":"cert[]=/etc/ssl/private/example.com.rsa.crt-chain.pem"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5041ba"},"children":[{"type":"text","value":"key[]=/etc/ssl/private/example.com.ecdsa.key.pem"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5041ba"},"children":[{"type":"text","value":"cert[]=/etc/ssl/private/example.com.ecdsa.crt-chain.pem"}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"cert"},"children":[{"type":"text","value":"cert"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Specifies the location(s) for the certificate chain file. For multiple certificate chains, use "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"cert[]="}]},{"type":"text","value":" assignment for each. Non-absolute paths are relative to the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/"}]},{"type":"text","value":" directory. See the description of the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"key"}]},{"type":"text","value":" parameter for specific use."}]},{"type":"element","tag":"h3","props":{"id":"no_tls_hosts"},"children":[{"type":"text","value":"no_tls_hosts"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If needed, add this section to the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"config/tls.ini"}]},{"type":"text","value":" file and list any IP ranges that have broken TLS hosts. Ex:"}]},{"type":"element","tag":"code","props":{"code":"[no_tls_hosts]\n192.168.1.3\n172.16.0.0/16\n","language":"ini"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d5c37"},"children":[{"type":"text","value":"[no_tls_hosts]"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5041ba"},"children":[{"type":"text","value":"192.168.1.3"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5041ba"},"children":[{"type":"text","value":"172.16.0.0/16"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"a","props":{"href":"http://nodejs.org/api/tls.html","rel":["nofollow"]},"children":[{"type":"text","value":"Node.js TLS"}]},{"type":"text","value":" page has additional information about the following options."}]},{"type":"element","tag":"h3","props":{"id":"no_starttls_ports"},"children":[{"type":"text","value":"no_starttls_ports"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"An array of incoming ports on which Haraka will not advertise STARTTLS capability."}]},{"type":"element","tag":"code","props":{"code":"no_starttls_ports[]=2525\n","language":"ini"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5041ba"},"children":[{"type":"text","value":"no_starttls_ports[]=2525"}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"force_tls_hosts"},"children":[{"type":"text","value":"force_tls_hosts"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For known good TLS hosts, it's possible to force that the outbound mailer will only connect via secure sockets. This makes Haraka use "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"forced TLS"}]},{"type":"text","value":" instead of "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"opportunistic TLS"}]},{"type":"text","value":". For forced TLS, the STARTTLS upgrade must succeed with a valid certificate (overriding "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"rejectUnauthorized"}]},{"type":"text","value":"). The list is matched both against the host (MX record or "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"nexthop"}]},{"type":"text","value":" in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"relay_dest_domains.ini"}]},{"type":"text","value":"), and the domain name of the email address."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Note: unlike "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"no_tls_hosts"}]},{"type":"text","value":", this feature is implemented as an array:"}]},{"type":"element","tag":"code","props":{"code":"[outbound]\nforce_tls_hosts[]=172.17.123.1\nforce_tls_hosts[]=172.17.124.0/24\nforce_tls_hosts[]=mx.example.org\nforce_tls_hosts[]=example.com\n","language":"ini"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7d5c37"},"children":[{"type":"text","value":"[outbound]"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5041ba"},"children":[{"type":"text","value":"force_tls_hosts[]=172.17.123.1"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5041ba"},"children":[{"type":"text","value":"force_tls_hosts[]=172.17.124.0/24"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5041ba"},"children":[{"type":"text","value":"force_tls_hosts[]=mx.example.org"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5041ba"},"children":[{"type":"text","value":"force_tls_hosts[]=example.com"}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"ciphers"},"children":[{"type":"text","value":"ciphers"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A list of allowable ciphers to use. Example:"}]},{"type":"element","tag":"code","props":{"code":"ciphers=EECDH+AESGCM:EDH+aRSA+AESGCM:EECDH+AES256:EDH+aRSA+AES256:EECDH+AES128:EDH+aRSA+AES128:RSA+AES:RSA+3DES\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"ciphers=EECDH+AESGCM:EDH+aRSA+AESGCM:EECDH+AES256:EDH+aRSA+AES256:EECDH+AES128:EDH+aRSA+AES128:RSA+AES:RSA+3DES"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"See also: "},{"type":"element","tag":"a","props":{"href":"https://ssl-config.mozilla.org/","rel":["nofollow"]},"children":[{"type":"text","value":"Mozilla SSL configuration generator"}]},{"type":"text","value":" and the "},{"type":"element","tag":"a","props":{"href":"https://www.ssllabs.com/ssltest/index.html","rel":["nofollow"]},"children":[{"type":"text","value":"SSLlabs Test Page"}]}]},{"type":"element","tag":"h3","props":{"id":"minversion"},"children":[{"type":"text","value":"minVersion"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Specifies minimum allowable TLS protocol version to use. Example:"}]},{"type":"element","tag":"code","props":{"code":" minVersion=TLSv1.1 \n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":" minVersion=TLSv1.1 "}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If unset, the default is node's tls.DEFAULT_MIN_VERSION constant."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"("},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Node.js 11.4+ required"}]},{"type":"text","value":", for older instances you can use "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"secureProtocol"}]},{"type":"text","value":" settings)"}]},{"type":"element","tag":"h3","props":{"id":"honorcipherorder"},"children":[{"type":"text","value":"honorCipherOrder"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If specified, the list of configured ciphers is treated as the cipher priority from highest to lowest. The first matching cipher will be used, instead of letting the client choose. The default is "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"true"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h3","props":{"id":"ecdhcurve"},"children":[{"type":"text","value":"ecdhCurve"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Specifies the elliptic curve used for ECDH or ECDHE ciphers.\nOnly one curve can be specified. The default is "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"prime256v1"}]},{"type":"text","value":" (NIST P-256)."}]},{"type":"element","tag":"h3","props":{"id":"dhparam"},"children":[{"type":"text","value":"dhparam"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Specifies the file containing the diffie-hellman parameters to use for DH or DHE key exchange. If this param or file is missing, it will be generated automatically. Default: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"dhparams.pem"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h3","props":{"id":"requestcert"},"children":[{"type":"text","value":"requestCert"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Whether Haraka should request a certificate from a connecting client."}]},{"type":"element","tag":"code","props":{"code":"requestCert=[true|false]  (default: true)\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"requestCert=[true|false]  (default: true)"}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"rejectunauthorized"},"children":[{"type":"text","value":"rejectUnauthorized"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Reject connections from clients without a CA validated TLS certificate."}]},{"type":"element","tag":"code","props":{"code":"rejectUnauthorized=[true|false]  (default: false)\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"rejectUnauthorized=[true|false]  (default: false)"}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"requireauthorized"},"children":[{"type":"text","value":"requireAuthorized"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"rejectUnauthorized=false"}]},{"type":"text","value":", require validated TLS certificates on just the specified ports."}]},{"type":"element","tag":"code","props":{"code":"requireAuthorized[]=465;\nrequireAuthorized[]=587;\n","language":"ini"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5041ba"},"children":[{"type":"text","value":"requireAuthorized[]=465"}]},{"type":"element","tag":"span","props":{"class":"ct-e8083d"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5041ba"},"children":[{"type":"text","value":"requireAuthorized[]=587"}]},{"type":"element","tag":"span","props":{"class":"ct-e8083d"},"children":[{"type":"text","value":";"}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"secureprotocol"},"children":[{"type":"text","value":"secureProtocol"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Specifies the OpenSSL API function used for handling the TLS session. Choose\none of the methods described at the\n"},{"type":"element","tag":"a","props":{"href":"https://www.openssl.org/docs/manmaster/ssl/ssl.html","rel":["nofollow"]},"children":[{"type":"text","value":"OpenSSL API page"}]},{"type":"text","value":".\nThe default is "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"SSLv23_method"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h3","props":{"id":"requestocsp"},"children":[{"type":"text","value":"requestOCSP"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Specifies that OCSP Stapling should be enabled, according to RFC 6066.\nStapling of OCSP messages allows the client to receive these along the\nTLS session setup instead of delaying the session setup by requiring a\nseparate http connection to the OCSP server."}]},{"type":"element","tag":"code","props":{"code":"requestOCSP=[true|false]  (default: false)\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"requestOCSP=[true|false]  (default: false)"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"OCSP responses from the OCSP server are cached in memory for as long as\nthey are valid, and get refreshed after that time. A server restart\nrequires the OCSP responses to be fetched again upon the first client\nconnection."}]},{"type":"element","tag":"h2","props":{"id":"inbound-specific-configuration"},"children":[{"type":"text","value":"Inbound Specific Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"By default the above options are shared with outbound mail (either\nusing "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"smtp_forward"}]},{"type":"text","value":", "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"smtp_proxy"}]},{"type":"text","value":" or plain outbound mail heading to\nan external destination). To make these options specific to inbound\nmail, put them under an "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[inbound]"}]},{"type":"text","value":" parameter group. Outbound options\ncan go under an "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[outbound]"}]},{"type":"text","value":" parameter group, and plugins that use\nSMTP tls for queueing such as "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"smtp_proxy"}]},{"type":"text","value":" and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"smtp_forward"}]},{"type":"text","value":" can\nuse that plugin name for plugin specific options."}]},{"type":"element","tag":"h2","props":{"id":"redis-section"},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[redis]"}]},{"type":"text","value":" section"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This section is mainly used to enable so called "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"TLS NO-GO"}]},{"type":"text","value":" feature that essentially stops advertising/using TLS if there was a problem setting it up previously. We use "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"no_tls|ip.add.re.ss"}]},{"type":"text","value":" key to store the flag in redis. There are a couple of settings that control the behavior:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"disable_for_failed_hosts = true"}]},{"type":"text","value":" to enable the feature"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"disable_expiry = 604800"}]},{"type":"text","value":" to set for how long we disable TLS for failing host, in seconds"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"disable_inbound_expiry = 3600"}]},{"type":"text","value":" same as above, but applies to inbound (aka STARTTLS capability) only"}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-e8083d{color:#6E7781}\n.ct-7d5c37{color:#953800}\n.ct-5041ba{color:#24292F}\n.ct-af32b9{color:#CF222E}\n.dark .ct-af32b9{color:#FF7B72}\n.dark .ct-5041ba{color:#C9D1D9}\n.dark .ct-7d5c37{color:#FFA657}\n.dark .ct-e8083d{color:#8B949E}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"certificate-files","depth":2,"text":"Certificate Files"},{"id":"certificate-directory","depth":2,"text":"Certificate Directory"},{"id":"purchased-certificate","depth":2,"text":"Purchased Certificate"},{"id":"self-issued-unsigned-certificate","depth":2,"text":"Self Issued (unsigned) Certificate"},{"id":"configuration","depth":2,"text":"Configuration","children":[{"id":"key","depth":3,"text":"key"},{"id":"cert","depth":3,"text":"cert"},{"id":"no_tls_hosts","depth":3,"text":"no_tls_hosts"},{"id":"no_starttls_ports","depth":3,"text":"no_starttls_ports"},{"id":"force_tls_hosts","depth":3,"text":"force_tls_hosts"},{"id":"ciphers","depth":3,"text":"ciphers"},{"id":"minversion","depth":3,"text":"minVersion"},{"id":"honorcipherorder","depth":3,"text":"honorCipherOrder"},{"id":"ecdhcurve","depth":3,"text":"ecdhCurve"},{"id":"dhparam","depth":3,"text":"dhparam"},{"id":"requestcert","depth":3,"text":"requestCert"},{"id":"rejectunauthorized","depth":3,"text":"rejectUnauthorized"},{"id":"requireauthorized","depth":3,"text":"requireAuthorized"},{"id":"secureprotocol","depth":3,"text":"secureProtocol"},{"id":"requestocsp","depth":3,"text":"requestOCSP"}]},{"id":"inbound-specific-configuration","depth":2,"text":"Inbound Specific Configuration"},{"id":"redis-section","depth":2,"text":"[redis] section"}]}},"_type":"markdown","_id":"content:8.plugins:tls.md","_source":"content","_file":"8.plugins/tls.md","_extension":"md"},{"_path":"/plugins/toobusy","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"toobusy - Reject connections when the server is too busy","description":"Haraka toobusy plugin - Reject connections when the server is too busy","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"toobusy-plugin"},"children":[{"type":"text","value":"TooBusy plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin will stop Haraka accepting new connections when the event loop\nlatency is too high."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"See "},{"type":"element","tag":"a","props":{"href":"https://github.com/STRML/node-toobusy","rel":["nofollow"]},"children":[{"type":"text","value":"node-toobusy"}]},{"type":"text","value":" for details."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To use this plugin you have to install the 'toobusy-js' module by running\n'npm install toobusy-js' in your Haraka configuration directory."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin should be listed at the top of your config/plugins file so that\nit runs before any other plugin that hooks lookup_rdns."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you wish to override the default maxLag value of 70ms then add the desired\nvalue to config/toobusy.maxlag.  This can be set and changed at runtime and\nno restart is required."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Note that if you set the maxLag value to <10 then this will cause the toobusy\nmodule to raise an exception which will cause Haraka to stop."}]}]},"navigation":{"title":"toobusy"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"toobusy-plugin"},"children":[{"type":"text","value":"TooBusy plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin will stop Haraka accepting new connections when the event loop\nlatency is too high."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"See "},{"type":"element","tag":"a","props":{"href":"https://github.com/STRML/node-toobusy","rel":["nofollow"]},"children":[{"type":"text","value":"node-toobusy"}]},{"type":"text","value":" for details."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To use this plugin you have to install the 'toobusy-js' module by running\n'npm install toobusy-js' in your Haraka configuration directory."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin should be listed at the top of your config/plugins file so that\nit runs before any other plugin that hooks lookup_rdns."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you wish to override the default maxLag value of 70ms then add the desired\nvalue to config/toobusy.maxlag.  This can be set and changed at runtime and\nno restart is required."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Note that if you set the maxLag value to <10 then this will cause the toobusy\nmodule to raise an exception which will cause Haraka to stop."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"configuration","depth":2,"text":"Configuration"}]}},"_type":"markdown","_id":"content:8.plugins:toobusy.md","_source":"content","_file":"8.plugins/toobusy.md","_extension":"md"},{"_path":"/plugins/watch","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"watch - smtp connections in HTTP browser","description":"Haraka watch plugin - smtp connections in HTTP browser","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"watch-plugin"},"children":[{"type":"text","value":"Watch plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Watch SMTP traffic to your Haraka server in a web interface."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Watch Screen Capture","src":"http://www.tnpi.net/internet/mail/haraka-watch.png"},"children":[]}]},{"type":"element","tag":"h2","props":{"id":"enable-watch"},"children":[{"type":"text","value":"Enable Watch"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Enable Haraka's HTTP server (see "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"listen"}]},{"type":"text","value":" in http.ini)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Add 'watch' to config/plugins"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Point your web browser at "},{"type":"element","tag":"a","props":{"href":"http://mail.example.com/watch/","rel":["nofollow"]},"children":[{"type":"text","value":"http://mail.example.com/watch/"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Enjoy the blinky lights."}]},{"type":"element","tag":"h2","props":{"id":"tips"},"children":[{"type":"text","value":"Tips"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Hover your mouse pointer or tap (with touch devices) on table data to see more\ndetails."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Copy that connection UUID at left and use it to grep your logs for even more."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Edit the files in watch/html and play with the appearance. If you make it\nbetter, post a screen shot somewhere and create an Issue or PR."}]}]},{"type":"element","tag":"h2","props":{"id":"interpretation-key"},"children":[{"type":"text","value":"Interpretation Key"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Green: tests passed"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Light Green: tests passed, but with conditions"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Yellow: poor results, but not awful."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Light red: tests failed, but no rejection"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Red: tests failed causing rejection"}]}]}]},"navigation":{"title":"watch"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"watch-plugin"},"children":[{"type":"text","value":"Watch plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Watch SMTP traffic to your Haraka server in a web interface."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Watch Screen Capture","src":"http://www.tnpi.net/internet/mail/haraka-watch.png"},"children":[]}]},{"type":"element","tag":"h2","props":{"id":"enable-watch"},"children":[{"type":"text","value":"Enable Watch"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Enable Haraka's HTTP server (see "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"listen"}]},{"type":"text","value":" in http.ini)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Add 'watch' to config/plugins"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Point your web browser at "},{"type":"element","tag":"a","props":{"href":"http://mail.example.com/watch/","rel":["nofollow"]},"children":[{"type":"text","value":"http://mail.example.com/watch/"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Enjoy the blinky lights."}]},{"type":"element","tag":"h2","props":{"id":"tips"},"children":[{"type":"text","value":"Tips"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Hover your mouse pointer or tap (with touch devices) on table data to see more\ndetails."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Copy that connection UUID at left and use it to grep your logs for even more."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Edit the files in watch/html and play with the appearance. If you make it\nbetter, post a screen shot somewhere and create an Issue or PR."}]}]},{"type":"element","tag":"h2","props":{"id":"interpretation-key"},"children":[{"type":"text","value":"Interpretation Key"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Green: tests passed"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Light Green: tests passed, but with conditions"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Yellow: poor results, but not awful."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Light red: tests failed, but no rejection"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Red: tests failed causing rejection"}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"enable-watch","depth":2,"text":"Enable Watch"},{"id":"tips","depth":2,"text":"Tips"},{"id":"interpretation-key","depth":2,"text":"Interpretation Key"}]}},"_type":"markdown","_id":"content:8.plugins:watch.md","_source":"content","_file":"8.plugins/watch.md","_extension":"md"},{"_path":"/plugins/xclient","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"xclient - XCLIENT support for Haraka","description":"Haraka xclient plugin - XCLIENT support for Haraka","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"xclient-plugin"},"children":[{"type":"text","value":"XClient plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Implements the "},{"type":"element","tag":"a","props":{"href":"http://www.postfix.org/XCLIENT_README.html","rel":["nofollow"]},"children":[{"type":"text","value":"XCLIENT"}]},{"type":"text","value":" protocol."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"configuration"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"xclient.hosts"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"A list of IP addresses, one per line that should be allowed to use the\nXCLIENT protocol.  Localhost (127.0.0.1 or ::1) is allowed implicitly."}]}]}]},"navigation":{"title":"xclient"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"xclient-plugin"},"children":[{"type":"text","value":"XClient plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Implements the "},{"type":"element","tag":"a","props":{"href":"http://www.postfix.org/XCLIENT_README.html","rel":["nofollow"]},"children":[{"type":"text","value":"XCLIENT"}]},{"type":"text","value":" protocol."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"configuration"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"xclient.hosts"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"A list of IP addresses, one per line that should be allowed to use the\nXCLIENT protocol.  Localhost (127.0.0.1 or ::1) is allowed implicitly."}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"configuration","depth":2,"text":"configuration"}]}},"_type":"markdown","_id":"content:8.plugins:xclient.md","_source":"content","_file":"8.plugins/xclient.md","_extension":"md"},{"_path":"/barelf","_dir":"","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"Bare Line Feeds sent to Haraka","description":"Bare Line Feeds sent to Haraka","excerpt":{"type":"root","children":[{"type":"element","tag":"h3","props":{"id":"bare-lfs-in-smtp"},"children":[{"type":"text","value":"Bare LFs in SMTP"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Most likely you're here because your mailer displayed the pointer\r\n``See "},{"type":"element","tag":"a","props":{"href":"http://haraka.github.com/barelf.html","rel":["nofollow"]},"children":[{"type":"text","value":"http://haraka.github.com/barelf.html"}]},{"type":"text","value":"''"}]},{"type":"element","tag":"h2","props":{"id":"where-did-that-pointer-come-from"},"children":[{"type":"text","value":"Where did that pointer come from?"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It was generated by "},{"type":"element","tag":"nuxt-link","props":{"to":"/"},"children":[{"type":"text","value":"Haraka"}]},{"type":"text","value":", an Internet message transfer agent. Your mailer tried to send an e-mail message to a server running Haraka.\r\nUnfortunately, Haraka spotted a problem: your mailer sent a bare LF."}]},{"type":"element","tag":"h3","props":{"id":"why-should-i-worry-about-bare-lfs"},"children":[{"type":"text","value":"Why should I worry about bare LFs?"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can't get mail through to msn.com and thousands of other systems around the Internet. Your mailer is violating 822bis section 2.3, which specifically prohibits all bare LFs."}]},{"type":"element","tag":"h3","props":{"id":"how-can-my-mailer-be-fixed"},"children":[{"type":"text","value":"How can my mailer be fixed?"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"That depends on what software you're using."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Solaris 2.5 sendmail:"}]},{"type":"text","value":"\r\nUpgrade!\r\nFixed in Solaris 2.5.1.\r\nYou can fix the problem by putting ``,E=\\r\\n''\r\nat the end of Mether, Mtcp, or Msmtp in sendmail.cf.\r\n(Note that Mether is not the same as DMether.)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"sendmail V8 has a bug that will produce a bare LF in certain messages (e.g., messages with very long lines). This bug was identified in November 1996; I don't know if it has been fixed yet."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Eudora Pro 4.0 for Windows:"}]},{"type":"text","value":"\r\nUpgrade!\r\nThe HTML LF problem was fixed in 4.0.1.\r\nThe attachment LF problem was fixed in 4.1."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"listproc 6.0c:"}]},{"type":"text","value":"\r\nChuck Foster says you should add "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"CONVERT(buf);'' before "}]},{"type":"text","value":"WRITE_TO_SOCKET'' around line 165 of sysmail.c\r\nin the Listproc source code."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"fetchmail:"}]},{"type":"text","value":"\r\nUpgrade!\r\nRecent versions of fetchmail reportedly do the right thing.\r\nMake sure the forcecr option is on."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Galacticom WorldGroups:"}]},{"type":"text","value":"\r\nReported 19970716. No information yet on how it can be fixed."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Claris Emailer:"}]},{"type":"text","value":"\r\nReported 19980613. No information yet on how it can be fixed."}]},{"type":"element","tag":"h3","props":{"id":"what-is-a-bare-lf-anyway"},"children":[{"type":"text","value":"What is a bare LF, anyway?"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It is an ASCII linefeed (LF) character not preceded by an ASCII carriage-return (CR) character.\r\nEvery line in an Internet mail message is required to end with CR LF. The entire message ends with CR LF dot CR LF.  822bis specifically prohibits other uses of LF.\r\nThe mail clients discussed above are incorrectly ending lines with LF and, in most cases, ending the entire message with LF dot LF.\r\nThat's not CR LF dot CR LF, so a server such as msn.com will sit there waiting for the rest of the message. After a while it'll give up and drop the connection.\r\nYour mail doesn't get through."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Some mail servers convert a bare LF into CR LF, and accept LF dot LF as the end of a mail message. This behavior is specifically prohibited by 821bis (and RFC 2821)."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This document was taken from "},{"type":"element","tag":"a","props":{"href":"http://cr.yp.to/docs/smtplf.html","rel":["nofollow"]},"children":[{"type":"text","value":"http://cr.yp.to/docs/smtplf.html"}]}]}]},"navigation":false,"aside":false,"body":{"type":"root","children":[{"type":"element","tag":"h3","props":{"id":"bare-lfs-in-smtp"},"children":[{"type":"text","value":"Bare LFs in SMTP"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Most likely you're here because your mailer displayed the pointer\r\n``See "},{"type":"element","tag":"a","props":{"href":"http://haraka.github.com/barelf.html","rel":["nofollow"]},"children":[{"type":"text","value":"http://haraka.github.com/barelf.html"}]},{"type":"text","value":"''"}]},{"type":"element","tag":"h2","props":{"id":"where-did-that-pointer-come-from"},"children":[{"type":"text","value":"Where did that pointer come from?"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It was generated by "},{"type":"element","tag":"nuxt-link","props":{"to":"/"},"children":[{"type":"text","value":"Haraka"}]},{"type":"text","value":", an Internet message transfer agent. Your mailer tried to send an e-mail message to a server running Haraka.\r\nUnfortunately, Haraka spotted a problem: your mailer sent a bare LF."}]},{"type":"element","tag":"h3","props":{"id":"why-should-i-worry-about-bare-lfs"},"children":[{"type":"text","value":"Why should I worry about bare LFs?"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can't get mail through to msn.com and thousands of other systems around the Internet. Your mailer is violating 822bis section 2.3, which specifically prohibits all bare LFs."}]},{"type":"element","tag":"h3","props":{"id":"how-can-my-mailer-be-fixed"},"children":[{"type":"text","value":"How can my mailer be fixed?"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"That depends on what software you're using."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Solaris 2.5 sendmail:"}]},{"type":"text","value":"\r\nUpgrade!\r\nFixed in Solaris 2.5.1.\r\nYou can fix the problem by putting ``,E=\\r\\n''\r\nat the end of Mether, Mtcp, or Msmtp in sendmail.cf.\r\n(Note that Mether is not the same as DMether.)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"sendmail V8 has a bug that will produce a bare LF in certain messages (e.g., messages with very long lines). This bug was identified in November 1996; I don't know if it has been fixed yet."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Eudora Pro 4.0 for Windows:"}]},{"type":"text","value":"\r\nUpgrade!\r\nThe HTML LF problem was fixed in 4.0.1.\r\nThe attachment LF problem was fixed in 4.1."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"listproc 6.0c:"}]},{"type":"text","value":"\r\nChuck Foster says you should add "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"CONVERT(buf);'' before "}]},{"type":"text","value":"WRITE_TO_SOCKET'' around line 165 of sysmail.c\r\nin the Listproc source code."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"fetchmail:"}]},{"type":"text","value":"\r\nUpgrade!\r\nRecent versions of fetchmail reportedly do the right thing.\r\nMake sure the forcecr option is on."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Galacticom WorldGroups:"}]},{"type":"text","value":"\r\nReported 19970716. No information yet on how it can be fixed."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Claris Emailer:"}]},{"type":"text","value":"\r\nReported 19980613. No information yet on how it can be fixed."}]},{"type":"element","tag":"h3","props":{"id":"what-is-a-bare-lf-anyway"},"children":[{"type":"text","value":"What is a bare LF, anyway?"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It is an ASCII linefeed (LF) character not preceded by an ASCII carriage-return (CR) character.\r\nEvery line in an Internet mail message is required to end with CR LF. The entire message ends with CR LF dot CR LF.  822bis specifically prohibits other uses of LF.\r\nThe mail clients discussed above are incorrectly ending lines with LF and, in most cases, ending the entire message with LF dot LF.\r\nThat's not CR LF dot CR LF, so a server such as msn.com will sit there waiting for the rest of the message. After a while it'll give up and drop the connection.\r\nYour mail doesn't get through."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Some mail servers convert a bare LF into CR LF, and accept LF dot LF as the end of a mail message. This behavior is specifically prohibited by 821bis (and RFC 2821)."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This document was taken from "},{"type":"element","tag":"a","props":{"href":"http://cr.yp.to/docs/smtplf.html","rel":["nofollow"]},"children":[{"type":"text","value":"http://cr.yp.to/docs/smtplf.html"}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"bare-lfs-in-smtp","depth":3,"text":"Bare LFs in SMTP"},{"id":"where-did-that-pointer-come-from","depth":2,"text":"Where did that pointer come from?","children":[{"id":"why-should-i-worry-about-bare-lfs","depth":3,"text":"Why should I worry about bare LFs?"},{"id":"how-can-my-mailer-be-fixed","depth":3,"text":"How can my mailer be fixed?"},{"id":"what-is-a-bare-lf-anyway","depth":3,"text":"What is a bare LF, anyway?"}]}]}},"_type":"markdown","_id":"content:barelf.md","_source":"content","_file":"barelf.md","_extension":"md"}],"navigation":[{"title":"Getting Started","_path":"/getting_started"},{"title":"About","_path":"/about"},{"title":"Community","_path":"/community"},{"title":"Known Users","_path":"/users"},{"title":"Core","_path":"/core","children":[{"title":"Address Object","_path":"/core/Address"},{"title":"Body Object","_path":"/core/Body"},{"title":"Config","_path":"/core/Config"},{"title":"Connection Object","_path":"/core/Connection"},{"title":"Core Configuration Files","_path":"/core/CoreConfig"},{"title":"Custom Return Codes","_path":"/core/CustomReturnCodes"},{"title":"HAProxy","_path":"/core/HAProxy"},{"title":"Header Object","_path":"/core/Header"},{"title":"Net_Utils","_path":"/core/Net_Utils"},{"title":"Outbound","_path":"/core/Outbound"},{"title":"Plugins","_path":"/core/Plugins"},{"title":"Results","_path":"/core/Results"},{"title":"Transaction Object","_path":"/core/Transaction"}]},{"title":"Tutorials","_path":"/tutorials","children":[{"title":"Migrating from v1 to v2","_path":"/tutorials/migrating_from_v1_to_v2"},{"title":"Configuring Outbound","_path":"/tutorials/settingupoutbound"},{"title":"Writing Plugins","_path":"/tutorials/tutorial"}]},{"title":"Plugins","_path":"/plugins","children":[{"title":"access","_path":"/plugins/access"},{"title":"aliases","_path":"/plugins/aliases"},{"title":"attachment","_path":"/plugins/attachment"},{"title":"Auth","_path":"/plugins/auth","children":[{"title":"auth/auth_bridge","_path":"/plugins/auth/auth_bridge"},{"title":"auth/auth_ldap","_path":"/plugins/auth/auth_ldap"},{"title":"auth/auth_proxy","_path":"/plugins/auth/auth_proxy"},{"title":"auth/auth_vpopmaild","_path":"/plugins/auth/auth_vpopmaild"},{"title":"auth/flat_file","_path":"/plugins/auth/flat_file"}]},{"title":"avg","_path":"/plugins/avg"},{"title":"backscatterer","_path":"/plugins/backscatterer"},{"title":"block_me","_path":"/plugins/block_me"},{"title":"bounce","_path":"/plugins/bounce"},{"title":"clamd","_path":"/plugins/clamd"},{"title":"connect.asn","_path":"/plugins/connect.asn"},{"title":"connect.fcrdns","_path":"/plugins/connect.fcrdns"},{"title":"geoip","_path":"/plugins/connect.geoip"},{"title":"connect.p0f","_path":"/plugins/connect.p0f"},{"title":"connect.rdns_access","_path":"/plugins/connect.rdns_access"},{"title":"daemonize","_path":"/plugins/daemonize"},{"title":"data.headers","_path":"/plugins/data.headers"},{"title":"data.signatures","_path":"/plugins/data.signatures"},{"title":"data.uribl","_path":"/plugins/data.uribl"},{"title":"dcc","_path":"/plugins/dcc"},{"title":"delay_deny","_path":"/plugins/delay_deny"},{"title":"dkim_sign","_path":"/plugins/dkim_sign"},{"title":"dkim_verify","_path":"/plugins/dkim_verify"},{"title":"dnsbl","_path":"/plugins/dnsbl"},{"title":"dnswl","_path":"/plugins/dnswl"},{"title":"early_talker","_path":"/plugins/early_talker"},{"title":"esets","_path":"/plugins/esets"},{"title":"graph","_path":"/plugins/graph"},{"title":"greylist","_path":"/plugins/greylist"},{"title":"helo.checks","_path":"/plugins/helo.checks"},{"title":"karma","_path":"/plugins/karma"},{"title":"limit","_path":"/plugins/limit"},{"title":"log.elasticsearch","_path":"/plugins/log.elasticsearch"},{"title":"log.syslog","_path":"/plugins/log.syslog"},{"title":"mail_from.access","_path":"/plugins/mail_from.access"},{"title":"mail_from.is_resolvable","_path":"/plugins/mail_from.is_resolvable"},{"title":"max_unrecognized_commands","_path":"/plugins/max_unrecognized_commands"},{"title":"messagesniffer","_path":"/plugins/messagesniffer"},{"title":"prevent_credential_leaks","_path":"/plugins/prevent_credential_leaks"},{"title":"process_title","_path":"/plugins/process_title"},{"title":"Queue","_path":"/plugins/queue","children":[{"title":"queue/deliver","_path":"/plugins/queue/deliver"},{"title":"discard","_path":"/plugins/queue/discard"},{"title":"queue/lmtp","_path":"/plugins/queue/lmtp"},{"title":"queue/qmail-queue","_path":"/plugins/queue/qmail-queue"},{"title":"quarantine","_path":"/plugins/queue/quarantine"},{"title":"queue/rabbitmq_amqplib","_path":"/plugins/queue/rabbitmq_amqplib"},{"title":"queue/rabbitmq","_path":"/plugins/queue/rabbitmq"},{"title":"queue/smtp_bridge","_path":"/plugins/queue/smtp_bridge"},{"title":"queue/smtp_forward","_path":"/plugins/queue/smtp_forward"},{"title":"queue/smtp_proxy","_path":"/plugins/queue/smtp_proxy"}]},{"title":"rate_limit","_path":"/plugins/rate_limit"},{"title":"rcpt_to.access","_path":"/plugins/rcpt_to.access"},{"title":"rcpt_to.in_host_list","_path":"/plugins/rcpt_to.in_host_list"},{"title":"rcpt_to.ldap.js","_path":"/plugins/rcpt_to.ldap"},{"title":"rcpt_to.max_count","_path":"/plugins/rcpt_to.max_count"},{"title":"rcpt_to.qmail_deliverable","_path":"/plugins/rcpt_to.qmail_deliverable"},{"title":"rcpt_to.routes","_path":"/plugins/rcpt_to.routes"},{"title":"record_envelope_addresses","_path":"/plugins/record_envelope_addresses"},{"title":"redis","_path":"/plugins/redis"},{"title":"relay_acl","_path":"/plugins/relay_acl"},{"title":"relay_all","_path":"/plugins/relay_all"},{"title":"relay_force_routing","_path":"/plugins/relay_force_routing"},{"title":"relay","_path":"/plugins/relay"},{"title":"reseed_rng","_path":"/plugins/reseed_rng"},{"title":"rspamd","_path":"/plugins/rspamd"},{"title":"spamassassin","_path":"/plugins/spamassassin"},{"title":"spf","_path":"/plugins/spf"},{"title":"status","_path":"/plugins/status"},{"title":"tarpit","_path":"/plugins/tarpit"},{"title":"tls","_path":"/plugins/tls"},{"title":"toobusy","_path":"/plugins/toobusy"},{"title":"watch","_path":"/plugins/watch"},{"title":"xclient","_path":"/plugins/xclient"}]}]}