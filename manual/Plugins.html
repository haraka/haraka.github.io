<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Meta, title, CSS, favicons, etc. -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Haraka Manual &raquo; Writing Haraka Plugins</title>
    
    <!-- Bootstrap core CSS -->
    <link href="/css/bootstrap.css" rel="stylesheet">

    <!-- Documentation extras -->
    <link href="/css/docs.css" rel="stylesheet">
    <link href="/css/pygments-manni.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="/js/html5shiv.js"></script>
      <script src="/js/respond.min.js"></script>
    <![endif]-->

    </head>
      <body class="bs-docs-home">
        <a class="sr-only" href="#content">Skip navigation</a>

        <!-- Docs master nav -->
        <header class="navbar navbar-inverse navbar-fixed-top bs-docs-nav" role="banner">
          <div class="container">
            <div class="navbar-header">
              <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a href="/" class="navbar-brand">Haraka</a>
            </div>
            <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
              <ul class="nav navbar-nav">
                <li>
                  <a href="/about.html">About</a>
                </li>
                <li>
                  <a href="/community.html">Community</a>
                </li>
                <li>
                  <a href="/users.html">Known Users</a>
                </li>
                <li>
                  <a href="https://github.com/baudehlo/Haraka">Source on Github</a>
                </li>
                <li class="active">
                  <a href="/manual.html">Manual</a>
                </li>
              </ul>
            </nav>
          </div>
        </header>
        
        <!-- Docs page layout -->
        <div class="bs-header" id="content">
          <div class="container">
            <h1>Writing Haraka Plugins</h1>
          </div>
        </div>
        
        <div class="container bs-docs-container">
          <div class="row">
            <div class="col-md-3">
              <div id="chapternav" class="bs-sidebar hidden-print" role="complementary">
                <ul class="nav bs-sidenav"><li><a class="submenu" data-toggle="collapse" data-target="#core" data-parent="#chapternav" href="javascript:void(null);">Core</a>
<ul id='core' class='nav'>
<li><a href='/README.html'>Haraka</a></li>
<li><a href='/manual/Address.html'>Address Object</a></li>
<li><a href='/manual/Body.html'>Body Object</a></li>
<li><a href='/manual/Config.html'>Config Files</a></li>
<li><a href='/manual/Connection.html'>Connection Object</a></li>
<li><a href='/manual/CoreConfig.html'>Core Configuration Files</a></li>
<li><a href='/manual/CustomReturnCodes.html'>Custom Return Codes</a></li>
<li><a href='/manual/HAProxy.html'>HAProxy PROXY protocol extension support</a></li>
<li><a href='/manual/Header.html'>Header Object</a></li>
<li><a href='/manual/Logging_API.html'>Logging API</a></li>
<li><a href='/manual/Net_Utils.html'>Net_Utils</a></li>
<li><a href='/manual/Outbound.html'>Outbound Mail with Haraka</a></li>
<li class="active"><a href='/manual/Plugins.html'>Writing Haraka Plugins</a></li>
<li><a href='/manual/Transaction.html'>Transaction Object</a></li>
</ul></li>
<li><a class="submenu" data-toggle="collapse" data-target="#tutorials" data-parent="#chapternav" href="javascript:void(null);">Tutorials</a>
<ul id='tutorials' class='nav'>
<li><a href='/manual/Tutorial.html'>Writing Haraka Plugins</a></li>
<li><a href='/manual/tutorials/Migrating_from_v1_to_v2.html'>Migrating from Haraka v1.x to v2.x</a></li>
<li><a href='/manual/tutorials/SettingUpOutbound.html'>Configuring Haraka For Outbound Email</a></li>
</ul></li>
<li><a class="submenu" data-toggle="collapse" data-target="#plugins" data-parent="#chapternav" href="javascript:void(null);">Plugins</a>
<ul id='plugins' class='nav'>
<li><a href='/manual/plugins/auth/auth_ldap.html'>auth/auth_ldap</a></li>
<li><a href='/manual/plugins/auth/auth_proxy.html'>auth/auth_proxy</a></li>
<li><a href='/manual/plugins/auth/flat_file.html'>auth/flat_file</a></li>
<li><a href='/manual/plugins/queue/deliver.html'>queue/deliver</a></li>
<li><a href='/manual/plugins/queue/discard.html'>discard</a></li>
<li><a href='/manual/plugins/queue/lmtp.html'>queue/lmtp</a></li>
<li><a href='/manual/plugins/queue/qmail-queue.html'>queue/qmail-queue</a></li>
<li><a href='/manual/plugins/queue/quarantine.html'>quarantine</a></li>
<li><a href='/manual/plugins/queue/smtp_forward.html'>queue/smtp_forward</a></li>
<li><a href='/manual/plugins/queue/smtp_proxy.html'>queue/smtp_proxy</a></li>
<li><a href='/manual/plugins/aliases.html'>aliases</a></li>
<li><a href='/manual/plugins/attachment.html'>attachment</a></li>
<li><a href='/manual/plugins/avg.html'>avg</a></li>
<li><a href='/manual/plugins/block_me.html'>block_me</a></li>
<li><a href='/manual/plugins/bounces.html'>bounce</a></li>
<li><a href='/manual/plugins/clamd.html'>clamd</a></li>
<li><a href='/manual/plugins/connect.geoip.html'>geoip</a></li>
<li><a href='/manual/plugins/connect.p0f.html'>connect.p0f - A TCP Fingerprinting Plugin</a></li>
<li><a href='/manual/plugins/connect.rdns_access.html'>connect.rdns_access</a></li>
<li><a href='/manual/plugins/daemonize.html'>daemonize</a></li>
<li><a href='/manual/plugins/data.headers.html'>data.headers</a></li>
<li><a href='/manual/plugins/data.nomsgid.html'>data.nomsgid</a></li>
<li><a href='/manual/plugins/data.noreceived.html'>data.noreceived</a></li>
<li><a href='/manual/plugins/data.rfc5322_header_checks.html'>data.rfc5322_header_checks</a></li>
<li><a href='/manual/plugins/data.signatures.html'>data.signatures</a></li>
<li><a href='/manual/plugins/data.uribl.html'>data.uribl</a></li>
<li><a href='/manual/plugins/delay_deny.html'>delay_deny</a></li>
<li><a href='/manual/plugins/dkim_sign.html'>dkim_sign</a></li>
<li><a href='/manual/plugins/dnsbl.html'>dnsbl</a></li>
<li><a href='/manual/plugins/dnswl.html'>dnswl</a></li>
<li><a href='/manual/plugins/early_talker.html'>early_talker</a></li>
<li><a href='/manual/plugins/graph.html'>graph</a></li>
<li><a href='/manual/plugins/helo.checks.html'>helo.checks</a></li>
<li><a href='/manual/plugins/karma.html'>karma - reward good and penalize bad mail senders</a></li>
<li><a href='/manual/plugins/log.syslog.html'>log.syslog</a></li>
<li><a href='/manual/plugins/lookup_rdns.strict.html'>lookup_rdns.strict</a></li>
<li><a href='/manual/plugins/mail_from.access.html'>mail_from.access</a></li>
<li><a href='/manual/plugins/mail_from.blocklist.html'>mail_from.blocklist</a></li>
<li><a href='/manual/plugins/mail_from.is_resolvable.html'>mail_from.is_resolvable</a></li>
<li><a href='/manual/plugins/mail_from.nobounces.html'>mail_from.nobounces</a></li>
<li><a href='/manual/plugins/max_unrecognized_commands.html'>max_unrecognized_commands</a></li>
<li><a href='/manual/plugins/messagesniffer.html'>messagesniffer</a></li>
<li><a href='/manual/plugins/process_title.html'>process_title</a></li>
<li><a href='/manual/plugins/rate_limit.html'>rate_limit</a></li>
<li><a href='/manual/plugins/rcpt_to.access.html'>rcpt_to.access</a></li>
<li><a href='/manual/plugins/rcpt_to.blocklist.html'>rcpt_to.blocklist</a></li>
<li><a href='/manual/plugins/rcpt_to.in_host_list.html'>rcpt_to.in_host_list</a></li>
<li><a href='/manual/plugins/rcpt_to.max_count.html'>rcpt_to.max_count</a></li>
<li><a href='/manual/plugins/rcpt_to.qmail_deliverable.html'>qmail_deliverable</a></li>
<li><a href='/manual/plugins/rdns.regexp.html'>rdns.regexp</a></li>
<li><a href='/manual/plugins/relay_acl.html'>relay_acl</a></li>
<li><a href='/manual/plugins/relay_all.html'>relay_all</a></li>
<li><a href='/manual/plugins/relay_force_routing.html'>relay_force_routing.js</a></li>
<li><a href='/manual/plugins/reseed_rng.html'>reseed_rng</a></li>
<li><a href='/manual/plugins/spamassassin.html'>spamassassin</a></li>
<li><a href='/manual/plugins/spf.html'>spf</a></li>
<li><a href='/manual/plugins/tarpit.html'>tarpit</a></li>
<li><a href='/manual/plugins/tls.html'>tls</a></li>
<li><a href='/manual/plugins/toobusy.html'>toobusy</a></li>
<li><a href='/manual/plugins/xclient.html'>XCLIENT</a></li>
</ul></li></ul>

              </div>
            </div>
            
            <div class="col-md-9" role="main">
              <div class="bs-docs-section">
                <h1>Writing Haraka Plugins</h1>

<p>All aspects of receiving an email in Haraka are controlled via plugins, to the
extent that no mail will even be received unless you have a minimum of a 'rcpt'
plugin and a 'queue' plugin.</p>

<p>The 'rcpt' plugin is used to determine if a particular recipient should be
allowed to be relayed or received for. The 'queue' plugin queue's the email
somewhere - perhaps to disk, or perhaps to an onward SMTP server.</p>

<h2>Anatomy of a Plugin</h2>

<p>Plugins in Haraka are simply Javascript files in the plugins/ directory.</p>

<p>To enable a plugin, simply add its name to <code>config/plugins</code>.</p>

<p>In order to hook into the "rcpt" event, simply create a method in exports
to hook it:</p>

<pre><code>exports.hook_rcpt = function (next, connection, params) {
    // email address is in params[0]
    // do something with the address... then call:
    next();
};
</code></pre>

<p>We've introduced a couple of new concepts here, so let's go through them:</p>

<ul>
<li>next - we need to call this when we are done processing or Haraka will
hang.</li>
<li>exports - the plugin acts as an object (with access to "this" if you need it)
but methods go directly into exports.</li>
</ul>

<p>The next() method is the most critical thing here - since Haraka is an event based
SMTP server, we may need to go off and fetch network information before we
can return a result. We can do that asynchronously and simply run next()
when we are done, which allows Haraka to go on processing other clients while
we fetch our information.</p>

<p>See "The Next Function" below for more details.</p>

<h2>Logging</h2>

<p>Plugins inherit all the logging methods of <code>logger.js</code>, which are:</p>

<ul>
<li>logprotocol</li>
<li>logdebug</li>
<li>loginfo</li>
<li>lognotice</li>
<li>logwarn</li>
<li>logerror</li>
<li>logcrit</li>
<li>logalert</li>
<li>logemerg</li>
</ul>

<p>It should also be noted that if plugins throw an exception directly when in a
hook the exception will be caught and generate a logcrit level error. However
they will not be caught quite as gracefully if you are in async code within
your plugin. Use error codes for that, log the error, and run your next()
function appropriately.</p>

<h2>Multiple Hooks</h2>

<p>You can hook the same event multipe times, to do that provide a register()
method and hook it:</p>

<pre><code>exports.register = function() {
    this.register_hook('queue', 'try_queue_my_way');
    this.register_hook('queue', 'try_queue_highway');
};
</code></pre>

<p>Then when the earlier hook calls <code>next()</code> (without parameters) it continues on
to the next hook you registered to try that one.</p>

<h1>The Next Function</h1>

<p>The next() function takes two optional parameters: <code>code</code> and <code>msg</code></p>

<p>The code is one of the below listed return values. The msg corresponds with
the string to send to the client in case of a failure. Use an Array if you need
to send back a multi-line response. The msg should NOT contain the code number
- that is taken care of by the Haraka internals.</p>

<h2>Return Values</h2>

<p>These constants are compiled into your plugin when it is loaded, you do not
need to define them:</p>

<ul>
<li><p>CONT</p>

<p>Continue and let other plugins handle this particular hook. This is the
default if no parameters are given.</p></li>
<li><p>DENY</p>

<p>Reject the mail with a 5xx error.</p></li>
<li><p>DENYSOFT</p>

<p>Reject the mail with a 4xx error.</p></li>
<li><p>DENYDISCONNECT</p>

<p>Reject the mail with a 5xx error and immediately disconnect.</p></li>
<li><p>DISCONNECT</p>

<p>Simply immediately disconnect</p></li>
<li><p>OK</p>

<p>Required by rcpt and queue plugins if we are to allow the email to be
accepted, or the queue was successful, respectively. </p>

<p>This also has a special meaning when used on deny hook.  Returning OK
on the deny hook will override the result to CONT.</p>

<p>Once a plugin calls next(OK) no further plugins on the same hook will 
run after it.</p></li>
<li><p>HOOK_NEXT</p>

<p>This is a special return value that is currently only available on the
<code>unrecognized_command</code> hook.  It instructs Haraka to run a different plugin
hook instead of responding normally.  The <code>msg</code> argument is required and
must be set to the name of the hook that is to be run.</p></li>
</ul>

<h2>Available Hooks</h2>

<p>These are just the name of the hook, with any parameter sent to it:</p>

<ul>
<li>init_master - called when the main (master) process is started</li>
<li>init_child - called whenever a child process is started when using multiple "nodes"</li>
<li>lookup_rdns - called to look up the rDNS - return the rDNS via <code>next(OK, rdns)</code></li>
<li>connect - called after we got rDNS</li>
<li>capabilities - called to get the ESMTP capabilities (such as STARTTLS)</li>
<li>unrecognized_command - called when the remote end sends a command we don't recognise</li>
<li>disconnect - called upon disconnect</li>
<li>helo (hostname)</li>
<li>ehlo (hostname)</li>
<li>quit</li>
<li>vrfy</li>
<li>noop</li>
<li>rset</li>
<li>mail ([from, esmtp_params])</li>
<li>rcpt ([to,   esmtp_params])</li>
<li>rcpt_ok (to)</li>
<li>data - called at the DATA command</li>
<li>data_post - called at the end-of-data marker</li>
<li>max_data_exceeded - called if the message is bigger than connection.max_bytes</li>
<li>queue - called to queue the mail</li>
<li>queue_outbound - called to queue the mail when connection.relaying is set</li>
<li>queue_ok - called when a mail has been queued successfully</li>
<li>reset_transaction - called before the transaction is reset (via RSET, or MAIL)</li>
<li>deny - called if a plugin returns one of DENY, DENYSOFT or DENYDISCONNECT</li>
<li>get_mx (hmail, domain) - called when sending outbound mail to lookup the MX record</li>
<li>bounce (hmail, err) - called when sending outbound mail if the mail would bounce</li>
<li>delivered (hmail, [host, ip, response, delay, port, mode, recipients]) - called
when outbound mail is delivered to the destination</li>
<li>send_email (hmail) - called when outbound is about to be sent</li>
</ul>

<p>The <code>rcpt</code> hook is slightly special. If we have a plugin (prior to rcpt) that
sets the <code>connection.relaying = true</code> flag, then we do not need any rcpt
hooks, or if we do, none of them need call <code>next(OK)</code>. However if
<code>connection.relaying</code> remains <code>false</code> (as is the default - you don't want an
open relay!), then one rcpt plugin MUST return <code>next(OK)</code> or your sender
will receive the error message "I cannot deliver for that user". The most
obvious choice for this activity is the <code>rcpt_to.in_host_list</code> plugin, which
lists the domains for which you wish to receive email.</p>

<p>If a rcpt plugin DOES call <code>next(OK)</code> then the <code>rcpt_ok</code> hook is run. This
is primarily used by the <code>queue/smtp_proxy</code> plugin which needs to run after
all rcpt hooks.</p>

<h2>Sharing State</h2>

<p>There are several cases where you might need to share information between
plugins.  This is done using <code>notes</code> - there are three types available:</p>

<ul>
<li><p>server.notes</p>

<p>Available in all plugins.  This is created at PID start-up and is shared
amongst all plugins on the same PID and listener.
Typical uses for notes at this level would be to share database
connections between multiple plugins or connection pools etc.</p></li>
<li><p>connection.notes</p>

<p>Available on any hook that passes 'connection' as a function parameter.
This is shared amongst all plugins for a single connection and is
destroyed after the client disconnects.
Typical uses for notes at this level would be to store information
about the connected client e.g. rDNS names, HELO/EHLO, white/black
list status etc.</p></li>
<li><p>connection.transaction.notes</p>

<p>Available on any hook that passes 'connection' as a function parameter
between hook_mail and hook_data_post.
This is shared amongst all plugins for this transaction (e.g. MAIL FROM
through until a message is received or the connection is reset).
Typical uses for notes at this level would be to store information
on things like greylisting which uses client, sender and recipient
information etc.</p></li>
</ul>

<p>All of these notes are simply a Javascript object underneath - so you use
them like a simple key/value store e.g.</p>

<pre><code>connection.transaction.notes.test = 'testing';
</code></pre>

<h2>Further Reading</h2>

<p>Now you want to read about the Connection object.</p>

              </div>
            </div>
          </div>
        </div>

        <footer class="container" role="contentinfo">
            <ul class="bs-masthead-links">
            <li>
            <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
            <input type="hidden" name="cmd" value="_s-xclick">
            <input type="hidden" name="encrypted" value="-----BEGIN PKCS7-----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-----END PKCS7-----
            ">
            <input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
            <img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
            </form>
            </li>
            </ul>
        </footer>
        
        <!-- Placed at the end of the document so the pages load faster -->
        <script src="/js/jquery.js"></script>
        <script src="/js/bootstrap.js"></script>
        <script src="/js/holder.js"></script>
        <!-- <script src="/js/application.js"></script> -->
        <script>
        $('.bs-sidebar ul ul').each(function (i, el) {
            if (!$(el).find('li.active').length) {
                $(el).collapse('toggle');
            }
        });
        $('a.submenu').on('touchstart', function(e) { e.stopPropagation(); });
        </script>

    </body>
</html>
